# Comparing `tmp/gdsfactory-6.90.9.tar.gz` & `tmp/gdsfactory-6.91.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "gdsfactory-6.90.9.tar", last modified: Tue May  2 04:45:44 2023, max compression
+gzip compressed data, was "gdsfactory-6.91.0.tar", last modified: Fri May  5 22:23:31 2023, max compression
```

## Comparing `gdsfactory-6.90.9.tar` & `gdsfactory-6.91.0.tar`

### file list

```diff
@@ -1,670 +1,667 @@
--rw-r--r--   0        0        0     1072 2023-05-02 04:45:27.993533 gdsfactory-6.90.9/LICENSE
--rw-r--r--   0        0        0    14276 2023-05-02 04:45:27.993533 gdsfactory-6.90.9/README.md
--rw-r--r--   0        0        0     3415 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/__init__.py
--rw-r--r--   0        0        0     2096 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_keepout.py
--rw-r--r--   0        0        0    12629 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_labels.py
--rw-r--r--   0        0        0     3711 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_loopback.py
--rw-r--r--   0        0        0     5054 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_padding.py
--rw-r--r--   0        0        0    15465 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_pins.py
--rw-r--r--   0        0        0    14700 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_ports.py
--rw-r--r--   0        0        0     2884 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_tapers.py
--rw-r--r--   0        0        0     2257 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_tapers_cross_section.py
--rw-r--r--   0        0        0     1831 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/add_termination.py
--rw-r--r--   0        0        0     1676 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/asserts.py
--rw-r--r--   0        0        0    11843 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/cell.py
--rw-r--r--   0        0        0    15946 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/circuitviz.py
--rw-r--r--   0        0        0     5325 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/cli.py
--rw-r--r--   0        0        0    99269 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/component.py
--rw-r--r--   0        0        0    23360 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/component_layout.py
--rw-r--r--   0        0        0    29699 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/component_reference.py
--rw-r--r--   0        0        0     1205 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/C.py
--rw-r--r--   0        0        0     1144 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/L.py
--rw-r--r--   0        0        0    20964 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/__init__.py
--rw-r--r--   0        0        0     2621 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/add_fiducials.py
--rw-r--r--   0        0        0    14087 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/add_grating_couplers.py
--rw-r--r--   0        0        0     2014 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/add_trenches.py
--rw-r--r--   0        0        0     3207 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/align.py
--rw-r--r--   0        0        0     2622 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/array_component.py
--rw-r--r--   0        0        0     4705 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/array_with_fanout.py
--rw-r--r--   0        0        0     4322 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/array_with_via.py
--rw-r--r--   0        0        0     4042 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/awg.py
--rw-r--r--   0        0        0     1269 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/bbox.py
--rw-r--r--   0        0        0     2851 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/bend_circular.py
--rw-r--r--   0        0        0     2649 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/bend_circular_heater.py
--rw-r--r--   0        0        0     7882 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/bend_euler.py
--rw-r--r--   0        0        0     2682 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/bend_port.py
--rw-r--r--   0        0        0     3664 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/bend_s.py
--rw-r--r--   0        0        0     5373 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/bezier.py
--rw-r--r--   0        0        0     1605 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/cavity.py
--rw-r--r--   0        0        0     5766 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/cdc.py
--rw-r--r--   0        0        0     2929 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/cdsem_all.py
--rw-r--r--   0        0        0     1788 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/cdsem_bend180.py
--rw-r--r--   0        0        0     1631 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/cdsem_coupler.py
--rw-r--r--   0        0        0     1412 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/cdsem_straight.py
--rw-r--r--   0        0        0     1565 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/cdsem_straight_density.py
--rw-r--r--   0        0        0      793 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/circle.py
--rw-r--r--   0        0        0     5722 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/coh_rx_dual_pol.py
--rw-r--r--   0        0        0     8922 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/coh_rx_single_pol.py
--rw-r--r--   0        0        0     5043 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/coh_tx_dual_pol.py
--rw-r--r--   0        0        0     6118 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/coh_tx_single_pol.py
--rw-r--r--   0        0        0     2548 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/compass.py
--rw-r--r--   0        0        0     9856 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/component_lattice.py
--rw-r--r--   0        0        0     7174 2023-05-02 04:45:28.001533 gdsfactory-6.90.9/gdsfactory/components/component_sequence.py
--rw-r--r--   0        0        0      812 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/copy_layers.py
--rw-r--r--   0        0        0     3460 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler.py
--rw-r--r--   0        0        0     2113 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler90.py
--rw-r--r--   0        0        0     1802 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler90bend.py
--rw-r--r--   0        0        0     4666 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler_adiabatic.py
--rw-r--r--   0        0        0     1909 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler_asymmetric.py
--rw-r--r--   0        0        0     3970 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler_full.py
--rw-r--r--   0        0        0     3414 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler_ring.py
--rw-r--r--   0        0        0     1060 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler_straight.py
--rw-r--r--   0        0        0     1164 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler_straight_asymmetric.py
--rw-r--r--   0        0        0     2192 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/coupler_symmetric.py
--rw-r--r--   0        0        0     1848 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/cross.py
--rw-r--r--   0        0        0    12873 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/crossing_waveguide.py
--rw-r--r--   0        0        0      500 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
--rw-r--r--   0        0        0     1014 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
--rw-r--r--   0        0        0    19749 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
--rw-r--r--   0        0        0    19751 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
--rw-r--r--   0        0        0    19749 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
--rw-r--r--   0        0        0    19751 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
--rw-r--r--   0        0        0    19775 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
--rw-r--r--   0        0        0     3143 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
--rw-r--r--   0        0        0     5272 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/cutback_2x2.py
--rw-r--r--   0        0        0     6450 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/cutback_bend.py
--rw-r--r--   0        0        0     3765 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/cutback_component.py
--rw-r--r--   0        0        0     2721 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/cutback_splitter.py
--rw-r--r--   0        0        0     2971 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/dbr.py
--rw-r--r--   0        0        0     4288 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/dbr_tapered.py
--rw-r--r--   0        0        0     2486 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/delay_snake.py
--rw-r--r--   0        0        0     3177 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/delay_snake2.py
--rw-r--r--   0        0        0     3237 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/delay_snake3.py
--rw-r--r--   0        0        0     4319 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/delay_snake_sbend.py
--rw-r--r--   0        0        0     1226 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/dicing_lane.py
--rw-r--r--   0        0        0     3471 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/die.py
--rw-r--r--   0        0        0     2975 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/die_bbox.py
--rw-r--r--   0        0        0     2863 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/die_bbox_frame.py
--rw-r--r--   0        0        0     8015 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/disk.py
--rw-r--r--   0        0        0     4112 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/edge_coupler_array.py
--rw-r--r--   0        0        0     1214 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/ellipse.py
--rw-r--r--   0        0        0     1800 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/extend_ports_list.py
--rw-r--r--   0        0        0     7944 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/extension.py
--rw-r--r--   0        0        0      981 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/fiber.py
--rw-r--r--   0        0        0     1432 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/fiber_array.py
--rw-r--r--   0        0        0      722 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/fiducial_squares.py
--rw-r--r--   0        0        0     3290 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/ge_detector_straight_si_contacts.py
--rw-r--r--   0        0        0     1063 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_array.py
--rw-r--r--   0        0        0     4682 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_dual_pol.py
--rw-r--r--   0        0        0     7110 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical.py
--rw-r--r--   0        0        0     7221 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
--rw-r--r--   0        0        0     4960 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical_lumerical.py
--rw-r--r--   0        0        0     4592 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical_trenches.py
--rw-r--r--   0        0        0     1773 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_functions.py
--rw-r--r--   0        0        0     9058 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_loss.py
--rw-r--r--   0        0        0     1786 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_loss_fiber_single.py
--rw-r--r--   0        0        0     4142 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_rectangular.py
--rw-r--r--   0        0        0     4685 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
--rw-r--r--   0        0        0     3887 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
--rw-r--r--   0        0        0     1578 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/grating_coupler_tree.py
--rw-r--r--   0        0        0     8773 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/greek_cross.py
--rw-r--r--   0        0        0     1019 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/hline.py
--rw-r--r--   0        0        0     3687 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/interdigital_capacitor.py
--rw-r--r--   0        0        0     1825 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/litho_calipers.py
--rw-r--r--   0        0        0     1244 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/litho_ruler.py
--rw-r--r--   0        0        0     1304 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/litho_steps.py
--rw-r--r--   0        0        0      650 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/logo.py
--rw-r--r--   0        0        0     1679 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/loop_mirror.py
--rw-r--r--   0        0        0     3873 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mmi1x2.py
--rw-r--r--   0        0        0     2814 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mmi1x2_with_sbend.py
--rw-r--r--   0        0        0     3858 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mmi2x2.py
--rw-r--r--   0        0        0     3299 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mmi2x2_with_sbend.py
--rw-r--r--   0        0        0     4947 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mmi_90degree_hybrid.py
--rw-r--r--   0        0        0     3265 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mode_converter.py
--rw-r--r--   0        0        0     7414 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzi.py
--rw-r--r--   0        0        0     2499 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzi_arm.py
--rw-r--r--   0        0        0     5835 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzi_arms.py
--rw-r--r--   0        0        0    12214 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzi_lattice.py
--rw-r--r--   0        0        0     4025 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzi_pads_center.py
--rw-r--r--   0        0        0     1064 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzi_phase_shifter.py
--rw-r--r--   0        0        0     6342 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzit.py
--rw-r--r--   0        0        0     3502 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzit_lattice.py
--rw-r--r--   0        0        0     6047 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/mzm.py
--rw-r--r--   0        0        0     3518 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/nxn.py
--rw-r--r--   0        0        0     1940 2023-05-02 04:45:28.005533 gdsfactory-6.90.9/gdsfactory/components/optimal_90deg.py
--rw-r--r--   0        0        0     3876 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/optimal_hairpin.py
--rw-r--r--   0        0        0     6131 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/optimal_step.py
--rw-r--r--   0        0        0     6327 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/pack_doe.py
--rw-r--r--   0        0        0     3860 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/pad.py
--rw-r--r--   0        0        0     1890 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/pad_gsg.py
--rw-r--r--   0        0        0     1157 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/pads_shorted.py
--rw-r--r--   0        0        0     3833 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/polarization_splitter_rotator.py
--rw-r--r--   0        0        0     1147 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ramp.py
--rw-r--r--   0        0        0     1508 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/rectangle.py
--rw-r--r--   0        0        0     2972 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/rectangle_with_slits.py
--rw-r--r--   0        0        0     1508 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/regular_polygon.py
--rw-r--r--   0        0        0     3302 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/resistance_meander.py
--rw-r--r--   0        0        0     2642 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/resistance_sheet.py
--rw-r--r--   0        0        0     1273 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring.py
--rw-r--r--   0        0        0     4143 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_crow.py
--rw-r--r--   0        0        0     3272 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_crow_couplers.py
--rw-r--r--   0        0        0     2267 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_double.py
--rw-r--r--   0        0        0     3846 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_double_heater.py
--rw-r--r--   0        0        0     7757 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_double_pn.py
--rw-r--r--   0        0        0    12137 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_section_based.py
--rw-r--r--   0        0        0     2719 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_single.py
--rw-r--r--   0        0        0     1968 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_single_array.py
--rw-r--r--   0        0        0     6098 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_single_bend_coupler.py
--rw-r--r--   0        0        0     2714 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_single_dut.py
--rw-r--r--   0        0        0     4018 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_single_heater.py
--rw-r--r--   0        0        0     5267 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/ring_single_pn.py
--rw-r--r--   0        0        0     2282 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/seal_ring.py
--rw-r--r--   0        0        0     3758 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/snspd.py
--rw-r--r--   0        0        0     2059 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/spiral_double.py
--rw-r--r--   0        0        0     5871 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/spiral_external_io.py
--rw-r--r--   0        0        0    16658 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/spiral_heater.py
--rw-r--r--   0        0        0     9181 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/spiral_inner_io.py
--rw-r--r--   0        0        0     1754 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/splitter_chain.py
--rw-r--r--   0        0        0     5327 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/splitter_tree.py
--rw-r--r--   0        0        0     2526 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight.py
--rw-r--r--   0        0        0     1033 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_array.py
--rw-r--r--   0        0        0     7914 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_heater_doped_rib.py
--rw-r--r--   0        0        0     1922 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_heater_doped_strip.py
--rw-r--r--   0        0        0     7891 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_heater_meander.py
--rw-r--r--   0        0        0     8090 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_heater_meander_doped.py
--rw-r--r--   0        0        0     5686 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_heater_metal.py
--rw-r--r--   0        0        0     2809 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_pin.py
--rw-r--r--   0        0        0     3974 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_pin_slot.py
--rw-r--r--   0        0        0      655 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/straight_rib.py
--rw-r--r--   0        0        0      820 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/switch_tree.py
--rw-r--r--   0        0        0     7713 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/taper.py
--rw-r--r--   0        0        0     3530 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/taper_adiabatic.py
--rw-r--r--   0        0        0     2457 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/taper_cross_section.py
--rw-r--r--   0        0        0     2363 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/taper_from_csv.py
--rw-r--r--   0        0        0     1215 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/taper_parabolic.py
--rw-r--r--   0        0        0     1635 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/terminator.py
--rw-r--r--   0        0        0     2913 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/text.py
--rw-r--r--   0        0        0     3821 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/text_freetype.py
--rw-r--r--   0        0        0     3156 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/text_rectangular.py
--rw-r--r--   0        0        0     3943 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/text_rectangular_font.py
--rw-r--r--   0        0        0     2536 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/triangles.py
--rw-r--r--   0        0        0      715 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/verniers.py
--rw-r--r--   0        0        0     2468 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/version_stamp.py
--rw-r--r--   0        0        0     2436 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/via.py
--rw-r--r--   0        0        0     3060 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/via_corner.py
--rw-r--r--   0        0        0     5342 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/via_cutback.py
--rw-r--r--   0        0        0    15574 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/via_stack.py
--rw-r--r--   0        0        0     4554 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/via_stack_slot.py
--rw-r--r--   0        0        0     4944 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/via_stack_with_offset.py
--rw-r--r--   0        0        0     1088 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/wafer.py
--rw-r--r--   0        0        0     2542 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/wire.py
--rw-r--r--   0        0        0      978 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/components/wire_sbend.py
--rw-r--r--   0        0        0     7736 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/config.py
--rw-r--r--   0        0        0      481 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/conftest.py
--rw-r--r--   0        0        0    38409 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/constants.py
--rw-r--r--   0        0        0     1476 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/containers.py
--rw-r--r--   0        0        0    82607 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/cross_section.py
--rw-r--r--   0        0        0     2974 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/decorators.py
--rw-r--r--   0        0        0     6810 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/difftest.py
--rw-r--r--   0        0        0      988 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/events.py
--rw-r--r--   0        0        0      204 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/export/__init__.py
--rw-r--r--   0        0        0     3353 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/export/to_3d.py
--rw-r--r--   0        0        0     1940 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/export/to_np.py
--rw-r--r--   0        0        0     3058 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/export/to_stl.py
--rw-r--r--   0        0        0     7438 2023-05-02 04:45:28.009533 gdsfactory-6.90.9/gdsfactory/export/write_gerbers.py
--rw-r--r--   0        0        0     2968 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/filestorage.py
--rw-r--r--   0        0        0    11802 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/fill.py
--rw-r--r--   0        0        0     7799 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/font.py
--rw-r--r--   0        0        0     8073 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/functions.py
--rw-r--r--   0        0        0       20 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/.gitattributes
--rw-r--r--   0        0        0       83 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/.gitconfig
--rw-r--r--   0        0        0       72 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/__init__.py
--rw-r--r--   0        0        0     1069 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/gds_diff_git.py
--rw-r--r--   0        0        0     2935 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/gdsdiff.py
--rw-r--r--   0        0        0      708 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/install.py
--rw-r--r--   0        0        0      271 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/sample.py
--rw-r--r--   0        0        0     1059 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/gdsdiff/test_xor.py
--rw-r--r--   0        0        0     1722 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/__init__.py
--rw-r--r--   0        0        0     8142 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/get_klayout_pyxs.py
--rw-r--r--   0        0        0       44 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/README.md
--rw-r--r--   0        0        0      104 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/Makefile
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/__init__.py
--rw-r--r--   0        0        0     2842 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/errors.py
--rw-r--r--   0        0        0      579 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/generic.drc
--rw-r--r--   0        0        0     2929 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/generic.lydrc
--rw-r--r--   0        0        0     1014 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/write_drc.py
--rw-r--r--   0        0        0     6193 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/grain.xml
--rw-r--r--   0        0        0    10140 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/icon_128x128.png
--rw-r--r--   0        0        0     4248 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/icon_64x64.png
--rw-r--r--   0        0        0    10945 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
--rw-r--r--   0        0        0     5031 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/klive.lym
--rw-r--r--   0        0        0      710 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
--rw-r--r--   0        0        0      538 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/python/__init__.py
--rw-r--r--   0        0        0      114 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
--rw-r--r--   0        0        0     4303 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
--rw-r--r--   0        0        0      269 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/Makefile
--rw-r--r--   0        0        0     1519 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/generic.layerstack
--rw-r--r--   0        0        0    40153 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/layers.lyp
--rw-r--r--   0        0        0     5884 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/tech.lyt
--rw-r--r--   0        0        0     4258 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
--rw-r--r--   0        0        0     4537 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
--rw-r--r--   0        0        0     4690 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
--rw-r--r--   0        0        0     5508 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
--rw-r--r--   0        0        0     1855 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/layer_map.py
--rw-r--r--   0        0        0     6472 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/layer_stack.py
--rw-r--r--   0        0        0    10547 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/layer_views.yaml
--rw-r--r--   0        0        0      158 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/generic_tech/simulation_settings.py
--rw-r--r--   0        0        0     1337 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/__init__.py
--rw-r--r--   0        0        0     4644 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/boolean.py
--rw-r--r--   0        0        0     3814 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/boolean_klayout.py
--rw-r--r--   0        0        0     1904 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/boolean_polygons.py
--rw-r--r--   0        0        0      522 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/check_duplicated_cells.py
--rw-r--r--   0        0        0     2719 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/check_exclusion.py
--rw-r--r--   0        0        0     2829 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/check_inclusion.py
--rw-r--r--   0        0        0     3566 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/check_space.py
--rw-r--r--   0        0        0     1904 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/check_width.py
--rw-r--r--   0        0        0     5005 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/fill_klayout.py
--rw-r--r--   0        0        0     7084 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/fill_tiled.py
--rw-r--r--   0        0        0     1247 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/fillet.py
--rw-r--r--   0        0        0     6664 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/functions.py
--rw-r--r--   0        0        0     1991 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/invert.py
--rw-r--r--   0        0        0     3685 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/layer_priority.py
--rw-r--r--   0        0        0     2683 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/manhattanize.py
--rw-r--r--   0        0        0     4192 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/maskprep.py
--rw-r--r--   0        0        0     4744 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/maskprep_flat.py
--rw-r--r--   0        0        0     2797 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/offset.py
--rw-r--r--   0        0        0     3842 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/outline.py
--rw-r--r--   0        0        0     2255 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/trim.py
--rw-r--r--   0        0        0     2713 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/union.py
--rw-r--r--   0        0        0     9629 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/write_drc.py
--rw-r--r--   0        0        0     1783 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/geometry/xor_diff.py
--rw-r--r--   0        0        0     1158 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/get_factories.py
--rw-r--r--   0        0        0    23562 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/get_netlist.py
--rw-r--r--   0        0        0    14426 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/get_netlist_flat.py
--rw-r--r--   0        0        0      682 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/get_netlist_klayout.py
--rw-r--r--   0        0        0     9455 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/grid.py
--rw-r--r--   0        0        0     4363 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/install.py
--rw-r--r--   0        0        0     1340 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/klive.py
--rw-r--r--   0        0        0      585 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/labels/__init__.py
--rw-r--r--   0        0        0     3563 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/labels/add_label_yaml.py
--rw-r--r--   0        0        0     3847 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/labels/ehva.py
--rw-r--r--   0        0        0     3810 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/labels/merge_test_metadata.py
--rw-r--r--   0        0        0     4668 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/labels/siepic.py
--rw-r--r--   0        0        0     4847 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/labels/write_labels.py
--rw-r--r--   0        0        0     1149 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/materials.py
--rw-r--r--   0        0        0     5247 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/name.py
--rw-r--r--   0        0        0    11237 2023-05-02 04:45:28.013533 gdsfactory-6.90.9/gdsfactory/pack.py
--rw-r--r--   0        0        0    50880 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/path.py
--rw-r--r--   0        0        0    25849 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/pdk.py
--rw-r--r--   0        0        0     6170 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/picmodel.py
--rw-r--r--   0        0        0     5068 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/pixelate.py
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/dagster/__init__.py
--rw-r--r--   0        0        0      976 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/dagster/workflow.py
--rw-r--r--   0        0        0      566 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/README.md
--rw-r--r--   0        0        0     1592 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/__init__.py
--rw-r--r--   0        0        0     6272 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/db_upload.py
--rw-r--r--   0        0        0    16143 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/models.py
--rw-r--r--   0        0        0      747 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/psycopg2.py
--rw-r--r--   0        0        0     1115 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/serialization.py
--rw-r--r--   0        0        0      660 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/simulation_models.py
--rw-r--r--   0        0        0      171 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/plugins/database/sql_base.py
--rw-r--r--   0        0        0    32084 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/port.py
--rw-r--r--   0        0        0    37609 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/quickplotter.py
--rw-r--r--   0        0        0      696 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/__init__.py
--rw-r--r--   0        0        0     1639 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/from_dphox.py
--rw-r--r--   0        0        0     1285 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/from_gdspaths.py
--rw-r--r--   0        0        0     1953 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/from_np.py
--rw-r--r--   0        0        0     2813 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/from_phidl.py
--rw-r--r--   0        0        0    38082 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/from_yaml.py
--rw-r--r--   0        0        0     5897 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/from_yaml_template.py
--rw-r--r--   0        0        0     5688 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/import_gds.py
--rw-r--r--   0        0        0     3407 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/read/labels.py
--rw-r--r--   0        0        0     3769 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/__init__.py
--rw-r--r--   0        0        0     2920 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/add_electrical_pads_shortest.py
--rw-r--r--   0        0        0     3015 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/add_electrical_pads_top.py
--rw-r--r--   0        0        0     3035 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/add_electrical_pads_top_dc.py
--rw-r--r--   0        0        0     8715 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/add_fiber_array.py
--rw-r--r--   0        0        0    10624 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/add_fiber_single.py
--rw-r--r--   0        0        0     8967 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/add_pads.py
--rw-r--r--   0        0        0    38940 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/all_angle.py
--rw-r--r--   0        0        0     3916 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/auto_taper.py
--rw-r--r--   0        0        0      982 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/factories.py
--rw-r--r--   0        0        0     4415 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/fanout.py
--rw-r--r--   0        0        0     2800 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/fanout2x2.py
--rw-r--r--   0        0        0    24342 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_bundle.py
--rw-r--r--   0        0        0     8632 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_bundle_corner.py
--rw-r--r--   0        0        0     6900 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_bundle_from_steps.py
--rw-r--r--   0        0        0    12949 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_bundle_from_waypoints.py
--rw-r--r--   0        0        0     5284 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_bundle_path_length_match.py
--rw-r--r--   0        0        0     1937 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_bundle_sbend.py
--rw-r--r--   0        0        0    17064 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_bundle_u.py
--rw-r--r--   0        0        0     1510 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_input_labels.py
--rw-r--r--   0        0        0     9233 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_route.py
--rw-r--r--   0        0        0    10824 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_route_astar.py
--rw-r--r--   0        0        0     6119 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_route_from_steps.py
--rw-r--r--   0        0        0     2766 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_route_sbend.py
--rw-r--r--   0        0        0     3311 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_routes_bend180.py
--rw-r--r--   0        0        0     1854 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/get_routes_straight.py
--rw-r--r--   0        0        0    34394 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/manhattan.py
--rw-r--r--   0        0        0    10081 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/path_length_matching.py
--rw-r--r--   0        0        0    22568 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/route_fiber_array.py
--rw-r--r--   0        0        0     8679 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/route_fiber_single.py
--rw-r--r--   0        0        0    18132 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/route_ports_to_side.py
--rw-r--r--   0        0        0     4361 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/route_quad.py
--rw-r--r--   0        0        0    14370 2023-05-02 04:45:28.017533 gdsfactory-6.90.9/gdsfactory/routing/route_sharp.py
--rw-r--r--   0        0        0    10167 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/routing/route_south.py
--rw-r--r--   0        0        0     5072 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/routing/sort_ports.py
--rw-r--r--   0        0        0     2477 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/routing/utils.py
--rw-r--r--   0        0        0     2889 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell.py
--rw-r--r--   0        0        0      646 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
--rw-r--r--   0        0        0     1101 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell_with_pins.py
--rw-r--r--   0        0        0      664 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
--rw-r--r--   0        0        0      347 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/02_component_autoname.py
--rw-r--r--   0        0        0      887 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/03_move.py
--rw-r--r--   0        0        0      881 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/04_connect.py
--rw-r--r--   0        0        0      710 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/05_remove_layers.py
--rw-r--r--   0        0        0      931 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/06_remapping_layers.py
--rw-r--r--   0        0        0     1082 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/07_flattening_device.py
--rw-r--r--   0        0        0      475 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/08_group.py
--rw-r--r--   0        0        0     1631 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/11_component_layout.py
--rw-r--r--   0        0        0     2245 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/12_component_refs.py
--rw-r--r--   0        0        0      955 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/13_component_netlist.py
--rw-r--r--   0        0        0     2592 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/14_component_connectivity.py
--rw-r--r--   0        0        0     1636 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/15_component_sequence1.py
--rw-r--r--   0        0        0     1680 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/16_component_sequence2.py
--rw-r--r--   0        0        0      965 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/17_ports.py
--rw-r--r--   0        0        0      489 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/18_port_markers.py
--rw-r--r--   0        0        0      361 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/19_references.py
--rw-r--r--   0        0        0      533 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/20_components.py
--rw-r--r--   0        0        0      507 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/21_add_fiber_array.py
--rw-r--r--   0        0        0      493 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/22_add_fiber_single.py
--rw-r--r--   0        0        0      569 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/22_add_pads.py
--rw-r--r--   0        0        0      848 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/23_reticle.py
--rw-r--r--   0        0        0     1588 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/23_reticle_passives.py
--rw-r--r--   0        0        0      457 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/24_doe.py
--rw-r--r--   0        0        0      687 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/24_doe_2.py
--rw-r--r--   0        0        0      692 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/24_doe_3.py
--rw-r--r--   0        0        0      306 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/25_slot_cross_section.py
--rw-r--r--   0        0        0     1363 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/30_lidar.py
--rw-r--r--   0        0        0     1412 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/30_lidar_pcell.py
--rw-r--r--   0        0        0     1943 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/30_lidar_with_pads.py
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/__init__.py
--rw-r--r--   0        0        0     1307 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing.py
--rw-r--r--   0        0        0      558 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
--rw-r--r--   0        0        0     6062 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
--rw-r--r--   0        0        0      444 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
--rw-r--r--   0        0        0      463 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
--rw-r--r--   0        0        0     1552 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
--rw-r--r--   0        0        0     1315 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
--rw-r--r--   0        0        0      602 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
--rw-r--r--   0        0        0     3317 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
--rw-r--r--   0        0        0     1484 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
--rw-r--r--   0        0        0     3045 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
--rw-r--r--   0        0        0     3782 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
--rw-r--r--   0        0        0     1988 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/big_device.py
--rw-r--r--   0        0        0       19 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/Makefile
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/__init__.py
--rw-r--r--   0        0        0     1129 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/benchmark/fill_demo.py
--rw-r--r--   0        0        0      343 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
--rw-r--r--   0        0        0      637 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/mask.pic.yml
--rw-r--r--   0        0        0      622 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
--rw-r--r--   0        0        0      569 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
--rw-r--r--   0        0        0      453 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/pads.pic.yml
--rw-r--r--   0        0        0      287 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/rectangles.pic.yml
--rw-r--r--   0        0        0     2260 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/drc_errors.py
--rw-r--r--   0        0        0     1014 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/drc_write.py
--rw-r--r--   0        0        0     4530 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/layers.py
--rw-r--r--   0        0        0      158 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/layers_sky130.py
--rw-r--r--   0        0        0      364 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/layers_xsection.py
--rw-r--r--   0        0        0      708 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/lvs.py
--rw-r--r--   0        0        0      574 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/demo/pcell.py
--rw-r--r--   0        0        0     4174 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/netlists/mzi.yml
--rw-r--r--   0        0        0     5840 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/netlists/mzi_full.yml
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/__init__.py
--rw-r--r--   0        0        0     4235 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/fab_c.py
--rw-r--r--   0        0        0      475 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/fab_d/__init__.py
--rw-r--r--   0        0        0     1880 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/fab_d/phase_shifters.py
--rw-r--r--   0        0        0     1715 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c.py
--rw-r--r--   0        0        0       50 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
--rw-r--r--   0        0        0       93 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
--rw-r--r--   0        0        0       85 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
--rw-r--r--   0        0        0      139 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
--rw-r--r--   0        0        0       90 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
--rw-r--r--   0        0        0      126 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
--rw-r--r--   0        0        0       48 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
--rw-r--r--   0        0        0     1023 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
--rw-r--r--   0        0        0     2100 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
--rw-r--r--   0        0        0     1839 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
--rw-r--r--   0        0        0     1267 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
--rw-r--r--   0        0        0     1592 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
--rw-r--r--   0        0        0     1061 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
--rw-r--r--   0        0        0     1054 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
--rw-r--r--   0        0        0     1577 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
--rw-r--r--   0        0        0     4313 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
--rw-r--r--   0        0        0     3625 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
--rw-r--r--   0        0        0     3603 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
--rw-r--r--   0        0        0     4271 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
--rw-r--r--   0        0        0      840 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
--rw-r--r--   0        0        0     2171 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
--rw-r--r--   0        0        0      316 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/schematic.py
--rw-r--r--   0        0        0    17692 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/schematic_editor.py
--rw-r--r--   0        0        0     4194 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/serialization.py
--rw-r--r--   0        0        0     1612 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/show.py
--rw-r--r--   0        0        0      724 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/__init__.py
--rw-r--r--   0        0        0     4369 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/add_simulation_markers.py
--rw-r--r--   0        0        0     2476 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/convert_sparameters.py
--rw-r--r--   0        0        0      547 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/devsim/__init__.py
--rw-r--r--   0        0        0     2559 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/devsim/doping.py
--rw-r--r--   0        0        0    11977 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/devsim/get_simulation.py
--rw-r--r--   0        0        0    23601 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/devsim/get_simulation_xsection.py
--rw-r--r--   0        0        0    19708 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/devsim/get_solver.py
--rw-r--r--   0        0        0     1632 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/devsim/test_devsim.py
--rw-r--r--   0        0        0      189 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/disable_print.py
--rw-r--r--   0        0        0       79 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/eme/__init__.py
--rw-r--r--   0        0        0    14784 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/eme/meow_eme.py
--rw-r--r--   0        0        0     1771 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/eme/test_meow_simulation.py
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.021534 gdsfactory-6.90.9/gdsfactory/simulation/fem/__init__.py
--rw-r--r--   0        0        0     8968 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/fem/mode_solver.py
--rw-r--r--   0        0        0     2205 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/fem/test_mode_solver.py
--rw-r--r--   0        0        0     3351 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/get_effective_indices.py
--rw-r--r--   0        0        0     3109 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/get_modes_path.py
--rw-r--r--   0        0        0     3888 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/get_sparameters_path.py
--rw-r--r--   0        0        0     1863 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/__init__.py
--rw-r--r--   0        0        0     3194 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_material.py
--rw-r--r--   0        0        0     6137 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_meep_geometry.py
--rw-r--r--   0        0        0     6054 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_port_eigenmode.py
--rw-r--r--   0        0        0    11014 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_simulation.py
--rw-r--r--   0        0        0    15701 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py
--rw-r--r--   0        0        0    17944 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py
--rw-r--r--   0        0        0    12302 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py
--rw-r--r--   0        0        0    11914 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_eigenmode.py
--rw-r--r--   0        0        0      832 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_materials.py
--rw-r--r--   0        0        0    10128 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0     6642 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py
--rw-r--r--   0        0        0    10128 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv
--rw-r--r--   0        0        0    10128 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv
--rw-r--r--   0        0        0    10093 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv
--rw-r--r--   0        0        0    10085 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv
--rw-r--r--   0        0        0    34701 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv
--rw-r--r--   0        0        0    10123 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv
--rw-r--r--   0        0        0     9966 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv
--rw-r--r--   0        0        0     9966 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv
--rw-r--r--   0        0        0    10085 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv
--rw-r--r--   0        0        0    10129 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv
--rw-r--r--   0        0        0    13951 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_grating.py
--rw-r--r--   0        0        0    21273 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_meep.py
--rw-r--r--   0        0        0     8135 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py
--rw-r--r--   0        0        0     9561 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py
--rw-r--r--   0        0        0     1246 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/__init__.py
--rw-r--r--   0        0        0     6653 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/break_geometry.py
--rw-r--r--   0        0        0    11250 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/mesh.py
--rw-r--r--   0        0        0    11808 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/meshtracker.py
--rw-r--r--   0        0        0     7752 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/parse_component.py
--rw-r--r--   0        0        0     3644 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/parse_gds.py
--rw-r--r--   0        0        0     3605 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/parse_layerstack.py
--rw-r--r--   0        0        0     2990 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/refine.py
--rw-r--r--   0        0        0    10851 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/scratch/mesh3D.py
--rw-r--r--   0        0        0     2489 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/tests/test_meshing.py
--rw-r--r--   0        0        0    14168 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/uz_xsection_mesh.py
--rw-r--r--   0        0        0     7441 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/xy_xsection_mesh.py
--rw-r--r--   0        0        0    16326 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gmsh/xyz_mesh.py
--rw-r--r--   0        0        0     1524 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/__init__.py
--rw-r--r--   0        0        0     4368 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/get_results.py
--rw-r--r--   0        0        0    20009 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/get_simulation.py
--rw-r--r--   0        0        0    21061 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py
--rw-r--r--   0        0        0     2821 2023-05-02 04:45:28.025534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/materials.py
--rw-r--r--   0        0        0    39677 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/modes.py
--rw-r--r--   0        0        0     8941 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/sim_run.yaml
--rw-r--r--   0        0        0     8114 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml
--rw-r--r--   0        0        0     8114 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml
--rw-r--r--   0        0        0     1597 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_modes.py
--rw-r--r--   0        0        0      262 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_modes/test_sweep_width.csv
--rw-r--r--   0        0        0      879 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_results.py
--rw-r--r--   0        0        0     1505 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_simulation.py
--rw-r--r--   0        0        0     1270 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py
--rw-r--r--   0        0        0     9297 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv
--rw-r--r--   0        0        0     1732 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0     1224 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/utils.py
--rw-r--r--   0        0        0    10515 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/write_sparameters.py
--rw-r--r--   0        0        0     7695 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py
--rw-r--r--   0        0        0      588 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/lumerical/__init__.py
--rw-r--r--   0        0        0    16011 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/lumerical/interconnect.py
--rw-r--r--   0        0        0     4286 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/lumerical/read.py
--rw-r--r--   0        0        0     3569 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/lumerical/settings.py
--rw-r--r--   0        0        0     2401 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/lumerical/test_read_sparameters.py
--rw-r--r--   0        0        0    19865 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py
--rw-r--r--   0        0        0     1504 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py
--rw-r--r--   0        0        0      932 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/__init__.py
--rw-r--r--   0        0        0     1574 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/coupler.py
--rw-r--r--   0        0        0     4132 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/find_coupling_vs_gap.py
--rw-r--r--   0        0        0     2534 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/find_mode_dispersion.py
--rw-r--r--   0        0        0     8846 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/find_modes.py
--rwxr-xr-x   0        0        0     7032 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/find_modes_cross_section.py
--rw-r--r--   0        0        0     4448 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py
--rw-r--r--   0        0        0     2706 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/find_neff_vs_width.py
--rw-r--r--   0        0        0     6956 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/get_mode_solver_coupler.py
--rwxr-xr-x   0        0        0     4462 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/get_mode_solver_cross_section.py
--rw-r--r--   0        0        0     5257 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/get_mode_solver_rib.py
--rw-r--r--   0        0        0     1110 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv
--rw-r--r--   0        0        0     1102 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv
--rw-r--r--   0        0        0     1110 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv
--rw-r--r--   0        0        0     7979 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/neff_convergence_test.py
--rw-r--r--   0        0        0      267 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/neff_vs_width.csv
--rw-r--r--   0        0        0     2469 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/overlap.py
--rw-r--r--   0        0        0      418 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_dw_dh.py
--rw-r--r--   0        0        0       83 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh.csv
--rw-r--r--   0        0        0      548 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv
--rw-r--r--   0        0        0     1131 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_find_modes.py
--rw-r--r--   0        0        0      647 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py
--rw-r--r--   0        0        0      354 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_neff_vs_width.py
--rw-r--r--   0        0        0      113 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_neff_vs_width/test_neff_vs_width.csv
--rw-r--r--   0        0        0    15452 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/types.py
--rw-r--r--   0        0        0     1145 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/modes/waveguide.py
--rw-r--r--   0        0        0     2013 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/__init__.py
--rw-r--r--   0        0        0      597 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/coupler.py
--rw-r--r--   0        0        0      377 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/fsr.py
--rw-r--r--   0        0        0      418 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/heater.py
--rw-r--r--   0        0        0     3063 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/mzi.py
--rw-r--r--   0        0        0     2616 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/ring.py
--rw-r--r--   0        0        0     7332 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/plot.py
--rw-r--r--   0        0        0     2480 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/plot_csv.py
--rw-r--r--   0        0        0      703 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/port_symmetries.py
--rw-r--r--   0        0        0     4637 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/diffusion.py
--rw-r--r--   0        0        0     5317 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/implant_tables.py
--rw-r--r--   0        0        0     6784 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/pysrim.py
--rw-r--r--   0        0        0     2182 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/silicon.py
--rw-r--r--   0        0        0     1861 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/skew/antimony_si_skew.csv
--rw-r--r--   0        0        0     1050 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/skew/arsenic_si_skew.csv
--rw-r--r--   0        0        0     1468 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/skew/boron_si_skew.csv
--rw-r--r--   0        0        0     1118 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv
--rw-r--r--   0        0        0      191 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/__init__.py
--rw-r--r--   0        0        0    14792 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/build_model.py
--rw-r--r--   0        0        0     7449 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/femwell_waveguide_model.py
--rw-r--r--   0        0        0     1571 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/interpolators.py
--rw-r--r--   0        0        0     6755 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/meep_FDTD_model.py
--rw-r--r--   0        0        0     4528 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/meow_eme_model.py
--rw-r--r--   0        0        0     5613 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/mlp.py
--rw-r--r--   0        0        0     7358 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/models.py
--rw-r--r--   0        0        0    13884 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/parameter.py
--rwxr-xr-x   0        0        0     2205 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/plot_model.py
--rw-r--r--   0        0        0     6805 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/read.py
--rw-r--r--   0        0        0     1350 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/tests/test_mzi.py
--rw-r--r--   0        0        0     2220 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/tests/test_mzi_lattice.py
--rw-r--r--   0        0        0     1397 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/sax/tests/test_parameters.py
--rw-r--r--   0        0        0     1357 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/__init__.py
--rw-r--r--   0        0        0     1573 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/add_gc.py
--rw-r--r--   0        0        0     3383 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/circuit.py
--rw-r--r--   0        0        0      891 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/__init__.py
--rw-r--r--   0        0        0     1295 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/bend_circular.py
--rw-r--r--   0        0        0     1388 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/bend_euler.py
--rw-r--r--   0        0        0     2560 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler.py
--rw-r--r--   0        0        0     1046 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_fdtd.py
--rw-r--r--   0        0        0     1848 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_ring.py
--rw-r--r--   0        0        0     1329 2023-05-02 04:45:28.029534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py
--rw-r--r--   0        0        0      589 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py
--rw-r--r--   0        0        0      913 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/gc.py
--rw-r--r--   0        0        0     2032 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mmi1x2.py
--rw-r--r--   0        0        0     1910 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mmi2x2.py
--rw-r--r--   0        0        0     2618 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mzi.py
--rw-r--r--   0        0        0     1759 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mzi_siepic.py
--rw-r--r--   0        0        0      487 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mzi_thermal.py
--rw-r--r--   0        0        0     2597 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_double.py
--rw-r--r--   0        0        0     1665 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_double_siepic.py
--rw-r--r--   0        0        0     1782 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_single.py
--rw-r--r--   0        0        0     1416 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_single_siepic.py
--rw-r--r--   0        0        0     1099 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/straight.py
--rw-r--r--   0        0        0      800 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/get_transmission.py
--rw-r--r--   0        0        0     2516 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/model_from_gdsfactory.py
--rw-r--r--   0        0        0     3841 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/model_from_sparameters.py
--rw-r--r--   0        0        0     2438 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/plot_circuit.py
--rw-r--r--   0        0        0     1798 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py
--rw-r--r--   0        0        0     2773 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/plot_model.py
--rw-r--r--   0        0        0     1261 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_circuit.py
--rw-r--r--   0        0        0       90 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_circuit/test_circuit_transmission.yml
--rw-r--r--   0        0        0     1109 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components.py
--rw-r--r--   0        0        0       66 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_circuits_mzi_.yml
--rw-r--r--   0        0        0       69 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_double_.yml
--rw-r--r--   0        0        0       69 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_single_.yml
--rw-r--r--   0        0        0       92 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_circular_.yml
--rw-r--r--   0        0        0       92 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_euler_.yml
--rw-r--r--   0        0        0      412 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_.yml
--rw-r--r--   0        0        0      412 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_ring_.yml
--rw-r--r--   0        0        0      114 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_gc1550te_.yml
--rw-r--r--   0        0        0      256 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi1x2_.yml
--rw-r--r--   0        0        0      460 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi2x2_.yml
--rw-r--r--   0        0        0      104 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components/test_elements_straight_.yml
--rw-r--r--   0        0        0      166 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/simphony/types.py
--rw-r--r--   0        0        0      471 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/sipann/__init__.py
--rw-r--r--   0        0        0     1376 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/sipann/bend_circular.py
--rw-r--r--   0        0        0     1465 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/sipann/bend_euler.py
--rw-r--r--   0        0        0     2508 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/sipann/coupler.py
--rw-r--r--   0        0        0     1892 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/sipann/coupler_ring.py
--rw-r--r--   0        0        0      736 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/sipann/straight.py
--rw-r--r--   0        0        0      100 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/thermal/__init__.py
--rw-r--r--   0        0        0     7781 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/simulation/thermal/heater.py
--rw-r--r--   0        0        0     1744 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/snap.py
--rw-r--r--   0        0        0     4245 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/symbols.py
--rw-r--r--   0        0        0      524 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/technology/__init__.py
--rw-r--r--   0        0        0     7065 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/technology/klayout_tech.py
--rw-r--r--   0        0        0     1078 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/technology/layer_map.py
--rw-r--r--   0        0        0    14989 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/technology/layer_stack.py
--rw-r--r--   0        0        0    42052 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/technology/layer_views.py
--rw-r--r--   0        0        0     1984 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/technology/simulation_settings.py
--rw-r--r--   0        0        0     1635 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/types.py
--rw-r--r--   0        0        0    10000 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/typings.py
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/utils/__init__.py
--rw-r--r--   0        0        0     1304 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/utils/async_utils.py
--rw-r--r--   0        0        0      376 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/utils/color_utils.py
--rw-r--r--   0        0        0      558 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/utils/file_utils.py
--rw-r--r--   0        0        0      185 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/utils/function_utils.py
--rw-r--r--   0        0        0      676 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/utils/xml_utils.py
--rw-r--r--   0        0        0     1429 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/utils/yaml_utils.py
--rw-r--r--   0        0        0     4825 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/watch.py
--rw-r--r--   0        0        0        0 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/widgets/__init__.py
--rw-r--r--   0        0        0     7921 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/widgets/layout_viewer.py
--rw-r--r--   0        0        0     7454 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/gdsfactory/write_cells.py
--rw-r--r--   0        0        0     5467 2023-05-02 04:45:28.033534 gdsfactory-6.90.9/pyproject.toml
--rw-r--r--   0        0        0    18548 1970-01-01 00:00:00.000000 gdsfactory-6.90.9/PKG-INFO
+-rw-r--r--   0        0        0     1072 2023-05-05 22:23:15.371309 gdsfactory-6.91.0/LICENSE
+-rw-r--r--   0        0        0    14276 2023-05-05 22:23:15.371309 gdsfactory-6.91.0/README.md
+-rw-r--r--   0        0        0     3415 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/__init__.py
+-rw-r--r--   0        0        0     2096 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_keepout.py
+-rw-r--r--   0        0        0    12629 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_labels.py
+-rw-r--r--   0        0        0     3711 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_loopback.py
+-rw-r--r--   0        0        0     5054 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_padding.py
+-rw-r--r--   0        0        0    15465 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_pins.py
+-rw-r--r--   0        0        0    14700 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_ports.py
+-rw-r--r--   0        0        0     2884 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_tapers.py
+-rw-r--r--   0        0        0     2257 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_tapers_cross_section.py
+-rw-r--r--   0        0        0     1831 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/add_termination.py
+-rw-r--r--   0        0        0     1676 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/asserts.py
+-rw-r--r--   0        0        0    11843 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/cell.py
+-rw-r--r--   0        0        0    15946 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/circuitviz.py
+-rw-r--r--   0        0        0     5325 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/cli.py
+-rw-r--r--   0        0        0    99019 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/component.py
+-rw-r--r--   0        0        0    23360 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/component_layout.py
+-rw-r--r--   0        0        0    29699 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/component_reference.py
+-rw-r--r--   0        0        0     1205 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/C.py
+-rw-r--r--   0        0        0     1144 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/L.py
+-rw-r--r--   0        0        0    20964 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/__init__.py
+-rw-r--r--   0        0        0     2621 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/add_fiducials.py
+-rw-r--r--   0        0        0    14087 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/add_grating_couplers.py
+-rw-r--r--   0        0        0     2014 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/add_trenches.py
+-rw-r--r--   0        0        0     3207 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/align.py
+-rw-r--r--   0        0        0     2622 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/array_component.py
+-rw-r--r--   0        0        0     4705 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/array_with_fanout.py
+-rw-r--r--   0        0        0     4322 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/array_with_via.py
+-rw-r--r--   0        0        0     4042 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/awg.py
+-rw-r--r--   0        0        0     1269 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/bbox.py
+-rw-r--r--   0        0        0     2851 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/bend_circular.py
+-rw-r--r--   0        0        0     2649 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/bend_circular_heater.py
+-rw-r--r--   0        0        0     7882 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/bend_euler.py
+-rw-r--r--   0        0        0     2682 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/bend_port.py
+-rw-r--r--   0        0        0     3664 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/bend_s.py
+-rw-r--r--   0        0        0     5373 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/bezier.py
+-rw-r--r--   0        0        0     1605 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cavity.py
+-rw-r--r--   0        0        0     5766 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cdc.py
+-rw-r--r--   0        0        0     2929 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cdsem_all.py
+-rw-r--r--   0        0        0     1788 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cdsem_bend180.py
+-rw-r--r--   0        0        0     1631 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cdsem_coupler.py
+-rw-r--r--   0        0        0     1412 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cdsem_straight.py
+-rw-r--r--   0        0        0     1565 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cdsem_straight_density.py
+-rw-r--r--   0        0        0      793 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/circle.py
+-rw-r--r--   0        0        0     5722 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coh_rx_dual_pol.py
+-rw-r--r--   0        0        0     8922 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coh_rx_single_pol.py
+-rw-r--r--   0        0        0     5043 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coh_tx_dual_pol.py
+-rw-r--r--   0        0        0     6118 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coh_tx_single_pol.py
+-rw-r--r--   0        0        0     2548 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/compass.py
+-rw-r--r--   0        0        0     9856 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/component_lattice.py
+-rw-r--r--   0        0        0     7174 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/component_sequence.py
+-rw-r--r--   0        0        0      812 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/copy_layers.py
+-rw-r--r--   0        0        0     3460 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler.py
+-rw-r--r--   0        0        0     2113 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler90.py
+-rw-r--r--   0        0        0     1802 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler90bend.py
+-rw-r--r--   0        0        0     4666 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler_adiabatic.py
+-rw-r--r--   0        0        0     1909 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler_asymmetric.py
+-rw-r--r--   0        0        0     3970 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler_full.py
+-rw-r--r--   0        0        0     3414 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler_ring.py
+-rw-r--r--   0        0        0     1060 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler_straight.py
+-rw-r--r--   0        0        0     1164 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler_straight_asymmetric.py
+-rw-r--r--   0        0        0     2192 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/coupler_symmetric.py
+-rw-r--r--   0        0        0     1848 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/cross.py
+-rw-r--r--   0        0        0    12873 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/crossing_waveguide.py
+-rw-r--r--   0        0        0      500 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/csv_data/grating_coupler_1etch_h220_e70.csv
+-rw-r--r--   0        0        0     1014 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv
+-rw-r--r--   0        0        0    19749 2023-05-05 22:23:15.379309 gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv
+-rw-r--r--   0        0        0    19751 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv
+-rw-r--r--   0        0        0    19749 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv
+-rw-r--r--   0        0        0    19751 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv
+-rw-r--r--   0        0        0    19775 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv
+-rw-r--r--   0        0        0     3143 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv
+-rw-r--r--   0        0        0     5272 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/cutback_2x2.py
+-rw-r--r--   0        0        0     6450 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/cutback_bend.py
+-rw-r--r--   0        0        0     3765 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/cutback_component.py
+-rw-r--r--   0        0        0     2721 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/cutback_splitter.py
+-rw-r--r--   0        0        0     2971 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/dbr.py
+-rw-r--r--   0        0        0     4288 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/dbr_tapered.py
+-rw-r--r--   0        0        0     2486 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/delay_snake.py
+-rw-r--r--   0        0        0     3177 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/delay_snake2.py
+-rw-r--r--   0        0        0     3237 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/delay_snake3.py
+-rw-r--r--   0        0        0     4319 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/delay_snake_sbend.py
+-rw-r--r--   0        0        0     1226 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/dicing_lane.py
+-rw-r--r--   0        0        0     3471 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/die.py
+-rw-r--r--   0        0        0     2975 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/die_bbox.py
+-rw-r--r--   0        0        0     2863 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/die_bbox_frame.py
+-rw-r--r--   0        0        0     8015 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/disk.py
+-rw-r--r--   0        0        0     4112 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/edge_coupler_array.py
+-rw-r--r--   0        0        0     1214 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/ellipse.py
+-rw-r--r--   0        0        0     1800 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/extend_ports_list.py
+-rw-r--r--   0        0        0     7944 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/extension.py
+-rw-r--r--   0        0        0      981 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/fiber.py
+-rw-r--r--   0        0        0     1432 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/fiber_array.py
+-rw-r--r--   0        0        0      722 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/fiducial_squares.py
+-rw-r--r--   0        0        0     3290 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/ge_detector_straight_si_contacts.py
+-rw-r--r--   0        0        0     1063 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_array.py
+-rw-r--r--   0        0        0     4682 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_dual_pol.py
+-rw-r--r--   0        0        0     7110 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical.py
+-rw-r--r--   0        0        0     7221 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py
+-rw-r--r--   0        0        0     4960 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py
+-rw-r--r--   0        0        0     4592 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical_trenches.py
+-rw-r--r--   0        0        0     1773 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_functions.py
+-rw-r--r--   0        0        0     9058 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_loss.py
+-rw-r--r--   0        0        0     1786 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_loss_fiber_single.py
+-rw-r--r--   0        0        0     4142 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_rectangular.py
+-rw-r--r--   0        0        0     4685 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py
+-rw-r--r--   0        0        0     3887 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py
+-rw-r--r--   0        0        0     1578 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/grating_coupler_tree.py
+-rw-r--r--   0        0        0     8773 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/greek_cross.py
+-rw-r--r--   0        0        0     1019 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/hline.py
+-rw-r--r--   0        0        0     3687 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/interdigital_capacitor.py
+-rw-r--r--   0        0        0     1825 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/litho_calipers.py
+-rw-r--r--   0        0        0     1244 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/litho_ruler.py
+-rw-r--r--   0        0        0     1304 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/litho_steps.py
+-rw-r--r--   0        0        0      650 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/logo.py
+-rw-r--r--   0        0        0     1679 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/loop_mirror.py
+-rw-r--r--   0        0        0     3873 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mmi1x2.py
+-rw-r--r--   0        0        0     2814 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mmi1x2_with_sbend.py
+-rw-r--r--   0        0        0     3858 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mmi2x2.py
+-rw-r--r--   0        0        0     3299 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mmi2x2_with_sbend.py
+-rw-r--r--   0        0        0     4947 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mmi_90degree_hybrid.py
+-rw-r--r--   0        0        0     3265 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mode_converter.py
+-rw-r--r--   0        0        0     7414 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzi.py
+-rw-r--r--   0        0        0     2499 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzi_arm.py
+-rw-r--r--   0        0        0     5835 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzi_arms.py
+-rw-r--r--   0        0        0    12214 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzi_lattice.py
+-rw-r--r--   0        0        0     4025 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzi_pads_center.py
+-rw-r--r--   0        0        0     1064 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzi_phase_shifter.py
+-rw-r--r--   0        0        0     6342 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzit.py
+-rw-r--r--   0        0        0     3502 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzit_lattice.py
+-rw-r--r--   0        0        0     6047 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/mzm.py
+-rw-r--r--   0        0        0     3518 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/nxn.py
+-rw-r--r--   0        0        0     1940 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/optimal_90deg.py
+-rw-r--r--   0        0        0     3876 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/optimal_hairpin.py
+-rw-r--r--   0        0        0     6131 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/optimal_step.py
+-rw-r--r--   0        0        0     6327 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/pack_doe.py
+-rw-r--r--   0        0        0     3860 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/pad.py
+-rw-r--r--   0        0        0     1890 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/pad_gsg.py
+-rw-r--r--   0        0        0     1157 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/pads_shorted.py
+-rw-r--r--   0        0        0     3833 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/polarization_splitter_rotator.py
+-rw-r--r--   0        0        0     1147 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/ramp.py
+-rw-r--r--   0        0        0     1508 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/rectangle.py
+-rw-r--r--   0        0        0     2972 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/rectangle_with_slits.py
+-rw-r--r--   0        0        0     1508 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/regular_polygon.py
+-rw-r--r--   0        0        0     3302 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/resistance_meander.py
+-rw-r--r--   0        0        0     2642 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/resistance_sheet.py
+-rw-r--r--   0        0        0     1273 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/ring.py
+-rw-r--r--   0        0        0     4143 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/ring_crow.py
+-rw-r--r--   0        0        0     3272 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/ring_crow_couplers.py
+-rw-r--r--   0        0        0     2267 2023-05-05 22:23:15.383309 gdsfactory-6.91.0/gdsfactory/components/ring_double.py
+-rw-r--r--   0        0        0     3846 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_double_heater.py
+-rw-r--r--   0        0        0     7757 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_double_pn.py
+-rw-r--r--   0        0        0    12137 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_section_based.py
+-rw-r--r--   0        0        0     2719 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_single.py
+-rw-r--r--   0        0        0     1968 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_single_array.py
+-rw-r--r--   0        0        0     6098 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_single_bend_coupler.py
+-rw-r--r--   0        0        0     2714 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_single_dut.py
+-rw-r--r--   0        0        0     4018 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_single_heater.py
+-rw-r--r--   0        0        0     5267 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/ring_single_pn.py
+-rw-r--r--   0        0        0     2282 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/seal_ring.py
+-rw-r--r--   0        0        0     3758 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/snspd.py
+-rw-r--r--   0        0        0     2059 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/spiral_double.py
+-rw-r--r--   0        0        0     5871 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/spiral_external_io.py
+-rw-r--r--   0        0        0    16658 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/spiral_heater.py
+-rw-r--r--   0        0        0     9181 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/spiral_inner_io.py
+-rw-r--r--   0        0        0     1754 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/splitter_chain.py
+-rw-r--r--   0        0        0     5327 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/splitter_tree.py
+-rw-r--r--   0        0        0     2526 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight.py
+-rw-r--r--   0        0        0     1033 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_array.py
+-rw-r--r--   0        0        0     7914 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_heater_doped_rib.py
+-rw-r--r--   0        0        0     1922 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_heater_doped_strip.py
+-rw-r--r--   0        0        0     7891 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_heater_meander.py
+-rw-r--r--   0        0        0     8090 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_heater_meander_doped.py
+-rw-r--r--   0        0        0     5686 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_heater_metal.py
+-rw-r--r--   0        0        0     2809 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_pin.py
+-rw-r--r--   0        0        0     3974 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_pin_slot.py
+-rw-r--r--   0        0        0      655 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/straight_rib.py
+-rw-r--r--   0        0        0      820 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/switch_tree.py
+-rw-r--r--   0        0        0     7713 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/taper.py
+-rw-r--r--   0        0        0     3530 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/taper_adiabatic.py
+-rw-r--r--   0        0        0     2457 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/taper_cross_section.py
+-rw-r--r--   0        0        0     2363 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/taper_from_csv.py
+-rw-r--r--   0        0        0     1215 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/taper_parabolic.py
+-rw-r--r--   0        0        0     1635 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/terminator.py
+-rw-r--r--   0        0        0     2913 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/text.py
+-rw-r--r--   0        0        0     3821 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/text_freetype.py
+-rw-r--r--   0        0        0     3156 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/text_rectangular.py
+-rw-r--r--   0        0        0     3943 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/text_rectangular_font.py
+-rw-r--r--   0        0        0     2536 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/triangles.py
+-rw-r--r--   0        0        0      715 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/verniers.py
+-rw-r--r--   0        0        0     2468 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/version_stamp.py
+-rw-r--r--   0        0        0     2436 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/via.py
+-rw-r--r--   0        0        0     3060 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/via_corner.py
+-rw-r--r--   0        0        0     5342 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/via_cutback.py
+-rw-r--r--   0        0        0    15574 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/via_stack.py
+-rw-r--r--   0        0        0     4554 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/via_stack_slot.py
+-rw-r--r--   0        0        0     4944 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/via_stack_with_offset.py
+-rw-r--r--   0        0        0     1088 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/wafer.py
+-rw-r--r--   0        0        0     2542 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/wire.py
+-rw-r--r--   0        0        0      978 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/components/wire_sbend.py
+-rw-r--r--   0        0        0     7919 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/config.py
+-rw-r--r--   0        0        0      481 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/conftest.py
+-rw-r--r--   0        0        0    38409 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/constants.py
+-rw-r--r--   0        0        0     1476 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/containers.py
+-rw-r--r--   0        0        0    82607 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/cross_section.py
+-rw-r--r--   0        0        0     2974 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/decorators.py
+-rw-r--r--   0        0        0     6884 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/difftest.py
+-rw-r--r--   0        0        0      988 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/events.py
+-rw-r--r--   0        0        0      204 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/export/__init__.py
+-rw-r--r--   0        0        0     3353 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/export/to_3d.py
+-rw-r--r--   0        0        0     1940 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/export/to_np.py
+-rw-r--r--   0        0        0     3058 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/export/to_stl.py
+-rw-r--r--   0        0        0     7438 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/export/write_gerbers.py
+-rw-r--r--   0        0        0     2968 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/filestorage.py
+-rw-r--r--   0        0        0    11802 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/fill.py
+-rw-r--r--   0        0        0     7799 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/font.py
+-rw-r--r--   0        0        0     8073 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/functions.py
+-rw-r--r--   0        0        0       20 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/.gitattributes
+-rw-r--r--   0        0        0       83 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/.gitconfig
+-rw-r--r--   0        0        0       72 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/__init__.py
+-rw-r--r--   0        0        0     1069 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/gds_diff_git.py
+-rw-r--r--   0        0        0     2935 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/gdsdiff.py
+-rw-r--r--   0        0        0      708 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/install.py
+-rw-r--r--   0        0        0      271 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/sample.py
+-rw-r--r--   0        0        0     1059 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/gdsdiff/test_xor.py
+-rw-r--r--   0        0        0     1100 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/generic_tech/README.md
+-rw-r--r--   0        0        0     1722 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/generic_tech/__init__.py
+-rw-r--r--   0        0        0      169 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/generic_tech/generic_tech.sh
+-rw-r--r--   0        0        0     8142 2023-05-05 22:23:15.387309 gdsfactory-6.91.0/gdsfactory/generic_tech/get_klayout_pyxs.py
+-rw-r--r--   0        0        0       44 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/README.md
+-rw-r--r--   0        0        0      104 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/Makefile
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/__init__.py
+-rw-r--r--   0        0        0     2842 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/errors.py
+-rw-r--r--   0        0        0      579 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/generic.drc
+-rw-r--r--   0        0        0     2929 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/generic.lydrc
+-rw-r--r--   0        0        0     1014 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/write_drc.py
+-rw-r--r--   0        0        0     6193 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/grain.xml
+-rw-r--r--   0        0        0    10140 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/icon_128x128.png
+-rw-r--r--   0        0        0     4248 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/icon_64x64.png
+-rw-r--r--   0        0        0    10945 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym
+-rw-r--r--   0        0        0      710 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym
+-rw-r--r--   0        0        0      538 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/python/__init__.py
+-rw-r--r--   0        0        0      114 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/__init__.py
+-rw-r--r--   0        0        0     4303 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py
+-rw-r--r--   0        0        0      269 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/Makefile
+-rw-r--r--   0        0        0     1519 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack
+-rw-r--r--   0        0        0    40153 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp
+-rw-r--r--   0        0        0     7689 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyt
+-rw-r--r--   0        0        0     4258 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs
+-rw-r--r--   0        0        0     4537 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs
+-rw-r--r--   0        0        0     4690 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs
+-rw-r--r--   0        0        0     5508 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs
+-rw-r--r--   0        0        0     1855 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/layer_map.py
+-rw-r--r--   0        0        0     6511 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/layer_stack.py
+-rw-r--r--   0        0        0    10547 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/layer_views.yaml
+-rw-r--r--   0        0        0      158 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/generic_tech/simulation_settings.py
+-rw-r--r--   0        0        0     1431 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/__init__.py
+-rw-r--r--   0        0        0     4917 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/boolean.py
+-rw-r--r--   0        0        0     3814 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/boolean_klayout.py
+-rw-r--r--   0        0        0     1904 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/boolean_polygons.py
+-rw-r--r--   0        0        0      598 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/check_duplicated_cells.py
+-rw-r--r--   0        0        0     2719 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/check_exclusion.py
+-rw-r--r--   0        0        0     2829 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/check_inclusion.py
+-rw-r--r--   0        0        0     3566 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/check_space.py
+-rw-r--r--   0        0        0     1904 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/check_width.py
+-rw-r--r--   0        0        0     5005 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/fill_klayout.py
+-rw-r--r--   0        0        0     7084 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/fill_tiled.py
+-rw-r--r--   0        0        0     1697 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/fillet.py
+-rw-r--r--   0        0        0     6664 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/functions.py
+-rw-r--r--   0        0        0     2167 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/invert.py
+-rw-r--r--   0        0        0     3685 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/layer_priority.py
+-rw-r--r--   0        0        0     3046 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/manhattanize.py
+-rw-r--r--   0        0        0     4192 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/maskprep.py
+-rw-r--r--   0        0        0     4744 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/maskprep_flat.py
+-rw-r--r--   0        0        0     3250 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/offset.py
+-rw-r--r--   0        0        0     3842 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/outline.py
+-rw-r--r--   0        0        0     2510 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/trim.py
+-rw-r--r--   0        0        0     2948 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/union.py
+-rw-r--r--   0        0        0     9629 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/write_drc.py
+-rw-r--r--   0        0        0     1783 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/geometry/xor_diff.py
+-rw-r--r--   0        0        0     1158 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/get_factories.py
+-rw-r--r--   0        0        0    23562 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/get_netlist.py
+-rw-r--r--   0        0        0    14426 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/get_netlist_flat.py
+-rw-r--r--   0        0        0      682 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/get_netlist_klayout.py
+-rw-r--r--   0        0        0     9455 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/grid.py
+-rw-r--r--   0        0        0     4363 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/install.py
+-rw-r--r--   0        0        0     1340 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/klive.py
+-rw-r--r--   0        0        0      585 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/labels/__init__.py
+-rw-r--r--   0        0        0     3563 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/labels/add_label_yaml.py
+-rw-r--r--   0        0        0     3847 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/labels/ehva.py
+-rw-r--r--   0        0        0     3810 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/labels/merge_test_metadata.py
+-rw-r--r--   0        0        0     4668 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/labels/siepic.py
+-rw-r--r--   0        0        0     4847 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/labels/write_labels.py
+-rw-r--r--   0        0        0     1149 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/materials.py
+-rw-r--r--   0        0        0     5247 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/name.py
+-rw-r--r--   0        0        0    11237 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/pack.py
+-rw-r--r--   0        0        0    50880 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/path.py
+-rw-r--r--   0        0        0    25849 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/pdk.py
+-rw-r--r--   0        0        0     6170 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/picmodel.py
+-rw-r--r--   0        0        0     5068 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/pixelate.py
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/plugins/dagster/__init__.py
+-rw-r--r--   0        0        0      976 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/plugins/dagster/workflow.py
+-rw-r--r--   0        0        0      566 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/plugins/database/README.md
+-rw-r--r--   0        0        0     1592 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/plugins/database/__init__.py
+-rw-r--r--   0        0        0     6216 2023-05-05 22:23:15.391309 gdsfactory-6.91.0/gdsfactory/plugins/database/db_upload.py
+-rw-r--r--   0        0        0    16143 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/plugins/database/models.py
+-rw-r--r--   0        0        0    32084 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/port.py
+-rw-r--r--   0        0        0    37609 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/quickplotter.py
+-rw-r--r--   0        0        0      696 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/__init__.py
+-rw-r--r--   0        0        0     1639 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/from_dphox.py
+-rw-r--r--   0        0        0     1285 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/from_gdspaths.py
+-rw-r--r--   0        0        0     1953 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/from_np.py
+-rw-r--r--   0        0        0     2813 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/from_phidl.py
+-rw-r--r--   0        0        0    38082 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/from_yaml.py
+-rw-r--r--   0        0        0     5897 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/from_yaml_template.py
+-rw-r--r--   0        0        0     5688 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/import_gds.py
+-rw-r--r--   0        0        0     3407 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/read/labels.py
+-rw-r--r--   0        0        0     3769 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/__init__.py
+-rw-r--r--   0        0        0     2920 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/add_electrical_pads_shortest.py
+-rw-r--r--   0        0        0     3015 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/add_electrical_pads_top.py
+-rw-r--r--   0        0        0     3035 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/add_electrical_pads_top_dc.py
+-rw-r--r--   0        0        0     8715 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/add_fiber_array.py
+-rw-r--r--   0        0        0    10624 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/add_fiber_single.py
+-rw-r--r--   0        0        0     8967 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/add_pads.py
+-rw-r--r--   0        0        0    38940 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/all_angle.py
+-rw-r--r--   0        0        0     3916 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/auto_taper.py
+-rw-r--r--   0        0        0      982 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/factories.py
+-rw-r--r--   0        0        0     4415 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/fanout.py
+-rw-r--r--   0        0        0     2800 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/fanout2x2.py
+-rw-r--r--   0        0        0    24342 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_bundle.py
+-rw-r--r--   0        0        0     8632 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_bundle_corner.py
+-rw-r--r--   0        0        0     6900 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_bundle_from_steps.py
+-rw-r--r--   0        0        0    12949 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_bundle_from_waypoints.py
+-rw-r--r--   0        0        0     5284 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_bundle_path_length_match.py
+-rw-r--r--   0        0        0     1937 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_bundle_sbend.py
+-rw-r--r--   0        0        0    17064 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_bundle_u.py
+-rw-r--r--   0        0        0     1510 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_input_labels.py
+-rw-r--r--   0        0        0     9233 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_route.py
+-rw-r--r--   0        0        0    10824 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_route_astar.py
+-rw-r--r--   0        0        0     6119 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_route_from_steps.py
+-rw-r--r--   0        0        0     2766 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_route_sbend.py
+-rw-r--r--   0        0        0     3311 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_routes_bend180.py
+-rw-r--r--   0        0        0     1854 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/get_routes_straight.py
+-rw-r--r--   0        0        0    34394 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/manhattan.py
+-rw-r--r--   0        0        0    10081 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/path_length_matching.py
+-rw-r--r--   0        0        0    22568 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/route_fiber_array.py
+-rw-r--r--   0        0        0     8679 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/route_fiber_single.py
+-rw-r--r--   0        0        0    18132 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/route_ports_to_side.py
+-rw-r--r--   0        0        0     4361 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/route_quad.py
+-rw-r--r--   0        0        0    14370 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/route_sharp.py
+-rw-r--r--   0        0        0    10167 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/route_south.py
+-rw-r--r--   0        0        0     5072 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/sort_ports.py
+-rw-r--r--   0        0        0     2477 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/routing/utils.py
+-rw-r--r--   0        0        0     2889 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell.py
+-rw-r--r--   0        0        0      646 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml
+-rw-r--r--   0        0        0     1101 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell_with_pins.py
+-rw-r--r--   0        0        0      664 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml
+-rw-r--r--   0        0        0      347 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/02_component_autoname.py
+-rw-r--r--   0        0        0      887 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/03_move.py
+-rw-r--r--   0        0        0      881 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/04_connect.py
+-rw-r--r--   0        0        0      710 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/05_remove_layers.py
+-rw-r--r--   0        0        0      931 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/06_remapping_layers.py
+-rw-r--r--   0        0        0     1082 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/07_flattening_device.py
+-rw-r--r--   0        0        0      475 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/08_group.py
+-rw-r--r--   0        0        0     1631 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/11_component_layout.py
+-rw-r--r--   0        0        0     2245 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/12_component_refs.py
+-rw-r--r--   0        0        0      955 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/13_component_netlist.py
+-rw-r--r--   0        0        0     2592 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/14_component_connectivity.py
+-rw-r--r--   0        0        0     1636 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/15_component_sequence1.py
+-rw-r--r--   0        0        0     1680 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/16_component_sequence2.py
+-rw-r--r--   0        0        0      965 2023-05-05 22:23:15.395309 gdsfactory-6.91.0/gdsfactory/samples/17_ports.py
+-rw-r--r--   0        0        0      489 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/18_port_markers.py
+-rw-r--r--   0        0        0      361 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/19_references.py
+-rw-r--r--   0        0        0      533 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/20_components.py
+-rw-r--r--   0        0        0      507 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/21_add_fiber_array.py
+-rw-r--r--   0        0        0      493 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/22_add_fiber_single.py
+-rw-r--r--   0        0        0      569 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/22_add_pads.py
+-rw-r--r--   0        0        0      848 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/23_reticle.py
+-rw-r--r--   0        0        0     1588 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/23_reticle_passives.py
+-rw-r--r--   0        0        0      457 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/24_doe.py
+-rw-r--r--   0        0        0      687 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/24_doe_2.py
+-rw-r--r--   0        0        0      692 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/24_doe_3.py
+-rw-r--r--   0        0        0      306 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/25_slot_cross_section.py
+-rw-r--r--   0        0        0     1363 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/30_lidar.py
+-rw-r--r--   0        0        0     1412 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/30_lidar_pcell.py
+-rw-r--r--   0        0        0     1943 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/30_lidar_with_pads.py
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/__init__.py
+-rw-r--r--   0        0        0     1307 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing.py
+-rw-r--r--   0        0        0      558 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml
+-rw-r--r--   0        0        0     6062 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml
+-rw-r--r--   0        0        0      444 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_error_intermediate_180.pic.yml
+-rw-r--r--   0        0        0      463 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_error_overconstrained.pic.yml
+-rw-r--r--   0        0        0     1552 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml
+-rw-r--r--   0        0        0     1315 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml
+-rw-r--r--   0        0        0      602 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml
+-rw-r--r--   0        0        0     3317 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml
+-rw-r--r--   0        0        0     1484 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml
+-rw-r--r--   0        0        0     3045 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml
+-rw-r--r--   0        0        0     3782 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml
+-rw-r--r--   0        0        0     1988 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/big_device.py
+-rw-r--r--   0        0        0       19 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/Makefile
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/__init__.py
+-rw-r--r--   0        0        0     1129 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/benchmark/fill_demo.py
+-rw-r--r--   0        0        0      343 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/benchmark/snap_demo_phidl.py
+-rw-r--r--   0        0        0      637 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/mask.pic.yml
+-rw-r--r--   0        0        0      622 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml
+-rw-r--r--   0        0        0      569 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml
+-rw-r--r--   0        0        0      453 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/pads.pic.yml
+-rw-r--r--   0        0        0      287 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/rectangles.pic.yml
+-rw-r--r--   0        0        0     2260 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/drc_errors.py
+-rw-r--r--   0        0        0     1014 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/drc_write.py
+-rw-r--r--   0        0        0     4530 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/layers.py
+-rw-r--r--   0        0        0      158 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/layers_sky130.py
+-rw-r--r--   0        0        0      364 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/layers_xsection.py
+-rw-r--r--   0        0        0      708 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/lvs.py
+-rw-r--r--   0        0        0      574 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/demo/pcell.py
+-rw-r--r--   0        0        0     4174 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/netlists/mzi.yml
+-rw-r--r--   0        0        0     5840 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/netlists/mzi_full.yml
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/__init__.py
+-rw-r--r--   0        0        0     4235 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/fab_c.py
+-rw-r--r--   0        0        0      475 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/fab_d/__init__.py
+-rw-r--r--   0        0        0     1880 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py
+-rw-r--r--   0        0        0     1715 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c.py
+-rw-r--r--   0        0        0       50 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_ports_bend_euler_c_.csv
+-rw-r--r--   0        0        0       93 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_ports_gc_nitride_c_.csv
+-rw-r--r--   0        0        0       85 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_c_.csv
+-rw-r--r--   0        0        0      139 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mmi1x2_nitride_o_.csv
+-rw-r--r--   0        0        0       90 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_c_.csv
+-rw-r--r--   0        0        0      126 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_ports_mzi_nitride_o_.csv
+-rw-r--r--   0        0        0       48 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_ports_straight_c_.csv
+-rw-r--r--   0        0        0     1023 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml
+-rw-r--r--   0        0        0     2100 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml
+-rw-r--r--   0        0        0     1839 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml
+-rw-r--r--   0        0        0     1267 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml
+-rw-r--r--   0        0        0     1592 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml
+-rw-r--r--   0        0        0     1061 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml
+-rw-r--r--   0        0        0     1054 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml
+-rw-r--r--   0        0        0     1577 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml
+-rw-r--r--   0        0        0     4313 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml
+-rw-r--r--   0        0        0     3625 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml
+-rw-r--r--   0        0        0     3603 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml
+-rw-r--r--   0        0        0     4271 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml
+-rw-r--r--   0        0        0      840 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml
+-rw-r--r--   0        0        0     2171 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml
+-rw-r--r--   0        0        0      316 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/schematic.py
+-rw-r--r--   0        0        0    17692 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/schematic_editor.py
+-rw-r--r--   0        0        0     4194 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/serialization.py
+-rw-r--r--   0        0        0     1612 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/show.py
+-rw-r--r--   0        0        0      724 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/__init__.py
+-rw-r--r--   0        0        0     4369 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/add_simulation_markers.py
+-rw-r--r--   0        0        0     2476 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/convert_sparameters.py
+-rw-r--r--   0        0        0      547 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/devsim/__init__.py
+-rw-r--r--   0        0        0     2559 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/devsim/doping.py
+-rw-r--r--   0        0        0    11977 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/devsim/get_simulation.py
+-rw-r--r--   0        0        0    23601 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/devsim/get_simulation_xsection.py
+-rw-r--r--   0        0        0    19708 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/devsim/get_solver.py
+-rw-r--r--   0        0        0     1632 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/devsim/test_devsim.py
+-rw-r--r--   0        0        0      189 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/disable_print.py
+-rw-r--r--   0        0        0       79 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/eme/__init__.py
+-rw-r--r--   0        0        0    14784 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/eme/meow_eme.py
+-rw-r--r--   0        0        0     1771 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/eme/test_meow_simulation.py
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/fem/__init__.py
+-rw-r--r--   0        0        0     8968 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/fem/mode_solver.py
+-rw-r--r--   0        0        0     2205 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/fem/test_mode_solver.py
+-rw-r--r--   0        0        0     3351 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/get_effective_indices.py
+-rw-r--r--   0        0        0     3109 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/get_modes_path.py
+-rw-r--r--   0        0        0     3888 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/get_sparameters_path.py
+-rw-r--r--   0        0        0     1863 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/__init__.py
+-rw-r--r--   0        0        0     3194 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_material.py
+-rw-r--r--   0        0        0     6137 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_meep_geometry.py
+-rw-r--r--   0        0        0     6054 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_port_eigenmode.py
+-rw-r--r--   0        0        0    11014 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_simulation.py
+-rw-r--r--   0        0        0    15701 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py
+-rw-r--r--   0        0        0    17944 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py
+-rw-r--r--   0        0        0    12302 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py
+-rw-r--r--   0        0        0    11914 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_eigenmode.py
+-rw-r--r--   0        0        0      832 2023-05-05 22:23:15.399309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_materials.py
+-rw-r--r--   0        0        0    10128 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv
+-rw-r--r--   0        0        0    10128 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv
+-rw-r--r--   0        0        0     6642 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py
+-rw-r--r--   0        0        0    10128 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv
+-rw-r--r--   0        0        0    10128 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv
+-rw-r--r--   0        0        0    10093 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv
+-rw-r--r--   0        0        0    10085 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv
+-rw-r--r--   0        0        0    10085 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv
+-rw-r--r--   0        0        0    34701 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv
+-rw-r--r--   0        0        0    10123 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv
+-rw-r--r--   0        0        0     9966 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv
+-rw-r--r--   0        0        0     9966 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv
+-rw-r--r--   0        0        0    10085 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv
+-rw-r--r--   0        0        0    10129 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv
+-rw-r--r--   0        0        0    13951 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_grating.py
+-rw-r--r--   0        0        0    21273 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_meep.py
+-rw-r--r--   0        0        0     8135 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py
+-rw-r--r--   0        0        0     9561 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py
+-rw-r--r--   0        0        0     1246 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/__init__.py
+-rw-r--r--   0        0        0     6653 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/break_geometry.py
+-rw-r--r--   0        0        0    11250 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/mesh.py
+-rw-r--r--   0        0        0    11808 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/meshtracker.py
+-rw-r--r--   0        0        0     7752 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/parse_component.py
+-rw-r--r--   0        0        0     3644 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/parse_gds.py
+-rw-r--r--   0        0        0     3605 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/parse_layerstack.py
+-rw-r--r--   0        0        0     2990 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/refine.py
+-rw-r--r--   0        0        0    10851 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/scratch/mesh3D.py
+-rw-r--r--   0        0        0     2489 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/tests/test_meshing.py
+-rw-r--r--   0        0        0    14168 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/uz_xsection_mesh.py
+-rw-r--r--   0        0        0     7441 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/xy_xsection_mesh.py
+-rw-r--r--   0        0        0    16326 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gmsh/xyz_mesh.py
+-rw-r--r--   0        0        0     1524 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/__init__.py
+-rw-r--r--   0        0        0     4368 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/get_results.py
+-rw-r--r--   0        0        0    20009 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/get_simulation.py
+-rw-r--r--   0        0        0    21061 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py
+-rw-r--r--   0        0        0     2821 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/materials.py
+-rw-r--r--   0        0        0    39677 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/modes.py
+-rw-r--r--   0        0        0     8941 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/sim_run.yaml
+-rw-r--r--   0        0        0     8114 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml
+-rw-r--r--   0        0        0     8114 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml
+-rw-r--r--   0        0        0     1597 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_modes.py
+-rw-r--r--   0        0        0      262 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_modes/test_sweep_width.csv
+-rw-r--r--   0        0        0      879 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_results.py
+-rw-r--r--   0        0        0     1505 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_simulation.py
+-rw-r--r--   0        0        0     1270 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py
+-rw-r--r--   0        0        0     9297 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv
+-rw-r--r--   0        0        0     1732 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py
+-rw-r--r--   0        0        0     1224 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/utils.py
+-rw-r--r--   0        0        0    10515 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/write_sparameters.py
+-rw-r--r--   0        0        0     7695 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py
+-rw-r--r--   0        0        0      588 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/lumerical/__init__.py
+-rw-r--r--   0        0        0    16011 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/lumerical/interconnect.py
+-rw-r--r--   0        0        0     4286 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/lumerical/read.py
+-rw-r--r--   0        0        0     3569 2023-05-05 22:23:15.403309 gdsfactory-6.91.0/gdsfactory/simulation/lumerical/settings.py
+-rw-r--r--   0        0        0     2348 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/lumerical/test_read_sparameters.py
+-rw-r--r--   0        0        0    19865 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py
+-rw-r--r--   0        0        0     1504 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py
+-rw-r--r--   0        0        0      932 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/__init__.py
+-rw-r--r--   0        0        0     1574 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/coupler.py
+-rw-r--r--   0        0        0     4132 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/find_coupling_vs_gap.py
+-rw-r--r--   0        0        0     2534 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/find_mode_dispersion.py
+-rw-r--r--   0        0        0     8846 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/find_modes.py
+-rwxr-xr-x   0        0        0     7032 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/find_modes_cross_section.py
+-rw-r--r--   0        0        0     4448 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py
+-rw-r--r--   0        0        0     2706 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/find_neff_vs_width.py
+-rw-r--r--   0        0        0     6956 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/get_mode_solver_coupler.py
+-rwxr-xr-x   0        0        0     4462 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/get_mode_solver_cross_section.py
+-rw-r--r--   0        0        0     5257 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/get_mode_solver_rib.py
+-rw-r--r--   0        0        0     1110 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv
+-rw-r--r--   0        0        0     1102 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv
+-rw-r--r--   0        0        0     1110 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv
+-rw-r--r--   0        0        0     7979 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/neff_convergence_test.py
+-rw-r--r--   0        0        0      267 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/neff_vs_width.csv
+-rw-r--r--   0        0        0     2469 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/overlap.py
+-rw-r--r--   0        0        0      418 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_dw_dh.py
+-rw-r--r--   0        0        0       83 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh.csv
+-rw-r--r--   0        0        0      548 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv
+-rw-r--r--   0        0        0     1131 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_find_modes.py
+-rw-r--r--   0        0        0      647 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py
+-rw-r--r--   0        0        0      354 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_neff_vs_width.py
+-rw-r--r--   0        0        0      113 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_neff_vs_width/test_neff_vs_width.csv
+-rw-r--r--   0        0        0    15452 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/types.py
+-rw-r--r--   0        0        0     1145 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/modes/waveguide.py
+-rw-r--r--   0        0        0     2013 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/__init__.py
+-rw-r--r--   0        0        0      597 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/coupler.py
+-rw-r--r--   0        0        0      377 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/fsr.py
+-rw-r--r--   0        0        0      418 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/heater.py
+-rw-r--r--   0        0        0     3063 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/mzi.py
+-rw-r--r--   0        0        0     2616 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/ring.py
+-rw-r--r--   0        0        0     7332 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/plot.py
+-rw-r--r--   0        0        0     2480 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/plot_csv.py
+-rw-r--r--   0        0        0      703 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/port_symmetries.py
+-rw-r--r--   0        0        0     4637 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/diffusion.py
+-rw-r--r--   0        0        0     5317 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/implant_tables.py
+-rw-r--r--   0        0        0     6784 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/pysrim.py
+-rw-r--r--   0        0        0     2182 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/silicon.py
+-rw-r--r--   0        0        0     1861 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/skew/antimony_si_skew.csv
+-rw-r--r--   0        0        0     1050 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/skew/arsenic_si_skew.csv
+-rw-r--r--   0        0        0     1468 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/skew/boron_si_skew.csv
+-rw-r--r--   0        0        0     1118 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv
+-rw-r--r--   0        0        0      191 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/__init__.py
+-rw-r--r--   0        0        0    14792 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/build_model.py
+-rw-r--r--   0        0        0     7449 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/femwell_waveguide_model.py
+-rw-r--r--   0        0        0     1571 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/interpolators.py
+-rw-r--r--   0        0        0     6755 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/meep_FDTD_model.py
+-rw-r--r--   0        0        0     4528 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/meow_eme_model.py
+-rw-r--r--   0        0        0     5613 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/mlp.py
+-rw-r--r--   0        0        0     7358 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/models.py
+-rw-r--r--   0        0        0    13884 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/parameter.py
+-rwxr-xr-x   0        0        0     2205 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/plot_model.py
+-rw-r--r--   0        0        0     6805 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/read.py
+-rw-r--r--   0        0        0     1350 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/tests/test_mzi.py
+-rw-r--r--   0        0        0     2220 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/tests/test_mzi_lattice.py
+-rw-r--r--   0        0        0     1397 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/sax/tests/test_parameters.py
+-rw-r--r--   0        0        0     1357 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/__init__.py
+-rw-r--r--   0        0        0     1573 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/add_gc.py
+-rw-r--r--   0        0        0     3383 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/circuit.py
+-rw-r--r--   0        0        0      891 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/__init__.py
+-rw-r--r--   0        0        0     1295 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/bend_circular.py
+-rw-r--r--   0        0        0     1388 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/bend_euler.py
+-rw-r--r--   0        0        0     2560 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler.py
+-rw-r--r--   0        0        0     1046 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_fdtd.py
+-rw-r--r--   0        0        0     1848 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_ring.py
+-rw-r--r--   0        0        0     1329 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py
+-rw-r--r--   0        0        0      589 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py
+-rw-r--r--   0        0        0      913 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/gc.py
+-rw-r--r--   0        0        0     2032 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mmi1x2.py
+-rw-r--r--   0        0        0     1910 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mmi2x2.py
+-rw-r--r--   0        0        0     2618 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mzi.py
+-rw-r--r--   0        0        0     1759 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mzi_siepic.py
+-rw-r--r--   0        0        0      487 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mzi_thermal.py
+-rw-r--r--   0        0        0     2597 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_double.py
+-rw-r--r--   0        0        0     1665 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_double_siepic.py
+-rw-r--r--   0        0        0     1782 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_single.py
+-rw-r--r--   0        0        0     1416 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_single_siepic.py
+-rw-r--r--   0        0        0     1099 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/straight.py
+-rw-r--r--   0        0        0      800 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/get_transmission.py
+-rw-r--r--   0        0        0     2516 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/model_from_gdsfactory.py
+-rw-r--r--   0        0        0     3841 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/model_from_sparameters.py
+-rw-r--r--   0        0        0     2438 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/plot_circuit.py
+-rw-r--r--   0        0        0     1798 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py
+-rw-r--r--   0        0        0     2773 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/plot_model.py
+-rw-r--r--   0        0        0     1261 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_circuit.py
+-rw-r--r--   0        0        0       90 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_circuit/test_circuit_transmission.yml
+-rw-r--r--   0        0        0     1109 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components.py
+-rw-r--r--   0        0        0       66 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_mzi_.yml
+-rw-r--r--   0        0        0       69 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_double_.yml
+-rw-r--r--   0        0        0       69 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_circuits_ring_single_.yml
+-rw-r--r--   0        0        0       92 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_circular_.yml
+-rw-r--r--   0        0        0       92 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_bend_euler_.yml
+-rw-r--r--   0        0        0      412 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_.yml
+-rw-r--r--   0        0        0      412 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_coupler_ring_.yml
+-rw-r--r--   0        0        0      114 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_gc1550te_.yml
+-rw-r--r--   0        0        0      256 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi1x2_.yml
+-rw-r--r--   0        0        0      460 2023-05-05 22:23:15.407309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_mmi2x2_.yml
+-rw-r--r--   0        0        0      104 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components/test_elements_straight_.yml
+-rw-r--r--   0        0        0      166 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/simphony/types.py
+-rw-r--r--   0        0        0      471 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/sipann/__init__.py
+-rw-r--r--   0        0        0     1376 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/sipann/bend_circular.py
+-rw-r--r--   0        0        0     1465 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/sipann/bend_euler.py
+-rw-r--r--   0        0        0     2508 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/sipann/coupler.py
+-rw-r--r--   0        0        0     1892 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/sipann/coupler_ring.py
+-rw-r--r--   0        0        0      736 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/sipann/straight.py
+-rw-r--r--   0        0        0      100 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/thermal/__init__.py
+-rw-r--r--   0        0        0     7781 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/simulation/thermal/heater.py
+-rw-r--r--   0        0        0     1744 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/snap.py
+-rw-r--r--   0        0        0     4245 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/symbols.py
+-rw-r--r--   0        0        0      524 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/technology/__init__.py
+-rw-r--r--   0        0        0     7065 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/technology/klayout_tech.py
+-rw-r--r--   0        0        0     1078 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/technology/layer_map.py
+-rw-r--r--   0        0        0    14989 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/technology/layer_stack.py
+-rw-r--r--   0        0        0    42052 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/technology/layer_views.py
+-rw-r--r--   0        0        0     1984 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/technology/simulation_settings.py
+-rw-r--r--   0        0        0     1635 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/types.py
+-rw-r--r--   0        0        0    10000 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/typings.py
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/utils/__init__.py
+-rw-r--r--   0        0        0     1304 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/utils/async_utils.py
+-rw-r--r--   0        0        0      376 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/utils/color_utils.py
+-rw-r--r--   0        0        0      558 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/utils/file_utils.py
+-rw-r--r--   0        0        0      185 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/utils/function_utils.py
+-rw-r--r--   0        0        0      676 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/utils/xml_utils.py
+-rw-r--r--   0        0        0     1429 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/utils/yaml_utils.py
+-rw-r--r--   0        0        0     4825 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/watch.py
+-rw-r--r--   0        0        0        0 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/widgets/__init__.py
+-rw-r--r--   0        0        0     7921 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/widgets/layout_viewer.py
+-rw-r--r--   0        0        0     7454 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/gdsfactory/write_cells.py
+-rw-r--r--   0        0        0     5467 2023-05-05 22:23:15.411309 gdsfactory-6.91.0/pyproject.toml
+-rw-r--r--   0        0        0    18547 1970-01-01 00:00:00.000000 gdsfactory-6.91.0/PKG-INFO
```

### Comparing `gdsfactory-6.90.9/LICENSE` & `gdsfactory-6.91.0/LICENSE`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/README.md` & `gdsfactory-6.91.0/README.md`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# gdsfactory 6.90.9
+# gdsfactory 6.91.0
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![issues](https://img.shields.io/github/issues/gdsfactory/gdsfactory)](https://github.com/gdsfactory/gdsfactory/issues)
```

### Comparing `gdsfactory-6.90.9/gdsfactory/__init__.py` & `gdsfactory-6.91.0/gdsfactory/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -142,8 +142,8 @@
     "snap",
     "typings",
     "technology",
     "write_cells",
     "xsection",
     "PATH",
 )
-__version__ = "6.90.9"
+__version__ = "6.91.0"
```

### Comparing `gdsfactory-6.90.9/gdsfactory/add_keepout.py` & `gdsfactory-6.91.0/gdsfactory/add_keepout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_labels.py` & `gdsfactory-6.91.0/gdsfactory/add_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_loopback.py` & `gdsfactory-6.91.0/gdsfactory/add_loopback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_padding.py` & `gdsfactory-6.91.0/gdsfactory/add_padding.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_pins.py` & `gdsfactory-6.91.0/gdsfactory/add_pins.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_ports.py` & `gdsfactory-6.91.0/gdsfactory/add_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_tapers.py` & `gdsfactory-6.91.0/gdsfactory/add_tapers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_tapers_cross_section.py` & `gdsfactory-6.91.0/gdsfactory/add_tapers_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/add_termination.py` & `gdsfactory-6.91.0/gdsfactory/add_termination.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/asserts.py` & `gdsfactory-6.91.0/gdsfactory/asserts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/cell.py` & `gdsfactory-6.91.0/gdsfactory/cell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/circuitviz.py` & `gdsfactory-6.91.0/gdsfactory/circuitviz.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/cli.py` & `gdsfactory-6.91.0/gdsfactory/cli.py`

 * *Files 2% similar despite different names*

```diff
@@ -19,15 +19,15 @@
 from gdsfactory.write_cells import write_cells as write_cells_to_separate_gds
 
 try:
     import rich_click as click
 except ImportError:
     import click
 
-VERSION = "6.90.9"
+VERSION = "6.91.0"
 LAYER_LABEL = LAYER.LABEL
 
 
 def print_version(ctx: Context, param: Option, value: bool) -> None:
     """Prints the version."""
     if not value or ctx.resilient_parsing:
         return
```

### Comparing `gdsfactory-6.90.9/gdsfactory/component.py` & `gdsfactory-6.91.0/gdsfactory/component.py`

 * *Files 2% similar despite different names*

```diff
@@ -8,6198 +8,6182 @@
 00000070: 2222 220a 6672 6f6d 205f 5f66 7574 7572  """.from __futur
 00000080: 655f 5f20 696d 706f 7274 2061 6e6e 6f74  e__ import annot
 00000090: 6174 696f 6e73 0a0a 696d 706f 7274 2064  ations..import d
 000000a0: 6174 6574 696d 650a 696d 706f 7274 2068  atetime.import h
 000000b0: 6173 686c 6962 0a69 6d70 6f72 7420 6974  ashlib.import it
 000000c0: 6572 746f 6f6c 730a 696d 706f 7274 206d  ertools.import m
 000000d0: 6174 680a 696d 706f 7274 2070 6174 686c  ath.import pathl
-000000e0: 6962 0a69 6d70 6f72 7420 7465 6d70 6669  ib.import tempfi
-000000f0: 6c65 0a69 6d70 6f72 7420 7575 6964 0a69  le.import uuid.i
-00000100: 6d70 6f72 7420 7761 726e 696e 6773 0a66  mport warnings.f
-00000110: 726f 6d20 636f 6c6c 6563 7469 6f6e 7320  rom collections 
-00000120: 696d 706f 7274 2043 6f75 6e74 6572 0a66  import Counter.f
-00000130: 726f 6d20 636f 6c6c 6563 7469 6f6e 732e  rom collections.
-00000140: 6162 6320 696d 706f 7274 2049 7465 7261  abc import Itera
-00000150: 626c 650a 6672 6f6d 2070 6174 686c 6962  ble.from pathlib
-00000160: 2069 6d70 6f72 7420 5061 7468 0a66 726f   import Path.fro
-00000170: 6d20 7479 7069 6e67 2069 6d70 6f72 7420  m typing import 
-00000180: 416e 792c 2044 6963 742c 204c 6973 742c  Any, Dict, List,
-00000190: 204f 7074 696f 6e61 6c2c 2053 6574 2c20   Optional, Set, 
-000001a0: 5475 706c 652c 2055 6e69 6f6e 0a0a 696d  Tuple, Union..im
-000001b0: 706f 7274 2067 6473 746b 0a69 6d70 6f72  port gdstk.impor
-000001c0: 7420 6e75 6d70 7920 6173 206e 700a 696d  t numpy as np.im
-000001d0: 706f 7274 2079 616d 6c0a 6672 6f6d 206f  port yaml.from o
-000001e0: 6d65 6761 636f 6e66 2069 6d70 6f72 7420  megaconf import 
-000001f0: 4469 6374 436f 6e66 6967 2c20 4f6d 6567  DictConfig, Omeg
-00000200: 6143 6f6e 660a 6672 6f6d 2074 7970 696e  aConf.from typin
-00000210: 675f 6578 7465 6e73 696f 6e73 2069 6d70  g_extensions imp
-00000220: 6f72 7420 4c69 7465 7261 6c0a 0a66 726f  ort Literal..fro
-00000230: 6d20 6764 7366 6163 746f 7279 2e63 6f6d  m gdsfactory.com
-00000240: 706f 6e65 6e74 5f6c 6179 6f75 7420 696d  ponent_layout im
-00000250: 706f 7274 2028 0a20 2020 204c 6162 656c  port (.    Label
-00000260: 2c0a 2020 2020 506f 6c79 676f 6e2c 0a20  ,.    Polygon,. 
-00000270: 2020 205f 616c 6967 6e2c 0a20 2020 205f     _align,.    _
-00000280: 6469 7374 7269 6275 7465 2c0a 2020 2020  distribute,.    
-00000290: 5f47 656f 6d65 7472 7948 656c 7065 722c  _GeometryHelper,
-000002a0: 0a20 2020 205f 7061 7273 655f 6c61 7965  .    _parse_laye
-000002b0: 722c 0a20 2020 2067 6574 5f70 6f6c 7967  r,.    get_polyg
-000002c0: 6f6e 732c 0a29 0a66 726f 6d20 6764 7366  ons,.).from gdsf
-000002d0: 6163 746f 7279 2e63 6f6d 706f 6e65 6e74  actory.component
-000002e0: 5f72 6566 6572 656e 6365 2069 6d70 6f72  _reference impor
-000002f0: 7420 436f 6d70 6f6e 656e 7452 6566 6572  t ComponentRefer
-00000300: 656e 6365 2c20 436f 6f72 6469 6e61 7465  ence, Coordinate
-00000310: 2c20 5369 7a65 496e 666f 0a66 726f 6d20  , SizeInfo.from 
-00000320: 6764 7366 6163 746f 7279 2e63 6f6e 6669  gdsfactory.confi
-00000330: 6720 696d 706f 7274 2043 4f4e 462c 206c  g import CONF, l
-00000340: 6f67 6765 720a 6672 6f6d 2067 6473 6661  ogger.from gdsfa
-00000350: 6374 6f72 792e 6372 6f73 735f 7365 6374  ctory.cross_sect
-00000360: 696f 6e20 696d 706f 7274 2043 726f 7373  ion import Cross
-00000370: 5365 6374 696f 6e0a 6672 6f6d 2067 6473  Section.from gds
-00000380: 6661 6374 6f72 792e 706f 7274 2069 6d70  factory.port imp
-00000390: 6f72 7420 280a 2020 2020 506f 7274 2c0a  ort (.    Port,.
-000003a0: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
-000003b0: 706f 7274 732c 0a20 2020 2061 7574 6f5f  ports,.    auto_
-000003c0: 7265 6e61 6d65 5f70 6f72 7473 5f63 6f75  rename_ports_cou
-000003d0: 6e74 6572 5f63 6c6f 636b 7769 7365 2c0a  nter_clockwise,.
-000003e0: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
-000003f0: 706f 7274 735f 6c61 7965 725f 6f72 6965  ports_layer_orie
-00000400: 6e74 6174 696f 6e2c 0a20 2020 2061 7574  ntation,.    aut
-00000410: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f6f  o_rename_ports_o
-00000420: 7269 656e 7461 7469 6f6e 2c0a 2020 2020  rientation,.    
-00000430: 6d61 705f 706f 7274 735f 6c61 7965 725f  map_ports_layer_
-00000440: 746f 5f6f 7269 656e 7461 7469 6f6e 2c0a  to_orientation,.
-00000450: 2020 2020 6d61 705f 706f 7274 735f 746f      map_ports_to
-00000460: 5f6f 7269 656e 7461 7469 6f6e 5f63 6377  _orientation_ccw
-00000470: 2c0a 2020 2020 6d61 705f 706f 7274 735f  ,.    map_ports_
-00000480: 746f 5f6f 7269 656e 7461 7469 6f6e 5f63  to_orientation_c
-00000490: 772c 0a20 2020 2073 656c 6563 745f 706f  w,.    select_po
-000004a0: 7274 732c 0a29 0a66 726f 6d20 6764 7366  rts,.).from gdsf
-000004b0: 6163 746f 7279 2e73 6572 6961 6c69 7a61  actory.serializa
-000004c0: 7469 6f6e 2069 6d70 6f72 7420 636c 6561  tion import clea
-000004d0: 6e5f 6469 6374 0a66 726f 6d20 6764 7366  n_dict.from gdsf
-000004e0: 6163 746f 7279 2e73 6e61 7020 696d 706f  actory.snap impo
-000004f0: 7274 2073 6e61 705f 746f 5f67 7269 640a  rt snap_to_grid.
-00000500: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-00000510: 7465 6368 6e6f 6c6f 6779 2069 6d70 6f72  technology impor
-00000520: 7420 4c61 7965 7256 6965 772c 204c 6179  t LayerView, Lay
-00000530: 6572 5669 6577 732c 204c 6179 6572 5374  erViews, LayerSt
-00000540: 6163 6b0a 6672 6f6d 2067 6473 6661 6374  ack.from gdsfact
-00000550: 6f72 792e 6765 6e65 7269 635f 7465 6368  ory.generic_tech
-00000560: 2069 6d70 6f72 7420 4c41 5945 520a 0a50   import LAYER..P
-00000570: 6c6f 7474 6572 203d 204c 6974 6572 616c  lotter = Literal
-00000580: 5b22 686f 6c6f 7669 6577 7322 2c20 226d  ["holoviews", "m
-00000590: 6174 706c 6f74 6c69 6222 2c20 2271 7422  atplotlib", "qt"
-000005a0: 2c20 226b 6c61 796f 7574 225d 0a41 7869  , "klayout"].Axi
-000005b0: 7320 3d20 4c69 7465 7261 6c5b 2278 222c  s = Literal["x",
-000005c0: 2022 7922 5d0a 0a47 4453 4449 525f 5445   "y"]..GDSDIR_TE
-000005d0: 4d50 203d 2070 6174 686c 6962 2e50 6174  MP = pathlib.Pat
-000005e0: 6828 7465 6d70 6669 6c65 2e54 656d 706f  h(tempfile.Tempo
-000005f0: 7261 7279 4469 7265 6374 6f72 7928 292e  raryDirectory().
-00000600: 6e61 6d65 292e 7061 7265 6e74 202f 2022  name).parent / "
-00000610: 6764 7366 6163 746f 7279 220a 0a0a 636c  gdsfactory"...cl
-00000620: 6173 7320 556e 6361 6368 6564 436f 6d70  ass UncachedComp
-00000630: 6f6e 656e 7457 6172 6e69 6e67 2855 7365  onentWarning(Use
-00000640: 7257 6172 6e69 6e67 293a 0a20 2020 2070  rWarning):.    p
-00000650: 6173 730a 0a0a 636c 6173 7320 556e 6361  ass...class Unca
-00000660: 6368 6564 436f 6d70 6f6e 656e 7445 7272  chedComponentErr
-00000670: 6f72 2856 616c 7565 4572 726f 7229 3a0a  or(ValueError):.
-00000680: 2020 2020 7061 7373 0a0a 0a63 6c61 7373      pass...class
-00000690: 204d 7574 6162 696c 6974 7945 7272 6f72   MutabilityError
-000006a0: 2856 616c 7565 4572 726f 7229 3a0a 2020  (ValueError):.  
-000006b0: 2020 7061 7373 0a0a 0a64 6566 205f 6765    pass...def _ge
-000006c0: 745f 6465 7065 6e64 656e 6369 6573 2863  t_dependencies(c
-000006d0: 6f6d 706f 6e65 6e74 2c20 7265 6665 7265  omponent, refere
-000006e0: 6e63 6573 5f73 6574 293a 0a20 2020 2066  nces_set):.    f
-000006f0: 6f72 2072 6566 2069 6e20 636f 6d70 6f6e  or ref in compon
-00000700: 656e 742e 7265 6665 7265 6e63 6573 3a0a  ent.references:.
-00000710: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
-00000720: 6573 5f73 6574 2e61 6464 2872 6566 2e72  es_set.add(ref.r
-00000730: 6566 5f63 656c 6c29 0a20 2020 2020 2020  ef_cell).       
-00000740: 205f 6765 745f 6465 7065 6e64 656e 6369   _get_dependenci
-00000750: 6573 2872 6566 2e72 6566 5f63 656c 6c2c  es(ref.ref_cell,
-00000760: 2072 6566 6572 656e 6365 735f 7365 7429   references_set)
-00000770: 0a0a 0a6d 7574 6162 696c 6974 795f 6572  ...mutability_er
-00000780: 726f 725f 6d65 7373 6167 6520 3d20 2222  ror_message = ""
-00000790: 220a 596f 7520 6361 6e6e 6f74 206d 6f64  ".You cannot mod
-000007a0: 6966 7920 6120 436f 6d70 6f6e 656e 7420  ify a Component 
-000007b0: 6166 7465 7220 6372 6561 7469 6f6e 2061  after creation a
-000007c0: 7320 6974 2077 696c 6c20 6166 6665 6374  s it will affect
-000007d0: 2061 6c6c 206f 6620 6974 7320 696e 7374   all of its inst
-000007e0: 616e 6365 732e 0a0a 4372 6561 7465 2061  ances...Create a
-000007f0: 206e 6577 2043 6f6d 706f 6e65 6e74 2061   new Component a
-00000800: 6e64 2061 6464 2061 2072 6566 6572 656e  nd add a referen
-00000810: 6365 2074 6f20 6974 2e0a 0a46 6f72 2065  ce to it...For e
-00000820: 7861 6d70 6c65 3a0a 0a23 2042 4144 0a63  xample:..# BAD.c
-00000830: 203d 2067 662e 636f 6d70 6f6e 656e 7473   = gf.components
-00000840: 2e62 656e 645f 6575 6c65 7228 290a 632e  .bend_euler().c.
-00000850: 6164 645f 7265 6628 6766 2e63 6f6d 706f  add_ref(gf.compo
-00000860: 6e65 6e74 732e 6d7a 6928 2929 0a0a 2320  nents.mzi())..# 
-00000870: 474f 4f44 0a63 203d 2067 662e 436f 6d70  GOOD.c = gf.Comp
-00000880: 6f6e 656e 7428 290a 632e 6164 645f 7265  onent().c.add_re
-00000890: 6628 6766 2e63 6f6d 706f 6e65 6e74 732e  f(gf.components.
-000008a0: 6265 6e64 5f65 756c 6572 2829 290a 632e  bend_euler()).c.
-000008b0: 6164 645f 7265 6628 6766 2e63 6f6d 706f  add_ref(gf.compo
-000008c0: 6e65 6e74 732e 6d7a 6928 2929 0a22 2222  nents.mzi())."""
-000008d0: 0a0a 6d6f 7665 5f65 7272 6f72 5f6d 6573  ..move_error_mes
-000008e0: 7361 6765 203d 2022 2222 0a59 6f75 2063  sage = """.You c
-000008f0: 616e 6e6f 7420 6d6f 7665 2061 2043 6f6d  annot move a Com
-00000900: 706f 6e65 6e74 2e20 596f 7520 6361 6e20  ponent. You can 
-00000910: 6372 6561 7465 2061 206e 6577 2043 6f6d  create a new Com
-00000920: 706f 6e65 6e74 2c20 6164 6420 6120 7265  ponent, add a re
-00000930: 6665 7265 6e63 6520 746f 2074 6865 206f  ference to the o
-00000940: 7468 6572 2043 6f6d 706f 6e65 6e74 2061  ther Component a
-00000950: 6e64 2074 6865 6e20 6d6f 7665 2074 6865  nd then move the
-00000960: 2072 6566 6572 656e 6365 2e0a 0a46 6f72   reference...For
-00000970: 2065 7861 6d70 6c65 3a0a 0a23 2042 4144   example:..# BAD
-00000980: 0a63 203d 2067 662e 636f 6d70 6f6e 656e  .c = gf.componen
-00000990: 7473 2e73 7472 6169 6768 7428 290a 632e  ts.straight().c.
-000009a0: 786d 696e 203d 2031 300a 0a23 2047 4f4f  xmin = 10..# GOO
-000009b0: 440a 6320 3d20 6766 2e43 6f6d 706f 6e65  D.c = gf.Compone
-000009c0: 6e74 2829 0a72 6566 203d 2063 2e61 6464  nt().ref = c.add
-000009d0: 5f72 6566 2867 662e 636f 6d70 6f6e 656e  _ref(gf.componen
-000009e0: 7473 2e73 7472 6169 6768 7428 2929 2023  ts.straight()) #
-000009f0: 206f 7220 7265 6620 3d20 6320 3c3c 2067   or ref = c << g
-00000a00: 662e 636f 6d70 6f6e 656e 7473 2e73 7472  f.components.str
-00000a10: 6169 6768 7428 290a 7265 662e 786d 696e  aight().ref.xmin
-00000a20: 203d 2031 300a 2222 220a 0a50 6174 6854   = 10."""..PathT
-00000a30: 7970 6520 3d20 556e 696f 6e5b 7374 722c  ype = Union[str,
-00000a40: 2050 6174 685d 0a46 6c6f 6174 3220 3d20   Path].Float2 = 
-00000a50: 5475 706c 655b 666c 6f61 742c 2066 6c6f  Tuple[float, flo
-00000a60: 6174 5d0a 4c61 7965 7220 3d20 5475 706c  at].Layer = Tupl
-00000a70: 655b 696e 742c 2069 6e74 5d0a 4c61 7965  e[int, int].Laye
-00000a80: 7273 203d 2054 7570 6c65 5b4c 6179 6572  rs = Tuple[Layer
-00000a90: 2c20 2e2e 2e5d 0a4c 6179 6572 5370 6563  , ...].LayerSpec
-00000aa0: 203d 2055 6e69 6f6e 5b73 7472 2c20 696e   = Union[str, in
-00000ab0: 742c 204c 6179 6572 2c20 4e6f 6e65 5d0a  t, Layer, None].
-00000ac0: 0a74 6d70 203d 2070 6174 686c 6962 2e50  .tmp = pathlib.P
-00000ad0: 6174 6828 7465 6d70 6669 6c65 2e54 656d  ath(tempfile.Tem
-00000ae0: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
-00000af0: 292e 6e61 6d65 2920 2f20 2267 6473 6661  ).name) / "gdsfa
-00000b00: 6374 6f72 7922 0a74 6d70 2e6d 6b64 6972  ctory".tmp.mkdir
-00000b10: 2865 7869 7374 5f6f 6b3d 5472 7565 2c20  (exist_ok=True, 
-00000b20: 7061 7265 6e74 733d 5472 7565 290a 5f74  parents=True)._t
-00000b30: 696d 6573 7461 6d70 3230 3139 203d 2064  imestamp2019 = d
-00000b40: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-00000b50: 2e66 726f 6d74 696d 6573 7461 6d70 2831  .fromtimestamp(1
-00000b60: 3537 3230 3134 3139 322e 3832 3733 290a  572014192.8273).
-00000b70: 4d41 585f 4e41 4d45 5f4c 454e 4754 4820  MAX_NAME_LENGTH 
-00000b80: 3d20 3332 0a0a 0a64 6566 205f 726e 6428  = 32...def _rnd(
-00000b90: 6172 722c 2070 7265 6369 7369 6f6e 3d31  arr, precision=1
-00000ba0: 652d 3429 3a0a 2020 2020 6172 7220 3d20  e-4):.    arr = 
-00000bb0: 6e70 2e61 7363 6f6e 7469 6775 6f75 7361  np.ascontiguousa
-00000bc0: 7272 6179 2861 7272 290a 2020 2020 6e64  rray(arr).    nd
-00000bd0: 6967 6974 7320 3d20 726f 756e 6428 2d6d  igits = round(-m
-00000be0: 6174 682e 6c6f 6731 3028 7072 6563 6973  ath.log10(precis
-00000bf0: 696f 6e29 290a 2020 2020 7265 7475 726e  ion)).    return
-00000c00: 206e 702e 6173 636f 6e74 6967 756f 7573   np.ascontiguous
-00000c10: 6172 7261 7928 6172 722e 726f 756e 6428  array(arr.round(
-00000c20: 6e64 6967 6974 7329 202f 2070 7265 6369  ndigits) / preci
-00000c30: 7369 6f6e 2c20 6474 7970 653d 6e70 2e69  sion, dtype=np.i
-00000c40: 6e74 3634 290a 0a0a 636c 6173 7320 436f  nt64)...class Co
-00000c50: 6d70 6f6e 656e 7428 5f47 656f 6d65 7472  mponent(_Geometr
-00000c60: 7948 656c 7065 7229 3a0a 2020 2020 2222  yHelper):.    ""
-00000c70: 2241 2043 6f6d 706f 6e65 6e74 2069 7320  "A Component is 
-00000c80: 616e 2065 6d70 7479 2063 616e 7661 7320  an empty canvas 
-00000c90: 7768 6572 6520 796f 7520 6164 6420 706f  where you add po
-00000ca0: 6c79 676f 6e73 2c20 7265 6665 7265 6e63  lygons, referenc
-00000cb0: 6573 2061 6e64 2070 6f72 7473 205c 0a20  es and ports \. 
-00000cc0: 2020 2020 2020 2020 2020 2028 746f 2063             (to c
-00000cd0: 6f6e 6e65 6374 2074 6f20 6f74 6865 7220  onnect to other 
-00000ce0: 636f 6d70 6f6e 656e 7473 292e 0a0a 2020  components)...  
-00000cf0: 2020 2d20 7374 6f72 6573 2073 6574 7469    - stores setti
-00000d00: 6e67 7320 7468 6174 2079 6f75 2075 7365  ngs that you use
-00000d10: 2074 6f20 6275 696c 6420 7468 6520 636f   to build the co
-00000d20: 6d70 6f6e 656e 740a 2020 2020 2d20 7374  mponent.    - st
-00000d30: 6f72 6573 2069 6e66 6f20 7468 6174 2079  ores info that y
-00000d40: 6f75 2077 616e 7420 746f 2075 7365 0a20  ou want to use. 
-00000d50: 2020 202d 2063 616e 2072 6574 7572 6e20     - can return 
-00000d60: 706f 7274 7320 6279 2074 7970 6520 286f  ports by type (o
-00000d70: 7074 6963 616c 2c20 656c 6563 7472 6963  ptical, electric
-00000d80: 616c 202e 2e2e 290a 2020 2020 2d20 6361  al ...).    - ca
-00000d90: 6e20 7265 7475 726e 206e 6574 6c69 7374  n return netlist
-00000da0: 2066 6f72 2063 6972 6375 6974 2073 696d   for circuit sim
-00000db0: 756c 6174 696f 6e0a 2020 2020 2d20 6361  ulation.    - ca
-00000dc0: 6e20 7772 6974 6520 746f 2047 4453 2c20  n write to GDS, 
-00000dd0: 4f41 5349 530a 2020 2020 2d20 6361 6e20  OASIS.    - can 
-00000de0: 7368 6f77 2069 6e20 4b4c 6179 6f75 742c  show in KLayout,
-00000df0: 206d 6174 706c 6f74 6c69 622c 2033 442c   matplotlib, 3D,
-00000e00: 2051 5420 7669 6577 6572 2c20 686f 6c6f   QT viewer, holo
-00000e10: 7669 6577 730a 2020 2020 2d20 6361 6e20  views.    - can 
-00000e20: 7265 7475 726e 2063 6f70 792c 206d 6972  return copy, mir
-00000e30: 726f 722c 2066 6c61 7474 656e 6564 2028  ror, flattened (
-00000e40: 6e6f 2072 6566 6572 656e 6365 7329 0a0a  no references)..
-00000e50: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00000e60: 2020 6e61 6d65 3a20 636f 6d70 6f6e 656e    name: componen
-00000e70: 745f 6e61 6d65 2e20 5573 6520 4063 656c  t_name. Use @cel
-00000e80: 6c20 6465 636f 7261 746f 7220 666f 7220  l decorator for 
-00000e90: 6175 746f 2d6e 616d 696e 672e 0a20 2020  auto-naming..   
-00000ea0: 2020 2020 2077 6974 685f 7575 6964 3a20       with_uuid: 
-00000eb0: 6164 6473 2075 6e69 7175 6520 6964 656e  adds unique iden
-00000ec0: 7469 6669 6572 2e0a 0a20 2020 2050 726f  tifier...    Pro
-00000ed0: 7065 7274 6965 733a 0a20 2020 2020 2020  perties:.       
-00000ee0: 2069 6e66 6f3a 2064 6963 7469 6f6e 6172   info: dictionar
-00000ef0: 7920 7468 6174 2069 6e63 6c75 6465 730a  y that includes.
-00000f00: 2020 2020 2020 2020 2020 2020 2d20 6465              - de
-00000f10: 7269 7665 6420 7072 6f70 6572 7469 6573  rived properties
-00000f20: 0a20 2020 2020 2020 2020 2020 202d 2065  .            - e
-00000f30: 7874 6572 6e61 6c20 6d65 7461 6461 7461  xternal metadata
-00000f40: 2028 7465 7374 5f70 726f 746f 636f 6c2c   (test_protocol,
-00000f50: 2064 6f63 732c 202e 2e2e 290a 2020 2020   docs, ...).    
-00000f60: 2020 2020 2020 2020 2d20 7369 6d75 6c61          - simula
-00000f70: 7469 6f6e 5f73 6574 7469 6e67 730a 2020  tion_settings.  
-00000f80: 2020 2020 2020 2020 2020 2d20 6675 6e63            - func
-00000f90: 7469 6f6e 5f6e 616d 650a 2020 2020 2020  tion_name.      
-00000fa0: 2020 2020 2020 2d20 6e61 6d65 3a20 666f        - name: fo
-00000fb0: 7220 7468 6520 636f 6d70 6f6e 656e 740a  r the component.
-00000fc0: 0a20 2020 2020 2020 2073 6574 7469 6e67  .        setting
-00000fd0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-00000fe0: 756c 6c3a 2066 756c 6c20 7365 7474 696e  ull: full settin
-00000ff0: 6773 2070 6173 7365 6420 746f 2074 6865  gs passed to the
-00001000: 2066 756e 6374 696f 6e20 746f 2063 7265   function to cre
-00001010: 6174 6520 636f 6d70 6f6e 656e 742e 0a20  ate component.. 
-00001020: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
-00001030: 6564 3a20 6368 616e 6765 6420 7365 7474  ed: changed sett
-00001040: 696e 6773 2e0a 2020 2020 2020 2020 2020  ings..          
-00001050: 2020 6465 6661 756c 743a 2064 6566 6175    default: defau
-00001060: 6c74 2063 6f6d 706f 6e65 6e74 2073 6574  lt component set
-00001070: 7469 6e67 732e 0a20 2020 2020 2020 2020  tings..         
-00001080: 2020 2063 6869 6c64 3a20 6469 6374 2069     child: dict i
-00001090: 6e66 6f20 6672 6f6d 2074 6865 2063 6869  nfo from the chi
-000010a0: 6c64 7265 6e2c 2069 6620 616e 792e 0a20  ldren, if any.. 
-000010b0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-000010c0: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
-000010d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000010e0: 6e61 6d65 3a20 7374 7220 3d20 2255 6e6e  name: str = "Unn
-000010f0: 616d 6564 222c 0a20 2020 2020 2020 2077  amed",.        w
-00001100: 6974 685f 7575 6964 3a20 626f 6f6c 203d  ith_uuid: bool =
-00001110: 2046 616c 7365 2c0a 2020 2020 2920 2d3e   False,.    ) ->
-00001120: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00001130: 2222 496e 6974 6961 6c69 7a65 2074 6865  ""Initialize the
-00001140: 2043 6f6d 706f 6e65 6e74 206f 626a 6563   Component objec
-00001150: 742e 2222 220a 2020 2020 2020 2020 7365  t.""".        se
-00001160: 6c66 2e75 6964 203d 2073 7472 2875 7569  lf.uid = str(uui
-00001170: 642e 7575 6964 3428 2929 5b3a 385d 0a20  d.uuid4())[:8]. 
-00001180: 2020 2020 2020 2069 6620 7769 7468 5f75         if with_u
-00001190: 7569 6420 6f72 206e 616d 6520 3d3d 2022  uid or name == "
-000011a0: 556e 6e61 6d65 6422 3a0a 2020 2020 2020  Unnamed":.      
-000011b0: 2020 2020 2020 6e61 6d65 202b 3d20 6622        name += f"
-000011c0: 5f7b 7365 6c66 2e75 6964 7d22 0a0a 2020  _{self.uid}"..  
-000011d0: 2020 2020 2020 7365 6c66 2e5f 6365 6c6c        self._cell
-000011e0: 203d 2067 6473 746b 2e43 656c 6c28 6e61   = gdstk.Cell(na
-000011f0: 6d65 3d6e 616d 6529 0a20 2020 2020 2020  me=name).       
-00001200: 2073 656c 662e 6e61 6d65 203d 206e 616d   self.name = nam
-00001210: 650a 2020 2020 2020 2020 7365 6c66 2e69  e.        self.i
-00001220: 6e66 6f3a 2044 6963 745b 7374 722c 2041  nfo: Dict[str, A
-00001230: 6e79 5d20 3d20 7b7d 0a0a 2020 2020 2020  ny] = {}..      
-00001240: 2020 7365 6c66 2e73 6574 7469 6e67 733a    self.settings:
-00001250: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
-00001260: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
-00001270: 662e 5f6c 6f63 6b65 6420 3d20 4661 6c73  f._locked = Fals
-00001280: 650a 2020 2020 2020 2020 7365 6c66 2e67  e.        self.g
-00001290: 6574 5f63 6869 6c64 5f6e 616d 6520 3d20  et_child_name = 
-000012a0: 4661 6c73 650a 2020 2020 2020 2020 7365  False.        se
-000012b0: 6c66 2e5f 7265 6665 7265 6e63 655f 6e61  lf._reference_na
-000012c0: 6d65 735f 636f 756e 7465 7220 3d20 436f  mes_counter = Co
-000012d0: 756e 7465 7228 290a 2020 2020 2020 2020  unter().        
-000012e0: 7365 6c66 2e5f 7265 6665 7265 6e63 655f  self._reference_
-000012f0: 6e61 6d65 735f 7573 6564 203d 2073 6574  names_used = set
-00001300: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-00001310: 5f6e 616d 6564 5f72 6566 6572 656e 6365  _named_reference
-00001320: 7320 3d20 7b7d 0a20 2020 2020 2020 2073  s = {}.        s
-00001330: 656c 662e 5f72 6566 6572 656e 6365 7320  elf._references 
-00001340: 3d20 5b5d 0a0a 2020 2020 2020 2020 7365  = []..        se
-00001350: 6c66 2e70 6f72 7473 203d 207b 7d0a 0a20  lf.ports = {}.. 
-00001360: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00001370: 2064 6566 2072 6566 6572 656e 6365 7328   def references(
-00001380: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00001390: 6574 7572 6e20 7365 6c66 2e5f 7265 6665  eturn self._refe
-000013a0: 7265 6e63 6573 0a0a 2020 2020 4070 726f  rences..    @pro
-000013b0: 7065 7274 790a 2020 2020 6465 6620 706f  perty.    def po
-000013c0: 6c79 676f 6e73 2873 656c 6629 202d 3e20  lygons(self) -> 
-000013d0: 4c69 7374 5b50 6f6c 7967 6f6e 5d3a 0a20  List[Polygon]:. 
-000013e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000013f0: 6c66 2e5f 6365 6c6c 2e70 6f6c 7967 6f6e  lf._cell.polygon
-00001400: 730a 0a20 2020 2040 7072 6f70 6572 7479  s..    @property
-00001410: 0a20 2020 2064 6566 2061 7265 6128 7365  .    def area(se
-00001420: 6c66 2920 2d3e 2066 6c6f 6174 3a0a 2020  lf) -> float:.  
-00001430: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00001440: 662e 5f63 656c 6c2e 6172 6561 0a0a 2020  f._cell.area..  
-00001450: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-00001460: 6465 6620 6c61 6265 6c73 2873 656c 6629  def labels(self)
-00001470: 202d 3e20 4c69 7374 5b4c 6162 656c 5d3a   -> List[Label]:
-00001480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00001490: 7365 6c66 2e5f 6365 6c6c 2e6c 6162 656c  self._cell.label
-000014a0: 730a 0a20 2020 2040 7072 6f70 6572 7479  s..    @property
-000014b0: 0a20 2020 2064 6566 2070 6174 6873 2873  .    def paths(s
-000014c0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-000014d0: 7475 726e 2073 656c 662e 5f63 656c 6c2e  turn self._cell.
-000014e0: 7061 7468 730a 0a20 2020 2040 7072 6f70  paths..    @prop
-000014f0: 6572 7479 0a20 2020 2064 6566 206e 616d  erty.    def nam
-00001500: 6528 7365 6c66 2920 2d3e 2073 7472 3a0a  e(self) -> str:.
-00001510: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00001520: 656c 662e 5f63 656c 6c2e 6e61 6d65 0a0a  elf._cell.name..
-00001530: 2020 2020 406e 616d 652e 7365 7474 6572      @name.setter
-00001540: 0a20 2020 2064 6566 206e 616d 6528 7365  .    def name(se
-00001550: 6c66 2c20 7661 6c75 6529 3a0a 2020 2020  lf, value):.    
-00001560: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e6e      self._cell.n
-00001570: 616d 6520 3d20 7661 6c75 650a 0a20 2020  ame = value..   
-00001580: 2064 6566 205f 5f69 7465 725f 5f28 7365   def __iter__(se
-00001590: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-000015a0: 596f 7520 6361 6e20 6974 6572 6174 6520  You can iterate 
-000015b0: 6f76 6572 2070 6f6c 7967 6f6e 732c 2070  over polygons, p
-000015c0: 6174 6873 2c20 6c61 6265 6c73 2061 6e64  aths, labels and
-000015d0: 2072 6566 6572 656e 6365 732e 2222 220a   references.""".
-000015e0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-000015f0: 7465 7274 6f6f 6c73 2e63 6861 696e 2873  tertools.chain(s
-00001600: 656c 662e 706f 6c79 676f 6e73 2c20 7365  elf.polygons, se
-00001610: 6c66 2e70 6174 6873 2c20 7365 6c66 2e6c  lf.paths, self.l
-00001620: 6162 656c 732c 2073 656c 662e 7265 6665  abels, self.refe
-00001630: 7265 6e63 6573 290a 0a20 2020 2064 6566  rences)..    def
-00001640: 2067 6574 5f70 6f6c 7967 6f6e 7328 0a20   get_polygons(. 
-00001650: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00001660: 2020 2020 2062 795f 7370 6563 3a20 556e       by_spec: Un
-00001670: 696f 6e5b 626f 6f6c 2c20 5475 706c 655b  ion[bool, Tuple[
-00001680: 696e 742c 2069 6e74 5d5d 203d 2046 616c  int, int]] = Fal
-00001690: 7365 2c0a 2020 2020 2020 2020 6465 7074  se,.        dept
-000016a0: 683a 204f 7074 696f 6e61 6c5b 696e 745d  h: Optional[int]
-000016b0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-000016c0: 2069 6e63 6c75 6465 5f70 6174 6873 3a20   include_paths: 
-000016d0: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-000016e0: 2020 2020 2061 735f 6172 7261 793a 2062       as_array: b
-000016f0: 6f6f 6c20 3d20 5472 7565 2c0a 2020 2020  ool = True,.    
-00001700: 2920 2d3e 2055 6e69 6f6e 5b4c 6973 745b  ) -> Union[List[
-00001710: 506f 6c79 676f 6e5d 2c20 4469 6374 5b54  Polygon], Dict[T
-00001720: 7570 6c65 5b69 6e74 2c20 696e 745d 2c20  uple[int, int], 
-00001730: 4c69 7374 5b50 6f6c 7967 6f6e 5d5d 5d3a  List[Polygon]]]:
-00001740: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00001750: 726e 2061 206c 6973 7420 6f66 2070 6f6c  rn a list of pol
-00001760: 7967 6f6e 7320 696e 2074 6869 7320 6365  ygons in this ce
-00001770: 6c6c 2e0a 0a20 2020 2020 2020 2041 7267  ll...        Arg
-00001780: 733a 0a20 2020 2020 2020 2020 2020 2062  s:.            b
-00001790: 795f 7370 6563 3a20 626f 6f6c 206f 7220  y_spec: bool or 
-000017a0: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
-000017b0: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-000017c0: 6865 2072 6574 7572 6e20 7661 6c75 6520  he return value 
-000017d0: 6973 2061 2064 6963 7469 6f6e 6172 7920  is a dictionary 
-000017e0: 7769 7468 2074 6865 0a20 2020 2020 2020  with the.       
-000017f0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00001800: 7320 6f66 2065 6163 6820 696e 6469 7669  s of each indivi
-00001810: 6475 616c 2070 6169 7220 286c 6179 6572  dual pair (layer
-00001820: 2c20 6461 7461 7479 7065 292c 2077 6869  , datatype), whi
-00001830: 6368 0a20 2020 2020 2020 2020 2020 2020  ch.             
-00001840: 2020 2061 7265 2075 7365 6420 6173 206b     are used as k
-00001850: 6579 732e 2020 4966 2073 6574 2074 6f20  eys.  If set to 
-00001860: 6120 7475 706c 6520 6f66 2028 6c61 7965  a tuple of (laye
-00001870: 722c 2064 6174 6174 7970 6529 2c0a 2020  r, datatype),.  
-00001880: 2020 2020 2020 2020 2020 2020 2020 6f6e                on
-00001890: 6c79 2070 6f6c 7967 6f6e 7320 7769 7468  ly polygons with
-000018a0: 2074 6861 7420 7370 6563 6966 6963 6174   that specificat
-000018b0: 696f 6e20 6172 6520 7265 7475 726e 6564  ion are returned
-000018c0: 2e0a 2020 2020 2020 2020 2020 2020 6465  ..            de
-000018d0: 7074 683a 2069 6e74 6567 6572 206f 7220  pth: integer or 
-000018e0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000018f0: 2020 2020 2049 6620 6e6f 7420 4e6f 6e65       If not None
-00001900: 2c20 6465 6669 6e65 7320 6672 6f6d 2068  , defines from h
-00001910: 6f77 206d 616e 7920 7265 6665 7265 6e63  ow many referenc
-00001920: 6520 6c65 7665 6c73 2074 6f0a 2020 2020  e levels to.    
-00001930: 2020 2020 2020 2020 2020 2020 7265 7472              retr
-00001940: 6965 7665 2070 6f6c 7967 6f6e 732e 2020  ieve polygons.  
-00001950: 5265 6665 7265 6e63 6573 2062 656c 6f77  References below
-00001960: 2074 6869 7320 6c65 7665 6c20 7769 6c6c   this level will
-00001970: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-00001980: 2020 2020 2020 2020 696e 2061 2062 6f75          in a bou
-00001990: 6e64 696e 6720 626f 782e 2020 4966 2060  nding box.  If `
-000019a0: 6279 5f73 7065 6360 2069 7320 5472 7565  by_spec` is True
-000019b0: 2074 6865 206b 6579 2077 696c 6c20 6265   the key will be
-000019c0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-000019d0: 2020 2020 206e 616d 6520 6f66 2074 6869       name of thi
-000019e0: 7320 6365 6c6c 2e0a 2020 2020 2020 2020  s cell..        
-000019f0: 2020 2020 696e 636c 7564 655f 7061 7468      include_path
-00001a00: 733a 2049 6620 5472 7565 2c20 706f 6c79  s: If True, poly
-00001a10: 676f 6e61 6c20 7265 7072 6573 656e 7461  gonal representa
-00001a20: 7469 6f6e 206f 6620 7061 7468 7320 6172  tion of paths ar
-00001a30: 6520 616c 736f 2069 6e63 6c75 6465 6420  e also included 
-00001a40: 696e 2074 6865 2072 6573 756c 742e 0a20  in the result.. 
-00001a50: 2020 2020 2020 2020 2020 2061 735f 6172             as_ar
-00001a60: 7261 793a 2077 6865 6e20 6173 5f61 7272  ray: when as_arr
-00001a70: 6179 3d66 616c 7365 2c20 7265 7475 726e  ay=false, return
-00001a80: 2074 6865 2050 6f6c 7967 6f6e 206f 626a   the Polygon obj
-00001a90: 6563 7473 2069 6e73 7465 6164 2e0a 2020  ects instead..  
-00001aa0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00001ab0: 6c79 676f 6e20 6f62 6a65 6374 7320 6861  lygon objects ha
-00001ac0: 7665 206d 6f72 6520 696e 666f 726d 6174  ve more informat
-00001ad0: 696f 6e20 2865 7370 6563 6961 6c6c 7920  ion (especially 
-00001ae0: 7768 656e 2062 795f 7370 6563 3d46 616c  when by_spec=Fal
-00001af0: 7365 2920 616e 6420 6172 6520 6661 7374  se) and are fast
-00001b00: 6572 2074 6f20 7265 7472 6965 7665 2e0a  er to retrieve..
-00001b10: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00001b20: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00001b30: 3a20 6c69 7374 206f 6620 6172 7261 792d  : list of array-
-00001b40: 6c69 6b65 5b4e 5d5b 325d 206f 7220 6469  like[N][2] or di
-00001b50: 6374 696f 6e61 7279 0a20 2020 2020 2020  ctionary.       
-00001b60: 2020 2020 2020 2020 204c 6973 7420 636f           List co
-00001b70: 6e74 6169 6e69 6e67 2074 6865 2063 6f6f  ntaining the coo
-00001b80: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
-00001b90: 7665 7274 6963 6573 206f 6620 6561 6368  vertices of each
-00001ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001bb0: 2070 6f6c 7967 6f6e 2c20 6f72 2064 6963   polygon, or dic
-00001bc0: 7469 6f6e 6172 7920 7769 7468 2077 6974  tionary with wit
-00001bd0: 6820 7468 6520 6c69 7374 206f 6620 706f  h the list of po
-00001be0: 6c79 676f 6e73 2028 6966 0a20 2020 2020  lygons (if.     
-00001bf0: 2020 2020 2020 2020 2020 2060 6279 5f73             `by_s
-00001c00: 7065 6360 2069 7320 5472 7565 292e 0a0a  pec` is True)...
-00001c10: 2020 2020 2020 2020 4e6f 7465 3a0a 2020          Note:.  
-00001c20: 2020 2020 2020 2020 2020 496e 7374 616e            Instan
-00001c30: 6365 7320 6f66 2060 466c 6578 5061 7468  ces of `FlexPath
-00001c40: 6020 616e 6420 6052 6f62 7573 7450 6174  ` and `RobustPat
-00001c50: 6860 2061 7265 2061 6c73 6f20 696e 636c  h` are also incl
-00001c60: 7564 6564 2069 6e0a 2020 2020 2020 2020  uded in.        
-00001c70: 2020 2020 7468 6520 7265 7375 6c74 2062      the result b
-00001c80: 7920 636f 6d70 7574 696e 6720 7468 6569  y computing thei
-00001c90: 7220 706f 6c79 676f 6e61 6c20 626f 756e  r polygonal boun
-00001ca0: 6461 7279 2e0a 2020 2020 2020 2020 2222  dary..        ""
-00001cb0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00001cc0: 2067 6574 5f70 6f6c 7967 6f6e 7328 0a20   get_polygons(. 
-00001cd0: 2020 2020 2020 2020 2020 2069 6e73 7461             insta
-00001ce0: 6e63 653d 7365 6c66 2c0a 2020 2020 2020  nce=self,.      
-00001cf0: 2020 2020 2020 6279 5f73 7065 633d 6279        by_spec=by
-00001d00: 5f73 7065 632c 0a20 2020 2020 2020 2020  _spec,.         
-00001d10: 2020 2064 6570 7468 3d64 6570 7468 2c0a     depth=depth,.
-00001d20: 2020 2020 2020 2020 2020 2020 696e 636c              incl
-00001d30: 7564 655f 7061 7468 733d 696e 636c 7564  ude_paths=includ
-00001d40: 655f 7061 7468 732c 0a20 2020 2020 2020  e_paths,.       
-00001d50: 2020 2020 2061 735f 6172 7261 793d 6173       as_array=as
-00001d60: 5f61 7272 6179 2c0a 2020 2020 2020 2020  _array,.        
-00001d70: 290a 0a20 2020 2064 6566 2067 6574 5f64  )..    def get_d
-00001d80: 6570 656e 6465 6e63 6965 7328 7365 6c66  ependencies(self
-00001d90: 2c20 7265 6375 7273 6976 653a 2062 6f6f  , recursive: boo
-00001da0: 6c20 3d20 4661 6c73 6529 202d 3e20 4c69  l = False) -> Li
-00001db0: 7374 5b43 6f6d 706f 6e65 6e74 5d3a 0a20  st[Component]:. 
-00001dc0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00001dd0: 2061 2073 6574 206f 6620 7468 6520 6365   a set of the ce
-00001de0: 6c6c 7320 696e 636c 7564 6564 2069 6e20  lls included in 
-00001df0: 7468 6973 2063 656c 6c20 6173 2072 6566  this cell as ref
-00001e00: 6572 656e 6365 732e 0a0a 2020 2020 2020  erences...      
-00001e10: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00001e20: 2020 2020 7265 6375 7273 6976 653a 2049      recursive: I
-00001e30: 6620 5472 7565 2072 6574 7572 6e73 2064  f True returns d
-00001e40: 6570 656e 6465 6e63 6965 7320 7265 6375  ependencies recu
-00001e50: 7273 6976 656c 792e 0a0a 2020 2020 2020  rsively...      
-00001e60: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00001e70: 2020 2020 2020 206f 7574 3a20 6c69 7374         out: list
-00001e80: 206f 6620 436f 6d70 6f6e 656e 7473 2072   of Components r
-00001e90: 6566 6572 656e 6365 6420 6279 2074 6869  eferenced by thi
-00001ea0: 7320 436f 6d70 6f6e 656e 742e 0a20 2020  s Component..   
-00001eb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00001ec0: 2069 6620 6e6f 7420 7265 6375 7273 6976   if not recursiv
-00001ed0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00001ee0: 6574 7572 6e20 6c69 7374 287b 7265 662e  eturn list({ref.
-00001ef0: 7061 7265 6e74 2066 6f72 2072 6566 2069  parent for ref i
-00001f00: 6e20 7365 6c66 2e72 6566 6572 656e 6365  n self.reference
-00001f10: 737d 290a 0a20 2020 2020 2020 2072 6566  s})..        ref
-00001f20: 6572 656e 6365 735f 7365 7420 3d20 7365  erences_set = se
-00001f30: 7428 290a 2020 2020 2020 2020 5f67 6574  t().        _get
-00001f40: 5f64 6570 656e 6465 6e63 6965 7328 7365  _dependencies(se
-00001f50: 6c66 2c20 7265 6665 7265 6e63 6573 5f73  lf, references_s
-00001f60: 6574 3d72 6566 6572 656e 6365 735f 7365  et=references_se
-00001f70: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
-00001f80: 6e20 6c69 7374 2872 6566 6572 656e 6365  n list(reference
-00001f90: 735f 7365 7429 0a0a 2020 2020 6465 6620  s_set)..    def 
-00001fa0: 6765 745f 636f 6d70 6f6e 656e 745f 7370  get_component_sp
-00001fb0: 6563 2873 656c 6629 3a0a 2020 2020 2020  ec(self):.      
-00001fc0: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00001fd0: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00001fe0: 2020 2020 2020 2020 2022 636f 6d70 6f6e           "compon
-00001ff0: 656e 7422 3a20 7365 6c66 2e73 6574 7469  ent": self.setti
-00002000: 6e67 732e 6675 6e63 7469 6f6e 5f6e 616d  ngs.function_nam
-00002010: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00002020: 2020 2022 7365 7474 696e 6773 223a 2073     "settings": s
-00002030: 656c 662e 7365 7474 696e 6773 2e63 6861  elf.settings.cha
-00002040: 6e67 6564 2c0a 2020 2020 2020 2020 2020  nged,.          
-00002050: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
-00002060: 6966 2073 656c 662e 7365 7474 696e 6773  if self.settings
-00002070: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00002080: 6520 7b22 636f 6d70 6f6e 656e 7422 3a20  e {"component": 
-00002090: 7365 6c66 2e6e 616d 652c 2022 7365 7474  self.name, "sett
-000020a0: 696e 6773 223a 207b 7d7d 0a20 2020 2020  ings": {}}.     
-000020b0: 2020 2029 0a0a 2020 2020 6465 6620 5f5f     )..    def __
-000020c0: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
-000020d0: 6b65 7929 3a0a 2020 2020 2020 2020 2222  key):.        ""
-000020e0: 2241 6363 6573 7320 7265 6665 7265 6e63  "Access referenc
-000020f0: 6520 706f 7274 732e 2222 220a 2020 2020  e ports.""".    
-00002100: 2020 2020 6966 206b 6579 206e 6f74 2069      if key not i
-00002110: 6e20 7365 6c66 2e70 6f72 7473 3a0a 2020  n self.ports:.  
-00002120: 2020 2020 2020 2020 2020 706f 7274 7320            ports 
-00002130: 3d20 6c69 7374 2873 656c 662e 706f 7274  = list(self.port
-00002140: 732e 6b65 7973 2829 290a 2020 2020 2020  s.keys()).      
-00002150: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00002160: 6545 7272 6f72 2866 227b 6b65 7921 727d  eError(f"{key!r}
-00002170: 206e 6f74 2069 6e20 7b70 6f72 7473 7d22   not in {ports}"
-00002180: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00002190: 6e20 7365 6c66 2e70 6f72 7473 5b6b 6579  n self.ports[key
-000021a0: 5d0a 0a20 2020 2064 6566 205f 5f6c 7368  ]..    def __lsh
-000021b0: 6966 745f 5f28 7365 6c66 2c20 656c 656d  ift__(self, elem
-000021c0: 656e 7429 3a0a 2020 2020 2020 2020 2222  ent):.        ""
-000021d0: 2243 6f6e 7665 6e69 656e 6365 206f 7065  "Convenience ope
-000021e0: 7261 746f 7220 6571 7569 7661 6c65 6e74  rator equivalent
-000021f0: 2074 6f20 6164 645f 7265 6628 292e 2222   to add_ref().""
-00002200: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00002210: 2073 656c 662e 6164 645f 7265 6628 656c   self.add_ref(el
-00002220: 656d 656e 7429 0a0a 2020 2020 6465 6620  ement)..    def 
-00002230: 756e 6c6f 636b 2873 656c 6629 202d 3e20  unlock(self) -> 
-00002240: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00002250: 224f 6e6c 7920 646f 2074 6869 7320 6966  "Only do this if
-00002260: 2079 6f75 206b 6e6f 7720 7768 6174 2079   you know what y
-00002270: 6f75 2061 7265 2064 6f69 6e67 2e22 2222  ou are doing."""
-00002280: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
-00002290: 6f63 6b65 6420 3d20 4661 6c73 650a 0a20  ocked = False.. 
-000022a0: 2020 2064 6566 206c 6f63 6b28 7365 6c66     def lock(self
-000022b0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000022c0: 2020 2022 2222 4d61 6b65 7320 7375 7265     """Makes sure
-000022d0: 2063 6f6d 706f 6e65 6e74 7320 6361 6e27   components can'
-000022e0: 7420 6164 6420 6e65 7720 656c 656d 656e  t add new elemen
-000022f0: 7473 206f 7220 6d6f 7665 2065 7869 7374  ts or move exist
-00002300: 696e 6720 6f6e 6573 2e0a 0a20 2020 2020  ing ones...     
-00002310: 2020 2043 6f6d 706f 6e65 6e74 7320 6c6f     Components lo
-00002320: 636b 2061 7574 6f6d 6174 6963 616c 6c79  ck automatically
-00002330: 2077 6865 6e20 676f 696e 6720 696e 746f   when going into
-00002340: 2074 6865 2043 4143 4845 2074 6f0a 2020   the CACHE to.  
-00002350: 2020 2020 2020 656e 7375 7265 206f 6e65        ensure one
-00002360: 2063 6f6d 706f 6e65 6e74 2064 6f65 7320   component does 
-00002370: 6e6f 7420 6368 616e 6765 206f 7468 6572  not change other
-00002380: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
-00002390: 2020 2020 2020 7365 6c66 2e5f 6c6f 636b        self._lock
-000023a0: 6564 203d 2054 7275 650a 0a20 2020 2064  ed = True..    d
-000023b0: 6566 205f 5f73 6574 6974 656d 5f5f 2873  ef __setitem__(s
-000023c0: 656c 662c 206b 6579 2c20 656c 656d 656e  elf, key, elemen
-000023d0: 7429 3a0a 2020 2020 2020 2020 2222 2241  t):.        """A
-000023e0: 6c6c 6f77 2061 6464 696e 6720 706f 6c79  llow adding poly
-000023f0: 676f 6e73 2061 6e64 2063 656c 6c20 7265  gons and cell re
-00002400: 6665 7265 6e63 6573 2e0a 0a20 2020 2020  ferences...     
-00002410: 2020 206c 696b 6520 445b 2761 7263 3327     like D['arc3'
-00002420: 5d20 3d20 7067 2e61 7263 2829 0a0a 2020  ] = pg.arc()..  
-00002430: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-00002440: 2020 2020 2020 2020 6b65 793a 2041 6c69          key: Ali
-00002450: 6173 206e 616d 652e 0a20 2020 2020 2020  as name..       
-00002460: 2020 2020 2065 6c65 6d65 6e74 3a20 4f62       element: Ob
-00002470: 6a65 6374 2074 6861 7420 7769 6c6c 2062  ject that will b
-00002480: 6520 6163 6365 7373 6962 6c65 2062 7920  e accessible by 
-00002490: 616c 6961 7320 6e61 6d65 2e0a 0a20 2020  alias name...   
-000024a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000024b0: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
-000024c0: 6c65 6d65 6e74 2c20 2843 6f6d 706f 6e65  lement, (Compone
-000024d0: 6e74 5265 6665 7265 6e63 652c 2050 6f6c  ntReference, Pol
-000024e0: 7967 6f6e 2929 3a0a 2020 2020 2020 2020  ygon)):.        
-000024f0: 2020 2020 7365 6c66 2e6e 616d 6564 5f72      self.named_r
-00002500: 6566 6572 656e 6365 735b 6b65 795d 203d  eferences[key] =
-00002510: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
-00002520: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00002530: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00002540: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00002550: 2020 2020 2066 2254 7269 6564 2074 6f20       f"Tried to 
-00002560: 6173 7369 676e 2061 6c69 6173 207b 6b65  assign alias {ke
-00002570: 7921 727d 2069 6e20 436f 6d70 6f6e 656e  y!r} in Componen
-00002580: 7420 7b73 656c 662e 6e61 6d65 2172 7d2c  t {self.name!r},
-00002590: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000025a0: 2020 2262 7574 2066 6169 6c65 6420 6265    "but failed be
-000025b0: 6361 7573 6520 7468 6520 6974 656d 2077  cause the item w
-000025c0: 6173 206e 6f74 2061 2043 6f6d 706f 6e65  as not a Compone
-000025d0: 6e74 5265 6665 7265 6e63 6522 0a20 2020  ntReference".   
-000025e0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-000025f0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00002600: 2064 6566 205f 5f67 6574 5f76 616c 6964   def __get_valid
-00002610: 6174 6f72 735f 5f28 636c 7329 3a0a 2020  ators__(cls):.  
-00002620: 2020 2020 2020 2222 2247 6574 2076 616c        """Get val
-00002630: 6964 6174 6f72 7320 666f 7220 7468 6520  idators for the 
-00002640: 436f 6d70 6f6e 656e 7420 6f62 6a65 6374  Component object
-00002650: 2e22 2222 0a20 2020 2020 2020 2079 6965  .""".        yie
-00002660: 6c64 2063 6c73 2e76 616c 6964 6174 650a  ld cls.validate.
-00002670: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00002680: 640a 2020 2020 6465 6620 7661 6c69 6461  d.    def valida
-00002690: 7465 2863 6c73 2c20 7629 3a0a 2020 2020  te(cls, v):.    
-000026a0: 2020 2020 2222 2250 7964 616e 7469 6320      """Pydantic 
-000026b0: 6173 7375 6d65 7320 636f 6d70 6f6e 656e  assumes componen
-000026c0: 7420 6973 2076 616c 6964 2069 6620 7468  t is valid if th
-000026d0: 6520 666f 6c6c 6f77 696e 6720 6172 6520  e following are 
-000026e0: 7472 7565 2e0a 0a20 2020 2020 2020 202d  true...        -
-000026f0: 206e 616d 6520 6368 6172 6163 7465 7273   name characters
-00002700: 203c 204d 4158 5f4e 414d 455f 4c45 4e47   < MAX_NAME_LENG
-00002710: 5448 0a20 2020 2020 2020 202d 2069 7320  TH.        - is 
-00002720: 6e6f 7420 656d 7074 7920 2868 6173 2072  not empty (has r
-00002730: 6566 6572 656e 6365 7320 6f72 2070 6f6c  eferences or pol
-00002740: 7967 6f6e 7329 0a20 2020 2020 2020 2022  ygons).        "
-00002750: 2222 0a20 2020 2020 2020 204d 4158 5f4e  "".        MAX_N
-00002760: 414d 455f 4c45 4e47 5448 203d 2039 390a  AME_LENGTH = 99.
-00002770: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
-00002780: 7369 6e73 7461 6e63 6528 0a20 2020 2020  sinstance(.     
-00002790: 2020 2020 2020 2076 2c20 436f 6d70 6f6e         v, Compon
-000027a0: 656e 740a 2020 2020 2020 2020 292c 2066  ent.        ), f
-000027b0: 2254 7970 6545 7272 6f72 2c20 476f 7420  "TypeError, Got 
-000027c0: 7b74 7970 6528 7629 7d2c 2065 7870 6563  {type(v)}, expec
-000027d0: 7469 6e67 2043 6f6d 706f 6e65 6e74 220a  ting Component".
-000027e0: 2020 2020 2020 2020 6173 7365 7274 2028          assert (
-000027f0: 0a20 2020 2020 2020 2020 2020 206c 656e  .            len
-00002800: 2876 2e6e 616d 6529 203c 3d20 4d41 585f  (v.name) <= MAX_
-00002810: 4e41 4d45 5f4c 454e 4754 480a 2020 2020  NAME_LENGTH.    
-00002820: 2020 2020 292c 2066 226e 616d 6520 607b      ), f"name `{
-00002830: 762e 6e61 6d65 7d60 207b 6c65 6e28 762e  v.name}` {len(v.
-00002840: 6e61 6d65 297d 203e 207b 4d41 585f 4e41  name)} > {MAX_NA
-00002850: 4d45 5f4c 454e 4754 487d 2022 0a20 2020  ME_LENGTH} ".   
-00002860: 2020 2020 2072 6574 7572 6e20 760a 0a20       return v.. 
-00002870: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00002880: 2064 6566 206e 616d 6564 5f72 6566 6572   def named_refer
-00002890: 656e 6365 7328 7365 6c66 293a 0a20 2020  ences(self):.   
-000028a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000028b0: 2e5f 6e61 6d65 645f 7265 6665 7265 6e63  ._named_referenc
-000028c0: 6573 0a0a 2020 2020 6465 6620 6164 645f  es..    def add_
-000028d0: 6c61 6265 6c28 0a20 2020 2020 2020 2073  label(.        s
-000028e0: 656c 662c 0a20 2020 2020 2020 2074 6578  elf,.        tex
-000028f0: 743a 2073 7472 203d 2022 6865 6c6c 6f22  t: str = "hello"
-00002900: 2c0a 2020 2020 2020 2020 706f 7369 7469  ,.        positi
-00002910: 6f6e 3a20 5475 706c 655b 666c 6f61 742c  on: Tuple[float,
-00002920: 2066 6c6f 6174 5d20 3d20 2830 2e30 2c20   float] = (0.0, 
-00002930: 302e 3029 2c0a 2020 2020 2020 2020 6d61  0.0),.        ma
-00002940: 676e 6966 6963 6174 696f 6e3a 2066 6c6f  gnification: flo
-00002950: 6174 203d 2031 2e30 2c0a 2020 2020 2020  at = 1.0,.      
-00002960: 2020 726f 7461 7469 6f6e 3a20 666c 6f61    rotation: floa
-00002970: 7420 3d20 302c 0a20 2020 2020 2020 2061  t = 0,.        a
-00002980: 6e63 686f 723a 2073 7472 203d 2022 6f22  nchor: str = "o"
-00002990: 2c0a 2020 2020 2020 2020 6c61 7965 723d  ,.        layer=
-000029a0: 2254 4558 5422 2c0a 2020 2020 2020 2020  "TEXT",.        
-000029b0: 785f 7265 666c 6563 7469 6f6e 3d46 616c  x_reflection=Fal
-000029c0: 7365 2c0a 2020 2020 2920 2d3e 204c 6162  se,.    ) -> Lab
-000029d0: 656c 3a0a 2020 2020 2020 2020 2222 2241  el:.        """A
-000029e0: 6464 7320 4c61 6265 6c20 746f 2074 6865  dds Label to the
-000029f0: 2043 6f6d 706f 6e65 6e74 2e0a 0a20 2020   Component...   
-00002a00: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00002a10: 2020 2020 2020 2074 6578 743a 204c 6162         text: Lab
-00002a20: 656c 2074 6578 742e 0a20 2020 2020 2020  el text..       
-00002a30: 2020 2020 2070 6f73 6974 696f 6e3a 2078       position: x
-00002a40: 2d2c 2079 2d63 6f6f 7264 696e 6174 6573  -, y-coordinates
-00002a50: 206f 6620 7468 6520 4c61 6265 6c20 6c6f   of the Label lo
-00002a60: 6361 7469 6f6e 2e0a 2020 2020 2020 2020  cation..        
-00002a70: 2020 2020 6d61 676e 6966 6963 6174 696f      magnificatio
-00002a80: 6e3a 204d 6167 6e69 6669 6361 7469 6f6e  n: Magnification
-00002a90: 2066 6163 746f 7220 666f 7220 7468 6520   factor for the 
-00002aa0: 4c61 6265 6c20 7465 7874 2e0a 2020 2020  Label text..    
-00002ab0: 2020 2020 2020 2020 726f 7461 7469 6f6e          rotation
-00002ac0: 3a20 416e 676c 6520 726f 7461 7469 6f6e  : Angle rotation
-00002ad0: 206f 6620 7468 6520 4c61 6265 6c20 7465   of the Label te
-00002ae0: 7874 2e0a 2020 2020 2020 2020 2020 2020  xt..            
-00002af0: 616e 6368 6f72 3a20 7b27 6e27 2c20 2765  anchor: {'n', 'e
-00002b00: 272c 2027 7327 2c20 2777 272c 2027 6f27  ', 's', 'w', 'o'
-00002b10: 2c20 276e 6527 2c20 276e 7727 2c20 2e2e  , 'ne', 'nw', ..
-00002b20: 2e7d 0a20 2020 2020 2020 2020 2020 2020  .}.             
-00002b30: 2020 2050 6f73 6974 696f 6e20 6f66 2074     Position of t
-00002b40: 6865 2061 6e63 686f 7220 7265 6c61 7469  he anchor relati
-00002b50: 7665 2074 6f20 7468 6520 7465 7874 2e0a  ve to the text..
-00002b60: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00002b70: 723a 2053 7065 6369 6669 6320 6c61 7965  r: Specific laye
-00002b80: 7228 7329 2074 6f20 7075 7420 4c61 6265  r(s) to put Labe
-00002b90: 6c20 6f6e 2e0a 2020 2020 2020 2020 2020  l on..          
-00002ba0: 2020 785f 7265 666c 6563 7469 6f6e 3a20    x_reflection: 
-00002bb0: 5472 7565 2072 6566 6c65 6374 7320 6163  True reflects ac
-00002bc0: 726f 7373 2074 6865 2068 6f72 697a 6f6e  ross the horizon
-00002bd0: 7461 6c20 6178 6973 2062 6566 6f72 6520  tal axis before 
-00002be0: 726f 7461 7469 6f6e 2e0a 2020 2020 2020  rotation..      
-00002bf0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00002c00: 6f6d 2067 6473 6661 6374 6f72 792e 7064  om gdsfactory.pd
-00002c10: 6b20 696d 706f 7274 2067 6574 5f6c 6179  k import get_lay
-00002c20: 6572 0a0a 2020 2020 2020 2020 6c61 7965  er..        laye
-00002c30: 7220 3d20 6765 745f 6c61 7965 7228 6c61  r = get_layer(la
-00002c40: 7965 7229 0a0a 2020 2020 2020 2020 6764  yer)..        gd
-00002c50: 735f 6c61 7965 722c 2067 6473 5f64 6174  s_layer, gds_dat
-00002c60: 6174 7970 6520 3d20 6c61 7965 720a 0a20  atype = layer.. 
-00002c70: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00002c80: 696e 7374 616e 6365 2874 6578 742c 2073  instance(text, s
-00002c90: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-00002ca0: 2074 6578 7420 3d20 7465 7874 0a20 2020   text = text.   
-00002cb0: 2020 2020 206c 6162 656c 203d 204c 6162       label = Lab
-00002cc0: 656c 280a 2020 2020 2020 2020 2020 2020  el(.            
-00002cd0: 7465 7874 3d74 6578 742c 0a20 2020 2020  text=text,.     
-00002ce0: 2020 2020 2020 206f 7269 6769 6e3d 706f         origin=po
-00002cf0: 7369 7469 6f6e 2c0a 2020 2020 2020 2020  sition,.        
-00002d00: 2020 2020 616e 6368 6f72 3d61 6e63 686f      anchor=ancho
-00002d10: 722c 0a20 2020 2020 2020 2020 2020 206d  r,.            m
-00002d20: 6167 6e69 6669 6361 7469 6f6e 3d6d 6167  agnification=mag
-00002d30: 6e69 6669 6361 7469 6f6e 2c0a 2020 2020  nification,.    
-00002d40: 2020 2020 2020 2020 726f 7461 7469 6f6e          rotation
-00002d50: 3d72 6f74 6174 696f 6e2c 0a20 2020 2020  =rotation,.     
-00002d60: 2020 2020 2020 206c 6179 6572 3d67 6473         layer=gds
-00002d70: 5f6c 6179 6572 2c0a 2020 2020 2020 2020  _layer,.        
-00002d80: 2020 2020 7465 7874 7479 7065 3d67 6473      texttype=gds
-00002d90: 5f64 6174 6174 7970 652c 0a20 2020 2020  _datatype,.     
-00002da0: 2020 2020 2020 2078 5f72 6566 6c65 6374         x_reflect
-00002db0: 696f 6e3d 785f 7265 666c 6563 7469 6f6e  ion=x_reflection
-00002dc0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00002dd0: 2020 2020 7365 6c66 2e61 6464 286c 6162      self.add(lab
-00002de0: 656c 290a 2020 2020 2020 2020 7265 7475  el).        retu
-00002df0: 726e 206c 6162 656c 0a0a 2020 2020 4070  rn label..    @p
-00002e00: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00002e10: 6262 6f78 2873 656c 6629 3a0a 2020 2020  bbox(self):.    
-00002e20: 2020 2020 2222 2252 6574 7572 6e73 2074      """Returns t
-00002e30: 6865 2062 6f75 6e64 696e 6720 626f 7820  he bounding box 
-00002e40: 6f66 2074 6865 2043 6f6d 706f 6e65 6e74  of the Component
-00002e50: 5265 6665 7265 6e63 652e 0a0a 2020 2020  Reference...    
-00002e60: 2020 2020 6974 2073 6e61 7073 2074 6f20      it snaps to 
-00002e70: 3320 6465 6369 6d61 6c73 2069 6e20 756d  3 decimals in um
-00002e80: 2028 302e 3030 3175 6d20 3d20 316e 6d20   (0.001um = 1nm 
-00002e90: 7072 6563 6973 696f 6e29 0a20 2020 2020  precision).     
-00002ea0: 2020 2022 2222 0a20 2020 2020 2020 2062     """.        b
-00002eb0: 626f 7820 3d20 7365 6c66 2e5f 6365 6c6c  box = self._cell
-00002ec0: 2e62 6f75 6e64 696e 675f 626f 7828 290a  .bounding_box().
-00002ed0: 2020 2020 2020 2020 6966 2062 626f 7820          if bbox 
-00002ee0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00002ef0: 2020 2020 2062 626f 7820 3d20 2828 302c       bbox = ((0,
-00002f00: 2030 292c 2028 302c 2030 2929 0a20 2020   0), (0, 0)).   
-00002f10: 2020 2020 2072 6574 7572 6e20 6e70 2e72       return np.r
-00002f20: 6f75 6e64 2862 626f 782c 2033 290a 0a20  ound(bbox, 3).. 
-00002f30: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-00002f40: 2064 6566 2070 6f72 7473 5f6c 6179 6572   def ports_layer
-00002f50: 2873 656c 6629 202d 3e20 4469 6374 5b73  (self) -> Dict[s
-00002f60: 7472 2c20 7374 725d 3a0a 2020 2020 2020  tr, str]:.      
-00002f70: 2020 2222 2252 6574 7572 6e73 2061 206d    """Returns a m
-00002f80: 6170 7069 6e67 2066 726f 6d20 6c61 7965  apping from laye
-00002f90: 7230 5f6c 6179 6572 315f 4530 3a20 706f  r0_layer1_E0: po
-00002fa0: 7274 4e61 6d65 2e22 2222 0a20 2020 2020  rtName.""".     
-00002fb0: 2020 2072 6574 7572 6e20 6d61 705f 706f     return map_po
-00002fc0: 7274 735f 6c61 7965 725f 746f 5f6f 7269  rts_layer_to_ori
-00002fd0: 656e 7461 7469 6f6e 2873 656c 662e 706f  entation(self.po
-00002fe0: 7274 7329 0a0a 2020 2020 6465 6620 706f  rts)..    def po
-00002ff0: 7274 5f62 795f 6f72 6965 6e74 6174 696f  rt_by_orientatio
-00003000: 6e5f 6377 2873 656c 662c 206b 6579 3a20  n_cw(self, key: 
-00003010: 7374 722c 202a 2a6b 7761 7267 7329 3a0a  str, **kwargs):.
-00003020: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00003030: 6e73 2070 6f72 7420 6279 2069 6e64 6578  ns port by index
-00003040: 696e 6720 7468 656d 2063 6c6f 636b 7769  ing them clockwi
-00003050: 7365 2e22 2222 0a20 2020 2020 2020 206d  se.""".        m
-00003060: 203d 206d 6170 5f70 6f72 7473 5f74 6f5f   = map_ports_to_
-00003070: 6f72 6965 6e74 6174 696f 6e5f 6377 2873  orientation_cw(s
-00003080: 656c 662e 706f 7274 732c 202a 2a6b 7761  elf.ports, **kwa
-00003090: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
-000030a0: 6b65 7920 6e6f 7420 696e 206d 3a0a 2020  key not in m:.  
-000030b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000030c0: 4b65 7945 7272 6f72 2866 227b 6b65 797d  KeyError(f"{key}
-000030d0: 206e 6f74 2069 6e20 7b6c 6973 7428 6d2e   not in {list(m.
-000030e0: 6b65 7973 2829 297d 2229 0a20 2020 2020  keys())}").     
-000030f0: 2020 206b 6579 3220 3d20 6d5b 6b65 795d     key2 = m[key]
-00003100: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003110: 7365 6c66 2e70 6f72 7473 5b6b 6579 325d  self.ports[key2]
-00003120: 0a0a 2020 2020 6465 6620 706f 7274 5f62  ..    def port_b
-00003130: 795f 6f72 6965 6e74 6174 696f 6e5f 6363  y_orientation_cc
-00003140: 7728 7365 6c66 2c20 6b65 793a 2073 7472  w(self, key: str
-00003150: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00003160: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00003170: 706f 7274 2062 7920 696e 6465 7869 6e67  port by indexing
-00003180: 2074 6865 6d20 636c 6f63 6b77 6973 652e   them clockwise.
-00003190: 2222 220a 2020 2020 2020 2020 6d20 3d20  """.        m = 
-000031a0: 6d61 705f 706f 7274 735f 746f 5f6f 7269  map_ports_to_ori
-000031b0: 656e 7461 7469 6f6e 5f63 6377 2873 656c  entation_ccw(sel
-000031c0: 662e 706f 7274 732c 202a 2a6b 7761 7267  f.ports, **kwarg
-000031d0: 7329 0a20 2020 2020 2020 2069 6620 6b65  s).        if ke
-000031e0: 7920 6e6f 7420 696e 206d 3a0a 2020 2020  y not in m:.    
-000031f0: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
-00003200: 7945 7272 6f72 2866 227b 6b65 797d 206e  yError(f"{key} n
-00003210: 6f74 2069 6e20 7b6c 6973 7428 6d2e 6b65  ot in {list(m.ke
-00003220: 7973 2829 297d 2229 0a20 2020 2020 2020  ys())}").       
-00003230: 206b 6579 3220 3d20 6d5b 6b65 795d 0a20   key2 = m[key]. 
-00003240: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00003250: 6c66 2e70 6f72 7473 5b6b 6579 325d 0a0a  lf.ports[key2]..
-00003260: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
-00003270: 735f 7873 697a 6528 7365 6c66 2c20 2a2a  s_xsize(self, **
-00003280: 6b77 6172 6773 2920 2d3e 2066 6c6f 6174  kwargs) -> float
-00003290: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-000032a0: 7572 6e73 2078 6469 7374 616e 6365 2066  urns xdistance f
-000032b0: 726f 6d20 6561 7374 2074 6f20 7765 7374  rom east to west
-000032c0: 2070 6f72 7473 2e0a 0a20 2020 2020 2020   ports...       
-000032d0: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
-000032e0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-000032f0: 3a20 706f 7274 2047 4453 206c 6179 6572  : port GDS layer
-00003300: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00003310: 6566 6978 3a20 7769 7468 2069 6e20 706f  efix: with in po
-00003320: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
-00003330: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
-00003340: 3a20 696e 2064 6567 7265 6573 2e0a 2020  : in degrees..  
-00003350: 2020 2020 2020 2020 2020 7769 6474 683a            width:
-00003360: 2070 6f72 7420 7769 6474 682e 0a20 2020   port width..   
-00003370: 2020 2020 2020 2020 206c 6179 6572 735f           layers_
-00003380: 6578 636c 7564 6564 3a20 4c69 7374 206f  excluded: List o
-00003390: 6620 6c61 7965 7273 2074 6f20 6578 636c  f layers to excl
-000033a0: 7564 652e 0a20 2020 2020 2020 2020 2020  ude..           
-000033b0: 2070 6f72 745f 7479 7065 3a20 6f70 7469   port_type: opti
-000033c0: 6361 6c2c 2065 6c65 6374 7269 6361 6c2c  cal, electrical,
-000033d0: 202e 2e2e 0a20 2020 2020 2020 2022 2222   ....        """
-000033e0: 0a20 2020 2020 2020 2070 6f72 7473 5f63  .        ports_c
-000033f0: 7720 3d20 7365 6c66 2e67 6574 5f70 6f72  w = self.get_por
-00003400: 7473 5f6c 6973 7428 636c 6f63 6b77 6973  ts_list(clockwis
-00003410: 653d 5472 7565 2c20 2a2a 6b77 6172 6773  e=True, **kwargs
-00003420: 290a 2020 2020 2020 2020 706f 7274 735f  ).        ports_
-00003430: 6363 7720 3d20 7365 6c66 2e67 6574 5f70  ccw = self.get_p
-00003440: 6f72 7473 5f6c 6973 7428 636c 6f63 6b77  orts_list(clockw
-00003450: 6973 653d 4661 6c73 652c 202a 2a6b 7761  ise=False, **kwa
-00003460: 7267 7329 0a20 2020 2020 2020 2072 6574  rgs).        ret
-00003470: 7572 6e20 736e 6170 5f74 6f5f 6772 6964  urn snap_to_grid
-00003480: 2870 6f72 7473 5f63 6377 5b30 5d2e 7820  (ports_ccw[0].x 
-00003490: 2d20 706f 7274 735f 6377 5b30 5d2e 7829  - ports_cw[0].x)
-000034a0: 0a0a 2020 2020 6465 6620 6765 745f 706f  ..    def get_po
-000034b0: 7274 735f 7973 697a 6528 7365 6c66 2c20  rts_ysize(self, 
-000034c0: 2a2a 6b77 6172 6773 2920 2d3e 2066 6c6f  **kwargs) -> flo
-000034d0: 6174 3a0a 2020 2020 2020 2020 2222 2252  at:.        """R
-000034e0: 6574 7572 6e73 2079 6469 7374 616e 6365  eturns ydistance
-000034f0: 2066 726f 6d20 6561 7374 2074 6f20 7765   from east to we
-00003500: 7374 2070 6f72 7473 2e0a 0a20 2020 2020  st ports...     
-00003510: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
-00003520: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00003530: 6572 3a20 706f 7274 2047 4453 206c 6179  er: port GDS lay
-00003540: 6572 2e0a 2020 2020 2020 2020 2020 2020  er..            
-00003550: 7072 6566 6978 3a20 7769 7468 2069 6e20  prefix: with in 
-00003560: 706f 7274 206e 616d 652e 0a20 2020 2020  port name..     
-00003570: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
-00003580: 6f6e 3a20 696e 2064 6567 7265 6573 2e0a  on: in degrees..
-00003590: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-000035a0: 683a 2070 6f72 7420 7769 6474 6820 2875  h: port width (u
-000035b0: 6d29 2e0a 2020 2020 2020 2020 2020 2020  m)..            
-000035c0: 6c61 7965 7273 5f65 7863 6c75 6465 643a  layers_excluded:
-000035d0: 204c 6973 7420 6f66 206c 6179 6572 7320   List of layers 
-000035e0: 746f 2065 7863 6c75 6465 2e0a 2020 2020  to exclude..    
-000035f0: 2020 2020 2020 2020 706f 7274 5f74 7970          port_typ
-00003600: 653a 206f 7074 6963 616c 2c20 656c 6563  e: optical, elec
-00003610: 7472 6963 616c 2c20 2e2e 2e0a 2020 2020  trical, ....    
-00003620: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00003630: 706f 7274 735f 6377 203d 2073 656c 662e  ports_cw = self.
-00003640: 6765 745f 706f 7274 735f 6c69 7374 2863  get_ports_list(c
-00003650: 6c6f 636b 7769 7365 3d54 7275 652c 202a  lockwise=True, *
-00003660: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-00003670: 2070 6f72 7473 5f63 6377 203d 2073 656c   ports_ccw = sel
-00003680: 662e 6765 745f 706f 7274 735f 6c69 7374  f.get_ports_list
-00003690: 2863 6c6f 636b 7769 7365 3d46 616c 7365  (clockwise=False
-000036a0: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-000036b0: 2020 2020 7265 7475 726e 2073 6e61 705f      return snap_
-000036c0: 746f 5f67 7269 6428 706f 7274 735f 6363  to_grid(ports_cc
-000036d0: 775b 305d 2e79 202d 2070 6f72 7473 5f63  w[0].y - ports_c
-000036e0: 775b 305d 2e79 290a 0a20 2020 2064 6566  w[0].y)..    def
-000036f0: 2070 6c6f 745f 6e65 746c 6973 7428 0a20   plot_netlist(. 
-00003700: 2020 2020 2020 2073 656c 662c 2077 6974         self, wit
-00003710: 685f 6c61 6265 6c73 3a20 626f 6f6c 203d  h_labels: bool =
-00003720: 2054 7275 652c 2066 6f6e 745f 7765 6967   True, font_weig
-00003730: 6874 3a20 7374 7220 3d20 226e 6f72 6d61  ht: str = "norma
-00003740: 6c22 2c20 2a2a 6b77 6172 6773 0a20 2020  l", **kwargs.   
-00003750: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
-00003760: 6c6f 7473 2061 206e 6574 6c69 7374 2067  lots a netlist g
-00003770: 7261 7068 2077 6974 6820 6e65 7477 6f72  raph with networ
-00003780: 6b78 2e0a 0a20 2020 2020 2020 2041 7267  kx...        Arg
-00003790: 733a 0a20 2020 2020 2020 2020 2020 2077  s:.            w
-000037a0: 6974 685f 6c61 6265 6c73 3a20 6164 6420  ith_labels: add 
-000037b0: 6c61 6265 6c20 746f 2065 6163 6820 6e6f  label to each no
-000037c0: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
-000037d0: 666f 6e74 5f77 6569 6768 743a 206e 6f72  font_weight: nor
-000037e0: 6d61 6c2c 2062 6f6c 642e 0a20 2020 2020  mal, bold..     
-000037f0: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
-00003800: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
-00003810: 7473 2066 6f72 2074 6865 2067 6574 5f6e  ts for the get_n
-00003820: 6574 6c69 7374 2066 756e 6374 696f 6e0a  etlist function.
-00003830: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003840: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
-00003850: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
-00003860: 706c 740a 2020 2020 2020 2020 696d 706f  plt.        impo
-00003870: 7274 206e 6574 776f 726b 7820 6173 206e  rt networkx as n
-00003880: 780a 0a20 2020 2020 2020 2070 6c74 2e66  x..        plt.f
-00003890: 6967 7572 6528 290a 2020 2020 2020 2020  igure().        
-000038a0: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
-000038b0: 6574 5f6e 6574 6c69 7374 282a 2a6b 7761  et_netlist(**kwa
-000038c0: 7267 7329 0a20 2020 2020 2020 2063 6f6e  rgs).        con
-000038d0: 6e65 6374 696f 6e73 203d 206e 6574 6c69  nections = netli
-000038e0: 7374 5b22 636f 6e6e 6563 7469 6f6e 7322  st["connections"
-000038f0: 5d0a 2020 2020 2020 2020 706c 6163 656d  ].        placem
-00003900: 656e 7473 203d 206e 6574 6c69 7374 5b22  ents = netlist["
-00003910: 706c 6163 656d 656e 7473 225d 0a20 2020  placements"].   
-00003920: 2020 2020 2047 203d 206e 782e 4772 6170       G = nx.Grap
-00003930: 6828 290a 2020 2020 2020 2020 472e 6164  h().        G.ad
-00003940: 645f 6564 6765 735f 6672 6f6d 280a 2020  d_edges_from(.  
-00003950: 2020 2020 2020 2020 2020 5b0a 2020 2020            [.    
-00003960: 2020 2020 2020 2020 2020 2020 2822 2c22              (","
-00003970: 2e6a 6f69 6e28 6b2e 7370 6c69 7428 222c  .join(k.split(",
-00003980: 2229 5b3a 2d31 5d29 2c20 222c 222e 6a6f  ")[:-1]), ",".jo
-00003990: 696e 2876 2e73 706c 6974 2822 2c22 295b  in(v.split(",")[
-000039a0: 3a2d 315d 2929 0a20 2020 2020 2020 2020  :-1])).         
-000039b0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-000039c0: 696e 2063 6f6e 6e65 6374 696f 6e73 2e69  in connections.i
-000039d0: 7465 6d73 2829 0a20 2020 2020 2020 2020  tems().         
-000039e0: 2020 205d 0a20 2020 2020 2020 2029 0a20     ].        ). 
-000039f0: 2020 2020 2020 2070 6f73 203d 207b 6b3a         pos = {k:
-00003a00: 2028 765b 2278 225d 2c20 765b 2279 225d   (v["x"], v["y"]
-00003a10: 2920 666f 7220 6b2c 2076 2069 6e20 706c  ) for k, v in pl
-00003a20: 6163 656d 656e 7473 2e69 7465 6d73 2829  acements.items()
-00003a30: 7d0a 2020 2020 2020 2020 6c61 6265 6c73  }.        labels
-00003a40: 203d 207b 6b3a 2022 2c22 2e6a 6f69 6e28   = {k: ",".join(
-00003a50: 6b2e 7370 6c69 7428 222c 2229 5b3a 315d  k.split(",")[:1]
-00003a60: 2920 666f 7220 6b20 696e 2070 6c61 6365  ) for k in place
-00003a70: 6d65 6e74 732e 6b65 7973 2829 7d0a 2020  ments.keys()}.  
-00003a80: 2020 2020 2020 6e78 2e64 7261 7728 0a20        nx.draw(. 
-00003a90: 2020 2020 2020 2020 2020 2047 2c0a 2020             G,.  
-00003aa0: 2020 2020 2020 2020 2020 7769 7468 5f6c            with_l
-00003ab0: 6162 656c 733d 7769 7468 5f6c 6162 656c  abels=with_label
-00003ac0: 732c 0a20 2020 2020 2020 2020 2020 2066  s,.            f
-00003ad0: 6f6e 745f 7765 6967 6874 3d66 6f6e 745f  ont_weight=font_
-00003ae0: 7765 6967 6874 2c0a 2020 2020 2020 2020  weight,.        
-00003af0: 2020 2020 6c61 6265 6c73 3d6c 6162 656c      labels=label
-00003b00: 732c 0a20 2020 2020 2020 2020 2020 2070  s,.            p
-00003b10: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
-00003b20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00003b30: 2047 0a0a 2020 2020 6465 6620 706c 6f74   G..    def plot
-00003b40: 5f6e 6574 6c69 7374 5f66 6c61 7428 0a20  _netlist_flat(. 
-00003b50: 2020 2020 2020 2073 656c 662c 2077 6974         self, wit
-00003b60: 685f 6c61 6265 6c73 3a20 626f 6f6c 203d  h_labels: bool =
-00003b70: 2054 7275 652c 2066 6f6e 745f 7765 6967   True, font_weig
-00003b80: 6874 3a20 7374 7220 3d20 226e 6f72 6d61  ht: str = "norma
-00003b90: 6c22 2c20 2a2a 6b77 6172 6773 0a20 2020  l", **kwargs.   
-00003ba0: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
-00003bb0: 6c6f 7473 2061 206e 6574 6c69 7374 2067  lots a netlist g
-00003bc0: 7261 7068 2077 6974 6820 6e65 7477 6f72  raph with networ
-00003bd0: 6b78 2e0a 0a20 2020 2020 2020 2041 7267  kx...        Arg
-00003be0: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-00003bf0: 6c61 743a 2069 6620 7472 7565 2c20 7769  lat: if true, wi
-00003c00: 6c6c 2070 6c6f 7420 7468 6520 666c 6174  ll plot the flat
-00003c10: 206e 6574 6c69 7374 0a20 2020 2020 2020   netlist.       
-00003c20: 2020 2020 2077 6974 685f 6c61 6265 6c73       with_labels
-00003c30: 3a20 6164 6420 6c61 6265 6c20 746f 2065  : add label to e
-00003c40: 6163 6820 6e6f 6465 2e0a 2020 2020 2020  ach node..      
-00003c50: 2020 2020 2020 666f 6e74 5f77 6569 6768        font_weigh
-00003c60: 743a 206e 6f72 6d61 6c2c 2062 6f6c 642e  t: normal, bold.
-00003c70: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
-00003c80: 7761 7267 733a 206b 6579 776f 7264 2061  wargs: keyword a
-00003c90: 7267 756d 656e 7473 2066 6f72 2074 6865  rguments for the
-00003ca0: 2067 6574 5f6e 6574 6c69 7374 2066 756e   get_netlist fun
-00003cb0: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
-00003cc0: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
-00003cd0: 206d 6174 706c 6f74 6c69 622e 7079 706c   matplotlib.pypl
-00003ce0: 6f74 2061 7320 706c 740a 2020 2020 2020  ot as plt.      
-00003cf0: 2020 696d 706f 7274 206e 6574 776f 726b    import network
-00003d00: 7820 6173 206e 780a 0a20 2020 2020 2020  x as nx..       
-00003d10: 2070 6c74 2e66 6967 7572 6528 290a 2020   plt.figure().  
-00003d20: 2020 2020 2020 6e65 746c 6973 7420 3d20        netlist = 
-00003d30: 7365 6c66 2e67 6574 5f6e 6574 6c69 7374  self.get_netlist
-00003d40: 5f66 6c61 7428 2a2a 6b77 6172 6773 290a  _flat(**kwargs).
-00003d50: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
-00003d60: 6f6e 7320 3d20 6e65 746c 6973 745b 2263  ons = netlist["c
-00003d70: 6f6e 6e65 6374 696f 6e73 225d 0a20 2020  onnections"].   
-00003d80: 2020 2020 2070 6c61 6365 6d65 6e74 7320       placements 
-00003d90: 3d20 6e65 746c 6973 745b 2270 6c61 6365  = netlist["place
-00003da0: 6d65 6e74 7322 5d0a 2020 2020 2020 2020  ments"].        
-00003db0: 636f 6e6e 6563 7469 6f6e 735f 6c69 7374  connections_list
-00003dc0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00003dd0: 7220 6b2c 2076 5f6c 6973 7420 696e 2063  r k, v_list in c
-00003de0: 6f6e 6e65 6374 696f 6e73 2e69 7465 6d73  onnections.items
-00003df0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00003e00: 636f 6e6e 6563 7469 6f6e 735f 6c69 7374  connections_list
-00003e10: 2e65 7874 656e 6428 0a20 2020 2020 2020  .extend(.       
-00003e20: 2020 2020 2020 2020 2028 222c 222e 6a6f           (",".jo
-00003e30: 696e 286b 2e73 706c 6974 2822 2c22 295b  in(k.split(",")[
-00003e40: 3a2d 315d 292c 2022 2c22 2e6a 6f69 6e28  :-1]), ",".join(
-00003e50: 762e 7370 6c69 7428 222c 2229 5b3a 2d31  v.split(",")[:-1
-00003e60: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
-00003e70: 2020 2020 666f 7220 7620 696e 2076 5f6c      for v in v_l
-00003e80: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
-00003e90: 290a 2020 2020 2020 2020 4720 3d20 6e78  ).        G = nx
-00003ea0: 2e47 7261 7068 2829 0a20 2020 2020 2020  .Graph().       
-00003eb0: 2047 2e61 6464 5f65 6467 6573 5f66 726f   G.add_edges_fro
-00003ec0: 6d28 636f 6e6e 6563 7469 6f6e 735f 6c69  m(connections_li
-00003ed0: 7374 290a 2020 2020 2020 2020 706f 7320  st).        pos 
-00003ee0: 3d20 7b6b 3a20 2876 5b22 7822 5d2c 2076  = {k: (v["x"], v
-00003ef0: 5b22 7922 5d29 2066 6f72 206b 2c20 7620  ["y"]) for k, v 
-00003f00: 696e 2070 6c61 6365 6d65 6e74 732e 6974  in placements.it
-00003f10: 656d 7328 297d 0a20 2020 2020 2020 206c  ems()}.        l
-00003f20: 6162 656c 7320 3d20 7b6b 3a20 222c 222e  abels = {k: ",".
-00003f30: 6a6f 696e 286b 2e73 706c 6974 2822 2c22  join(k.split(","
-00003f40: 295b 3a31 5d29 2066 6f72 206b 2069 6e20  )[:1]) for k in 
-00003f50: 706c 6163 656d 656e 7473 2e6b 6579 7328  placements.keys(
-00003f60: 297d 0a20 2020 2020 2020 206e 782e 6472  )}.        nx.dr
-00003f70: 6177 280a 2020 2020 2020 2020 2020 2020  aw(.            
-00003f80: 472c 0a20 2020 2020 2020 2020 2020 2077  G,.            w
-00003f90: 6974 685f 6c61 6265 6c73 3d77 6974 685f  ith_labels=with_
-00003fa0: 6c61 6265 6c73 2c0a 2020 2020 2020 2020  labels,.        
-00003fb0: 2020 2020 666f 6e74 5f77 6569 6768 743d      font_weight=
-00003fc0: 666f 6e74 5f77 6569 6768 742c 0a20 2020  font_weight,.   
-00003fd0: 2020 2020 2020 2020 206c 6162 656c 733d           labels=
-00003fe0: 6c61 6265 6c73 2c0a 2020 2020 2020 2020  labels,.        
-00003ff0: 2020 2020 706f 733d 706f 732c 0a20 2020      pos=pos,.   
-00004000: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-00004010: 6574 7572 6e20 470a 0a20 2020 2064 6566  eturn G..    def
-00004020: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
-00004030: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
-00004040: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
-00004050: 6e79 5d3a 0a20 2020 2020 2020 2066 726f  ny]:.        fro
-00004060: 6d20 6764 7366 6163 746f 7279 2e67 6574  m gdsfactory.get
-00004070: 5f6e 6574 6c69 7374 2069 6d70 6f72 7420  _netlist import 
-00004080: 6765 745f 6e65 746c 6973 745f 7961 6d6c  get_netlist_yaml
-00004090: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000040a0: 2067 6574 5f6e 6574 6c69 7374 5f79 616d   get_netlist_yam
-000040b0: 6c28 7365 6c66 2c20 2a2a 6b77 6172 6773  l(self, **kwargs
-000040c0: 290a 0a20 2020 2064 6566 2077 7269 7465  )..    def write
-000040d0: 5f6e 6574 6c69 7374 2873 656c 662c 2066  _netlist(self, f
-000040e0: 696c 6570 6174 683a 2073 7472 2920 2d3e  ilepath: str) ->
-000040f0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00004100: 2222 5772 6974 6520 6e65 746c 6973 7420  ""Write netlist 
-00004110: 696e 2059 414d 4c2e 2222 220a 2020 2020  in YAML.""".    
-00004120: 2020 2020 6e65 746c 6973 7420 3d20 7365      netlist = se
-00004130: 6c66 2e67 6574 5f6e 6574 6c69 7374 2829  lf.get_netlist()
-00004140: 0a20 2020 2020 2020 204f 6d65 6761 436f  .        OmegaCo
-00004150: 6e66 2e73 6176 6528 6e65 746c 6973 742c  nf.save(netlist,
-00004160: 2066 696c 6570 6174 6829 0a0a 2020 2020   filepath)..    
-00004170: 6465 6620 7772 6974 655f 6e65 746c 6973  def write_netlis
-00004180: 745f 646f 7428 7365 6c66 2c20 6669 6c65  t_dot(self, file
-00004190: 7061 7468 3a20 4f70 7469 6f6e 616c 5b73  path: Optional[s
-000041a0: 7472 5d20 3d20 4e6f 6e65 2920 2d3e 204e  tr] = None) -> N
-000041b0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-000041c0: 5772 6974 6520 6e65 746c 6973 7420 6772  Write netlist gr
-000041d0: 6170 6820 696e 2044 4f54 2066 6f72 6d61  aph in DOT forma
-000041e0: 742e 2222 220a 2020 2020 2020 2020 6672  t.""".        fr
-000041f0: 6f6d 206e 6574 776f 726b 782e 6472 6177  om networkx.draw
-00004200: 696e 672e 6e78 5f61 6772 6170 6820 696d  ing.nx_agraph im
-00004210: 706f 7274 2077 7269 7465 5f64 6f74 0a0a  port write_dot..
-00004220: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-00004230: 203d 2066 696c 6570 6174 6820 6f72 2066   = filepath or f
-00004240: 227b 7365 6c66 2e6e 616d 657d 2e64 6f74  "{self.name}.dot
-00004250: 220a 0a20 2020 2020 2020 2047 203d 2073  "..        G = s
-00004260: 656c 662e 706c 6f74 5f6e 6574 6c69 7374  elf.plot_netlist
-00004270: 2829 0a20 2020 2020 2020 2077 7269 7465  ().        write
-00004280: 5f64 6f74 2847 2c20 6669 6c65 7061 7468  _dot(G, filepath
-00004290: 290a 0a20 2020 2064 6566 2067 6574 5f6e  )..    def get_n
-000042a0: 6574 6c69 7374 2873 656c 662c 202a 2a6b  etlist(self, **k
-000042b0: 7761 7267 7329 202d 3e20 4469 6374 5b73  wargs) -> Dict[s
-000042c0: 7472 2c20 416e 795d 3a0a 2020 2020 2020  tr, Any]:.      
-000042d0: 2020 2222 2246 726f 6d20 436f 6d70 6f6e    """From Compon
-000042e0: 656e 7420 7265 7475 726e 7320 696e 7374  ent returns inst
-000042f0: 616e 6365 732c 2063 6f6e 6e65 6374 696f  ances, connectio
-00004300: 6e73 2061 6e64 2070 6c61 6365 6d65 6e74  ns and placement
-00004310: 7320 6469 6374 2e0a 0a20 2020 2020 2020  s dict...       
-00004320: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
-00004330: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-00004340: 6e65 6e74 3a20 746f 2065 7874 7261 6374  nent: to extract
-00004350: 206e 6574 6c69 7374 2e0a 2020 2020 2020   netlist..      
-00004360: 2020 2020 2020 6675 6c6c 5f73 6574 7469        full_setti
-00004370: 6e67 733a 2054 7275 6520 7265 7475 726e  ngs: True return
-00004380: 7320 616c 6c2c 2066 616c 7365 2063 6861  s all, false cha
-00004390: 6e67 6564 2073 6574 7469 6e67 732e 0a20  nged settings.. 
-000043a0: 2020 2020 2020 2020 2020 2074 6f6c 6572             toler
-000043b0: 616e 6365 3a20 746f 6c65 7261 6e63 6520  ance: tolerance 
-000043c0: 696e 206e 6d20 746f 2063 6f6e 7369 6465  in nm to conside
-000043d0: 7220 7477 6f20 706f 7274 7320 636f 6e6e  r two ports conn
-000043e0: 6563 7465 642e 0a20 2020 2020 2020 2020  ected..         
-000043f0: 2020 2065 7863 6c75 6465 5f70 6f72 745f     exclude_port_
-00004400: 7479 7065 733a 206f 7074 696f 6e61 6c20  types: optional 
-00004410: 6c69 7374 206f 6620 706f 7274 2074 7970  list of port typ
-00004420: 6573 2074 6f20 6578 636c 7564 6520 6672  es to exclude fr
-00004430: 6f6d 206e 6574 6c69 7374 696e 672e 0a20  om netlisting.. 
-00004440: 2020 2020 2020 2020 2020 2067 6574 5f69             get_i
-00004450: 6e73 7461 6e63 655f 6e61 6d65 3a20 6675  nstance_name: fu
-00004460: 6e63 7469 6f6e 2074 6f20 6765 7420 696e  nction to get in
-00004470: 7374 616e 6365 206e 616d 652e 0a20 2020  stance name..   
-00004480: 2020 2020 2020 2020 2061 6c6c 6f77 5f6d           allow_m
-00004490: 756c 7469 706c 653a 2046 616c 7365 2074  ultiple: False t
-000044a0: 6f20 7261 6973 6520 616e 2065 7272 6f72  o raise an error
-000044b0: 2069 6620 6d6f 7265 2074 6861 6e20 7477   if more than tw
-000044c0: 6f20 706f 7274 7320 7368 6172 6520 7468  o ports share th
-000044d0: 6520 7361 6d65 2063 6f6e 6e65 6374 696f  e same connectio
-000044e0: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
-000044f0: 2020 2069 6620 5472 7565 2c20 7769 6c6c     if True, will
-00004500: 2072 6574 7572 6e20 6b65 793a 205b 7661   return key: [va
-00004510: 6c75 655d 2070 6169 7273 2077 6974 6820  lue] pairs with 
-00004520: 5b76 616c 7565 5d20 6120 6c69 7374 206f  [value] a list o
-00004530: 6620 616c 6c20 636f 6e6e 6563 7465 6420  f all connected 
-00004540: 696e 7374 616e 6365 732e 0a0a 2020 2020  instances...    
-00004550: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
-00004560: 2020 2020 2020 2020 204e 6574 6c69 7374           Netlist
-00004570: 2064 6963 7420 2869 6e73 7461 6e63 6573   dict (instances
-00004580: 2c20 636f 6e6e 6563 7469 6f6e 732c 2070  , connections, p
-00004590: 6c61 6365 6d65 6e74 732c 2070 6f72 7473  lacements, ports
-000045a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000045b0: 2020 696e 7374 616e 6365 733a 2044 6963    instances: Dic
-000045c0: 7420 6f66 2069 6e73 7461 6e63 6520 6e61  t of instance na
-000045d0: 6d65 2061 6e64 2073 6574 7469 6e67 732e  me and settings.
-000045e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000045f0: 2063 6f6e 6e65 6374 696f 6e73 3a20 4469   connections: Di
-00004600: 6374 206f 6620 496e 7374 616e 6365 314e  ct of Instance1N
-00004610: 616d 652c 706f 7274 4e61 6d65 3a20 496e  ame,portName: In
-00004620: 7374 616e 6365 324e 616d 652c 706f 7274  stance2Name,port
-00004630: 4e61 6d65 2e0a 2020 2020 2020 2020 2020  Name..          
-00004640: 2020 2020 2020 706c 6163 656d 656e 7473        placements
-00004650: 3a20 4469 6374 206f 6620 696e 7374 616e  : Dict of instan
-00004660: 6365 206e 616d 6573 2061 6e64 2070 6c61  ce names and pla
-00004670: 6365 6d65 6e74 7320 2878 2c20 792c 2072  cements (x, y, r
-00004680: 6f74 6174 696f 6e29 2e0a 2020 2020 2020  otation)..      
-00004690: 2020 2020 2020 2020 2020 706f 7274 733a            ports:
-000046a0: 2044 6963 7420 706f 7274 4e61 6d65 3a20   Dict portName: 
-000046b0: 436f 6d70 6f6e 656e 744e 616d 652c 706f  ComponentName,po
-000046c0: 7274 2e0a 2020 2020 2020 2020 2020 2020  rt..            
-000046d0: 2020 2020 6e61 6d65 3a20 6e61 6d65 206f      name: name o
-000046e0: 6620 636f 6d70 6f6e 656e 742e 0a20 2020  f component..   
-000046f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00004700: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-00004710: 2e67 6574 5f6e 6574 6c69 7374 2069 6d70  .get_netlist imp
-00004720: 6f72 7420 6765 745f 6e65 746c 6973 740a  ort get_netlist.
-00004730: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004740: 6765 745f 6e65 746c 6973 7428 636f 6d70  get_netlist(comp
-00004750: 6f6e 656e 743d 7365 6c66 2c20 2a2a 6b77  onent=self, **kw
-00004760: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
-00004770: 6574 5f6e 6574 6c69 7374 5f72 6563 7572  et_netlist_recur
-00004780: 7369 7665 2873 656c 662c 202a 2a6b 7761  sive(self, **kwa
-00004790: 7267 7329 202d 3e20 4469 6374 5b73 7472  rgs) -> Dict[str
-000047a0: 2c20 4469 6374 436f 6e66 6967 5d3a 0a20  , DictConfig]:. 
-000047b0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-000047c0: 7320 7265 6375 7273 6976 6520 6e65 746c  s recursive netl
-000047d0: 6973 7420 666f 7220 6120 636f 6d70 6f6e  ist for a compon
-000047e0: 656e 7420 616e 6420 7375 6263 6f6d 706f  ent and subcompo
-000047f0: 6e65 6e74 732e 0a0a 2020 2020 2020 2020  nents...        
-00004800: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
-00004810: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-00004820: 656e 743a 2074 6f20 6578 7472 6163 7420  ent: to extract 
-00004830: 6e65 746c 6973 742e 0a20 2020 2020 2020  netlist..       
-00004840: 2020 2020 2063 6f6d 706f 6e65 6e74 5f73       component_s
-00004850: 7566 6669 783a 2073 7566 6669 7820 746f  uffix: suffix to
-00004860: 2061 7070 656e 6420 746f 2065 6163 6820   append to each 
-00004870: 636f 6d70 6f6e 656e 7420 6e61 6d65 2e0a  component name..
-00004880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004890: 7573 6566 756c 2069 6620 746f 2073 6176  useful if to sav
-000048a0: 6520 616e 6420 7265 6c6f 6164 2061 2062  e and reload a b
-000048b0: 6163 6b2d 616e 6e6f 7461 7465 6420 6e65  ack-annotated ne
-000048c0: 746c 6973 742e 0a20 2020 2020 2020 2020  tlist..         
-000048d0: 2020 2067 6574 5f6e 6574 6c69 7374 5f66     get_netlist_f
-000048e0: 756e 633a 2066 756e 6374 696f 6e20 746f  unc: function to
-000048f0: 2065 7874 7261 6374 2069 6e64 6976 6964   extract individ
-00004900: 7561 6c20 6e65 746c 6973 7473 2e0a 2020  ual netlists..  
-00004910: 2020 2020 2020 2020 2020 6675 6c6c 5f73            full_s
-00004920: 6574 7469 6e67 733a 2054 7275 6520 7265  ettings: True re
-00004930: 7475 726e 7320 616c 6c2c 2066 616c 7365  turns all, false
-00004940: 2063 6861 6e67 6564 2073 6574 7469 6e67   changed setting
-00004950: 732e 0a20 2020 2020 2020 2020 2020 2074  s..            t
-00004960: 6f6c 6572 616e 6365 3a20 746f 6c65 7261  olerance: tolera
-00004970: 6e63 6520 696e 206e 6d20 746f 2063 6f6e  nce in nm to con
-00004980: 7369 6465 7220 7477 6f20 706f 7274 7320  sider two ports 
-00004990: 636f 6e6e 6563 7465 642e 0a20 2020 2020  connected..     
-000049a0: 2020 2020 2020 2065 7863 6c75 6465 5f70         exclude_p
-000049b0: 6f72 745f 7479 7065 733a 206f 7074 696f  ort_types: optio
-000049c0: 6e61 6c20 6c69 7374 206f 6620 706f 7274  nal list of port
-000049d0: 2074 7970 6573 2074 6f20 6578 636c 7564   types to exclud
-000049e0: 6520 6672 6f6d 206e 6574 6c69 7374 696e  e from netlistin
-000049f0: 672e 0a20 2020 2020 2020 2020 2020 2067  g..            g
-00004a00: 6574 5f69 6e73 7461 6e63 655f 6e61 6d65  et_instance_name
-00004a10: 3a20 6675 6e63 7469 6f6e 2074 6f20 6765  : function to ge
-00004a20: 7420 696e 7374 616e 6365 206e 616d 652e  t instance name.
-00004a30: 0a20 2020 2020 2020 2020 2020 2061 6c6c  .            all
-00004a40: 6f77 5f6d 756c 7469 706c 653a 2046 616c  ow_multiple: Fal
-00004a50: 7365 2074 6f20 7261 6973 6520 616e 2065  se to raise an e
-00004a60: 7272 6f72 2069 6620 6d6f 7265 2074 6861  rror if more tha
-00004a70: 6e20 7477 6f20 706f 7274 7320 7368 6172  n two ports shar
-00004a80: 6520 7468 6520 7361 6d65 2063 6f6e 6e65  e the same conne
-00004a90: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
-00004aa0: 2020 2020 2020 2069 6620 5472 7565 2c20         if True, 
-00004ab0: 7769 6c6c 2072 6574 7572 6e20 6b65 793a  will return key:
-00004ac0: 205b 7661 6c75 655d 2070 6169 7273 2077   [value] pairs w
-00004ad0: 6974 6820 5b76 616c 7565 5d20 6120 6c69  ith [value] a li
-00004ae0: 7374 206f 6620 616c 6c20 636f 6e6e 6563  st of all connec
-00004af0: 7465 6420 696e 7374 616e 6365 732e 0a0a  ted instances...
-00004b00: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-00004b10: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
-00004b20: 7469 6f6e 6172 7920 6f66 206e 6574 6c69  tionary of netli
-00004b30: 7374 732c 206b 6579 6564 2062 7920 7468  sts, keyed by th
-00004b40: 6520 6e61 6d65 206f 6620 6561 6368 2063  e name of each c
-00004b50: 6f6d 706f 6e65 6e74 2e0a 2020 2020 2020  omponent..      
-00004b60: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00004b70: 6f6d 2067 6473 6661 6374 6f72 792e 6765  om gdsfactory.ge
-00004b80: 745f 6e65 746c 6973 7420 696d 706f 7274  t_netlist import
-00004b90: 2067 6574 5f6e 6574 6c69 7374 5f72 6563   get_netlist_rec
-00004ba0: 7572 7369 7665 0a0a 2020 2020 2020 2020  ursive..        
-00004bb0: 7265 7475 726e 2067 6574 5f6e 6574 6c69  return get_netli
-00004bc0: 7374 5f72 6563 7572 7369 7665 2863 6f6d  st_recursive(com
-00004bd0: 706f 6e65 6e74 3d73 656c 662c 202a 2a6b  ponent=self, **k
-00004be0: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-00004bf0: 6765 745f 6e65 746c 6973 745f 666c 6174  get_netlist_flat
-00004c00: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
-00004c10: 202d 3e20 4469 6374 5b73 7472 2c20 4469   -> Dict[str, Di
-00004c20: 6374 436f 6e66 6967 5d3a 0a20 2020 2020  ctConfig]:.     
-00004c30: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-00004c40: 6e65 746c 6973 7420 7768 6572 6520 616c  netlist where al
-00004c50: 6c20 7375 6269 6e73 7461 6e63 6573 2061  l subinstances a
-00004c60: 7265 2065 7870 6f73 6564 2061 6e64 2069  re exposed and i
-00004c70: 6e64 6570 656e 6465 6e74 6c79 206e 616d  ndependently nam
-00004c80: 6564 2e0a 0a20 2020 2020 2020 204b 6579  ed...        Key
-00004c90: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
-00004ca0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-00004cb0: 3a20 746f 2065 7874 7261 6374 206e 6574  : to extract net
-00004cc0: 6c69 7374 2e0a 2020 2020 2020 2020 2020  list..          
-00004cd0: 2020 636f 6d70 6f6e 656e 745f 7375 6666    component_suff
-00004ce0: 6978 3a20 7375 6666 6978 2074 6f20 6170  ix: suffix to ap
-00004cf0: 7065 6e64 2074 6f20 6561 6368 2063 6f6d  pend to each com
-00004d00: 706f 6e65 6e74 206e 616d 652e 0a20 2020  ponent name..   
-00004d10: 2020 2020 2020 2020 2020 2020 2075 7365               use
-00004d20: 6675 6c20 6966 2074 6f20 7361 7665 2061  ful if to save a
-00004d30: 6e64 2072 656c 6f61 6420 6120 6261 636b  nd reload a back
-00004d40: 2d61 6e6e 6f74 6174 6564 206e 6574 6c69  -annotated netli
-00004d50: 7374 2e0a 2020 2020 2020 2020 2020 2020  st..            
-00004d60: 6765 745f 6e65 746c 6973 745f 6675 6e63  get_netlist_func
-00004d70: 3a20 6675 6e63 7469 6f6e 2074 6f20 6578  : function to ex
-00004d80: 7472 6163 7420 696e 6469 7669 6475 616c  tract individual
-00004d90: 206e 6574 6c69 7374 732e 0a20 2020 2020   netlists..     
-00004da0: 2020 2020 2020 2066 756c 6c5f 7365 7474         full_sett
-00004db0: 696e 6773 3a20 5472 7565 2072 6574 7572  ings: True retur
-00004dc0: 6e73 2061 6c6c 2c20 6661 6c73 6520 6368  ns all, false ch
-00004dd0: 616e 6765 6420 7365 7474 696e 6773 2e0a  anged settings..
-00004de0: 2020 2020 2020 2020 2020 2020 746f 6c65              tole
-00004df0: 7261 6e63 653a 2074 6f6c 6572 616e 6365  rance: tolerance
-00004e00: 2069 6e20 6e6d 2074 6f20 636f 6e73 6964   in nm to consid
-00004e10: 6572 2074 776f 2070 6f72 7473 2063 6f6e  er two ports con
-00004e20: 6e65 6374 6564 2e0a 2020 2020 2020 2020  nected..        
-00004e30: 2020 2020 6578 636c 7564 655f 706f 7274      exclude_port
-00004e40: 5f74 7970 6573 3a20 6f70 7469 6f6e 616c  _types: optional
-00004e50: 206c 6973 7420 6f66 2070 6f72 7420 7479   list of port ty
-00004e60: 7065 7320 746f 2065 7863 6c75 6465 2066  pes to exclude f
-00004e70: 726f 6d20 6e65 746c 6973 7469 6e67 2e0a  rom netlisting..
-00004e80: 2020 2020 2020 2020 2020 2020 6765 745f              get_
-00004e90: 696e 7374 616e 6365 5f6e 616d 653a 2066  instance_name: f
-00004ea0: 756e 6374 696f 6e20 746f 2067 6574 2069  unction to get i
-00004eb0: 6e73 7461 6e63 6520 6e61 6d65 2e0a 2020  nstance name..  
-00004ec0: 2020 2020 2020 2020 2020 616c 6c6f 775f            allow_
-00004ed0: 6d75 6c74 6970 6c65 3a20 4661 6c73 6520  multiple: False 
-00004ee0: 746f 2072 6169 7365 2061 6e20 6572 726f  to raise an erro
-00004ef0: 7220 6966 206d 6f72 6520 7468 616e 2074  r if more than t
-00004f00: 776f 2070 6f72 7473 2073 6861 7265 2074  wo ports share t
-00004f10: 6865 2073 616d 6520 636f 6e6e 6563 7469  he same connecti
-00004f20: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00004f30: 2020 2020 6966 2054 7275 652c 2077 696c      if True, wil
-00004f40: 6c20 7265 7475 726e 206b 6579 3a20 5b76  l return key: [v
-00004f50: 616c 7565 5d20 7061 6972 7320 7769 7468  alue] pairs with
-00004f60: 205b 7661 6c75 655d 2061 206c 6973 7420   [value] a list 
-00004f70: 6f66 2061 6c6c 2063 6f6e 6e65 6374 6564  of all connected
-00004f80: 2069 6e73 7461 6e63 6573 2e0a 0a20 2020   instances...   
-00004f90: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-00004fa0: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
-00004fb0: 6e61 7279 206f 6620 6e65 746c 6973 7473  nary of netlists
-00004fc0: 2c20 6b65 7965 6420 6279 2074 6865 206e  , keyed by the n
-00004fd0: 616d 6520 6f66 2065 6163 6820 636f 6d70  ame of each comp
-00004fe0: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
-00004ff0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00005000: 6764 7366 6163 746f 7279 2e67 6574 5f6e  gdsfactory.get_n
-00005010: 6574 6c69 7374 5f66 6c61 7420 696d 706f  etlist_flat impo
-00005020: 7274 2067 6574 5f6e 6574 6c69 7374 5f66  rt get_netlist_f
-00005030: 6c61 740a 0a20 2020 2020 2020 2072 6574  lat..        ret
-00005040: 7572 6e20 6765 745f 6e65 746c 6973 745f  urn get_netlist_
-00005050: 666c 6174 2863 6f6d 706f 6e65 6e74 3d73  flat(component=s
-00005060: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
-00005070: 2020 2020 6465 6620 6173 7365 7274 5f70      def assert_p
-00005080: 6f72 7473 5f6f 6e5f 6772 6964 2873 656c  orts_on_grid(sel
-00005090: 662c 206e 6d3a 2069 6e74 203d 2031 2920  f, nm: int = 1) 
-000050a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000050b0: 2022 2222 4173 7365 7274 7320 7468 6174   """Asserts that
-000050c0: 2061 6c6c 2070 6f72 7473 2061 7265 206f   all ports are o
-000050d0: 6e20 6772 6964 2e22 2222 0a20 2020 2020  n grid.""".     
-000050e0: 2020 2066 6f72 2070 6f72 7420 696e 2073     for port in s
-000050f0: 656c 662e 706f 7274 732e 7661 6c75 6573  elf.ports.values
-00005100: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00005110: 706f 7274 2e61 7373 6572 745f 6f6e 5f67  port.assert_on_g
-00005120: 7269 6428 6e6d 3d6e 6d29 0a0a 2020 2020  rid(nm=nm)..    
-00005130: 6465 6620 6765 745f 706f 7274 7328 7365  def get_ports(se
-00005140: 6c66 2c20 6465 7074 683d 4e6f 6e65 293a  lf, depth=None):
-00005150: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00005160: 726e 7320 636f 7069 6573 206f 6620 616c  rns copies of al
-00005170: 6c20 7468 6520 706f 7274 7320 6f66 2074  l the ports of t
-00005180: 6865 2043 6f6d 706f 6e65 6e74 2c20 726f  he Component, ro
-00005190: 7461 7465 6420 616e 6420 5c0a 2020 2020  tated and \.    
-000051a0: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-000051b0: 736c 6174 6564 2073 6f20 7468 6174 2074  slated so that t
-000051c0: 6865 7927 7265 2069 6e20 7468 6569 7220  hey're in their 
-000051d0: 746f 702d 6c65 7665 6c20 706f 7369 7469  top-level positi
-000051e0: 6f6e 2e0a 0a20 2020 2020 2020 2054 6865  on...        The
-000051f0: 2050 6f72 7473 2072 6574 7572 6e65 6420   Ports returned 
-00005200: 6172 6520 636f 7069 6573 206f 6620 7468  are copies of th
-00005210: 6520 6f72 6967 696e 616c 732c 2062 7574  e originals, but
-00005220: 2065 6163 6820 636f 7079 2068 6173 2074   each copy has t
-00005230: 6865 2073 616d 650a 2020 2020 2020 2020  he same.        
-00005240: 6060 7569 6460 6020 6173 2074 6865 206f  ``uid`` as the o
-00005250: 7269 6769 6e61 6c20 736f 2074 6861 7420  riginal so that 
-00005260: 7468 6579 2063 616e 2062 6520 7472 6163  they can be trac
-00005270: 6564 2062 6163 6b20 746f 2074 6865 206f  ed back to the o
-00005280: 7269 6769 6e61 6c20 6966 206e 6565 6465  riginal if neede
-00005290: 642e 0a0a 2020 2020 2020 2020 4172 6773  d...        Args
-000052a0: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-000052b0: 7074 6820 3a20 696e 7420 6f72 204e 6f6e  pth : int or Non
-000052c0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-000052d0: 2020 4966 206e 6f74 204e 6f6e 652c 2064    If not None, d
-000052e0: 6566 696e 6573 2066 726f 6d20 686f 7720  efines from how 
-000052f0: 6d61 6e79 2072 6566 6572 656e 6365 206c  many reference l
-00005300: 6576 656c 7320 746f 0a20 2020 2020 2020  evels to.       
-00005310: 2020 2020 2020 2020 2072 6574 7269 6576           retriev
-00005320: 6520 506f 7274 7320 6672 6f6d 2e0a 0a20  e Ports from... 
-00005330: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-00005340: 2020 2020 2020 2020 2020 2020 706f 7274              port
-00005350: 5f6c 6973 7420 3a20 6c69 7374 206f 6620  _list : list of 
-00005360: 506f 7274 204c 6973 7420 6f66 2061 6c6c  Port List of all
-00005370: 2050 6f72 7473 2069 6e20 7468 6520 436f   Ports in the Co
-00005380: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
-00005390: 2022 2222 0a20 2020 2020 2020 2070 6f72   """.        por
-000053a0: 745f 6c69 7374 203d 205b 702e 5f63 6f70  t_list = [p._cop
-000053b0: 7928 2920 666f 7220 7020 696e 2073 656c  y() for p in sel
-000053c0: 662e 706f 7274 732e 7661 6c75 6573 2829  f.ports.values()
-000053d0: 5d0a 0a20 2020 2020 2020 2069 6620 6465  ]..        if de
-000053e0: 7074 6820 6973 204e 6f6e 6520 6f72 2064  pth is None or d
-000053f0: 6570 7468 203e 2030 3a0a 2020 2020 2020  epth > 0:.      
-00005400: 2020 2020 2020 666f 7220 7220 696e 2073        for r in s
-00005410: 656c 662e 7265 6665 7265 6e63 6573 3a0a  elf.references:.
-00005420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005430: 6e65 775f 6465 7074 6820 3d20 4e6f 6e65  new_depth = None
-00005440: 2069 6620 6465 7074 6820 6973 204e 6f6e   if depth is Non
-00005450: 6520 656c 7365 2064 6570 7468 202d 2031  e else depth - 1
-00005460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005470: 2072 6566 5f70 6f72 7473 203d 2072 2e70   ref_ports = r.p
-00005480: 6172 656e 742e 6765 745f 706f 7274 7328  arent.get_ports(
-00005490: 6465 7074 683d 6e65 775f 6465 7074 6829  depth=new_depth)
-000054a0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000054b0: 2020 2320 5472 616e 7366 6f72 6d20 706f    # Transform po
-000054c0: 7274 7320 7468 6174 2063 616d 6520 6672  rts that came fr
-000054d0: 6f6d 2061 2072 6566 6572 656e 6365 0a20  om a reference. 
-000054e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000054f0: 6566 5f70 6f72 7473 5f74 7261 6e73 666f  ef_ports_transfo
-00005500: 726d 6564 203d 205b 5d0a 2020 2020 2020  rmed = [].      
-00005510: 2020 2020 2020 2020 2020 666f 7220 7270            for rp
-00005520: 2069 6e20 7265 665f 706f 7274 733a 0a20   in ref_ports:. 
-00005530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005540: 2020 206e 6577 5f70 6f72 7420 3d20 7270     new_port = rp
-00005550: 2e5f 636f 7079 2829 0a20 2020 2020 2020  ._copy().       
-00005560: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00005570: 5f63 656e 7465 722c 206e 6577 5f6f 7269  _center, new_ori
-00005580: 656e 7461 7469 6f6e 203d 2072 2e5f 7472  entation = r._tr
-00005590: 616e 7366 6f72 6d5f 706f 7274 280a 2020  ansform_port(.  
-000055a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055b0: 2020 2020 2020 7270 2e63 656e 7465 722c        rp.center,
-000055c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000055d0: 2020 2020 2020 2020 2072 702e 6f72 6965           rp.orie
-000055e0: 6e74 6174 696f 6e2c 0a20 2020 2020 2020  ntation,.       
-000055f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005600: 2072 2e6f 7269 6769 6e2c 0a20 2020 2020   r.origin,.     
-00005610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005620: 2020 2072 2e72 6f74 6174 696f 6e2c 0a20     r.rotation,. 
-00005630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005640: 2020 2020 2020 2072 2e78 5f72 6566 6c65         r.x_refle
-00005650: 6374 696f 6e2c 0a20 2020 2020 2020 2020  ction,.         
-00005660: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00005670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005680: 206e 6577 5f70 6f72 742e 6365 6e74 6572   new_port.center
-00005690: 203d 206e 6577 5f63 656e 7465 720a 2020   = new_center.  
-000056a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056b0: 2020 6e65 775f 706f 7274 2e6e 6577 5f6f    new_port.new_o
-000056c0: 7269 656e 7461 7469 6f6e 203d 206e 6577  rientation = new
-000056d0: 5f6f 7269 656e 7461 7469 6f6e 0a20 2020  _orientation.   
-000056e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056f0: 2072 6566 5f70 6f72 7473 5f74 7261 6e73   ref_ports_trans
-00005700: 666f 726d 6564 2e61 7070 656e 6428 6e65  formed.append(ne
-00005710: 775f 706f 7274 290a 2020 2020 2020 2020  w_port).        
-00005720: 2020 2020 2020 2020 706f 7274 5f6c 6973          port_lis
-00005730: 7420 2b3d 2072 6566 5f70 6f72 7473 5f74  t += ref_ports_t
-00005740: 7261 6e73 666f 726d 6564 0a0a 2020 2020  ransformed..    
-00005750: 2020 2020 7265 7475 726e 2070 6f72 745f      return port_
-00005760: 6c69 7374 0a0a 2020 2020 6465 6620 6765  list..    def ge
-00005770: 745f 706f 7274 735f 6469 6374 2873 656c  t_ports_dict(sel
-00005780: 662c 202a 2a6b 7761 7267 7329 202d 3e20  f, **kwargs) -> 
-00005790: 4469 6374 5b73 7472 2c20 506f 7274 5d3a  Dict[str, Port]:
-000057a0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-000057b0: 726e 7320 6120 6469 6374 206f 6620 706f  rns a dict of po
-000057c0: 7274 732e 0a0a 2020 2020 2020 2020 4b65  rts...        Ke
-000057d0: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-000057e0: 2020 2020 2020 2020 6c61 7965 723a 2070          layer: p
-000057f0: 6f72 7420 4744 5320 6c61 7965 722e 0a20  ort GDS layer.. 
-00005800: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-00005810: 783a 2073 656c 6563 7420 706f 7274 7320  x: select ports 
-00005820: 7769 7468 2070 7265 6669 7820 696e 2070  with prefix in p
-00005830: 6f72 7420 6e61 6d65 2e0a 2020 2020 2020  ort name..      
-00005840: 2020 2020 2020 7375 6666 6978 3a20 7365        suffix: se
-00005850: 6c65 6374 2070 6f72 7473 2077 6974 6820  lect ports with 
-00005860: 706f 7274 206e 616d 6520 7375 6666 6978  port name suffix
-00005870: 2e0a 2020 2020 2020 2020 2020 2020 6f72  ..            or
-00005880: 6965 6e74 6174 696f 6e3a 2073 656c 6563  ientation: selec
-00005890: 7420 706f 7274 7320 7769 7468 206f 7269  t ports with ori
-000058a0: 656e 7461 7469 6f6e 2069 6e20 6465 6772  entation in degr
-000058b0: 6565 732e 0a20 2020 2020 2020 2020 2020  ees..           
-000058c0: 2077 6964 7468 3a20 7365 6c65 6374 2070   width: select p
-000058d0: 6f72 7473 2077 6974 6820 706f 7274 2077  orts with port w
-000058e0: 6964 7468 2e0a 2020 2020 2020 2020 2020  idth..          
-000058f0: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
-00005900: 643a 204c 6973 7420 6f66 206c 6179 6572  d: List of layer
-00005910: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
-00005920: 2020 2020 2020 2020 2020 706f 7274 5f74            port_t
-00005930: 7970 653a 2073 656c 6563 7420 706f 7274  ype: select port
-00005940: 7320 7769 7468 2070 6f72 745f 7479 7065  s with port_type
-00005950: 2028 6f70 7469 6361 6c2c 2065 6c65 6374   (optical, elect
-00005960: 7269 6361 6c2c 2076 6572 7469 6361 6c5f  rical, vertical_
-00005970: 7465 292e 0a20 2020 2020 2020 2020 2020  te)..           
-00005980: 2063 6c6f 636b 7769 7365 3a20 6966 2054   clockwise: if T
-00005990: 7275 652c 2073 6f72 7420 706f 7274 7320  rue, sort ports 
-000059a0: 636c 6f63 6b77 6973 652c 2046 616c 7365  clockwise, False
-000059b0: 3a20 636f 756e 7465 722d 636c 6f63 6b77  : counter-clockw
-000059c0: 6973 652e 0a20 2020 2020 2020 2022 2222  ise..        """
-000059d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000059e0: 7365 6c65 6374 5f70 6f72 7473 2873 656c  select_ports(sel
-000059f0: 662e 706f 7274 732c 202a 2a6b 7761 7267  f.ports, **kwarg
-00005a00: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
-00005a10: 706f 7274 735f 6c69 7374 2873 656c 662c  ports_list(self,
-00005a20: 202a 2a6b 7761 7267 7329 202d 3e20 4c69   **kwargs) -> Li
-00005a30: 7374 5b50 6f72 745d 3a0a 2020 2020 2020  st[Port]:.      
-00005a40: 2020 2222 2252 6574 7572 6e73 206c 6973    """Returns lis
-00005a50: 7420 6f66 2070 6f72 7473 2e0a 0a20 2020  t of ports...   
-00005a60: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
-00005a70: 733a 0a20 2020 2020 2020 2020 2020 206c  s:.            l
-00005a80: 6179 6572 3a20 7365 6c65 6374 2070 6f72  ayer: select por
-00005a90: 7473 2077 6974 6820 4744 5320 6c61 7965  ts with GDS laye
-00005aa0: 722e 0a20 2020 2020 2020 2020 2020 2070  r..            p
-00005ab0: 7265 6669 783a 2073 656c 6563 7420 706f  refix: select po
-00005ac0: 7274 7320 7769 7468 2070 7265 6669 7820  rts with prefix 
-00005ad0: 696e 2070 6f72 7420 6e61 6d65 2e0a 2020  in port name..  
-00005ae0: 2020 2020 2020 2020 2020 7375 6666 6978            suffix
-00005af0: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
-00005b00: 6974 6820 706f 7274 206e 616d 6520 7375  ith port name su
-00005b10: 6666 6978 2e0a 2020 2020 2020 2020 2020  ffix..          
-00005b20: 2020 6f72 6965 6e74 6174 696f 6e3a 2073    orientation: s
-00005b30: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
-00005b40: 206f 7269 656e 7461 7469 6f6e 2069 6e20   orientation in 
-00005b50: 6465 6772 6565 732e 0a20 2020 2020 2020  degrees..       
-00005b60: 2020 2020 206f 7269 656e 7461 7469 6f6e       orientation
-00005b70: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
-00005b80: 6974 6820 6f72 6965 6e74 6174 696f 6e20  ith orientation 
-00005b90: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
-00005ba0: 2020 2020 2020 2020 7769 6474 683a 2073          width: s
-00005bb0: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
-00005bc0: 2070 6f72 7420 7769 6474 682e 0a20 2020   port width..   
-00005bd0: 2020 2020 2020 2020 206c 6179 6572 735f           layers_
-00005be0: 6578 636c 7564 6564 3a20 4c69 7374 206f  excluded: List o
-00005bf0: 6620 6c61 7965 7273 2074 6f20 6578 636c  f layers to excl
-00005c00: 7564 652e 0a20 2020 2020 2020 2020 2020  ude..           
-00005c10: 2070 6f72 745f 7479 7065 3a20 7365 6c65   port_type: sele
-00005c20: 6374 2070 6f72 7473 2077 6974 6820 706f  ct ports with po
-00005c30: 7274 5f74 7970 6520 286f 7074 6963 616c  rt_type (optical
-00005c40: 2c20 656c 6563 7472 6963 616c 2c20 7665  , electrical, ve
-00005c50: 7274 6963 616c 5f74 6529 2e0a 2020 2020  rtical_te)..    
-00005c60: 2020 2020 2020 2020 636c 6f63 6b77 6973          clockwis
-00005c70: 653a 2069 6620 5472 7565 2c20 736f 7274  e: if True, sort
-00005c80: 2070 6f72 7473 2063 6c6f 636b 7769 7365   ports clockwise
-00005c90: 2c20 4661 6c73 653a 2063 6f75 6e74 6572  , False: counter
-00005ca0: 2d63 6c6f 636b 7769 7365 2e0a 2020 2020  -clockwise..    
-00005cb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00005cc0: 7265 7475 726e 206c 6973 7428 7365 6c65  return list(sele
-00005cd0: 6374 5f70 6f72 7473 2873 656c 662e 706f  ct_ports(self.po
-00005ce0: 7274 732c 202a 2a6b 7761 7267 7329 2e76  rts, **kwargs).v
-00005cf0: 616c 7565 7328 2929 0a0a 2020 2020 6465  alues())..    de
-00005d00: 6620 6765 745f 706f 7274 735f 7061 6e64  f get_ports_pand
-00005d10: 6173 2873 656c 6629 3a0a 2020 2020 2020  as(self):.      
-00005d20: 2020 696d 706f 7274 2070 616e 6461 7320    import pandas 
-00005d30: 6173 2070 640a 0a20 2020 2020 2020 2063  as pd..        c
-00005d40: 6f6c 5f73 7065 6320 3d20 5b0a 2020 2020  ol_spec = [.    
-00005d50: 2020 2020 2020 2020 226e 616d 6522 2c0a          "name",.
-00005d60: 2020 2020 2020 2020 2020 2020 2277 6964              "wid
-00005d70: 7468 222c 0a20 2020 2020 2020 2020 2020  th",.           
-00005d80: 2022 6365 6e74 6572 222c 0a20 2020 2020   "center",.     
-00005d90: 2020 2020 2020 2022 6f72 6965 6e74 6174         "orientat
-00005da0: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
-00005db0: 2020 226c 6179 6572 222c 0a20 2020 2020    "layer",.     
-00005dc0: 2020 2020 2020 2022 706f 7274 5f74 7970         "port_typ
-00005dd0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00005de0: 2273 6865 6172 5f61 6e67 6c65 222c 0a20  "shear_angle",. 
-00005df0: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-00005e00: 2020 7265 7475 726e 2070 642e 4461 7461    return pd.Data
-00005e10: 4672 616d 6528 0a20 2020 2020 2020 2020  Frame(.         
-00005e20: 2020 205b 706f 7274 2e74 6f5f 6469 6374     [port.to_dict
-00005e30: 2829 2066 6f72 2070 6f72 7420 696e 2073  () for port in s
-00005e40: 656c 662e 6765 745f 706f 7274 735f 6c69  elf.get_ports_li
-00005e50: 7374 2829 5d2c 2063 6f6c 756d 6e73 3d63  st()], columns=c
-00005e60: 6f6c 5f73 7065 630a 2020 2020 2020 2020  ol_spec.        
-00005e70: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
-00005e80: 6f72 7473 5f70 6f6c 6172 7328 7365 6c66  orts_polars(self
-00005e90: 293a 0a20 2020 2020 2020 2069 6d70 6f72  ):.        impor
-00005ea0: 7420 706f 6c61 7273 2061 7320 706c 0a0a  t polars as pl..
-00005eb0: 2020 2020 2020 2020 636f 6c5f 7370 6563          col_spec
-00005ec0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00005ed0: 2022 6e61 6d65 223a 2070 6c2e 5574 6638   "name": pl.Utf8
-00005ee0: 2c0a 2020 2020 2020 2020 2020 2020 2277  ,.            "w
-00005ef0: 6964 7468 223a 2070 6c2e 466c 6f61 7436  idth": pl.Float6
-00005f00: 342c 0a20 2020 2020 2020 2020 2020 2022  4,.            "
-00005f10: 6365 6e74 6572 223a 2070 6c2e 4c69 7374  center": pl.List
-00005f20: 2870 6c2e 466c 6f61 7436 3429 2c0a 2020  (pl.Float64),.  
-00005f30: 2020 2020 2020 2020 2020 226f 7269 656e            "orien
-00005f40: 7461 7469 6f6e 223a 2070 6c2e 466c 6f61  tation": pl.Floa
-00005f50: 7436 342c 0a20 2020 2020 2020 2020 2020  t64,.           
-00005f60: 2022 6c61 7965 7222 3a20 706c 2e4c 6973   "layer": pl.Lis
-00005f70: 7428 706c 2e55 496e 7431 3629 2c0a 2020  t(pl.UInt16),.  
-00005f80: 2020 2020 2020 2020 2020 2270 6f72 745f            "port_
-00005f90: 7479 7065 223a 2070 6c2e 5574 6638 2c0a  type": pl.Utf8,.
-00005fa0: 2020 2020 2020 2020 2020 2020 2273 6865              "she
-00005fb0: 6172 5f61 6e67 6c65 223a 2070 6c2e 466c  ar_angle": pl.Fl
-00005fc0: 6f61 7436 342c 0a20 2020 2020 2020 207d  oat64,.        }
-00005fd0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00005fe0: 2070 6c2e 4461 7461 4672 616d 6528 0a20   pl.DataFrame(. 
-00005ff0: 2020 2020 2020 2020 2020 205b 706f 7274             [port
-00006000: 2e74 6f5f 6469 6374 2829 2066 6f72 2070  .to_dict() for p
-00006010: 6f72 7420 696e 2073 656c 662e 6765 745f  ort in self.get_
-00006020: 706f 7274 735f 6c69 7374 2829 5d2c 2073  ports_list()], s
-00006030: 6368 656d 613d 636f 6c5f 7370 6563 0a20  chema=col_spec. 
-00006040: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00006050: 6620 7265 6628 0a20 2020 2020 2020 2073  f ref(.        s
-00006060: 656c 662c 0a20 2020 2020 2020 2070 6f73  elf,.        pos
-00006070: 6974 696f 6e3a 2043 6f6f 7264 696e 6174  ition: Coordinat
-00006080: 6520 3d20 2830 2c20 3029 2c0a 2020 2020  e = (0, 0),.    
-00006090: 2020 2020 706f 7274 5f69 643a 204f 7074      port_id: Opt
-000060a0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-000060b0: 652c 0a20 2020 2020 2020 2072 6f74 6174  e,.        rotat
-000060c0: 696f 6e3a 2066 6c6f 6174 203d 2030 2c0a  ion: float = 0,.
-000060d0: 2020 2020 2020 2020 685f 6d69 7272 6f72          h_mirror
-000060e0: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-000060f0: 2020 2020 2020 2020 765f 6d69 7272 6f72          v_mirror
-00006100: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-00006110: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
-00006120: 6e74 5265 6665 7265 6e63 653a 0a20 2020  ntReference:.   
-00006130: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-00006140: 436f 6d70 6f6e 656e 7420 7265 6665 7265  Component refere
-00006150: 6e63 652e 0a0a 2020 2020 2020 2020 4172  nce...        Ar
-00006160: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00006170: 706f 7369 7469 6f6e 3a20 782c 2079 2070  position: x, y p
-00006180: 6f73 6974 696f 6e2e 0a20 2020 2020 2020  osition..       
-00006190: 2020 2020 2070 6f72 745f 6964 3a20 6e61       port_id: na
-000061a0: 6d65 206f 6620 7468 6520 706f 7274 2e0a  me of the port..
-000061b0: 2020 2020 2020 2020 2020 2020 726f 7461              rota
-000061c0: 7469 6f6e 3a20 696e 2064 6567 7265 6573  tion: in degrees
-000061d0: 2e0a 2020 2020 2020 2020 2020 2020 685f  ..            h_
-000061e0: 6d69 7272 6f72 3a20 686f 7269 7a6f 6e74  mirror: horizont
-000061f0: 616c 206d 6972 726f 7220 7573 696e 6720  al mirror using 
-00006200: 7920 6178 6973 2028 782c 2031 2920 2831  y axis (x, 1) (1
-00006210: 2c20 3029 2e0a 2020 2020 2020 2020 2020  , 0)..          
-00006220: 2020 2020 2020 5468 6973 2069 7320 7468        This is th
-00006230: 6520 6d6f 7374 2063 6f6d 6d6f 6e20 6d69  e most common mi
-00006240: 7272 6f72 2e0a 2020 2020 2020 2020 2020  rror..          
-00006250: 2020 765f 6d69 7272 6f72 3a20 7665 7274    v_mirror: vert
-00006260: 6963 616c 206d 6972 726f 7220 7573 696e  ical mirror usin
-00006270: 6720 7820 6178 6973 2028 312c 2079 2920  g x axis (1, y) 
-00006280: 2830 2c20 7929 2e0a 2020 2020 2020 2020  (0, y)..        
-00006290: 2222 220a 2020 2020 2020 2020 5f72 6566  """.        _ref
-000062a0: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
-000062b0: 7265 6e63 6528 7365 6c66 290a 0a20 2020  rence(self)..   
-000062c0: 2020 2020 2069 6620 706f 7274 5f69 6420       if port_id 
-000062d0: 616e 6420 706f 7274 5f69 6420 6e6f 7420  and port_id not 
-000062e0: 696e 2073 656c 662e 706f 7274 733a 0a20  in self.ports:. 
-000062f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00006300: 2056 616c 7565 4572 726f 7228 6622 706f   ValueError(f"po
-00006310: 7274 207b 706f 7274 5f69 647d 206e 6f74  rt {port_id} not
-00006320: 2069 6e20 7b73 656c 662e 706f 7274 732e   in {self.ports.
-00006330: 6b65 7973 2829 7d22 290a 0a20 2020 2020  keys()}")..     
-00006340: 2020 206f 7269 6769 6e20 3d20 7365 6c66     origin = self
-00006350: 2e70 6f72 7473 5b70 6f72 745f 6964 5d2e  .ports[port_id].
-00006360: 6365 6e74 6572 2069 6620 706f 7274 5f69  center if port_i
-00006370: 6420 656c 7365 2028 302c 2030 290a 2020  d else (0, 0).  
-00006380: 2020 2020 2020 6966 2068 5f6d 6972 726f        if h_mirro
-00006390: 723a 0a20 2020 2020 2020 2020 2020 205f  r:.            _
-000063a0: 7265 662e 6d69 7272 6f72 5f78 2870 6f72  ref.mirror_x(por
-000063b0: 745f 6964 290a 0a20 2020 2020 2020 2069  t_id)..        i
-000063c0: 6620 765f 6d69 7272 6f72 3a0a 2020 2020  f v_mirror:.    
-000063d0: 2020 2020 2020 2020 5f72 6566 2e6d 6972          _ref.mir
-000063e0: 726f 725f 7928 706f 7274 5f69 6429 0a0a  ror_y(port_id)..
-000063f0: 2020 2020 2020 2020 6966 2072 6f74 6174          if rotat
-00006400: 696f 6e20 213d 2030 3a0a 2020 2020 2020  ion != 0:.      
-00006410: 2020 2020 2020 5f72 6566 2e72 6f74 6174        _ref.rotat
-00006420: 6528 726f 7461 7469 6f6e 2c20 6f72 6967  e(rotation, orig
-00006430: 696e 290a 2020 2020 2020 2020 5f72 6566  in).        _ref
-00006440: 2e6d 6f76 6528 6f72 6967 696e 2c20 706f  .move(origin, po
-00006450: 7369 7469 6f6e 290a 0a20 2020 2020 2020  sition)..       
-00006460: 2072 6574 7572 6e20 5f72 6566 0a0a 2020   return _ref..  
-00006470: 2020 6465 6620 7265 665f 6365 6e74 6572    def ref_center
-00006480: 2873 656c 662c 2070 6f73 6974 696f 6e3d  (self, position=
-00006490: 2830 2c20 3029 293a 0a20 2020 2020 2020  (0, 0)):.       
-000064a0: 2022 2222 5265 7475 726e 7320 6120 7265   """Returns a re
-000064b0: 6665 7265 6e63 6520 6f66 2074 6865 2063  ference of the c
-000064c0: 6f6d 706f 6e65 6e74 2063 656e 7465 7265  omponent centere
-000064d0: 6420 6174 2028 783d 302c 2079 3d30 292e  d at (x=0, y=0).
-000064e0: 2222 220a 2020 2020 2020 2020 7369 203d  """.        si =
-000064f0: 2073 656c 662e 7369 7a65 5f69 6e66 6f0a   self.size_info.
-00006500: 2020 2020 2020 2020 7963 203d 2073 692e          yc = si.
-00006510: 736f 7574 6820 2b20 7369 2e68 6569 6768  south + si.heigh
-00006520: 7420 2f20 320a 2020 2020 2020 2020 7863  t / 2.        xc
-00006530: 203d 2073 692e 7765 7374 202b 2073 692e   = si.west + si.
-00006540: 7769 6474 6820 2f20 320a 2020 2020 2020  width / 2.      
-00006550: 2020 6365 6e74 6572 203d 2028 7863 2c20    center = (xc, 
-00006560: 7963 290a 2020 2020 2020 2020 5f72 6566  yc).        _ref
-00006570: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
-00006580: 7265 6e63 6528 7365 6c66 290a 2020 2020  rence(self).    
-00006590: 2020 2020 5f72 6566 2e6d 6f76 6528 6365      _ref.move(ce
-000065a0: 6e74 6572 2c20 706f 7369 7469 6f6e 290a  nter, position).
-000065b0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
-000065c0: 7265 660a 0a20 2020 2064 6566 205f 5f72  ref..    def __r
-000065d0: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
-000065e0: 7472 3a0a 2020 2020 2020 2020 2222 2252  tr:.        """R
-000065f0: 6574 7572 6e20 6120 7374 7269 6e67 2072  eturn a string r
-00006600: 6570 7265 7365 6e74 6174 696f 6e20 6f66  epresentation of
-00006610: 2074 6865 206f 626a 6563 742e 2222 220a   the object.""".
-00006620: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00006630: 0a20 2020 2020 2020 2020 2020 2066 227b  .            f"{
-00006640: 7365 6c66 2e6e 616d 657d 3a20 7569 6420  self.name}: uid 
-00006650: 7b73 656c 662e 7569 647d 2c20 220a 2020  {self.uid}, ".  
-00006660: 2020 2020 2020 2020 2020 6622 706f 7274            f"port
-00006670: 7320 7b6c 6973 7428 7365 6c66 2e70 6f72  s {list(self.por
-00006680: 7473 2e6b 6579 7328 2929 7d2c 2022 0a20  ts.keys())}, ". 
-00006690: 2020 2020 2020 2020 2020 2066 2272 6566             f"ref
-000066a0: 6572 656e 6365 7320 7b6c 6973 7428 7365  erences {list(se
-000066b0: 6c66 2e6e 616d 6564 5f72 6566 6572 656e  lf.named_referen
-000066c0: 6365 732e 6b65 7973 2829 297d 2c20 220a  ces.keys())}, ".
-000066d0: 2020 2020 2020 2020 2020 2020 6622 7b6c              f"{l
-000066e0: 656e 2873 656c 662e 706f 6c79 676f 6e73  en(self.polygons
-000066f0: 297d 2070 6f6c 7967 6f6e 7322 0a20 2020  )} polygons".   
-00006700: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00006710: 7070 7269 6e74 2873 656c 6629 202d 3e20  pprint(self) -> 
-00006720: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00006730: 2250 7269 6e74 7320 636f 6d70 6f6e 656e  "Prints componen
-00006740: 7420 696e 666f 2e22 2222 0a20 2020 2020  t info.""".     
-00006750: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00006760: 2020 2020 6672 6f6d 2072 6963 6820 696d      from rich im
-00006770: 706f 7274 2070 7265 7474 790a 0a20 2020  port pretty..   
-00006780: 2020 2020 2020 2020 2070 7265 7474 792e           pretty.
-00006790: 696e 7374 616c 6c28 290a 2020 2020 2020  install().      
-000067a0: 2020 2020 2020 7072 6574 7479 2e70 7072        pretty.ppr
-000067b0: 696e 7428 7365 6c66 2e74 6f5f 6469 6374  int(self.to_dict
-000067c0: 2829 290a 2020 2020 2020 2020 6578 6365  ()).        exce
-000067d0: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
+000000e0: 6962 0a69 6d70 6f72 7420 7575 6964 0a69  ib.import uuid.i
+000000f0: 6d70 6f72 7420 7761 726e 696e 6773 0a66  mport warnings.f
+00000100: 726f 6d20 636f 6c6c 6563 7469 6f6e 7320  rom collections 
+00000110: 696d 706f 7274 2043 6f75 6e74 6572 0a66  import Counter.f
+00000120: 726f 6d20 636f 6c6c 6563 7469 6f6e 732e  rom collections.
+00000130: 6162 6320 696d 706f 7274 2049 7465 7261  abc import Itera
+00000140: 626c 650a 6672 6f6d 2070 6174 686c 6962  ble.from pathlib
+00000150: 2069 6d70 6f72 7420 5061 7468 0a66 726f   import Path.fro
+00000160: 6d20 7479 7069 6e67 2069 6d70 6f72 7420  m typing import 
+00000170: 416e 792c 2044 6963 742c 204c 6973 742c  Any, Dict, List,
+00000180: 204f 7074 696f 6e61 6c2c 2053 6574 2c20   Optional, Set, 
+00000190: 5475 706c 652c 2055 6e69 6f6e 0a0a 696d  Tuple, Union..im
+000001a0: 706f 7274 2067 6473 746b 0a69 6d70 6f72  port gdstk.impor
+000001b0: 7420 6e75 6d70 7920 6173 206e 700a 696d  t numpy as np.im
+000001c0: 706f 7274 2079 616d 6c0a 6672 6f6d 206f  port yaml.from o
+000001d0: 6d65 6761 636f 6e66 2069 6d70 6f72 7420  megaconf import 
+000001e0: 4469 6374 436f 6e66 6967 2c20 4f6d 6567  DictConfig, Omeg
+000001f0: 6143 6f6e 660a 6672 6f6d 2074 7970 696e  aConf.from typin
+00000200: 675f 6578 7465 6e73 696f 6e73 2069 6d70  g_extensions imp
+00000210: 6f72 7420 4c69 7465 7261 6c0a 0a66 726f  ort Literal..fro
+00000220: 6d20 6764 7366 6163 746f 7279 2e63 6f6d  m gdsfactory.com
+00000230: 706f 6e65 6e74 5f6c 6179 6f75 7420 696d  ponent_layout im
+00000240: 706f 7274 2028 0a20 2020 204c 6162 656c  port (.    Label
+00000250: 2c0a 2020 2020 506f 6c79 676f 6e2c 0a20  ,.    Polygon,. 
+00000260: 2020 205f 616c 6967 6e2c 0a20 2020 205f     _align,.    _
+00000270: 6469 7374 7269 6275 7465 2c0a 2020 2020  distribute,.    
+00000280: 5f47 656f 6d65 7472 7948 656c 7065 722c  _GeometryHelper,
+00000290: 0a20 2020 205f 7061 7273 655f 6c61 7965  .    _parse_laye
+000002a0: 722c 0a20 2020 2067 6574 5f70 6f6c 7967  r,.    get_polyg
+000002b0: 6f6e 732c 0a29 0a66 726f 6d20 6764 7366  ons,.).from gdsf
+000002c0: 6163 746f 7279 2e63 6f6d 706f 6e65 6e74  actory.component
+000002d0: 5f72 6566 6572 656e 6365 2069 6d70 6f72  _reference impor
+000002e0: 7420 436f 6d70 6f6e 656e 7452 6566 6572  t ComponentRefer
+000002f0: 656e 6365 2c20 436f 6f72 6469 6e61 7465  ence, Coordinate
+00000300: 2c20 5369 7a65 496e 666f 0a66 726f 6d20  , SizeInfo.from 
+00000310: 6764 7366 6163 746f 7279 2e63 6f6e 6669  gdsfactory.confi
+00000320: 6720 696d 706f 7274 2043 4f4e 462c 206c  g import CONF, l
+00000330: 6f67 6765 722c 2047 4453 4449 525f 5445  ogger, GDSDIR_TE
+00000340: 4d50 0a66 726f 6d20 6764 7366 6163 746f  MP.from gdsfacto
+00000350: 7279 2e63 726f 7373 5f73 6563 7469 6f6e  ry.cross_section
+00000360: 2069 6d70 6f72 7420 4372 6f73 7353 6563   import CrossSec
+00000370: 7469 6f6e 0a66 726f 6d20 6764 7366 6163  tion.from gdsfac
+00000380: 746f 7279 2e70 6f72 7420 696d 706f 7274  tory.port import
+00000390: 2028 0a20 2020 2050 6f72 742c 0a20 2020   (.    Port,.   
+000003a0: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
+000003b0: 7473 2c0a 2020 2020 6175 746f 5f72 656e  ts,.    auto_ren
+000003c0: 616d 655f 706f 7274 735f 636f 756e 7465  ame_ports_counte
+000003d0: 725f 636c 6f63 6b77 6973 652c 0a20 2020  r_clockwise,.   
+000003e0: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
+000003f0: 7473 5f6c 6179 6572 5f6f 7269 656e 7461  ts_layer_orienta
+00000400: 7469 6f6e 2c0a 2020 2020 6175 746f 5f72  tion,.    auto_r
+00000410: 656e 616d 655f 706f 7274 735f 6f72 6965  ename_ports_orie
+00000420: 6e74 6174 696f 6e2c 0a20 2020 206d 6170  ntation,.    map
+00000430: 5f70 6f72 7473 5f6c 6179 6572 5f74 6f5f  _ports_layer_to_
+00000440: 6f72 6965 6e74 6174 696f 6e2c 0a20 2020  orientation,.   
+00000450: 206d 6170 5f70 6f72 7473 5f74 6f5f 6f72   map_ports_to_or
+00000460: 6965 6e74 6174 696f 6e5f 6363 772c 0a20  ientation_ccw,. 
+00000470: 2020 206d 6170 5f70 6f72 7473 5f74 6f5f     map_ports_to_
+00000480: 6f72 6965 6e74 6174 696f 6e5f 6377 2c0a  orientation_cw,.
+00000490: 2020 2020 7365 6c65 6374 5f70 6f72 7473      select_ports
+000004a0: 2c0a 290a 6672 6f6d 2067 6473 6661 6374  ,.).from gdsfact
+000004b0: 6f72 792e 7365 7269 616c 697a 6174 696f  ory.serializatio
+000004c0: 6e20 696d 706f 7274 2063 6c65 616e 5f64  n import clean_d
+000004d0: 6963 740a 6672 6f6d 2067 6473 6661 6374  ict.from gdsfact
+000004e0: 6f72 792e 736e 6170 2069 6d70 6f72 7420  ory.snap import 
+000004f0: 736e 6170 5f74 6f5f 6772 6964 0a66 726f  snap_to_grid.fro
+00000500: 6d20 6764 7366 6163 746f 7279 2e74 6563  m gdsfactory.tec
+00000510: 686e 6f6c 6f67 7920 696d 706f 7274 204c  hnology import L
+00000520: 6179 6572 5669 6577 2c20 4c61 7965 7256  ayerView, LayerV
+00000530: 6965 7773 2c20 4c61 7965 7253 7461 636b  iews, LayerStack
+00000540: 0a66 726f 6d20 6764 7366 6163 746f 7279  .from gdsfactory
+00000550: 2e67 656e 6572 6963 5f74 6563 6820 696d  .generic_tech im
+00000560: 706f 7274 204c 4159 4552 0a0a 506c 6f74  port LAYER..Plot
+00000570: 7465 7220 3d20 4c69 7465 7261 6c5b 2268  ter = Literal["h
+00000580: 6f6c 6f76 6965 7773 222c 2022 6d61 7470  oloviews", "matp
+00000590: 6c6f 746c 6962 222c 2022 7174 222c 2022  lotlib", "qt", "
+000005a0: 6b6c 6179 6f75 7422 5d0a 4178 6973 203d  klayout"].Axis =
+000005b0: 204c 6974 6572 616c 5b22 7822 2c20 2279   Literal["x", "y
+000005c0: 225d 0a0a 0a63 6c61 7373 2055 6e63 6163  "]...class Uncac
+000005d0: 6865 6443 6f6d 706f 6e65 6e74 5761 726e  hedComponentWarn
+000005e0: 696e 6728 5573 6572 5761 726e 696e 6729  ing(UserWarning)
+000005f0: 3a0a 2020 2020 7061 7373 0a0a 0a63 6c61  :.    pass...cla
+00000600: 7373 2055 6e63 6163 6865 6443 6f6d 706f  ss UncachedCompo
+00000610: 6e65 6e74 4572 726f 7228 5661 6c75 6545  nentError(ValueE
+00000620: 7272 6f72 293a 0a20 2020 2070 6173 730a  rror):.    pass.
+00000630: 0a0a 636c 6173 7320 4d75 7461 6269 6c69  ..class Mutabili
+00000640: 7479 4572 726f 7228 5661 6c75 6545 7272  tyError(ValueErr
+00000650: 6f72 293a 0a20 2020 2070 6173 730a 0a0a  or):.    pass...
+00000660: 6465 6620 5f67 6574 5f64 6570 656e 6465  def _get_depende
+00000670: 6e63 6965 7328 636f 6d70 6f6e 656e 742c  ncies(component,
+00000680: 2072 6566 6572 656e 6365 735f 7365 7429   references_set)
+00000690: 3a0a 2020 2020 666f 7220 7265 6620 696e  :.    for ref in
+000006a0: 2063 6f6d 706f 6e65 6e74 2e72 6566 6572   component.refer
+000006b0: 656e 6365 733a 0a20 2020 2020 2020 2072  ences:.        r
+000006c0: 6566 6572 656e 6365 735f 7365 742e 6164  eferences_set.ad
+000006d0: 6428 7265 662e 7265 665f 6365 6c6c 290a  d(ref.ref_cell).
+000006e0: 2020 2020 2020 2020 5f67 6574 5f64 6570          _get_dep
+000006f0: 656e 6465 6e63 6965 7328 7265 662e 7265  endencies(ref.re
+00000700: 665f 6365 6c6c 2c20 7265 6665 7265 6e63  f_cell, referenc
+00000710: 6573 5f73 6574 290a 0a0a 6d75 7461 6269  es_set)...mutabi
+00000720: 6c69 7479 5f65 7272 6f72 5f6d 6573 7361  lity_error_messa
+00000730: 6765 203d 2022 2222 0a59 6f75 2063 616e  ge = """.You can
+00000740: 6e6f 7420 6d6f 6469 6679 2061 2043 6f6d  not modify a Com
+00000750: 706f 6e65 6e74 2061 6674 6572 2063 7265  ponent after cre
+00000760: 6174 696f 6e20 6173 2069 7420 7769 6c6c  ation as it will
+00000770: 2061 6666 6563 7420 616c 6c20 6f66 2069   affect all of i
+00000780: 7473 2069 6e73 7461 6e63 6573 2e0a 0a43  ts instances...C
+00000790: 7265 6174 6520 6120 6e65 7720 436f 6d70  reate a new Comp
+000007a0: 6f6e 656e 7420 616e 6420 6164 6420 6120  onent and add a 
+000007b0: 7265 6665 7265 6e63 6520 746f 2069 742e  reference to it.
+000007c0: 0a0a 466f 7220 6578 616d 706c 653a 0a0a  ..For example:..
+000007d0: 2320 4241 440a 6320 3d20 6766 2e63 6f6d  # BAD.c = gf.com
+000007e0: 706f 6e65 6e74 732e 6265 6e64 5f65 756c  ponents.bend_eul
+000007f0: 6572 2829 0a63 2e61 6464 5f72 6566 2867  er().c.add_ref(g
+00000800: 662e 636f 6d70 6f6e 656e 7473 2e6d 7a69  f.components.mzi
+00000810: 2829 290a 0a23 2047 4f4f 440a 6320 3d20  ())..# GOOD.c = 
+00000820: 6766 2e43 6f6d 706f 6e65 6e74 2829 0a63  gf.Component().c
+00000830: 2e61 6464 5f72 6566 2867 662e 636f 6d70  .add_ref(gf.comp
+00000840: 6f6e 656e 7473 2e62 656e 645f 6575 6c65  onents.bend_eule
+00000850: 7228 2929 0a63 2e61 6464 5f72 6566 2867  r()).c.add_ref(g
+00000860: 662e 636f 6d70 6f6e 656e 7473 2e6d 7a69  f.components.mzi
+00000870: 2829 290a 2222 220a 0a6d 6f76 655f 6572  ())."""..move_er
+00000880: 726f 725f 6d65 7373 6167 6520 3d20 2222  ror_message = ""
+00000890: 220a 596f 7520 6361 6e6e 6f74 206d 6f76  ".You cannot mov
+000008a0: 6520 6120 436f 6d70 6f6e 656e 742e 2059  e a Component. Y
+000008b0: 6f75 2063 616e 2063 7265 6174 6520 6120  ou can create a 
+000008c0: 6e65 7720 436f 6d70 6f6e 656e 742c 2061  new Component, a
+000008d0: 6464 2061 2072 6566 6572 656e 6365 2074  dd a reference t
+000008e0: 6f20 7468 6520 6f74 6865 7220 436f 6d70  o the other Comp
+000008f0: 6f6e 656e 7420 616e 6420 7468 656e 206d  onent and then m
+00000900: 6f76 6520 7468 6520 7265 6665 7265 6e63  ove the referenc
+00000910: 652e 0a0a 466f 7220 6578 616d 706c 653a  e...For example:
+00000920: 0a0a 2320 4241 440a 6320 3d20 6766 2e63  ..# BAD.c = gf.c
+00000930: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
+00000940: 6874 2829 0a63 2e78 6d69 6e20 3d20 3130  ht().c.xmin = 10
+00000950: 0a0a 2320 474f 4f44 0a63 203d 2067 662e  ..# GOOD.c = gf.
+00000960: 436f 6d70 6f6e 656e 7428 290a 7265 6620  Component().ref 
+00000970: 3d20 632e 6164 645f 7265 6628 6766 2e63  = c.add_ref(gf.c
+00000980: 6f6d 706f 6e65 6e74 732e 7374 7261 6967  omponents.straig
+00000990: 6874 2829 2920 2320 6f72 2072 6566 203d  ht()) # or ref =
+000009a0: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
+000009b0: 6e74 732e 7374 7261 6967 6874 2829 0a72  nts.straight().r
+000009c0: 6566 2e78 6d69 6e20 3d20 3130 0a22 2222  ef.xmin = 10."""
+000009d0: 0a0a 5061 7468 5479 7065 203d 2055 6e69  ..PathType = Uni
+000009e0: 6f6e 5b73 7472 2c20 5061 7468 5d0a 466c  on[str, Path].Fl
+000009f0: 6f61 7432 203d 2054 7570 6c65 5b66 6c6f  oat2 = Tuple[flo
+00000a00: 6174 2c20 666c 6f61 745d 0a4c 6179 6572  at, float].Layer
+00000a10: 203d 2054 7570 6c65 5b69 6e74 2c20 696e   = Tuple[int, in
+00000a20: 745d 0a4c 6179 6572 7320 3d20 5475 706c  t].Layers = Tupl
+00000a30: 655b 4c61 7965 722c 202e 2e2e 5d0a 4c61  e[Layer, ...].La
+00000a40: 7965 7253 7065 6320 3d20 556e 696f 6e5b  yerSpec = Union[
+00000a50: 7374 722c 2069 6e74 2c20 4c61 7965 722c  str, int, Layer,
+00000a60: 204e 6f6e 655d 0a0a 5f74 696d 6573 7461   None].._timesta
+00000a70: 6d70 3230 3139 203d 2064 6174 6574 696d  mp2019 = datetim
+00000a80: 652e 6461 7465 7469 6d65 2e66 726f 6d74  e.datetime.fromt
+00000a90: 696d 6573 7461 6d70 2831 3537 3230 3134  imestamp(1572014
+00000aa0: 3139 322e 3832 3733 290a 4d41 585f 4e41  192.8273).MAX_NA
+00000ab0: 4d45 5f4c 454e 4754 4820 3d20 3332 0a0a  ME_LENGTH = 32..
+00000ac0: 0a64 6566 205f 726e 6428 6172 722c 2070  .def _rnd(arr, p
+00000ad0: 7265 6369 7369 6f6e 3d31 652d 3429 3a0a  recision=1e-4):.
+00000ae0: 2020 2020 6172 7220 3d20 6e70 2e61 7363      arr = np.asc
+00000af0: 6f6e 7469 6775 6f75 7361 7272 6179 2861  ontiguousarray(a
+00000b00: 7272 290a 2020 2020 6e64 6967 6974 7320  rr).    ndigits 
+00000b10: 3d20 726f 756e 6428 2d6d 6174 682e 6c6f  = round(-math.lo
+00000b20: 6731 3028 7072 6563 6973 696f 6e29 290a  g10(precision)).
+00000b30: 2020 2020 7265 7475 726e 206e 702e 6173      return np.as
+00000b40: 636f 6e74 6967 756f 7573 6172 7261 7928  contiguousarray(
+00000b50: 6172 722e 726f 756e 6428 6e64 6967 6974  arr.round(ndigit
+00000b60: 7329 202f 2070 7265 6369 7369 6f6e 2c20  s) / precision, 
+00000b70: 6474 7970 653d 6e70 2e69 6e74 3634 290a  dtype=np.int64).
+00000b80: 0a0a 636c 6173 7320 436f 6d70 6f6e 656e  ..class Componen
+00000b90: 7428 5f47 656f 6d65 7472 7948 656c 7065  t(_GeometryHelpe
+00000ba0: 7229 3a0a 2020 2020 2222 2241 2043 6f6d  r):.    """A Com
+00000bb0: 706f 6e65 6e74 2069 7320 616e 2065 6d70  ponent is an emp
+00000bc0: 7479 2063 616e 7661 7320 7768 6572 6520  ty canvas where 
+00000bd0: 796f 7520 6164 6420 706f 6c79 676f 6e73  you add polygons
+00000be0: 2c20 7265 6665 7265 6e63 6573 2061 6e64  , references and
+00000bf0: 2070 6f72 7473 205c 0a20 2020 2020 2020   ports \.       
+00000c00: 2020 2020 2028 746f 2063 6f6e 6e65 6374       (to connect
+00000c10: 2074 6f20 6f74 6865 7220 636f 6d70 6f6e   to other compon
+00000c20: 656e 7473 292e 0a0a 2020 2020 2d20 7374  ents)...    - st
+00000c30: 6f72 6573 2073 6574 7469 6e67 7320 7468  ores settings th
+00000c40: 6174 2079 6f75 2075 7365 2074 6f20 6275  at you use to bu
+00000c50: 696c 6420 7468 6520 636f 6d70 6f6e 656e  ild the componen
+00000c60: 740a 2020 2020 2d20 7374 6f72 6573 2069  t.    - stores i
+00000c70: 6e66 6f20 7468 6174 2079 6f75 2077 616e  nfo that you wan
+00000c80: 7420 746f 2075 7365 0a20 2020 202d 2063  t to use.    - c
+00000c90: 616e 2072 6574 7572 6e20 706f 7274 7320  an return ports 
+00000ca0: 6279 2074 7970 6520 286f 7074 6963 616c  by type (optical
+00000cb0: 2c20 656c 6563 7472 6963 616c 202e 2e2e  , electrical ...
+00000cc0: 290a 2020 2020 2d20 6361 6e20 7265 7475  ).    - can retu
+00000cd0: 726e 206e 6574 6c69 7374 2066 6f72 2063  rn netlist for c
+00000ce0: 6972 6375 6974 2073 696d 756c 6174 696f  ircuit simulatio
+00000cf0: 6e0a 2020 2020 2d20 6361 6e20 7772 6974  n.    - can writ
+00000d00: 6520 746f 2047 4453 2c20 4f41 5349 530a  e to GDS, OASIS.
+00000d10: 2020 2020 2d20 6361 6e20 7368 6f77 2069      - can show i
+00000d20: 6e20 4b4c 6179 6f75 742c 206d 6174 706c  n KLayout, matpl
+00000d30: 6f74 6c69 622c 2033 442c 2051 5420 7669  otlib, 3D, QT vi
+00000d40: 6577 6572 2c20 686f 6c6f 7669 6577 730a  ewer, holoviews.
+00000d50: 2020 2020 2d20 6361 6e20 7265 7475 726e      - can return
+00000d60: 2063 6f70 792c 206d 6972 726f 722c 2066   copy, mirror, f
+00000d70: 6c61 7474 656e 6564 2028 6e6f 2072 6566  lattened (no ref
+00000d80: 6572 656e 6365 7329 0a0a 2020 2020 4172  erences)..    Ar
+00000d90: 6773 3a0a 2020 2020 2020 2020 6e61 6d65  gs:.        name
+00000da0: 3a20 636f 6d70 6f6e 656e 745f 6e61 6d65  : component_name
+00000db0: 2e20 5573 6520 4063 656c 6c20 6465 636f  . Use @cell deco
+00000dc0: 7261 746f 7220 666f 7220 6175 746f 2d6e  rator for auto-n
+00000dd0: 616d 696e 672e 0a20 2020 2020 2020 2077  aming..        w
+00000de0: 6974 685f 7575 6964 3a20 6164 6473 2075  ith_uuid: adds u
+00000df0: 6e69 7175 6520 6964 656e 7469 6669 6572  nique identifier
+00000e00: 2e0a 0a20 2020 2050 726f 7065 7274 6965  ...    Propertie
+00000e10: 733a 0a20 2020 2020 2020 2069 6e66 6f3a  s:.        info:
+00000e20: 2064 6963 7469 6f6e 6172 7920 7468 6174   dictionary that
+00000e30: 2069 6e63 6c75 6465 730a 2020 2020 2020   includes.      
+00000e40: 2020 2020 2020 2d20 6465 7269 7665 6420        - derived 
+00000e50: 7072 6f70 6572 7469 6573 0a20 2020 2020  properties.     
+00000e60: 2020 2020 2020 202d 2065 7874 6572 6e61         - externa
+00000e70: 6c20 6d65 7461 6461 7461 2028 7465 7374  l metadata (test
+00000e80: 5f70 726f 746f 636f 6c2c 2064 6f63 732c  _protocol, docs,
+00000e90: 202e 2e2e 290a 2020 2020 2020 2020 2020   ...).          
+00000ea0: 2020 2d20 7369 6d75 6c61 7469 6f6e 5f73    - simulation_s
+00000eb0: 6574 7469 6e67 730a 2020 2020 2020 2020  ettings.        
+00000ec0: 2020 2020 2d20 6675 6e63 7469 6f6e 5f6e      - function_n
+00000ed0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
+00000ee0: 2d20 6e61 6d65 3a20 666f 7220 7468 6520  - name: for the 
+00000ef0: 636f 6d70 6f6e 656e 740a 0a20 2020 2020  component..     
+00000f00: 2020 2073 6574 7469 6e67 733a 0a20 2020     settings:.   
+00000f10: 2020 2020 2020 2020 2066 756c 6c3a 2066           full: f
+00000f20: 756c 6c20 7365 7474 696e 6773 2070 6173  ull settings pas
+00000f30: 7365 6420 746f 2074 6865 2066 756e 6374  sed to the funct
+00000f40: 696f 6e20 746f 2063 7265 6174 6520 636f  ion to create co
+00000f50: 6d70 6f6e 656e 742e 0a20 2020 2020 2020  mponent..       
+00000f60: 2020 2020 2063 6861 6e67 6564 3a20 6368       changed: ch
+00000f70: 616e 6765 6420 7365 7474 696e 6773 2e0a  anged settings..
+00000f80: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00000f90: 756c 743a 2064 6566 6175 6c74 2063 6f6d  ult: default com
+00000fa0: 706f 6e65 6e74 2073 6574 7469 6e67 732e  ponent settings.
+00000fb0: 0a20 2020 2020 2020 2020 2020 2063 6869  .            chi
+00000fc0: 6c64 3a20 6469 6374 2069 6e66 6f20 6672  ld: dict info fr
+00000fd0: 6f6d 2074 6865 2063 6869 6c64 7265 6e2c  om the children,
+00000fe0: 2069 6620 616e 792e 0a20 2020 2022 2222   if any..    """
+00000ff0: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+00001000: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
+00001010: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
+00001020: 7374 7220 3d20 2255 6e6e 616d 6564 222c  str = "Unnamed",
+00001030: 0a20 2020 2020 2020 2077 6974 685f 7575  .        with_uu
+00001040: 6964 3a20 626f 6f6c 203d 2046 616c 7365  id: bool = False
+00001050: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
+00001060: 0a20 2020 2020 2020 2022 2222 496e 6974  .        """Init
+00001070: 6961 6c69 7a65 2074 6865 2043 6f6d 706f  ialize the Compo
+00001080: 6e65 6e74 206f 626a 6563 742e 2222 220a  nent object.""".
+00001090: 2020 2020 2020 2020 7365 6c66 2e75 6964          self.uid
+000010a0: 203d 2073 7472 2875 7569 642e 7575 6964   = str(uuid.uuid
+000010b0: 3428 2929 5b3a 385d 0a20 2020 2020 2020  4())[:8].       
+000010c0: 2069 6620 7769 7468 5f75 7569 6420 6f72   if with_uuid or
+000010d0: 206e 616d 6520 3d3d 2022 556e 6e61 6d65   name == "Unname
+000010e0: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
+000010f0: 6e61 6d65 202b 3d20 6622 5f7b 7365 6c66  name += f"_{self
+00001100: 2e75 6964 7d22 0a0a 2020 2020 2020 2020  .uid}"..        
+00001110: 7365 6c66 2e5f 6365 6c6c 203d 2067 6473  self._cell = gds
+00001120: 746b 2e43 656c 6c28 6e61 6d65 3d6e 616d  tk.Cell(name=nam
+00001130: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+00001140: 6e61 6d65 203d 206e 616d 650a 2020 2020  name = name.    
+00001150: 2020 2020 7365 6c66 2e69 6e66 6f3a 2044      self.info: D
+00001160: 6963 745b 7374 722c 2041 6e79 5d20 3d20  ict[str, Any] = 
+00001170: 7b7d 0a0a 2020 2020 2020 2020 7365 6c66  {}..        self
+00001180: 2e73 6574 7469 6e67 733a 2044 6963 745b  .settings: Dict[
+00001190: 7374 722c 2041 6e79 5d20 3d20 7b7d 0a20  str, Any] = {}. 
+000011a0: 2020 2020 2020 2073 656c 662e 5f6c 6f63         self._loc
+000011b0: 6b65 6420 3d20 4661 6c73 650a 2020 2020  ked = False.    
+000011c0: 2020 2020 7365 6c66 2e67 6574 5f63 6869      self.get_chi
+000011d0: 6c64 5f6e 616d 6520 3d20 4661 6c73 650a  ld_name = False.
+000011e0: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
+000011f0: 6665 7265 6e63 655f 6e61 6d65 735f 636f  ference_names_co
+00001200: 756e 7465 7220 3d20 436f 756e 7465 7228  unter = Counter(
+00001210: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00001220: 7265 6665 7265 6e63 655f 6e61 6d65 735f  reference_names_
+00001230: 7573 6564 203d 2073 6574 2829 0a20 2020  used = set().   
+00001240: 2020 2020 2073 656c 662e 5f6e 616d 6564       self._named
+00001250: 5f72 6566 6572 656e 6365 7320 3d20 7b7d  _references = {}
+00001260: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
+00001270: 6566 6572 656e 6365 7320 3d20 5b5d 0a0a  eferences = []..
+00001280: 2020 2020 2020 2020 7365 6c66 2e70 6f72          self.por
+00001290: 7473 203d 207b 7d0a 0a20 2020 2040 7072  ts = {}..    @pr
+000012a0: 6f70 6572 7479 0a20 2020 2064 6566 2072  operty.    def r
+000012b0: 6566 6572 656e 6365 7328 7365 6c66 293a  eferences(self):
+000012c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000012d0: 7365 6c66 2e5f 7265 6665 7265 6e63 6573  self._references
+000012e0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+000012f0: 2020 2020 6465 6620 706f 6c79 676f 6e73      def polygons
+00001300: 2873 656c 6629 202d 3e20 4c69 7374 5b50  (self) -> List[P
+00001310: 6f6c 7967 6f6e 5d3a 0a20 2020 2020 2020  olygon]:.       
+00001320: 2072 6574 7572 6e20 7365 6c66 2e5f 6365   return self._ce
+00001330: 6c6c 2e70 6f6c 7967 6f6e 730a 0a20 2020  ll.polygons..   
+00001340: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00001350: 6566 2061 7265 6128 7365 6c66 2920 2d3e  ef area(self) ->
+00001360: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+00001370: 7265 7475 726e 2073 656c 662e 5f63 656c  return self._cel
+00001380: 6c2e 6172 6561 0a0a 2020 2020 4070 726f  l.area..    @pro
+00001390: 7065 7274 790a 2020 2020 6465 6620 6c61  perty.    def la
+000013a0: 6265 6c73 2873 656c 6629 202d 3e20 4c69  bels(self) -> Li
+000013b0: 7374 5b4c 6162 656c 5d3a 0a20 2020 2020  st[Label]:.     
+000013c0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000013d0: 6365 6c6c 2e6c 6162 656c 730a 0a20 2020  cell.labels..   
+000013e0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+000013f0: 6566 2070 6174 6873 2873 656c 6629 3a0a  ef paths(self):.
+00001400: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00001410: 656c 662e 5f63 656c 6c2e 7061 7468 730a  elf._cell.paths.
+00001420: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00001430: 2020 2064 6566 206e 616d 6528 7365 6c66     def name(self
+00001440: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+00001450: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+00001460: 656c 6c2e 6e61 6d65 0a0a 2020 2020 406e  ell.name..    @n
+00001470: 616d 652e 7365 7474 6572 0a20 2020 2064  ame.setter.    d
+00001480: 6566 206e 616d 6528 7365 6c66 2c20 7661  ef name(self, va
+00001490: 6c75 6529 3a0a 2020 2020 2020 2020 7365  lue):.        se
+000014a0: 6c66 2e5f 6365 6c6c 2e6e 616d 6520 3d20  lf._cell.name = 
+000014b0: 7661 6c75 650a 0a20 2020 2064 6566 205f  value..    def _
+000014c0: 5f69 7465 725f 5f28 7365 6c66 293a 0a20  _iter__(self):. 
+000014d0: 2020 2020 2020 2022 2222 596f 7520 6361         """You ca
+000014e0: 6e20 6974 6572 6174 6520 6f76 6572 2070  n iterate over p
+000014f0: 6f6c 7967 6f6e 732c 2070 6174 6873 2c20  olygons, paths, 
+00001500: 6c61 6265 6c73 2061 6e64 2072 6566 6572  labels and refer
+00001510: 656e 6365 732e 2222 220a 2020 2020 2020  ences.""".      
+00001520: 2020 7265 7475 726e 2069 7465 7274 6f6f    return itertoo
+00001530: 6c73 2e63 6861 696e 2873 656c 662e 706f  ls.chain(self.po
+00001540: 6c79 676f 6e73 2c20 7365 6c66 2e70 6174  lygons, self.pat
+00001550: 6873 2c20 7365 6c66 2e6c 6162 656c 732c  hs, self.labels,
+00001560: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
+00001570: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
+00001580: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
+00001590: 2073 656c 662c 0a20 2020 2020 2020 2062   self,.        b
+000015a0: 795f 7370 6563 3a20 556e 696f 6e5b 626f  y_spec: Union[bo
+000015b0: 6f6c 2c20 5475 706c 655b 696e 742c 2069  ol, Tuple[int, i
+000015c0: 6e74 5d5d 203d 2046 616c 7365 2c0a 2020  nt]] = False,.  
+000015d0: 2020 2020 2020 6465 7074 683a 204f 7074        depth: Opt
+000015e0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
+000015f0: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
+00001600: 6465 5f70 6174 6873 3a20 626f 6f6c 203d  de_paths: bool =
+00001610: 2054 7275 652c 0a20 2020 2020 2020 2061   True,.        a
+00001620: 735f 6172 7261 793a 2062 6f6f 6c20 3d20  s_array: bool = 
+00001630: 5472 7565 2c0a 2020 2020 2920 2d3e 2055  True,.    ) -> U
+00001640: 6e69 6f6e 5b4c 6973 745b 506f 6c79 676f  nion[List[Polygo
+00001650: 6e5d 2c20 4469 6374 5b54 7570 6c65 5b69  n], Dict[Tuple[i
+00001660: 6e74 2c20 696e 745d 2c20 4c69 7374 5b50  nt, int], List[P
+00001670: 6f6c 7967 6f6e 5d5d 5d3a 0a20 2020 2020  olygon]]]:.     
+00001680: 2020 2022 2222 5265 7475 726e 2061 206c     """Return a l
+00001690: 6973 7420 6f66 2070 6f6c 7967 6f6e 7320  ist of polygons 
+000016a0: 696e 2074 6869 7320 6365 6c6c 2e0a 0a20  in this cell... 
+000016b0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000016c0: 2020 2020 2020 2020 2062 795f 7370 6563           by_spec
+000016d0: 3a20 626f 6f6c 206f 7220 6c61 7965 720a  : bool or layer.
+000016e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016f0: 4966 2054 7275 652c 2074 6865 2072 6574  If True, the ret
+00001700: 7572 6e20 7661 6c75 6520 6973 2061 2064  urn value is a d
+00001710: 6963 7469 6f6e 6172 7920 7769 7468 2074  ictionary with t
+00001720: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00001730: 2020 2070 6f6c 7967 6f6e 7320 6f66 2065     polygons of e
+00001740: 6163 6820 696e 6469 7669 6475 616c 2070  ach individual p
+00001750: 6169 7220 286c 6179 6572 2c20 6461 7461  air (layer, data
+00001760: 7479 7065 292c 2077 6869 6368 0a20 2020  type), which.   
+00001770: 2020 2020 2020 2020 2020 2020 2061 7265               are
+00001780: 2075 7365 6420 6173 206b 6579 732e 2020   used as keys.  
+00001790: 4966 2073 6574 2074 6f20 6120 7475 706c  If set to a tupl
+000017a0: 6520 6f66 2028 6c61 7965 722c 2064 6174  e of (layer, dat
+000017b0: 6174 7970 6529 2c0a 2020 2020 2020 2020  atype),.        
+000017c0: 2020 2020 2020 2020 6f6e 6c79 2070 6f6c          only pol
+000017d0: 7967 6f6e 7320 7769 7468 2074 6861 7420  ygons with that 
+000017e0: 7370 6563 6966 6963 6174 696f 6e20 6172  specification ar
+000017f0: 6520 7265 7475 726e 6564 2e0a 2020 2020  e returned..    
+00001800: 2020 2020 2020 2020 6465 7074 683a 2069          depth: i
+00001810: 6e74 6567 6572 206f 7220 4e6f 6e65 0a20  nteger or None. 
+00001820: 2020 2020 2020 2020 2020 2020 2020 2049                 I
+00001830: 6620 6e6f 7420 4e6f 6e65 2c20 6465 6669  f not None, defi
+00001840: 6e65 7320 6672 6f6d 2068 6f77 206d 616e  nes from how man
+00001850: 7920 7265 6665 7265 6e63 6520 6c65 7665  y reference leve
+00001860: 6c73 2074 6f0a 2020 2020 2020 2020 2020  ls to.          
+00001870: 2020 2020 2020 7265 7472 6965 7665 2070        retrieve p
+00001880: 6f6c 7967 6f6e 732e 2020 5265 6665 7265  olygons.  Refere
+00001890: 6e63 6573 2062 656c 6f77 2074 6869 7320  nces below this 
+000018a0: 6c65 7665 6c20 7769 6c6c 2072 6573 756c  level will resul
+000018b0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000018c0: 2020 696e 2061 2062 6f75 6e64 696e 6720    in a bounding 
+000018d0: 626f 782e 2020 4966 2060 6279 5f73 7065  box.  If `by_spe
+000018e0: 6360 2069 7320 5472 7565 2074 6865 206b  c` is True the k
+000018f0: 6579 2077 696c 6c20 6265 2074 6865 0a20  ey will be the. 
+00001900: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00001910: 616d 6520 6f66 2074 6869 7320 6365 6c6c  ame of this cell
+00001920: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00001930: 636c 7564 655f 7061 7468 733a 2049 6620  clude_paths: If 
+00001940: 5472 7565 2c20 706f 6c79 676f 6e61 6c20  True, polygonal 
+00001950: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
+00001960: 6620 7061 7468 7320 6172 6520 616c 736f  f paths are also
+00001970: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
+00001980: 2072 6573 756c 742e 0a20 2020 2020 2020   result..       
+00001990: 2020 2020 2061 735f 6172 7261 793a 2077       as_array: w
+000019a0: 6865 6e20 6173 5f61 7272 6179 3d66 616c  hen as_array=fal
+000019b0: 7365 2c20 7265 7475 726e 2074 6865 2050  se, return the P
+000019c0: 6f6c 7967 6f6e 206f 626a 6563 7473 2069  olygon objects i
+000019d0: 6e73 7465 6164 2e0a 2020 2020 2020 2020  nstead..        
+000019e0: 2020 2020 2020 2020 706f 6c79 676f 6e20          polygon 
+000019f0: 6f62 6a65 6374 7320 6861 7665 206d 6f72  objects have mor
+00001a00: 6520 696e 666f 726d 6174 696f 6e20 2865  e information (e
+00001a10: 7370 6563 6961 6c6c 7920 7768 656e 2062  specially when b
+00001a20: 795f 7370 6563 3d46 616c 7365 2920 616e  y_spec=False) an
+00001a30: 6420 6172 6520 6661 7374 6572 2074 6f20  d are faster to 
+00001a40: 7265 7472 6965 7665 2e0a 0a20 2020 2020  retrieve...     
+00001a50: 2020 2052 6574 7572 6e73 0a20 2020 2020     Returns.     
+00001a60: 2020 2020 2020 206f 7574 3a20 6c69 7374         out: list
+00001a70: 206f 6620 6172 7261 792d 6c69 6b65 5b4e   of array-like[N
+00001a80: 5d5b 325d 206f 7220 6469 6374 696f 6e61  ][2] or dictiona
+00001a90: 7279 0a20 2020 2020 2020 2020 2020 2020  ry.             
+00001aa0: 2020 204c 6973 7420 636f 6e74 6169 6e69     List containi
+00001ab0: 6e67 2074 6865 2063 6f6f 7264 696e 6174  ng the coordinat
+00001ac0: 6573 206f 6620 7468 6520 7665 7274 6963  es of the vertic
+00001ad0: 6573 206f 6620 6561 6368 0a20 2020 2020  es of each.     
+00001ae0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00001af0: 6f6e 2c20 6f72 2064 6963 7469 6f6e 6172  on, or dictionar
+00001b00: 7920 7769 7468 2077 6974 6820 7468 6520  y with with the 
+00001b10: 6c69 7374 206f 6620 706f 6c79 676f 6e73  list of polygons
+00001b20: 2028 6966 0a20 2020 2020 2020 2020 2020   (if.           
+00001b30: 2020 2020 2060 6279 5f73 7065 6360 2069       `by_spec` i
+00001b40: 7320 5472 7565 292e 0a0a 2020 2020 2020  s True)...      
+00001b50: 2020 4e6f 7465 3a0a 2020 2020 2020 2020    Note:.        
+00001b60: 2020 2020 496e 7374 616e 6365 7320 6f66      Instances of
+00001b70: 2060 466c 6578 5061 7468 6020 616e 6420   `FlexPath` and 
+00001b80: 6052 6f62 7573 7450 6174 6860 2061 7265  `RobustPath` are
+00001b90: 2061 6c73 6f20 696e 636c 7564 6564 2069   also included i
+00001ba0: 6e0a 2020 2020 2020 2020 2020 2020 7468  n.            th
+00001bb0: 6520 7265 7375 6c74 2062 7920 636f 6d70  e result by comp
+00001bc0: 7574 696e 6720 7468 6569 7220 706f 6c79  uting their poly
+00001bd0: 676f 6e61 6c20 626f 756e 6461 7279 2e0a  gonal boundary..
+00001be0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001bf0: 2020 2020 7265 7475 726e 2067 6574 5f70      return get_p
+00001c00: 6f6c 7967 6f6e 7328 0a20 2020 2020 2020  olygons(.       
+00001c10: 2020 2020 2069 6e73 7461 6e63 653d 7365       instance=se
+00001c20: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00001c30: 6279 5f73 7065 633d 6279 5f73 7065 632c  by_spec=by_spec,
+00001c40: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
+00001c50: 7468 3d64 6570 7468 2c0a 2020 2020 2020  th=depth,.      
+00001c60: 2020 2020 2020 696e 636c 7564 655f 7061        include_pa
+00001c70: 7468 733d 696e 636c 7564 655f 7061 7468  ths=include_path
+00001c80: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
+00001c90: 735f 6172 7261 793d 6173 5f61 7272 6179  s_array=as_array
+00001ca0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+00001cb0: 2064 6566 2067 6574 5f64 6570 656e 6465   def get_depende
+00001cc0: 6e63 6965 7328 7365 6c66 2c20 7265 6375  ncies(self, recu
+00001cd0: 7273 6976 653a 2062 6f6f 6c20 3d20 4661  rsive: bool = Fa
+00001ce0: 6c73 6529 202d 3e20 4c69 7374 5b43 6f6d  lse) -> List[Com
+00001cf0: 706f 6e65 6e74 5d3a 0a20 2020 2020 2020  ponent]:.       
+00001d00: 2022 2222 5265 7475 726e 2061 2073 6574   """Return a set
+00001d10: 206f 6620 7468 6520 6365 6c6c 7320 696e   of the cells in
+00001d20: 636c 7564 6564 2069 6e20 7468 6973 2063  cluded in this c
+00001d30: 656c 6c20 6173 2072 6566 6572 656e 6365  ell as reference
+00001d40: 732e 0a0a 2020 2020 2020 2020 4172 6773  s...        Args
+00001d50: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00001d60: 6375 7273 6976 653a 2049 6620 5472 7565  cursive: If True
+00001d70: 2072 6574 7572 6e73 2064 6570 656e 6465   returns depende
+00001d80: 6e63 6965 7320 7265 6375 7273 6976 656c  ncies recursivel
+00001d90: 792e 0a0a 2020 2020 2020 2020 5265 7475  y...        Retu
+00001da0: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00001db0: 206f 7574 3a20 6c69 7374 206f 6620 436f   out: list of Co
+00001dc0: 6d70 6f6e 656e 7473 2072 6566 6572 656e  mponents referen
+00001dd0: 6365 6420 6279 2074 6869 7320 436f 6d70  ced by this Comp
+00001de0: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
+00001df0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00001e00: 7420 7265 6375 7273 6976 653a 0a20 2020  t recursive:.   
+00001e10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00001e20: 6c69 7374 287b 7265 662e 7061 7265 6e74  list({ref.parent
+00001e30: 2066 6f72 2072 6566 2069 6e20 7365 6c66   for ref in self
+00001e40: 2e72 6566 6572 656e 6365 737d 290a 0a20  .references}).. 
+00001e50: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+00001e60: 735f 7365 7420 3d20 7365 7428 290a 2020  s_set = set().  
+00001e70: 2020 2020 2020 5f67 6574 5f64 6570 656e        _get_depen
+00001e80: 6465 6e63 6965 7328 7365 6c66 2c20 7265  dencies(self, re
+00001e90: 6665 7265 6e63 6573 5f73 6574 3d72 6566  ferences_set=ref
+00001ea0: 6572 656e 6365 735f 7365 7429 0a20 2020  erences_set).   
+00001eb0: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
+00001ec0: 2872 6566 6572 656e 6365 735f 7365 7429  (references_set)
+00001ed0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
+00001ee0: 6d70 6f6e 656e 745f 7370 6563 2873 656c  mponent_spec(sel
+00001ef0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00001f00: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
+00001f10: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+00001f20: 2020 2022 636f 6d70 6f6e 656e 7422 3a20     "component": 
+00001f30: 7365 6c66 2e73 6574 7469 6e67 732e 6675  self.settings.fu
+00001f40: 6e63 7469 6f6e 5f6e 616d 652c 0a20 2020  nction_name,.   
+00001f50: 2020 2020 2020 2020 2020 2020 2022 7365               "se
+00001f60: 7474 696e 6773 223a 2073 656c 662e 7365  ttings": self.se
+00001f70: 7474 696e 6773 2e63 6861 6e67 6564 2c0a  ttings.changed,.
+00001f80: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
+00001f90: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00001fa0: 662e 7365 7474 696e 6773 0a20 2020 2020  f.settings.     
+00001fb0: 2020 2020 2020 2065 6c73 6520 7b22 636f         else {"co
+00001fc0: 6d70 6f6e 656e 7422 3a20 7365 6c66 2e6e  mponent": self.n
+00001fd0: 616d 652c 2022 7365 7474 696e 6773 223a  ame, "settings":
+00001fe0: 207b 7d7d 0a20 2020 2020 2020 2029 0a0a   {}}.        )..
+00001ff0: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+00002000: 6d5f 5f28 7365 6c66 2c20 6b65 7929 3a0a  m__(self, key):.
+00002010: 2020 2020 2020 2020 2222 2241 6363 6573          """Acces
+00002020: 7320 7265 6665 7265 6e63 6520 706f 7274  s reference port
+00002030: 732e 2222 220a 2020 2020 2020 2020 6966  s.""".        if
+00002040: 206b 6579 206e 6f74 2069 6e20 7365 6c66   key not in self
+00002050: 2e70 6f72 7473 3a0a 2020 2020 2020 2020  .ports:.        
+00002060: 2020 2020 706f 7274 7320 3d20 6c69 7374      ports = list
+00002070: 2873 656c 662e 706f 7274 732e 6b65 7973  (self.ports.keys
+00002080: 2829 290a 2020 2020 2020 2020 2020 2020  ()).            
+00002090: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+000020a0: 2866 227b 6b65 7921 727d 206e 6f74 2069  (f"{key!r} not i
+000020b0: 6e20 7b70 6f72 7473 7d22 290a 0a20 2020  n {ports}")..   
+000020c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000020d0: 2e70 6f72 7473 5b6b 6579 5d0a 0a20 2020  .ports[key]..   
+000020e0: 2064 6566 205f 5f6c 7368 6966 745f 5f28   def __lshift__(
+000020f0: 7365 6c66 2c20 656c 656d 656e 7429 3a0a  self, element):.
+00002100: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
+00002110: 6e69 656e 6365 206f 7065 7261 746f 7220  nience operator 
+00002120: 6571 7569 7661 6c65 6e74 2074 6f20 6164  equivalent to ad
+00002130: 645f 7265 6628 292e 2222 220a 2020 2020  d_ref().""".    
+00002140: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00002150: 6164 645f 7265 6628 656c 656d 656e 7429  add_ref(element)
+00002160: 0a0a 2020 2020 6465 6620 756e 6c6f 636b  ..    def unlock
+00002170: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00002180: 2020 2020 2020 2020 2222 224f 6e6c 7920          """Only 
+00002190: 646f 2074 6869 7320 6966 2079 6f75 206b  do this if you k
+000021a0: 6e6f 7720 7768 6174 2079 6f75 2061 7265  now what you are
+000021b0: 2064 6f69 6e67 2e22 2222 0a20 2020 2020   doing.""".     
+000021c0: 2020 2073 656c 662e 5f6c 6f63 6b65 6420     self._locked 
+000021d0: 3d20 4661 6c73 650a 0a20 2020 2064 6566  = False..    def
+000021e0: 206c 6f63 6b28 7365 6c66 2920 2d3e 204e   lock(self) -> N
+000021f0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00002200: 4d61 6b65 7320 7375 7265 2063 6f6d 706f  Makes sure compo
+00002210: 6e65 6e74 7320 6361 6e27 7420 6164 6420  nents can't add 
+00002220: 6e65 7720 656c 656d 656e 7473 206f 7220  new elements or 
+00002230: 6d6f 7665 2065 7869 7374 696e 6720 6f6e  move existing on
+00002240: 6573 2e0a 0a20 2020 2020 2020 2043 6f6d  es...        Com
+00002250: 706f 6e65 6e74 7320 6c6f 636b 2061 7574  ponents lock aut
+00002260: 6f6d 6174 6963 616c 6c79 2077 6865 6e20  omatically when 
+00002270: 676f 696e 6720 696e 746f 2074 6865 2043  going into the C
+00002280: 4143 4845 2074 6f0a 2020 2020 2020 2020  ACHE to.        
+00002290: 656e 7375 7265 206f 6e65 2063 6f6d 706f  ensure one compo
+000022a0: 6e65 6e74 2064 6f65 7320 6e6f 7420 6368  nent does not ch
+000022b0: 616e 6765 206f 7468 6572 730a 2020 2020  ange others.    
+000022c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000022d0: 7365 6c66 2e5f 6c6f 636b 6564 203d 2054  self._locked = T
+000022e0: 7275 650a 0a20 2020 2064 6566 205f 5f73  rue..    def __s
+000022f0: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
+00002300: 6579 2c20 656c 656d 656e 7429 3a0a 2020  ey, element):.  
+00002310: 2020 2020 2020 2222 2241 6c6c 6f77 2061        """Allow a
+00002320: 6464 696e 6720 706f 6c79 676f 6e73 2061  dding polygons a
+00002330: 6e64 2063 656c 6c20 7265 6665 7265 6e63  nd cell referenc
+00002340: 6573 2e0a 0a20 2020 2020 2020 206c 696b  es...        lik
+00002350: 6520 445b 2761 7263 3327 5d20 3d20 7067  e D['arc3'] = pg
+00002360: 2e61 7263 2829 0a0a 2020 2020 2020 2020  .arc()..        
+00002370: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00002380: 2020 6b65 793a 2041 6c69 6173 206e 616d    key: Alias nam
+00002390: 652e 0a20 2020 2020 2020 2020 2020 2065  e..            e
+000023a0: 6c65 6d65 6e74 3a20 4f62 6a65 6374 2074  lement: Object t
+000023b0: 6861 7420 7769 6c6c 2062 6520 6163 6365  hat will be acce
+000023c0: 7373 6962 6c65 2062 7920 616c 6961 7320  ssible by alias 
+000023d0: 6e61 6d65 2e0a 0a20 2020 2020 2020 2022  name...        "
+000023e0: 2222 0a20 2020 2020 2020 2069 6620 6973  "".        if is
+000023f0: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
+00002400: 2c20 2843 6f6d 706f 6e65 6e74 5265 6665  , (ComponentRefe
+00002410: 7265 6e63 652c 2050 6f6c 7967 6f6e 2929  rence, Polygon))
+00002420: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00002430: 6c66 2e6e 616d 6564 5f72 6566 6572 656e  lf.named_referen
+00002440: 6365 735b 6b65 795d 203d 2065 6c65 6d65  ces[key] = eleme
+00002450: 6e74 0a20 2020 2020 2020 2065 6c73 653a  nt.        else:
+00002460: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00002470: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00002480: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00002490: 2254 7269 6564 2074 6f20 6173 7369 676e  "Tried to assign
+000024a0: 2061 6c69 6173 207b 6b65 7921 727d 2069   alias {key!r} i
+000024b0: 6e20 436f 6d70 6f6e 656e 7420 7b73 656c  n Component {sel
+000024c0: 662e 6e61 6d65 2172 7d2c 220a 2020 2020  f.name!r},".    
+000024d0: 2020 2020 2020 2020 2020 2020 2262 7574              "but
+000024e0: 2066 6169 6c65 6420 6265 6361 7573 6520   failed because 
+000024f0: 7468 6520 6974 656d 2077 6173 206e 6f74  the item was not
+00002500: 2061 2043 6f6d 706f 6e65 6e74 5265 6665   a ComponentRefe
+00002510: 7265 6e63 6522 0a20 2020 2020 2020 2020  rence".         
+00002520: 2020 2029 0a0a 2020 2020 4063 6c61 7373     )..    @class
+00002530: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00002540: 5f67 6574 5f76 616c 6964 6174 6f72 735f  _get_validators_
+00002550: 5f28 636c 7329 3a0a 2020 2020 2020 2020  _(cls):.        
+00002560: 2222 2247 6574 2076 616c 6964 6174 6f72  """Get validator
+00002570: 7320 666f 7220 7468 6520 436f 6d70 6f6e  s for the Compon
+00002580: 656e 7420 6f62 6a65 6374 2e22 2222 0a20  ent object.""". 
+00002590: 2020 2020 2020 2079 6965 6c64 2063 6c73         yield cls
+000025a0: 2e76 616c 6964 6174 650a 0a20 2020 2040  .validate..    @
+000025b0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000025c0: 6465 6620 7661 6c69 6461 7465 2863 6c73  def validate(cls
+000025d0: 2c20 7629 3a0a 2020 2020 2020 2020 2222  , v):.        ""
+000025e0: 2250 7964 616e 7469 6320 6173 7375 6d65  "Pydantic assume
+000025f0: 7320 636f 6d70 6f6e 656e 7420 6973 2076  s component is v
+00002600: 616c 6964 2069 6620 7468 6520 666f 6c6c  alid if the foll
+00002610: 6f77 696e 6720 6172 6520 7472 7565 2e0a  owing are true..
+00002620: 0a20 2020 2020 2020 202d 206e 616d 6520  .        - name 
+00002630: 6368 6172 6163 7465 7273 203c 204d 4158  characters < MAX
+00002640: 5f4e 414d 455f 4c45 4e47 5448 0a20 2020  _NAME_LENGTH.   
+00002650: 2020 2020 202d 2069 7320 6e6f 7420 656d       - is not em
+00002660: 7074 7920 2868 6173 2072 6566 6572 656e  pty (has referen
+00002670: 6365 7320 6f72 2070 6f6c 7967 6f6e 7329  ces or polygons)
+00002680: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00002690: 2020 2020 204d 4158 5f4e 414d 455f 4c45       MAX_NAME_LE
+000026a0: 4e47 5448 203d 2039 390a 2020 2020 2020  NGTH = 99.      
+000026b0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+000026c0: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
+000026d0: 2076 2c20 436f 6d70 6f6e 656e 740a 2020   v, Component.  
+000026e0: 2020 2020 2020 292c 2066 2254 7970 6545        ), f"TypeE
+000026f0: 7272 6f72 2c20 476f 7420 7b74 7970 6528  rror, Got {type(
+00002700: 7629 7d2c 2065 7870 6563 7469 6e67 2043  v)}, expecting C
+00002710: 6f6d 706f 6e65 6e74 220a 2020 2020 2020  omponent".      
+00002720: 2020 6173 7365 7274 2028 0a20 2020 2020    assert (.     
+00002730: 2020 2020 2020 206c 656e 2876 2e6e 616d         len(v.nam
+00002740: 6529 203c 3d20 4d41 585f 4e41 4d45 5f4c  e) <= MAX_NAME_L
+00002750: 454e 4754 480a 2020 2020 2020 2020 292c  ENGTH.        ),
+00002760: 2066 226e 616d 6520 607b 762e 6e61 6d65   f"name `{v.name
+00002770: 7d60 207b 6c65 6e28 762e 6e61 6d65 297d  }` {len(v.name)}
+00002780: 203e 207b 4d41 585f 4e41 4d45 5f4c 454e   > {MAX_NAME_LEN
+00002790: 4754 487d 2022 0a20 2020 2020 2020 2072  GTH} ".        r
+000027a0: 6574 7572 6e20 760a 0a20 2020 2040 7072  eturn v..    @pr
+000027b0: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
+000027c0: 616d 6564 5f72 6566 6572 656e 6365 7328  amed_references(
+000027d0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+000027e0: 6574 7572 6e20 7365 6c66 2e5f 6e61 6d65  eturn self._name
+000027f0: 645f 7265 6665 7265 6e63 6573 0a0a 2020  d_references..  
+00002800: 2020 6465 6620 6164 645f 6c61 6265 6c28    def add_label(
+00002810: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00002820: 2020 2020 2020 2074 6578 743a 2073 7472         text: str
+00002830: 203d 2022 6865 6c6c 6f22 2c0a 2020 2020   = "hello",.    
+00002840: 2020 2020 706f 7369 7469 6f6e 3a20 5475      position: Tu
+00002850: 706c 655b 666c 6f61 742c 2066 6c6f 6174  ple[float, float
+00002860: 5d20 3d20 2830 2e30 2c20 302e 3029 2c0a  ] = (0.0, 0.0),.
+00002870: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
+00002880: 6174 696f 6e3a 2066 6c6f 6174 203d 2031  ation: float = 1
+00002890: 2e30 2c0a 2020 2020 2020 2020 726f 7461  .0,.        rota
+000028a0: 7469 6f6e 3a20 666c 6f61 7420 3d20 302c  tion: float = 0,
+000028b0: 0a20 2020 2020 2020 2061 6e63 686f 723a  .        anchor:
+000028c0: 2073 7472 203d 2022 6f22 2c0a 2020 2020   str = "o",.    
+000028d0: 2020 2020 6c61 7965 723d 2254 4558 5422      layer="TEXT"
+000028e0: 2c0a 2020 2020 2020 2020 785f 7265 666c  ,.        x_refl
+000028f0: 6563 7469 6f6e 3d46 616c 7365 2c0a 2020  ection=False,.  
+00002900: 2020 2920 2d3e 204c 6162 656c 3a0a 2020    ) -> Label:.  
+00002910: 2020 2020 2020 2222 2241 6464 7320 4c61        """Adds La
+00002920: 6265 6c20 746f 2074 6865 2043 6f6d 706f  bel to the Compo
+00002930: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
+00002940: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00002950: 2074 6578 743a 204c 6162 656c 2074 6578   text: Label tex
+00002960: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
+00002970: 6f73 6974 696f 6e3a 2078 2d2c 2079 2d63  osition: x-, y-c
+00002980: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
+00002990: 6520 4c61 6265 6c20 6c6f 6361 7469 6f6e  e Label location
+000029a0: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+000029b0: 676e 6966 6963 6174 696f 6e3a 204d 6167  gnification: Mag
+000029c0: 6e69 6669 6361 7469 6f6e 2066 6163 746f  nification facto
+000029d0: 7220 666f 7220 7468 6520 4c61 6265 6c20  r for the Label 
+000029e0: 7465 7874 2e0a 2020 2020 2020 2020 2020  text..          
+000029f0: 2020 726f 7461 7469 6f6e 3a20 416e 676c    rotation: Angl
+00002a00: 6520 726f 7461 7469 6f6e 206f 6620 7468  e rotation of th
+00002a10: 6520 4c61 6265 6c20 7465 7874 2e0a 2020  e Label text..  
+00002a20: 2020 2020 2020 2020 2020 616e 6368 6f72            anchor
+00002a30: 3a20 7b27 6e27 2c20 2765 272c 2027 7327  : {'n', 'e', 's'
+00002a40: 2c20 2777 272c 2027 6f27 2c20 276e 6527  , 'w', 'o', 'ne'
+00002a50: 2c20 276e 7727 2c20 2e2e 2e7d 0a20 2020  , 'nw', ...}.   
+00002a60: 2020 2020 2020 2020 2020 2020 2050 6f73               Pos
+00002a70: 6974 696f 6e20 6f66 2074 6865 2061 6e63  ition of the anc
+00002a80: 686f 7220 7265 6c61 7469 7665 2074 6f20  hor relative to 
+00002a90: 7468 6520 7465 7874 2e0a 2020 2020 2020  the text..      
+00002aa0: 2020 2020 2020 6c61 7965 723a 2053 7065        layer: Spe
+00002ab0: 6369 6669 6320 6c61 7965 7228 7329 2074  cific layer(s) t
+00002ac0: 6f20 7075 7420 4c61 6265 6c20 6f6e 2e0a  o put Label on..
+00002ad0: 2020 2020 2020 2020 2020 2020 785f 7265              x_re
+00002ae0: 666c 6563 7469 6f6e 3a20 5472 7565 2072  flection: True r
+00002af0: 6566 6c65 6374 7320 6163 726f 7373 2074  eflects across t
+00002b00: 6865 2068 6f72 697a 6f6e 7461 6c20 6178  he horizontal ax
+00002b10: 6973 2062 6566 6f72 6520 726f 7461 7469  is before rotati
+00002b20: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
+00002b30: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+00002b40: 6661 6374 6f72 792e 7064 6b20 696d 706f  factory.pdk impo
+00002b50: 7274 2067 6574 5f6c 6179 6572 0a0a 2020  rt get_layer..  
+00002b60: 2020 2020 2020 6c61 7965 7220 3d20 6765        layer = ge
+00002b70: 745f 6c61 7965 7228 6c61 7965 7229 0a0a  t_layer(layer)..
+00002b80: 2020 2020 2020 2020 6764 735f 6c61 7965          gds_laye
+00002b90: 722c 2067 6473 5f64 6174 6174 7970 6520  r, gds_datatype 
+00002ba0: 3d20 6c61 7965 720a 0a20 2020 2020 2020  = layer..       
+00002bb0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00002bc0: 6365 2874 6578 742c 2073 7472 293a 0a20  ce(text, str):. 
+00002bd0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
+00002be0: 3d20 7465 7874 0a20 2020 2020 2020 206c  = text.        l
+00002bf0: 6162 656c 203d 204c 6162 656c 280a 2020  abel = Label(.  
+00002c00: 2020 2020 2020 2020 2020 7465 7874 3d74            text=t
+00002c10: 6578 742c 0a20 2020 2020 2020 2020 2020  ext,.           
+00002c20: 206f 7269 6769 6e3d 706f 7369 7469 6f6e   origin=position
+00002c30: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
+00002c40: 6368 6f72 3d61 6e63 686f 722c 0a20 2020  chor=anchor,.   
+00002c50: 2020 2020 2020 2020 206d 6167 6e69 6669           magnifi
+00002c60: 6361 7469 6f6e 3d6d 6167 6e69 6669 6361  cation=magnifica
+00002c70: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+00002c80: 2020 726f 7461 7469 6f6e 3d72 6f74 6174    rotation=rotat
+00002c90: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00002ca0: 206c 6179 6572 3d67 6473 5f6c 6179 6572   layer=gds_layer
+00002cb0: 2c0a 2020 2020 2020 2020 2020 2020 7465  ,.            te
+00002cc0: 7874 7479 7065 3d67 6473 5f64 6174 6174  xttype=gds_datat
+00002cd0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
+00002ce0: 2078 5f72 6566 6c65 6374 696f 6e3d 785f   x_reflection=x_
+00002cf0: 7265 666c 6563 7469 6f6e 2c0a 2020 2020  reflection,.    
+00002d00: 2020 2020 290a 2020 2020 2020 2020 7365      ).        se
+00002d10: 6c66 2e61 6464 286c 6162 656c 290a 2020  lf.add(label).  
+00002d20: 2020 2020 2020 7265 7475 726e 206c 6162        return lab
+00002d30: 656c 0a0a 2020 2020 4070 726f 7065 7274  el..    @propert
+00002d40: 790a 2020 2020 6465 6620 6262 6f78 2873  y.    def bbox(s
+00002d50: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00002d60: 2252 6574 7572 6e73 2074 6865 2062 6f75  "Returns the bou
+00002d70: 6e64 696e 6720 626f 7820 6f66 2074 6865  nding box of the
+00002d80: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+00002d90: 6e63 652e 0a0a 2020 2020 2020 2020 6974  nce...        it
+00002da0: 2073 6e61 7073 2074 6f20 3320 6465 6369   snaps to 3 deci
+00002db0: 6d61 6c73 2069 6e20 756d 2028 302e 3030  mals in um (0.00
+00002dc0: 3175 6d20 3d20 316e 6d20 7072 6563 6973  1um = 1nm precis
+00002dd0: 696f 6e29 0a20 2020 2020 2020 2022 2222  ion).        """
+00002de0: 0a20 2020 2020 2020 2062 626f 7820 3d20  .        bbox = 
+00002df0: 7365 6c66 2e5f 6365 6c6c 2e62 6f75 6e64  self._cell.bound
+00002e00: 696e 675f 626f 7828 290a 2020 2020 2020  ing_box().      
+00002e10: 2020 6966 2062 626f 7820 6973 204e 6f6e    if bbox is Non
+00002e20: 653a 0a20 2020 2020 2020 2020 2020 2062  e:.            b
+00002e30: 626f 7820 3d20 2828 302c 2030 292c 2028  box = ((0, 0), (
+00002e40: 302c 2030 2929 0a20 2020 2020 2020 2072  0, 0)).        r
+00002e50: 6574 7572 6e20 6e70 2e72 6f75 6e64 2862  eturn np.round(b
+00002e60: 626f 782c 2033 290a 0a20 2020 2040 7072  box, 3)..    @pr
+00002e70: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
+00002e80: 6f72 7473 5f6c 6179 6572 2873 656c 6629  orts_layer(self)
+00002e90: 202d 3e20 4469 6374 5b73 7472 2c20 7374   -> Dict[str, st
+00002ea0: 725d 3a0a 2020 2020 2020 2020 2222 2252  r]:.        """R
+00002eb0: 6574 7572 6e73 2061 206d 6170 7069 6e67  eturns a mapping
+00002ec0: 2066 726f 6d20 6c61 7965 7230 5f6c 6179   from layer0_lay
+00002ed0: 6572 315f 4530 3a20 706f 7274 4e61 6d65  er1_E0: portName
+00002ee0: 2e22 2222 0a20 2020 2020 2020 2072 6574  .""".        ret
+00002ef0: 7572 6e20 6d61 705f 706f 7274 735f 6c61  urn map_ports_la
+00002f00: 7965 725f 746f 5f6f 7269 656e 7461 7469  yer_to_orientati
+00002f10: 6f6e 2873 656c 662e 706f 7274 7329 0a0a  on(self.ports)..
+00002f20: 2020 2020 6465 6620 706f 7274 5f62 795f      def port_by_
+00002f30: 6f72 6965 6e74 6174 696f 6e5f 6377 2873  orientation_cw(s
+00002f40: 656c 662c 206b 6579 3a20 7374 722c 202a  elf, key: str, *
+00002f50: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
+00002f60: 2020 2222 2252 6574 7572 6e73 2070 6f72    """Returns por
+00002f70: 7420 6279 2069 6e64 6578 696e 6720 7468  t by indexing th
+00002f80: 656d 2063 6c6f 636b 7769 7365 2e22 2222  em clockwise."""
+00002f90: 0a20 2020 2020 2020 206d 203d 206d 6170  .        m = map
+00002fa0: 5f70 6f72 7473 5f74 6f5f 6f72 6965 6e74  _ports_to_orient
+00002fb0: 6174 696f 6e5f 6377 2873 656c 662e 706f  ation_cw(self.po
+00002fc0: 7274 732c 202a 2a6b 7761 7267 7329 0a20  rts, **kwargs). 
+00002fd0: 2020 2020 2020 2069 6620 6b65 7920 6e6f         if key no
+00002fe0: 7420 696e 206d 3a0a 2020 2020 2020 2020  t in m:.        
+00002ff0: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
+00003000: 6f72 2866 227b 6b65 797d 206e 6f74 2069  or(f"{key} not i
+00003010: 6e20 7b6c 6973 7428 6d2e 6b65 7973 2829  n {list(m.keys()
+00003020: 297d 2229 0a20 2020 2020 2020 206b 6579  )}").        key
+00003030: 3220 3d20 6d5b 6b65 795d 0a20 2020 2020  2 = m[key].     
+00003040: 2020 2072 6574 7572 6e20 7365 6c66 2e70     return self.p
+00003050: 6f72 7473 5b6b 6579 325d 0a0a 2020 2020  orts[key2]..    
+00003060: 6465 6620 706f 7274 5f62 795f 6f72 6965  def port_by_orie
+00003070: 6e74 6174 696f 6e5f 6363 7728 7365 6c66  ntation_ccw(self
+00003080: 2c20 6b65 793a 2073 7472 2c20 2a2a 6b77  , key: str, **kw
+00003090: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
+000030a0: 2222 5265 7475 726e 7320 706f 7274 2062  ""Returns port b
+000030b0: 7920 696e 6465 7869 6e67 2074 6865 6d20  y indexing them 
+000030c0: 636c 6f63 6b77 6973 652e 2222 220a 2020  clockwise.""".  
+000030d0: 2020 2020 2020 6d20 3d20 6d61 705f 706f        m = map_po
+000030e0: 7274 735f 746f 5f6f 7269 656e 7461 7469  rts_to_orientati
+000030f0: 6f6e 5f63 6377 2873 656c 662e 706f 7274  on_ccw(self.port
+00003100: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
+00003110: 2020 2020 2069 6620 6b65 7920 6e6f 7420       if key not 
+00003120: 696e 206d 3a0a 2020 2020 2020 2020 2020  in m:.          
+00003130: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
+00003140: 2866 227b 6b65 797d 206e 6f74 2069 6e20  (f"{key} not in 
+00003150: 7b6c 6973 7428 6d2e 6b65 7973 2829 297d  {list(m.keys())}
+00003160: 2229 0a20 2020 2020 2020 206b 6579 3220  ").        key2 
+00003170: 3d20 6d5b 6b65 795d 0a20 2020 2020 2020  = m[key].       
+00003180: 2072 6574 7572 6e20 7365 6c66 2e70 6f72   return self.por
+00003190: 7473 5b6b 6579 325d 0a0a 2020 2020 6465  ts[key2]..    de
+000031a0: 6620 6765 745f 706f 7274 735f 7873 697a  f get_ports_xsiz
+000031b0: 6528 7365 6c66 2c20 2a2a 6b77 6172 6773  e(self, **kwargs
+000031c0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
+000031d0: 2020 2020 2222 2252 6574 7572 6e73 2078      """Returns x
+000031e0: 6469 7374 616e 6365 2066 726f 6d20 6561  distance from ea
+000031f0: 7374 2074 6f20 7765 7374 2070 6f72 7473  st to west ports
+00003200: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+00003210: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+00003220: 2020 2020 206c 6179 6572 3a20 706f 7274       layer: port
+00003230: 2047 4453 206c 6179 6572 2e0a 2020 2020   GDS layer..    
+00003240: 2020 2020 2020 2020 7072 6566 6978 3a20          prefix: 
+00003250: 7769 7468 2069 6e20 706f 7274 206e 616d  with in port nam
+00003260: 652e 0a20 2020 2020 2020 2020 2020 206f  e..            o
+00003270: 7269 656e 7461 7469 6f6e 3a20 696e 2064  rientation: in d
+00003280: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
+00003290: 2020 2020 7769 6474 683a 2070 6f72 7420      width: port 
+000032a0: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
+000032b0: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
+000032c0: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
+000032d0: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
+000032e0: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+000032f0: 7479 7065 3a20 6f70 7469 6361 6c2c 2065  type: optical, e
+00003300: 6c65 6374 7269 6361 6c2c 202e 2e2e 0a20  lectrical, .... 
+00003310: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00003320: 2020 2070 6f72 7473 5f63 7720 3d20 7365     ports_cw = se
+00003330: 6c66 2e67 6574 5f70 6f72 7473 5f6c 6973  lf.get_ports_lis
+00003340: 7428 636c 6f63 6b77 6973 653d 5472 7565  t(clockwise=True
+00003350: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+00003360: 2020 2020 706f 7274 735f 6363 7720 3d20      ports_ccw = 
+00003370: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
+00003380: 6973 7428 636c 6f63 6b77 6973 653d 4661  ist(clockwise=Fa
+00003390: 6c73 652c 202a 2a6b 7761 7267 7329 0a20  lse, **kwargs). 
+000033a0: 2020 2020 2020 2072 6574 7572 6e20 736e         return sn
+000033b0: 6170 5f74 6f5f 6772 6964 2870 6f72 7473  ap_to_grid(ports
+000033c0: 5f63 6377 5b30 5d2e 7820 2d20 706f 7274  _ccw[0].x - port
+000033d0: 735f 6377 5b30 5d2e 7829 0a0a 2020 2020  s_cw[0].x)..    
+000033e0: 6465 6620 6765 745f 706f 7274 735f 7973  def get_ports_ys
+000033f0: 697a 6528 7365 6c66 2c20 2a2a 6b77 6172  ize(self, **kwar
+00003400: 6773 2920 2d3e 2066 6c6f 6174 3a0a 2020  gs) -> float:.  
+00003410: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00003420: 2079 6469 7374 616e 6365 2066 726f 6d20   ydistance from 
+00003430: 6561 7374 2074 6f20 7765 7374 2070 6f72  east to west por
+00003440: 7473 2e0a 0a20 2020 2020 2020 204b 6579  ts...        Key
+00003450: 776f 7264 2041 7267 733a 0a20 2020 2020  word Args:.     
+00003460: 2020 2020 2020 206c 6179 6572 3a20 706f         layer: po
+00003470: 7274 2047 4453 206c 6179 6572 2e0a 2020  rt GDS layer..  
+00003480: 2020 2020 2020 2020 2020 7072 6566 6978            prefix
+00003490: 3a20 7769 7468 2069 6e20 706f 7274 206e  : with in port n
+000034a0: 616d 652e 0a20 2020 2020 2020 2020 2020  ame..           
+000034b0: 206f 7269 656e 7461 7469 6f6e 3a20 696e   orientation: in
+000034c0: 2064 6567 7265 6573 2e0a 2020 2020 2020   degrees..      
+000034d0: 2020 2020 2020 7769 6474 683a 2070 6f72        width: por
+000034e0: 7420 7769 6474 6820 2875 6d29 2e0a 2020  t width (um)..  
+000034f0: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+00003500: 5f65 7863 6c75 6465 643a 204c 6973 7420  _excluded: List 
+00003510: 6f66 206c 6179 6572 7320 746f 2065 7863  of layers to exc
+00003520: 6c75 6465 2e0a 2020 2020 2020 2020 2020  lude..          
+00003530: 2020 706f 7274 5f74 7970 653a 206f 7074    port_type: opt
+00003540: 6963 616c 2c20 656c 6563 7472 6963 616c  ical, electrical
+00003550: 2c20 2e2e 2e0a 2020 2020 2020 2020 2222  , ....        ""
+00003560: 220a 2020 2020 2020 2020 706f 7274 735f  ".        ports_
+00003570: 6377 203d 2073 656c 662e 6765 745f 706f  cw = self.get_po
+00003580: 7274 735f 6c69 7374 2863 6c6f 636b 7769  rts_list(clockwi
+00003590: 7365 3d54 7275 652c 202a 2a6b 7761 7267  se=True, **kwarg
+000035a0: 7329 0a20 2020 2020 2020 2070 6f72 7473  s).        ports
+000035b0: 5f63 6377 203d 2073 656c 662e 6765 745f  _ccw = self.get_
+000035c0: 706f 7274 735f 6c69 7374 2863 6c6f 636b  ports_list(clock
+000035d0: 7769 7365 3d46 616c 7365 2c20 2a2a 6b77  wise=False, **kw
+000035e0: 6172 6773 290a 2020 2020 2020 2020 7265  args).        re
+000035f0: 7475 726e 2073 6e61 705f 746f 5f67 7269  turn snap_to_gri
+00003600: 6428 706f 7274 735f 6363 775b 305d 2e79  d(ports_ccw[0].y
+00003610: 202d 2070 6f72 7473 5f63 775b 305d 2e79   - ports_cw[0].y
+00003620: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
+00003630: 6e65 746c 6973 7428 0a20 2020 2020 2020  netlist(.       
+00003640: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
+00003650: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
+00003660: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
+00003670: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
+00003680: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
+00003690: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
+000036a0: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
+000036b0: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
+000036c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000036d0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
+000036e0: 6265 6c73 3a20 6164 6420 6c61 6265 6c20  bels: add label 
+000036f0: 746f 2065 6163 6820 6e6f 6465 2e0a 2020  to each node..  
+00003700: 2020 2020 2020 2020 2020 666f 6e74 5f77            font_w
+00003710: 6569 6768 743a 206e 6f72 6d61 6c2c 2062  eight: normal, b
+00003720: 6f6c 642e 0a20 2020 2020 2020 2020 2020  old..           
+00003730: 202a 2a6b 7761 7267 733a 206b 6579 776f   **kwargs: keywo
+00003740: 7264 2061 7267 756d 656e 7473 2066 6f72  rd arguments for
+00003750: 2074 6865 2067 6574 5f6e 6574 6c69 7374   the get_netlist
+00003760: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00003770: 2020 2222 220a 2020 2020 2020 2020 696d    """.        im
+00003780: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
+00003790: 7079 706c 6f74 2061 7320 706c 740a 2020  pyplot as plt.  
+000037a0: 2020 2020 2020 696d 706f 7274 206e 6574        import net
+000037b0: 776f 726b 7820 6173 206e 780a 0a20 2020  workx as nx..   
+000037c0: 2020 2020 2070 6c74 2e66 6967 7572 6528       plt.figure(
+000037d0: 290a 2020 2020 2020 2020 6e65 746c 6973  ).        netlis
+000037e0: 7420 3d20 7365 6c66 2e67 6574 5f6e 6574  t = self.get_net
+000037f0: 6c69 7374 282a 2a6b 7761 7267 7329 0a20  list(**kwargs). 
+00003800: 2020 2020 2020 2063 6f6e 6e65 6374 696f         connectio
+00003810: 6e73 203d 206e 6574 6c69 7374 5b22 636f  ns = netlist["co
+00003820: 6e6e 6563 7469 6f6e 7322 5d0a 2020 2020  nnections"].    
+00003830: 2020 2020 706c 6163 656d 656e 7473 203d      placements =
+00003840: 206e 6574 6c69 7374 5b22 706c 6163 656d   netlist["placem
+00003850: 656e 7473 225d 0a20 2020 2020 2020 2047  ents"].        G
+00003860: 203d 206e 782e 4772 6170 6828 290a 2020   = nx.Graph().  
+00003870: 2020 2020 2020 472e 6164 645f 6564 6765        G.add_edge
+00003880: 735f 6672 6f6d 280a 2020 2020 2020 2020  s_from(.        
+00003890: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+000038a0: 2020 2020 2020 2822 2c22 2e6a 6f69 6e28        (",".join(
+000038b0: 6b2e 7370 6c69 7428 222c 2229 5b3a 2d31  k.split(",")[:-1
+000038c0: 5d29 2c20 222c 222e 6a6f 696e 2876 2e73  ]), ",".join(v.s
+000038d0: 706c 6974 2822 2c22 295b 3a2d 315d 2929  plit(",")[:-1]))
+000038e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000038f0: 2066 6f72 206b 2c20 7620 696e 2063 6f6e   for k, v in con
+00003900: 6e65 6374 696f 6e73 2e69 7465 6d73 2829  nections.items()
+00003910: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
+00003920: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00003930: 2070 6f73 203d 207b 6b3a 2028 765b 2278   pos = {k: (v["x
+00003940: 225d 2c20 765b 2279 225d 2920 666f 7220  "], v["y"]) for 
+00003950: 6b2c 2076 2069 6e20 706c 6163 656d 656e  k, v in placemen
+00003960: 7473 2e69 7465 6d73 2829 7d0a 2020 2020  ts.items()}.    
+00003970: 2020 2020 6c61 6265 6c73 203d 207b 6b3a      labels = {k:
+00003980: 2022 2c22 2e6a 6f69 6e28 6b2e 7370 6c69   ",".join(k.spli
+00003990: 7428 222c 2229 5b3a 315d 2920 666f 7220  t(",")[:1]) for 
+000039a0: 6b20 696e 2070 6c61 6365 6d65 6e74 732e  k in placements.
+000039b0: 6b65 7973 2829 7d0a 2020 2020 2020 2020  keys()}.        
+000039c0: 6e78 2e64 7261 7728 0a20 2020 2020 2020  nx.draw(.       
+000039d0: 2020 2020 2047 2c0a 2020 2020 2020 2020       G,.        
+000039e0: 2020 2020 7769 7468 5f6c 6162 656c 733d      with_labels=
+000039f0: 7769 7468 5f6c 6162 656c 732c 0a20 2020  with_labels,.   
+00003a00: 2020 2020 2020 2020 2066 6f6e 745f 7765           font_we
+00003a10: 6967 6874 3d66 6f6e 745f 7765 6967 6874  ight=font_weight
+00003a20: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
+00003a30: 6265 6c73 3d6c 6162 656c 732c 0a20 2020  bels=labels,.   
+00003a40: 2020 2020 2020 2020 2070 6f73 3d70 6f73           pos=pos
+00003a50: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
+00003a60: 2020 2020 7265 7475 726e 2047 0a0a 2020      return G..  
+00003a70: 2020 6465 6620 706c 6f74 5f6e 6574 6c69    def plot_netli
+00003a80: 7374 5f66 6c61 7428 0a20 2020 2020 2020  st_flat(.       
+00003a90: 2073 656c 662c 2077 6974 685f 6c61 6265   self, with_labe
+00003aa0: 6c73 3a20 626f 6f6c 203d 2054 7275 652c  ls: bool = True,
+00003ab0: 2066 6f6e 745f 7765 6967 6874 3a20 7374   font_weight: st
+00003ac0: 7220 3d20 226e 6f72 6d61 6c22 2c20 2a2a  r = "normal", **
+00003ad0: 6b77 6172 6773 0a20 2020 2029 3a0a 2020  kwargs.    ):.  
+00003ae0: 2020 2020 2020 2222 2250 6c6f 7473 2061        """Plots a
+00003af0: 206e 6574 6c69 7374 2067 7261 7068 2077   netlist graph w
+00003b00: 6974 6820 6e65 7477 6f72 6b78 2e0a 0a20  ith networkx... 
+00003b10: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00003b20: 2020 2020 2020 2020 2066 6c61 743a 2069           flat: i
+00003b30: 6620 7472 7565 2c20 7769 6c6c 2070 6c6f  f true, will plo
+00003b40: 7420 7468 6520 666c 6174 206e 6574 6c69  t the flat netli
+00003b50: 7374 0a20 2020 2020 2020 2020 2020 2077  st.            w
+00003b60: 6974 685f 6c61 6265 6c73 3a20 6164 6420  ith_labels: add 
+00003b70: 6c61 6265 6c20 746f 2065 6163 6820 6e6f  label to each no
+00003b80: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
+00003b90: 666f 6e74 5f77 6569 6768 743a 206e 6f72  font_weight: nor
+00003ba0: 6d61 6c2c 2062 6f6c 642e 0a20 2020 2020  mal, bold..     
+00003bb0: 2020 2020 2020 202a 2a6b 7761 7267 733a         **kwargs:
+00003bc0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00003bd0: 7473 2066 6f72 2074 6865 2067 6574 5f6e  ts for the get_n
+00003be0: 6574 6c69 7374 2066 756e 6374 696f 6e0a  etlist function.
+00003bf0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003c00: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
+00003c10: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
+00003c20: 706c 740a 2020 2020 2020 2020 696d 706f  plt.        impo
+00003c30: 7274 206e 6574 776f 726b 7820 6173 206e  rt networkx as n
+00003c40: 780a 0a20 2020 2020 2020 2070 6c74 2e66  x..        plt.f
+00003c50: 6967 7572 6528 290a 2020 2020 2020 2020  igure().        
+00003c60: 6e65 746c 6973 7420 3d20 7365 6c66 2e67  netlist = self.g
+00003c70: 6574 5f6e 6574 6c69 7374 5f66 6c61 7428  et_netlist_flat(
+00003c80: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00003c90: 2020 636f 6e6e 6563 7469 6f6e 7320 3d20    connections = 
+00003ca0: 6e65 746c 6973 745b 2263 6f6e 6e65 6374  netlist["connect
+00003cb0: 696f 6e73 225d 0a20 2020 2020 2020 2070  ions"].        p
+00003cc0: 6c61 6365 6d65 6e74 7320 3d20 6e65 746c  lacements = netl
+00003cd0: 6973 745b 2270 6c61 6365 6d65 6e74 7322  ist["placements"
+00003ce0: 5d0a 2020 2020 2020 2020 636f 6e6e 6563  ].        connec
+00003cf0: 7469 6f6e 735f 6c69 7374 203d 205b 5d0a  tions_list = [].
+00003d00: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
+00003d10: 5f6c 6973 7420 696e 2063 6f6e 6e65 6374  _list in connect
+00003d20: 696f 6e73 2e69 7465 6d73 2829 3a0a 2020  ions.items():.  
+00003d30: 2020 2020 2020 2020 2020 636f 6e6e 6563            connec
+00003d40: 7469 6f6e 735f 6c69 7374 2e65 7874 656e  tions_list.exten
+00003d50: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+00003d60: 2020 2028 222c 222e 6a6f 696e 286b 2e73     (",".join(k.s
+00003d70: 706c 6974 2822 2c22 295b 3a2d 315d 292c  plit(",")[:-1]),
+00003d80: 2022 2c22 2e6a 6f69 6e28 762e 7370 6c69   ",".join(v.spli
+00003d90: 7428 222c 2229 5b3a 2d31 5d29 290a 2020  t(",")[:-1])).  
+00003da0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00003db0: 7220 7620 696e 2076 5f6c 6973 740a 2020  r v in v_list.  
+00003dc0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00003dd0: 2020 2020 4720 3d20 6e78 2e47 7261 7068      G = nx.Graph
+00003de0: 2829 0a20 2020 2020 2020 2047 2e61 6464  ().        G.add
+00003df0: 5f65 6467 6573 5f66 726f 6d28 636f 6e6e  _edges_from(conn
+00003e00: 6563 7469 6f6e 735f 6c69 7374 290a 2020  ections_list).  
+00003e10: 2020 2020 2020 706f 7320 3d20 7b6b 3a20        pos = {k: 
+00003e20: 2876 5b22 7822 5d2c 2076 5b22 7922 5d29  (v["x"], v["y"])
+00003e30: 2066 6f72 206b 2c20 7620 696e 2070 6c61   for k, v in pla
+00003e40: 6365 6d65 6e74 732e 6974 656d 7328 297d  cements.items()}
+00003e50: 0a20 2020 2020 2020 206c 6162 656c 7320  .        labels 
+00003e60: 3d20 7b6b 3a20 222c 222e 6a6f 696e 286b  = {k: ",".join(k
+00003e70: 2e73 706c 6974 2822 2c22 295b 3a31 5d29  .split(",")[:1])
+00003e80: 2066 6f72 206b 2069 6e20 706c 6163 656d   for k in placem
+00003e90: 656e 7473 2e6b 6579 7328 297d 0a20 2020  ents.keys()}.   
+00003ea0: 2020 2020 206e 782e 6472 6177 280a 2020       nx.draw(.  
+00003eb0: 2020 2020 2020 2020 2020 472c 0a20 2020            G,.   
+00003ec0: 2020 2020 2020 2020 2077 6974 685f 6c61           with_la
+00003ed0: 6265 6c73 3d77 6974 685f 6c61 6265 6c73  bels=with_labels
+00003ee0: 2c0a 2020 2020 2020 2020 2020 2020 666f  ,.            fo
+00003ef0: 6e74 5f77 6569 6768 743d 666f 6e74 5f77  nt_weight=font_w
+00003f00: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
+00003f10: 2020 206c 6162 656c 733d 6c61 6265 6c73     labels=labels
+00003f20: 2c0a 2020 2020 2020 2020 2020 2020 706f  ,.            po
+00003f30: 733d 706f 732c 0a20 2020 2020 2020 2029  s=pos,.        )
+00003f40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003f50: 470a 0a20 2020 2064 6566 2067 6574 5f6e  G..    def get_n
+00003f60: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
+00003f70: 2c20 2a2a 6b77 6172 6773 2920 2d3e 2044  , **kwargs) -> D
+00003f80: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
+00003f90: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+00003fa0: 6163 746f 7279 2e67 6574 5f6e 6574 6c69  actory.get_netli
+00003fb0: 7374 2069 6d70 6f72 7420 6765 745f 6e65  st import get_ne
+00003fc0: 746c 6973 745f 7961 6d6c 0a0a 2020 2020  tlist_yaml..    
+00003fd0: 2020 2020 7265 7475 726e 2067 6574 5f6e      return get_n
+00003fe0: 6574 6c69 7374 5f79 616d 6c28 7365 6c66  etlist_yaml(self
+00003ff0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+00004000: 2064 6566 2077 7269 7465 5f6e 6574 6c69   def write_netli
+00004010: 7374 2873 656c 662c 2066 696c 6570 6174  st(self, filepat
+00004020: 683a 2073 7472 2920 2d3e 204e 6f6e 653a  h: str) -> None:
+00004030: 0a20 2020 2020 2020 2022 2222 5772 6974  .        """Writ
+00004040: 6520 6e65 746c 6973 7420 696e 2059 414d  e netlist in YAM
+00004050: 4c2e 2222 220a 2020 2020 2020 2020 6e65  L.""".        ne
+00004060: 746c 6973 7420 3d20 7365 6c66 2e67 6574  tlist = self.get
+00004070: 5f6e 6574 6c69 7374 2829 0a20 2020 2020  _netlist().     
+00004080: 2020 204f 6d65 6761 436f 6e66 2e73 6176     OmegaConf.sav
+00004090: 6528 6e65 746c 6973 742c 2066 696c 6570  e(netlist, filep
+000040a0: 6174 6829 0a0a 2020 2020 6465 6620 7772  ath)..    def wr
+000040b0: 6974 655f 6e65 746c 6973 745f 646f 7428  ite_netlist_dot(
+000040c0: 7365 6c66 2c20 6669 6c65 7061 7468 3a20  self, filepath: 
+000040d0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+000040e0: 4e6f 6e65 2920 2d3e 204e 6f6e 653a 0a20  None) -> None:. 
+000040f0: 2020 2020 2020 2022 2222 5772 6974 6520         """Write 
+00004100: 6e65 746c 6973 7420 6772 6170 6820 696e  netlist graph in
+00004110: 2044 4f54 2066 6f72 6d61 742e 2222 220a   DOT format.""".
+00004120: 2020 2020 2020 2020 6672 6f6d 206e 6574          from net
+00004130: 776f 726b 782e 6472 6177 696e 672e 6e78  workx.drawing.nx
+00004140: 5f61 6772 6170 6820 696d 706f 7274 2077  _agraph import w
+00004150: 7269 7465 5f64 6f74 0a0a 2020 2020 2020  rite_dot..      
+00004160: 2020 6669 6c65 7061 7468 203d 2066 696c    filepath = fil
+00004170: 6570 6174 6820 6f72 2066 227b 7365 6c66  epath or f"{self
+00004180: 2e6e 616d 657d 2e64 6f74 220a 0a20 2020  .name}.dot"..   
+00004190: 2020 2020 2047 203d 2073 656c 662e 706c       G = self.pl
+000041a0: 6f74 5f6e 6574 6c69 7374 2829 0a20 2020  ot_netlist().   
+000041b0: 2020 2020 2077 7269 7465 5f64 6f74 2847       write_dot(G
+000041c0: 2c20 6669 6c65 7061 7468 290a 0a20 2020  , filepath)..   
+000041d0: 2064 6566 2067 6574 5f6e 6574 6c69 7374   def get_netlist
+000041e0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+000041f0: 202d 3e20 4469 6374 5b73 7472 2c20 416e   -> Dict[str, An
+00004200: 795d 3a0a 2020 2020 2020 2020 2222 2246  y]:.        """F
+00004210: 726f 6d20 436f 6d70 6f6e 656e 7420 7265  rom Component re
+00004220: 7475 726e 7320 696e 7374 616e 6365 732c  turns instances,
+00004230: 2063 6f6e 6e65 6374 696f 6e73 2061 6e64   connections and
+00004240: 2070 6c61 6365 6d65 6e74 7320 6469 6374   placements dict
+00004250: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
+00004260: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
+00004270: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
+00004280: 746f 2065 7874 7261 6374 206e 6574 6c69  to extract netli
+00004290: 7374 2e0a 2020 2020 2020 2020 2020 2020  st..            
+000042a0: 6675 6c6c 5f73 6574 7469 6e67 733a 2054  full_settings: T
+000042b0: 7275 6520 7265 7475 726e 7320 616c 6c2c  rue returns all,
+000042c0: 2066 616c 7365 2063 6861 6e67 6564 2073   false changed s
+000042d0: 6574 7469 6e67 732e 0a20 2020 2020 2020  ettings..       
+000042e0: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
+000042f0: 746f 6c65 7261 6e63 6520 696e 206e 6d20  tolerance in nm 
+00004300: 746f 2063 6f6e 7369 6465 7220 7477 6f20  to consider two 
+00004310: 706f 7274 7320 636f 6e6e 6563 7465 642e  ports connected.
+00004320: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00004330: 6c75 6465 5f70 6f72 745f 7479 7065 733a  lude_port_types:
+00004340: 206f 7074 696f 6e61 6c20 6c69 7374 206f   optional list o
+00004350: 6620 706f 7274 2074 7970 6573 2074 6f20  f port types to 
+00004360: 6578 636c 7564 6520 6672 6f6d 206e 6574  exclude from net
+00004370: 6c69 7374 696e 672e 0a20 2020 2020 2020  listing..       
+00004380: 2020 2020 2067 6574 5f69 6e73 7461 6e63       get_instanc
+00004390: 655f 6e61 6d65 3a20 6675 6e63 7469 6f6e  e_name: function
+000043a0: 2074 6f20 6765 7420 696e 7374 616e 6365   to get instance
+000043b0: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+000043c0: 2020 2061 6c6c 6f77 5f6d 756c 7469 706c     allow_multipl
+000043d0: 653a 2046 616c 7365 2074 6f20 7261 6973  e: False to rais
+000043e0: 6520 616e 2065 7272 6f72 2069 6620 6d6f  e an error if mo
+000043f0: 7265 2074 6861 6e20 7477 6f20 706f 7274  re than two port
+00004400: 7320 7368 6172 6520 7468 6520 7361 6d65  s share the same
+00004410: 2063 6f6e 6e65 6374 696f 6e2e 0a20 2020   connection..   
+00004420: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004430: 5472 7565 2c20 7769 6c6c 2072 6574 7572  True, will retur
+00004440: 6e20 6b65 793a 205b 7661 6c75 655d 2070  n key: [value] p
+00004450: 6169 7273 2077 6974 6820 5b76 616c 7565  airs with [value
+00004460: 5d20 6120 6c69 7374 206f 6620 616c 6c20  ] a list of all 
+00004470: 636f 6e6e 6563 7465 6420 696e 7374 616e  connected instan
+00004480: 6365 732e 0a0a 2020 2020 2020 2020 5265  ces...        Re
+00004490: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
+000044a0: 2020 204e 6574 6c69 7374 2064 6963 7420     Netlist dict 
+000044b0: 2869 6e73 7461 6e63 6573 2c20 636f 6e6e  (instances, conn
+000044c0: 6563 7469 6f6e 732c 2070 6c61 6365 6d65  ections, placeme
+000044d0: 6e74 732c 2070 6f72 7473 290a 2020 2020  nts, ports).    
+000044e0: 2020 2020 2020 2020 2020 2020 696e 7374              inst
+000044f0: 616e 6365 733a 2044 6963 7420 6f66 2069  ances: Dict of i
+00004500: 6e73 7461 6e63 6520 6e61 6d65 2061 6e64  nstance name and
+00004510: 2073 6574 7469 6e67 732e 0a20 2020 2020   settings..     
+00004520: 2020 2020 2020 2020 2020 2063 6f6e 6e65             conne
+00004530: 6374 696f 6e73 3a20 4469 6374 206f 6620  ctions: Dict of 
+00004540: 496e 7374 616e 6365 314e 616d 652c 706f  Instance1Name,po
+00004550: 7274 4e61 6d65 3a20 496e 7374 616e 6365  rtName: Instance
+00004560: 324e 616d 652c 706f 7274 4e61 6d65 2e0a  2Name,portName..
+00004570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004580: 706c 6163 656d 656e 7473 3a20 4469 6374  placements: Dict
+00004590: 206f 6620 696e 7374 616e 6365 206e 616d   of instance nam
+000045a0: 6573 2061 6e64 2070 6c61 6365 6d65 6e74  es and placement
+000045b0: 7320 2878 2c20 792c 2072 6f74 6174 696f  s (x, y, rotatio
+000045c0: 6e29 2e0a 2020 2020 2020 2020 2020 2020  n)..            
+000045d0: 2020 2020 706f 7274 733a 2044 6963 7420      ports: Dict 
+000045e0: 706f 7274 4e61 6d65 3a20 436f 6d70 6f6e  portName: Compon
+000045f0: 656e 744e 616d 652c 706f 7274 2e0a 2020  entName,port..  
+00004600: 2020 2020 2020 2020 2020 2020 2020 6e61                na
+00004610: 6d65 3a20 6e61 6d65 206f 6620 636f 6d70  me: name of comp
+00004620: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
+00004630: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00004640: 6764 7366 6163 746f 7279 2e67 6574 5f6e  gdsfactory.get_n
+00004650: 6574 6c69 7374 2069 6d70 6f72 7420 6765  etlist import ge
+00004660: 745f 6e65 746c 6973 740a 0a20 2020 2020  t_netlist..     
+00004670: 2020 2072 6574 7572 6e20 6765 745f 6e65     return get_ne
+00004680: 746c 6973 7428 636f 6d70 6f6e 656e 743d  tlist(component=
+00004690: 7365 6c66 2c20 2a2a 6b77 6172 6773 290a  self, **kwargs).
+000046a0: 0a20 2020 2064 6566 2067 6574 5f6e 6574  .    def get_net
+000046b0: 6c69 7374 5f72 6563 7572 7369 7665 2873  list_recursive(s
+000046c0: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
+000046d0: 3e20 4469 6374 5b73 7472 2c20 4469 6374  > Dict[str, Dict
+000046e0: 436f 6e66 6967 5d3a 0a20 2020 2020 2020  Config]:.       
+000046f0: 2022 2222 5265 7475 726e 7320 7265 6375   """Returns recu
+00004700: 7273 6976 6520 6e65 746c 6973 7420 666f  rsive netlist fo
+00004710: 7220 6120 636f 6d70 6f6e 656e 7420 616e  r a component an
+00004720: 6420 7375 6263 6f6d 706f 6e65 6e74 732e  d subcomponents.
+00004730: 0a0a 2020 2020 2020 2020 4b65 7977 6f72  ..        Keywor
+00004740: 6420 4172 6773 3a0a 2020 2020 2020 2020  d Args:.        
+00004750: 2020 2020 636f 6d70 6f6e 656e 743a 2074      component: t
+00004760: 6f20 6578 7472 6163 7420 6e65 746c 6973  o extract netlis
+00004770: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
+00004780: 6f6d 706f 6e65 6e74 5f73 7566 6669 783a  omponent_suffix:
+00004790: 2073 7566 6669 7820 746f 2061 7070 656e   suffix to appen
+000047a0: 6420 746f 2065 6163 6820 636f 6d70 6f6e  d to each compon
+000047b0: 656e 7420 6e61 6d65 2e0a 2020 2020 2020  ent name..      
+000047c0: 2020 2020 2020 2020 2020 7573 6566 756c            useful
+000047d0: 2069 6620 746f 2073 6176 6520 616e 6420   if to save and 
+000047e0: 7265 6c6f 6164 2061 2062 6163 6b2d 616e  reload a back-an
+000047f0: 6e6f 7461 7465 6420 6e65 746c 6973 742e  notated netlist.
+00004800: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
+00004810: 5f6e 6574 6c69 7374 5f66 756e 633a 2066  _netlist_func: f
+00004820: 756e 6374 696f 6e20 746f 2065 7874 7261  unction to extra
+00004830: 6374 2069 6e64 6976 6964 7561 6c20 6e65  ct individual ne
+00004840: 746c 6973 7473 2e0a 2020 2020 2020 2020  tlists..        
+00004850: 2020 2020 6675 6c6c 5f73 6574 7469 6e67      full_setting
+00004860: 733a 2054 7275 6520 7265 7475 726e 7320  s: True returns 
+00004870: 616c 6c2c 2066 616c 7365 2063 6861 6e67  all, false chang
+00004880: 6564 2073 6574 7469 6e67 732e 0a20 2020  ed settings..   
+00004890: 2020 2020 2020 2020 2074 6f6c 6572 616e           toleran
+000048a0: 6365 3a20 746f 6c65 7261 6e63 6520 696e  ce: tolerance in
+000048b0: 206e 6d20 746f 2063 6f6e 7369 6465 7220   nm to consider 
+000048c0: 7477 6f20 706f 7274 7320 636f 6e6e 6563  two ports connec
+000048d0: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
+000048e0: 2065 7863 6c75 6465 5f70 6f72 745f 7479   exclude_port_ty
+000048f0: 7065 733a 206f 7074 696f 6e61 6c20 6c69  pes: optional li
+00004900: 7374 206f 6620 706f 7274 2074 7970 6573  st of port types
+00004910: 2074 6f20 6578 636c 7564 6520 6672 6f6d   to exclude from
+00004920: 206e 6574 6c69 7374 696e 672e 0a20 2020   netlisting..   
+00004930: 2020 2020 2020 2020 2067 6574 5f69 6e73           get_ins
+00004940: 7461 6e63 655f 6e61 6d65 3a20 6675 6e63  tance_name: func
+00004950: 7469 6f6e 2074 6f20 6765 7420 696e 7374  tion to get inst
+00004960: 616e 6365 206e 616d 652e 0a20 2020 2020  ance name..     
+00004970: 2020 2020 2020 2061 6c6c 6f77 5f6d 756c         allow_mul
+00004980: 7469 706c 653a 2046 616c 7365 2074 6f20  tiple: False to 
+00004990: 7261 6973 6520 616e 2065 7272 6f72 2069  raise an error i
+000049a0: 6620 6d6f 7265 2074 6861 6e20 7477 6f20  f more than two 
+000049b0: 706f 7274 7320 7368 6172 6520 7468 6520  ports share the 
+000049c0: 7361 6d65 2063 6f6e 6e65 6374 696f 6e2e  same connection.
+000049d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000049e0: 2069 6620 5472 7565 2c20 7769 6c6c 2072   if True, will r
+000049f0: 6574 7572 6e20 6b65 793a 205b 7661 6c75  eturn key: [valu
+00004a00: 655d 2070 6169 7273 2077 6974 6820 5b76  e] pairs with [v
+00004a10: 616c 7565 5d20 6120 6c69 7374 206f 6620  alue] a list of 
+00004a20: 616c 6c20 636f 6e6e 6563 7465 6420 696e  all connected in
+00004a30: 7374 616e 6365 732e 0a0a 2020 2020 2020  stances...      
+00004a40: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00004a50: 2020 2020 2020 2044 6963 7469 6f6e 6172         Dictionar
+00004a60: 7920 6f66 206e 6574 6c69 7374 732c 206b  y of netlists, k
+00004a70: 6579 6564 2062 7920 7468 6520 6e61 6d65  eyed by the name
+00004a80: 206f 6620 6561 6368 2063 6f6d 706f 6e65   of each compone
+00004a90: 6e74 2e0a 2020 2020 2020 2020 2222 220a  nt..        """.
+00004aa0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+00004ab0: 6661 6374 6f72 792e 6765 745f 6e65 746c  factory.get_netl
+00004ac0: 6973 7420 696d 706f 7274 2067 6574 5f6e  ist import get_n
+00004ad0: 6574 6c69 7374 5f72 6563 7572 7369 7665  etlist_recursive
+00004ae0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00004af0: 2067 6574 5f6e 6574 6c69 7374 5f72 6563   get_netlist_rec
+00004b00: 7572 7369 7665 2863 6f6d 706f 6e65 6e74  ursive(component
+00004b10: 3d73 656c 662c 202a 2a6b 7761 7267 7329  =self, **kwargs)
+00004b20: 0a0a 2020 2020 6465 6620 6765 745f 6e65  ..    def get_ne
+00004b30: 746c 6973 745f 666c 6174 2873 656c 662c  tlist_flat(self,
+00004b40: 202a 2a6b 7761 7267 7329 202d 3e20 4469   **kwargs) -> Di
+00004b50: 6374 5b73 7472 2c20 4469 6374 436f 6e66  ct[str, DictConf
+00004b60: 6967 5d3a 0a20 2020 2020 2020 2022 2222  ig]:.        """
+00004b70: 5265 7475 726e 7320 6120 6e65 746c 6973  Returns a netlis
+00004b80: 7420 7768 6572 6520 616c 6c20 7375 6269  t where all subi
+00004b90: 6e73 7461 6e63 6573 2061 7265 2065 7870  nstances are exp
+00004ba0: 6f73 6564 2061 6e64 2069 6e64 6570 656e  osed and indepen
+00004bb0: 6465 6e74 6c79 206e 616d 6564 2e0a 0a20  dently named... 
+00004bc0: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
+00004bd0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00004be0: 2063 6f6d 706f 6e65 6e74 3a20 746f 2065   component: to e
+00004bf0: 7874 7261 6374 206e 6574 6c69 7374 2e0a  xtract netlist..
+00004c00: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00004c10: 6f6e 656e 745f 7375 6666 6978 3a20 7375  onent_suffix: su
+00004c20: 6666 6978 2074 6f20 6170 7065 6e64 2074  ffix to append t
+00004c30: 6f20 6561 6368 2063 6f6d 706f 6e65 6e74  o each component
+00004c40: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+00004c50: 2020 2020 2020 2075 7365 6675 6c20 6966         useful if
+00004c60: 2074 6f20 7361 7665 2061 6e64 2072 656c   to save and rel
+00004c70: 6f61 6420 6120 6261 636b 2d61 6e6e 6f74  oad a back-annot
+00004c80: 6174 6564 206e 6574 6c69 7374 2e0a 2020  ated netlist..  
+00004c90: 2020 2020 2020 2020 2020 6765 745f 6e65            get_ne
+00004ca0: 746c 6973 745f 6675 6e63 3a20 6675 6e63  tlist_func: func
+00004cb0: 7469 6f6e 2074 6f20 6578 7472 6163 7420  tion to extract 
+00004cc0: 696e 6469 7669 6475 616c 206e 6574 6c69  individual netli
+00004cd0: 7374 732e 0a20 2020 2020 2020 2020 2020  sts..           
+00004ce0: 2066 756c 6c5f 7365 7474 696e 6773 3a20   full_settings: 
+00004cf0: 5472 7565 2072 6574 7572 6e73 2061 6c6c  True returns all
+00004d00: 2c20 6661 6c73 6520 6368 616e 6765 6420  , false changed 
+00004d10: 7365 7474 696e 6773 2e0a 2020 2020 2020  settings..      
+00004d20: 2020 2020 2020 746f 6c65 7261 6e63 653a        tolerance:
+00004d30: 2074 6f6c 6572 616e 6365 2069 6e20 6e6d   tolerance in nm
+00004d40: 2074 6f20 636f 6e73 6964 6572 2074 776f   to consider two
+00004d50: 2070 6f72 7473 2063 6f6e 6e65 6374 6564   ports connected
+00004d60: 2e0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00004d70: 636c 7564 655f 706f 7274 5f74 7970 6573  clude_port_types
+00004d80: 3a20 6f70 7469 6f6e 616c 206c 6973 7420  : optional list 
+00004d90: 6f66 2070 6f72 7420 7479 7065 7320 746f  of port types to
+00004da0: 2065 7863 6c75 6465 2066 726f 6d20 6e65   exclude from ne
+00004db0: 746c 6973 7469 6e67 2e0a 2020 2020 2020  tlisting..      
+00004dc0: 2020 2020 2020 6765 745f 696e 7374 616e        get_instan
+00004dd0: 6365 5f6e 616d 653a 2066 756e 6374 696f  ce_name: functio
+00004de0: 6e20 746f 2067 6574 2069 6e73 7461 6e63  n to get instanc
+00004df0: 6520 6e61 6d65 2e0a 2020 2020 2020 2020  e name..        
+00004e00: 2020 2020 616c 6c6f 775f 6d75 6c74 6970      allow_multip
+00004e10: 6c65 3a20 4661 6c73 6520 746f 2072 6169  le: False to rai
+00004e20: 7365 2061 6e20 6572 726f 7220 6966 206d  se an error if m
+00004e30: 6f72 6520 7468 616e 2074 776f 2070 6f72  ore than two por
+00004e40: 7473 2073 6861 7265 2074 6865 2073 616d  ts share the sam
+00004e50: 6520 636f 6e6e 6563 7469 6f6e 2e0a 2020  e connection..  
+00004e60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00004e70: 2054 7275 652c 2077 696c 6c20 7265 7475   True, will retu
+00004e80: 726e 206b 6579 3a20 5b76 616c 7565 5d20  rn key: [value] 
+00004e90: 7061 6972 7320 7769 7468 205b 7661 6c75  pairs with [valu
+00004ea0: 655d 2061 206c 6973 7420 6f66 2061 6c6c  e] a list of all
+00004eb0: 2063 6f6e 6e65 6374 6564 2069 6e73 7461   connected insta
+00004ec0: 6e63 6573 2e0a 0a20 2020 2020 2020 2052  nces...        R
+00004ed0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00004ee0: 2020 2020 4469 6374 696f 6e61 7279 206f      Dictionary o
+00004ef0: 6620 6e65 746c 6973 7473 2c20 6b65 7965  f netlists, keye
+00004f00: 6420 6279 2074 6865 206e 616d 6520 6f66  d by the name of
+00004f10: 2065 6163 6820 636f 6d70 6f6e 656e 742e   each component.
+00004f20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00004f30: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+00004f40: 746f 7279 2e67 6574 5f6e 6574 6c69 7374  tory.get_netlist
+00004f50: 5f66 6c61 7420 696d 706f 7274 2067 6574  _flat import get
+00004f60: 5f6e 6574 6c69 7374 5f66 6c61 740a 0a20  _netlist_flat.. 
+00004f70: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
+00004f80: 745f 6e65 746c 6973 745f 666c 6174 2863  t_netlist_flat(c
+00004f90: 6f6d 706f 6e65 6e74 3d73 656c 662c 202a  omponent=self, *
+00004fa0: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
+00004fb0: 6620 6173 7365 7274 5f70 6f72 7473 5f6f  f assert_ports_o
+00004fc0: 6e5f 6772 6964 2873 656c 662c 206e 6d3a  n_grid(self, nm:
+00004fd0: 2069 6e74 203d 2031 2920 2d3e 204e 6f6e   int = 1) -> Non
+00004fe0: 653a 0a20 2020 2020 2020 2022 2222 4173  e:.        """As
+00004ff0: 7365 7274 7320 7468 6174 2061 6c6c 2070  serts that all p
+00005000: 6f72 7473 2061 7265 206f 6e20 6772 6964  orts are on grid
+00005010: 2e22 2222 0a20 2020 2020 2020 2066 6f72  .""".        for
+00005020: 2070 6f72 7420 696e 2073 656c 662e 706f   port in self.po
+00005030: 7274 732e 7661 6c75 6573 2829 3a0a 2020  rts.values():.  
+00005040: 2020 2020 2020 2020 2020 706f 7274 2e61            port.a
+00005050: 7373 6572 745f 6f6e 5f67 7269 6428 6e6d  ssert_on_grid(nm
+00005060: 3d6e 6d29 0a0a 2020 2020 6465 6620 6765  =nm)..    def ge
+00005070: 745f 706f 7274 7328 7365 6c66 2c20 6465  t_ports(self, de
+00005080: 7074 683d 4e6f 6e65 293a 0a20 2020 2020  pth=None):.     
+00005090: 2020 2022 2222 5265 7475 726e 7320 636f     """Returns co
+000050a0: 7069 6573 206f 6620 616c 6c20 7468 6520  pies of all the 
+000050b0: 706f 7274 7320 6f66 2074 6865 2043 6f6d  ports of the Com
+000050c0: 706f 6e65 6e74 2c20 726f 7461 7465 6420  ponent, rotated 
+000050d0: 616e 6420 5c0a 2020 2020 2020 2020 2020  and \.          
+000050e0: 2020 2020 2020 7472 616e 736c 6174 6564        translated
+000050f0: 2073 6f20 7468 6174 2074 6865 7927 7265   so that they're
+00005100: 2069 6e20 7468 6569 7220 746f 702d 6c65   in their top-le
+00005110: 7665 6c20 706f 7369 7469 6f6e 2e0a 0a20  vel position... 
+00005120: 2020 2020 2020 2054 6865 2050 6f72 7473         The Ports
+00005130: 2072 6574 7572 6e65 6420 6172 6520 636f   returned are co
+00005140: 7069 6573 206f 6620 7468 6520 6f72 6967  pies of the orig
+00005150: 696e 616c 732c 2062 7574 2065 6163 6820  inals, but each 
+00005160: 636f 7079 2068 6173 2074 6865 2073 616d  copy has the sam
+00005170: 650a 2020 2020 2020 2020 6060 7569 6460  e.        ``uid`
+00005180: 6020 6173 2074 6865 206f 7269 6769 6e61  ` as the origina
+00005190: 6c20 736f 2074 6861 7420 7468 6579 2063  l so that they c
+000051a0: 616e 2062 6520 7472 6163 6564 2062 6163  an be traced bac
+000051b0: 6b20 746f 2074 6865 206f 7269 6769 6e61  k to the origina
+000051c0: 6c20 6966 206e 6565 6465 642e 0a0a 2020  l if needed...  
+000051d0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+000051e0: 2020 2020 2020 2020 6465 7074 6820 3a20          depth : 
+000051f0: 696e 7420 6f72 204e 6f6e 650a 2020 2020  int or None.    
+00005200: 2020 2020 2020 2020 2020 2020 4966 206e              If n
+00005210: 6f74 204e 6f6e 652c 2064 6566 696e 6573  ot None, defines
+00005220: 2066 726f 6d20 686f 7720 6d61 6e79 2072   from how many r
+00005230: 6566 6572 656e 6365 206c 6576 656c 7320  eference levels 
+00005240: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
+00005250: 2020 2072 6574 7269 6576 6520 506f 7274     retrieve Port
+00005260: 7320 6672 6f6d 2e0a 0a20 2020 2020 2020  s from...       
+00005270: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
+00005280: 2020 2020 2020 706f 7274 5f6c 6973 7420        port_list 
+00005290: 3a20 6c69 7374 206f 6620 506f 7274 204c  : list of Port L
+000052a0: 6973 7420 6f66 2061 6c6c 2050 6f72 7473  ist of all Ports
+000052b0: 2069 6e20 7468 6520 436f 6d70 6f6e 656e   in the Componen
+000052c0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+000052d0: 2020 2020 2020 2070 6f72 745f 6c69 7374         port_list
+000052e0: 203d 205b 702e 5f63 6f70 7928 2920 666f   = [p._copy() fo
+000052f0: 7220 7020 696e 2073 656c 662e 706f 7274  r p in self.port
+00005300: 732e 7661 6c75 6573 2829 5d0a 0a20 2020  s.values()]..   
+00005310: 2020 2020 2069 6620 6465 7074 6820 6973       if depth is
+00005320: 204e 6f6e 6520 6f72 2064 6570 7468 203e   None or depth >
+00005330: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00005340: 666f 7220 7220 696e 2073 656c 662e 7265  for r in self.re
+00005350: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
+00005360: 2020 2020 2020 2020 2020 6e65 775f 6465            new_de
+00005370: 7074 6820 3d20 4e6f 6e65 2069 6620 6465  pth = None if de
+00005380: 7074 6820 6973 204e 6f6e 6520 656c 7365  pth is None else
+00005390: 2064 6570 7468 202d 2031 0a20 2020 2020   depth - 1.     
+000053a0: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
+000053b0: 6f72 7473 203d 2072 2e70 6172 656e 742e  orts = r.parent.
+000053c0: 6765 745f 706f 7274 7328 6465 7074 683d  get_ports(depth=
+000053d0: 6e65 775f 6465 7074 6829 0a0a 2020 2020  new_depth)..    
+000053e0: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
+000053f0: 616e 7366 6f72 6d20 706f 7274 7320 7468  ansform ports th
+00005400: 6174 2063 616d 6520 6672 6f6d 2061 2072  at came from a r
+00005410: 6566 6572 656e 6365 0a20 2020 2020 2020  eference.       
+00005420: 2020 2020 2020 2020 2072 6566 5f70 6f72           ref_por
+00005430: 7473 5f74 7261 6e73 666f 726d 6564 203d  ts_transformed =
+00005440: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00005450: 2020 2020 666f 7220 7270 2069 6e20 7265      for rp in re
+00005460: 665f 706f 7274 733a 0a20 2020 2020 2020  f_ports:.       
+00005470: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00005480: 5f70 6f72 7420 3d20 7270 2e5f 636f 7079  _port = rp._copy
+00005490: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+000054a0: 2020 2020 2020 206e 6577 5f63 656e 7465         new_cente
+000054b0: 722c 206e 6577 5f6f 7269 656e 7461 7469  r, new_orientati
+000054c0: 6f6e 203d 2072 2e5f 7472 616e 7366 6f72  on = r._transfor
+000054d0: 6d5f 706f 7274 280a 2020 2020 2020 2020  m_port(.        
+000054e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054f0: 7270 2e63 656e 7465 722c 0a20 2020 2020  rp.center,.     
+00005500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005510: 2020 2072 702e 6f72 6965 6e74 6174 696f     rp.orientatio
+00005520: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00005530: 2020 2020 2020 2020 2020 2072 2e6f 7269             r.ori
+00005540: 6769 6e2c 0a20 2020 2020 2020 2020 2020  gin,.           
+00005550: 2020 2020 2020 2020 2020 2020 2072 2e72               r.r
+00005560: 6f74 6174 696f 6e2c 0a20 2020 2020 2020  otation,.       
+00005570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005580: 2072 2e78 5f72 6566 6c65 6374 696f 6e2c   r.x_reflection,
+00005590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000055a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000055b0: 2020 2020 2020 2020 2020 206e 6577 5f70             new_p
+000055c0: 6f72 742e 6365 6e74 6572 203d 206e 6577  ort.center = new
+000055d0: 5f63 656e 7465 720a 2020 2020 2020 2020  _center.        
+000055e0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+000055f0: 706f 7274 2e6e 6577 5f6f 7269 656e 7461  port.new_orienta
+00005600: 7469 6f6e 203d 206e 6577 5f6f 7269 656e  tion = new_orien
+00005610: 7461 7469 6f6e 0a20 2020 2020 2020 2020  tation.         
+00005620: 2020 2020 2020 2020 2020 2072 6566 5f70             ref_p
+00005630: 6f72 7473 5f74 7261 6e73 666f 726d 6564  orts_transformed
+00005640: 2e61 7070 656e 6428 6e65 775f 706f 7274  .append(new_port
+00005650: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00005660: 2020 706f 7274 5f6c 6973 7420 2b3d 2072    port_list += r
+00005670: 6566 5f70 6f72 7473 5f74 7261 6e73 666f  ef_ports_transfo
+00005680: 726d 6564 0a0a 2020 2020 2020 2020 7265  rmed..        re
+00005690: 7475 726e 2070 6f72 745f 6c69 7374 0a0a  turn port_list..
+000056a0: 2020 2020 6465 6620 6765 745f 706f 7274      def get_port
+000056b0: 735f 6469 6374 2873 656c 662c 202a 2a6b  s_dict(self, **k
+000056c0: 7761 7267 7329 202d 3e20 4469 6374 5b73  wargs) -> Dict[s
+000056d0: 7472 2c20 506f 7274 5d3a 0a20 2020 2020  tr, Port]:.     
+000056e0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
+000056f0: 6469 6374 206f 6620 706f 7274 732e 0a0a  dict of ports...
+00005700: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+00005710: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00005720: 2020 6c61 7965 723a 2070 6f72 7420 4744    layer: port GD
+00005730: 5320 6c61 7965 722e 0a20 2020 2020 2020  S layer..       
+00005740: 2020 2020 2070 7265 6669 783a 2073 656c       prefix: sel
+00005750: 6563 7420 706f 7274 7320 7769 7468 2070  ect ports with p
+00005760: 7265 6669 7820 696e 2070 6f72 7420 6e61  refix in port na
+00005770: 6d65 2e0a 2020 2020 2020 2020 2020 2020  me..            
+00005780: 7375 6666 6978 3a20 7365 6c65 6374 2070  suffix: select p
+00005790: 6f72 7473 2077 6974 6820 706f 7274 206e  orts with port n
+000057a0: 616d 6520 7375 6666 6978 2e0a 2020 2020  ame suffix..    
+000057b0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
+000057c0: 696f 6e3a 2073 656c 6563 7420 706f 7274  ion: select port
+000057d0: 7320 7769 7468 206f 7269 656e 7461 7469  s with orientati
+000057e0: 6f6e 2069 6e20 6465 6772 6565 732e 0a20  on in degrees.. 
+000057f0: 2020 2020 2020 2020 2020 2077 6964 7468             width
+00005800: 3a20 7365 6c65 6374 2070 6f72 7473 2077  : select ports w
+00005810: 6974 6820 706f 7274 2077 6964 7468 2e0a  ith port width..
+00005820: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+00005830: 7273 5f65 7863 6c75 6465 643a 204c 6973  rs_excluded: Lis
+00005840: 7420 6f66 206c 6179 6572 7320 746f 2065  t of layers to e
+00005850: 7863 6c75 6465 2e0a 2020 2020 2020 2020  xclude..        
+00005860: 2020 2020 706f 7274 5f74 7970 653a 2073      port_type: s
+00005870: 656c 6563 7420 706f 7274 7320 7769 7468  elect ports with
+00005880: 2070 6f72 745f 7479 7065 2028 6f70 7469   port_type (opti
+00005890: 6361 6c2c 2065 6c65 6374 7269 6361 6c2c  cal, electrical,
+000058a0: 2076 6572 7469 6361 6c5f 7465 292e 0a20   vertical_te).. 
+000058b0: 2020 2020 2020 2020 2020 2063 6c6f 636b             clock
+000058c0: 7769 7365 3a20 6966 2054 7275 652c 2073  wise: if True, s
+000058d0: 6f72 7420 706f 7274 7320 636c 6f63 6b77  ort ports clockw
+000058e0: 6973 652c 2046 616c 7365 3a20 636f 756e  ise, False: coun
+000058f0: 7465 722d 636c 6f63 6b77 6973 652e 0a20  ter-clockwise.. 
+00005900: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00005910: 2020 2072 6574 7572 6e20 7365 6c65 6374     return select
+00005920: 5f70 6f72 7473 2873 656c 662e 706f 7274  _ports(self.port
+00005930: 732c 202a 2a6b 7761 7267 7329 0a0a 2020  s, **kwargs)..  
+00005940: 2020 6465 6620 6765 745f 706f 7274 735f    def get_ports_
+00005950: 6c69 7374 2873 656c 662c 202a 2a6b 7761  list(self, **kwa
+00005960: 7267 7329 202d 3e20 4c69 7374 5b50 6f72  rgs) -> List[Por
+00005970: 745d 3a0a 2020 2020 2020 2020 2222 2252  t]:.        """R
+00005980: 6574 7572 6e73 206c 6973 7420 6f66 2070  eturns list of p
+00005990: 6f72 7473 2e0a 0a20 2020 2020 2020 204b  orts...        K
+000059a0: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
+000059b0: 2020 2020 2020 2020 206c 6179 6572 3a20           layer: 
+000059c0: 7365 6c65 6374 2070 6f72 7473 2077 6974  select ports wit
+000059d0: 6820 4744 5320 6c61 7965 722e 0a20 2020  h GDS layer..   
+000059e0: 2020 2020 2020 2020 2070 7265 6669 783a           prefix:
+000059f0: 2073 656c 6563 7420 706f 7274 7320 7769   select ports wi
+00005a00: 7468 2070 7265 6669 7820 696e 2070 6f72  th prefix in por
+00005a10: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
+00005a20: 2020 2020 7375 6666 6978 3a20 7365 6c65      suffix: sele
+00005a30: 6374 2070 6f72 7473 2077 6974 6820 706f  ct ports with po
+00005a40: 7274 206e 616d 6520 7375 6666 6978 2e0a  rt name suffix..
+00005a50: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+00005a60: 6e74 6174 696f 6e3a 2073 656c 6563 7420  ntation: select 
+00005a70: 706f 7274 7320 7769 7468 206f 7269 656e  ports with orien
+00005a80: 7461 7469 6f6e 2069 6e20 6465 6772 6565  tation in degree
+00005a90: 732e 0a20 2020 2020 2020 2020 2020 206f  s..            o
+00005aa0: 7269 656e 7461 7469 6f6e 3a20 7365 6c65  rientation: sele
+00005ab0: 6374 2070 6f72 7473 2077 6974 6820 6f72  ct ports with or
+00005ac0: 6965 6e74 6174 696f 6e20 696e 2064 6567  ientation in deg
+00005ad0: 7265 6573 2e0a 2020 2020 2020 2020 2020  rees..          
+00005ae0: 2020 7769 6474 683a 2073 656c 6563 7420    width: select 
+00005af0: 706f 7274 7320 7769 7468 2070 6f72 7420  ports with port 
+00005b00: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
+00005b10: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
+00005b20: 6564 3a20 4c69 7374 206f 6620 6c61 7965  ed: List of laye
+00005b30: 7273 2074 6f20 6578 636c 7564 652e 0a20  rs to exclude.. 
+00005b40: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+00005b50: 7479 7065 3a20 7365 6c65 6374 2070 6f72  type: select por
+00005b60: 7473 2077 6974 6820 706f 7274 5f74 7970  ts with port_typ
+00005b70: 6520 286f 7074 6963 616c 2c20 656c 6563  e (optical, elec
+00005b80: 7472 6963 616c 2c20 7665 7274 6963 616c  trical, vertical
+00005b90: 5f74 6529 2e0a 2020 2020 2020 2020 2020  _te)..          
+00005ba0: 2020 636c 6f63 6b77 6973 653a 2069 6620    clockwise: if 
+00005bb0: 5472 7565 2c20 736f 7274 2070 6f72 7473  True, sort ports
+00005bc0: 2063 6c6f 636b 7769 7365 2c20 4661 6c73   clockwise, Fals
+00005bd0: 653a 2063 6f75 6e74 6572 2d63 6c6f 636b  e: counter-clock
+00005be0: 7769 7365 2e0a 2020 2020 2020 2020 2222  wise..        ""
+00005bf0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00005c00: 206c 6973 7428 7365 6c65 6374 5f70 6f72   list(select_por
+00005c10: 7473 2873 656c 662e 706f 7274 732c 202a  ts(self.ports, *
+00005c20: 2a6b 7761 7267 7329 2e76 616c 7565 7328  *kwargs).values(
+00005c30: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
+00005c40: 706f 7274 735f 7061 6e64 6173 2873 656c  ports_pandas(sel
+00005c50: 6629 3a0a 2020 2020 2020 2020 696d 706f  f):.        impo
+00005c60: 7274 2070 616e 6461 7320 6173 2070 640a  rt pandas as pd.
+00005c70: 0a20 2020 2020 2020 2063 6f6c 5f73 7065  .        col_spe
+00005c80: 6320 3d20 5b0a 2020 2020 2020 2020 2020  c = [.          
+00005c90: 2020 226e 616d 6522 2c0a 2020 2020 2020    "name",.      
+00005ca0: 2020 2020 2020 2277 6964 7468 222c 0a20        "width",. 
+00005cb0: 2020 2020 2020 2020 2020 2022 6365 6e74             "cent
+00005cc0: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
+00005cd0: 2022 6f72 6965 6e74 6174 696f 6e22 2c0a   "orientation",.
+00005ce0: 2020 2020 2020 2020 2020 2020 226c 6179              "lay
+00005cf0: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
+00005d00: 2022 706f 7274 5f74 7970 6522 2c0a 2020   "port_type",.  
+00005d10: 2020 2020 2020 2020 2020 2273 6865 6172            "shear
+00005d20: 5f61 6e67 6c65 222c 0a20 2020 2020 2020  _angle",.       
+00005d30: 205d 0a0a 2020 2020 2020 2020 7265 7475   ]..        retu
+00005d40: 726e 2070 642e 4461 7461 4672 616d 6528  rn pd.DataFrame(
+00005d50: 0a20 2020 2020 2020 2020 2020 205b 706f  .            [po
+00005d60: 7274 2e74 6f5f 6469 6374 2829 2066 6f72  rt.to_dict() for
+00005d70: 2070 6f72 7420 696e 2073 656c 662e 6765   port in self.ge
+00005d80: 745f 706f 7274 735f 6c69 7374 2829 5d2c  t_ports_list()],
+00005d90: 2063 6f6c 756d 6e73 3d63 6f6c 5f73 7065   columns=col_spe
+00005da0: 630a 2020 2020 2020 2020 290a 0a20 2020  c.        )..   
+00005db0: 2064 6566 2067 6574 5f70 6f72 7473 5f70   def get_ports_p
+00005dc0: 6f6c 6172 7328 7365 6c66 293a 0a20 2020  olars(self):.   
+00005dd0: 2020 2020 2069 6d70 6f72 7420 706f 6c61       import pola
+00005de0: 7273 2061 7320 706c 0a0a 2020 2020 2020  rs as pl..      
+00005df0: 2020 636f 6c5f 7370 6563 203d 207b 0a20    col_spec = {. 
+00005e00: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
+00005e10: 223a 2070 6c2e 5574 6638 2c0a 2020 2020  ": pl.Utf8,.    
+00005e20: 2020 2020 2020 2020 2277 6964 7468 223a          "width":
+00005e30: 2070 6c2e 466c 6f61 7436 342c 0a20 2020   pl.Float64,.   
+00005e40: 2020 2020 2020 2020 2022 6365 6e74 6572           "center
+00005e50: 223a 2070 6c2e 4c69 7374 2870 6c2e 466c  ": pl.List(pl.Fl
+00005e60: 6f61 7436 3429 2c0a 2020 2020 2020 2020  oat64),.        
+00005e70: 2020 2020 226f 7269 656e 7461 7469 6f6e      "orientation
+00005e80: 223a 2070 6c2e 466c 6f61 7436 342c 0a20  ": pl.Float64,. 
+00005e90: 2020 2020 2020 2020 2020 2022 6c61 7965             "laye
+00005ea0: 7222 3a20 706c 2e4c 6973 7428 706c 2e55  r": pl.List(pl.U
+00005eb0: 496e 7431 3629 2c0a 2020 2020 2020 2020  Int16),.        
+00005ec0: 2020 2020 2270 6f72 745f 7479 7065 223a      "port_type":
+00005ed0: 2070 6c2e 5574 6638 2c0a 2020 2020 2020   pl.Utf8,.      
+00005ee0: 2020 2020 2020 2273 6865 6172 5f61 6e67        "shear_ang
+00005ef0: 6c65 223a 2070 6c2e 466c 6f61 7436 342c  le": pl.Float64,
+00005f00: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+00005f10: 2020 2020 7265 7475 726e 2070 6c2e 4461      return pl.Da
+00005f20: 7461 4672 616d 6528 0a20 2020 2020 2020  taFrame(.       
+00005f30: 2020 2020 205b 706f 7274 2e74 6f5f 6469       [port.to_di
+00005f40: 6374 2829 2066 6f72 2070 6f72 7420 696e  ct() for port in
+00005f50: 2073 656c 662e 6765 745f 706f 7274 735f   self.get_ports_
+00005f60: 6c69 7374 2829 5d2c 2073 6368 656d 613d  list()], schema=
+00005f70: 636f 6c5f 7370 6563 0a20 2020 2020 2020  col_spec.       
+00005f80: 2029 0a0a 2020 2020 6465 6620 7265 6628   )..    def ref(
+00005f90: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00005fa0: 2020 2020 2020 2070 6f73 6974 696f 6e3a         position:
+00005fb0: 2043 6f6f 7264 696e 6174 6520 3d20 2830   Coordinate = (0
+00005fc0: 2c20 3029 2c0a 2020 2020 2020 2020 706f  , 0),.        po
+00005fd0: 7274 5f69 643a 204f 7074 696f 6e61 6c5b  rt_id: Optional[
+00005fe0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00005ff0: 2020 2020 2072 6f74 6174 696f 6e3a 2066       rotation: f
+00006000: 6c6f 6174 203d 2030 2c0a 2020 2020 2020  loat = 0,.      
+00006010: 2020 685f 6d69 7272 6f72 3a20 626f 6f6c    h_mirror: bool
+00006020: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+00006030: 2020 765f 6d69 7272 6f72 3a20 626f 6f6c    v_mirror: bool
+00006040: 203d 2046 616c 7365 2c0a 2020 2020 2920   = False,.    ) 
+00006050: 2d3e 2043 6f6d 706f 6e65 6e74 5265 6665  -> ComponentRefe
+00006060: 7265 6e63 653a 0a20 2020 2020 2020 2022  rence:.        "
+00006070: 2222 5265 7475 726e 7320 436f 6d70 6f6e  ""Returns Compon
+00006080: 656e 7420 7265 6665 7265 6e63 652e 0a0a  ent reference...
+00006090: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+000060a0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+000060b0: 6f6e 3a20 782c 2079 2070 6f73 6974 696f  on: x, y positio
+000060c0: 6e2e 0a20 2020 2020 2020 2020 2020 2070  n..            p
+000060d0: 6f72 745f 6964 3a20 6e61 6d65 206f 6620  ort_id: name of 
+000060e0: 7468 6520 706f 7274 2e0a 2020 2020 2020  the port..      
+000060f0: 2020 2020 2020 726f 7461 7469 6f6e 3a20        rotation: 
+00006100: 696e 2064 6567 7265 6573 2e0a 2020 2020  in degrees..    
+00006110: 2020 2020 2020 2020 685f 6d69 7272 6f72          h_mirror
+00006120: 3a20 686f 7269 7a6f 6e74 616c 206d 6972  : horizontal mir
+00006130: 726f 7220 7573 696e 6720 7920 6178 6973  ror using y axis
+00006140: 2028 782c 2031 2920 2831 2c20 3029 2e0a   (x, 1) (1, 0)..
+00006150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006160: 5468 6973 2069 7320 7468 6520 6d6f 7374  This is the most
+00006170: 2063 6f6d 6d6f 6e20 6d69 7272 6f72 2e0a   common mirror..
+00006180: 2020 2020 2020 2020 2020 2020 765f 6d69              v_mi
+00006190: 7272 6f72 3a20 7665 7274 6963 616c 206d  rror: vertical m
+000061a0: 6972 726f 7220 7573 696e 6720 7820 6178  irror using x ax
+000061b0: 6973 2028 312c 2079 2920 2830 2c20 7929  is (1, y) (0, y)
+000061c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000061d0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
+000061e0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
+000061f0: 7365 6c66 290a 0a20 2020 2020 2020 2069  self)..        i
+00006200: 6620 706f 7274 5f69 6420 616e 6420 706f  f port_id and po
+00006210: 7274 5f69 6420 6e6f 7420 696e 2073 656c  rt_id not in sel
+00006220: 662e 706f 7274 733a 0a20 2020 2020 2020  f.ports:.       
+00006230: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00006240: 4572 726f 7228 6622 706f 7274 207b 706f  Error(f"port {po
+00006250: 7274 5f69 647d 206e 6f74 2069 6e20 7b73  rt_id} not in {s
+00006260: 656c 662e 706f 7274 732e 6b65 7973 2829  elf.ports.keys()
+00006270: 7d22 290a 0a20 2020 2020 2020 206f 7269  }")..        ori
+00006280: 6769 6e20 3d20 7365 6c66 2e70 6f72 7473  gin = self.ports
+00006290: 5b70 6f72 745f 6964 5d2e 6365 6e74 6572  [port_id].center
+000062a0: 2069 6620 706f 7274 5f69 6420 656c 7365   if port_id else
+000062b0: 2028 302c 2030 290a 2020 2020 2020 2020   (0, 0).        
+000062c0: 6966 2068 5f6d 6972 726f 723a 0a20 2020  if h_mirror:.   
+000062d0: 2020 2020 2020 2020 205f 7265 662e 6d69           _ref.mi
+000062e0: 7272 6f72 5f78 2870 6f72 745f 6964 290a  rror_x(port_id).
+000062f0: 0a20 2020 2020 2020 2069 6620 765f 6d69  .        if v_mi
+00006300: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00006310: 2020 5f72 6566 2e6d 6972 726f 725f 7928    _ref.mirror_y(
+00006320: 706f 7274 5f69 6429 0a0a 2020 2020 2020  port_id)..      
+00006330: 2020 6966 2072 6f74 6174 696f 6e20 213d    if rotation !=
+00006340: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00006350: 5f72 6566 2e72 6f74 6174 6528 726f 7461  _ref.rotate(rota
+00006360: 7469 6f6e 2c20 6f72 6967 696e 290a 2020  tion, origin).  
+00006370: 2020 2020 2020 5f72 6566 2e6d 6f76 6528        _ref.move(
+00006380: 6f72 6967 696e 2c20 706f 7369 7469 6f6e  origin, position
+00006390: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000063a0: 6e20 5f72 6566 0a0a 2020 2020 6465 6620  n _ref..    def 
+000063b0: 7265 665f 6365 6e74 6572 2873 656c 662c  ref_center(self,
+000063c0: 2070 6f73 6974 696f 6e3d 2830 2c20 3029   position=(0, 0)
+000063d0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+000063e0: 7475 726e 7320 6120 7265 6665 7265 6e63  turns a referenc
+000063f0: 6520 6f66 2074 6865 2063 6f6d 706f 6e65  e of the compone
+00006400: 6e74 2063 656e 7465 7265 6420 6174 2028  nt centered at (
+00006410: 783d 302c 2079 3d30 292e 2222 220a 2020  x=0, y=0).""".  
+00006420: 2020 2020 2020 7369 203d 2073 656c 662e        si = self.
+00006430: 7369 7a65 5f69 6e66 6f0a 2020 2020 2020  size_info.      
+00006440: 2020 7963 203d 2073 692e 736f 7574 6820    yc = si.south 
+00006450: 2b20 7369 2e68 6569 6768 7420 2f20 320a  + si.height / 2.
+00006460: 2020 2020 2020 2020 7863 203d 2073 692e          xc = si.
+00006470: 7765 7374 202b 2073 692e 7769 6474 6820  west + si.width 
+00006480: 2f20 320a 2020 2020 2020 2020 6365 6e74  / 2.        cent
+00006490: 6572 203d 2028 7863 2c20 7963 290a 2020  er = (xc, yc).  
+000064a0: 2020 2020 2020 5f72 6566 203d 2043 6f6d        _ref = Com
+000064b0: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
+000064c0: 7365 6c66 290a 2020 2020 2020 2020 5f72  self).        _r
+000064d0: 6566 2e6d 6f76 6528 6365 6e74 6572 2c20  ef.move(center, 
+000064e0: 706f 7369 7469 6f6e 290a 2020 2020 2020  position).      
+000064f0: 2020 7265 7475 726e 205f 7265 660a 0a20    return _ref.. 
+00006500: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+00006510: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
+00006520: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+00006530: 6120 7374 7269 6e67 2072 6570 7265 7365  a string represe
+00006540: 6e74 6174 696f 6e20 6f66 2074 6865 206f  ntation of the o
+00006550: 626a 6563 742e 2222 220a 2020 2020 2020  bject.""".      
+00006560: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+00006570: 2020 2020 2020 2066 227b 7365 6c66 2e6e         f"{self.n
+00006580: 616d 657d 3a20 7569 6420 7b73 656c 662e  ame}: uid {self.
+00006590: 7569 647d 2c20 220a 2020 2020 2020 2020  uid}, ".        
+000065a0: 2020 2020 6622 706f 7274 7320 7b6c 6973      f"ports {lis
+000065b0: 7428 7365 6c66 2e70 6f72 7473 2e6b 6579  t(self.ports.key
+000065c0: 7328 2929 7d2c 2022 0a20 2020 2020 2020  s())}, ".       
+000065d0: 2020 2020 2066 2272 6566 6572 656e 6365       f"reference
+000065e0: 7320 7b6c 6973 7428 7365 6c66 2e6e 616d  s {list(self.nam
+000065f0: 6564 5f72 6566 6572 656e 6365 732e 6b65  ed_references.ke
+00006600: 7973 2829 297d 2c20 220a 2020 2020 2020  ys())}, ".      
+00006610: 2020 2020 2020 6622 7b6c 656e 2873 656c        f"{len(sel
+00006620: 662e 706f 6c79 676f 6e73 297d 2070 6f6c  f.polygons)} pol
+00006630: 7967 6f6e 7322 0a20 2020 2020 2020 2029  ygons".        )
+00006640: 0a0a 2020 2020 6465 6620 7070 7269 6e74  ..    def pprint
+00006650: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
+00006660: 2020 2020 2020 2020 2222 2250 7269 6e74          """Print
+00006670: 7320 636f 6d70 6f6e 656e 7420 696e 666f  s component info
+00006680: 2e22 2222 0a20 2020 2020 2020 2074 7279  .""".        try
+00006690: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
+000066a0: 6f6d 2072 6963 6820 696d 706f 7274 2070  om rich import p
+000066b0: 7265 7474 790a 0a20 2020 2020 2020 2020  retty..         
+000066c0: 2020 2070 7265 7474 792e 696e 7374 616c     pretty.instal
+000066d0: 6c28 290a 2020 2020 2020 2020 2020 2020  l().            
+000066e0: 7072 6574 7479 2e70 7072 696e 7428 7365  pretty.pprint(se
+000066f0: 6c66 2e74 6f5f 6469 6374 2829 290a 2020  lf.to_dict()).  
+00006700: 2020 2020 2020 6578 6365 7074 2049 6d70        except Imp
+00006710: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
+00006720: 2020 2020 2020 7072 696e 7428 7961 6d6c        print(yaml
+00006730: 2e64 756d 7028 7365 6c66 2e74 6f5f 6469  .dump(self.to_di
+00006740: 6374 2829 2929 0a0a 2020 2020 6465 6620  ct()))..    def 
+00006750: 7070 7269 6e74 5f70 6f72 7473 2873 656c  pprint_ports(sel
+00006760: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00006770: 2020 2020 2222 2250 7269 6e74 7320 636f      """Prints co
+00006780: 6d70 6f6e 656e 7420 6e65 746c 6973 7473  mponent netlists
+00006790: 2e22 2222 0a20 2020 2020 2020 2070 6f72  .""".        por
+000067a0: 7473 5f6c 6973 7420 3d20 7365 6c66 2e67  ts_list = self.g
+000067b0: 6574 5f70 6f72 7473 5f6c 6973 7428 290a  et_ports_list().
+000067c0: 2020 2020 2020 2020 666f 7220 706f 7274          for port
+000067d0: 2069 6e20 706f 7274 735f 6c69 7374 3a0a   in ports_list:.
 000067e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000067f0: 7428 7961 6d6c 2e64 756d 7028 7365 6c66  t(yaml.dump(self
-00006800: 2e74 6f5f 6469 6374 2829 2929 0a0a 2020  .to_dict()))..  
-00006810: 2020 6465 6620 7070 7269 6e74 5f70 6f72    def pprint_por
-00006820: 7473 2873 656c 6629 202d 3e20 4e6f 6e65  ts(self) -> None
-00006830: 3a0a 2020 2020 2020 2020 2222 2250 7269  :.        """Pri
-00006840: 6e74 7320 636f 6d70 6f6e 656e 7420 6e65  nts component ne
-00006850: 746c 6973 7473 2e22 2222 0a20 2020 2020  tlists.""".     
-00006860: 2020 2070 6f72 7473 5f6c 6973 7420 3d20     ports_list = 
-00006870: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
-00006880: 6973 7428 290a 2020 2020 2020 2020 666f  ist().        fo
-00006890: 7220 706f 7274 2069 6e20 706f 7274 735f  r port in ports_
-000068a0: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
-000068b0: 2020 7072 696e 7428 706f 7274 290a 0a20    print(port).. 
-000068c0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-000068d0: 2064 6566 206d 6574 6164 6174 615f 6368   def metadata_ch
-000068e0: 696c 6428 7365 6c66 2920 2d3e 2044 6963  ild(self) -> Dic
-000068f0: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-00006900: 7475 726e 7320 6d65 7461 6461 7461 2066  turns metadata f
-00006910: 726f 6d20 6368 696c 6420 6966 2061 6e79  rom child if any
-00006920: 2c20 4f74 6865 7277 6973 6520 7265 7475  , Otherwise retu
-00006930: 726e 7320 636f 6d70 6f6e 656e 7420 6f77  rns component ow
-00006940: 6e2e 0a0a 2020 2020 2020 2020 6d65 7461  n...        meta
-00006950: 6461 7461 2047 7265 6174 2074 6f20 6163  data Great to ac
-00006960: 6365 7373 2074 6865 2063 6869 6c64 7265  cess the childre
-00006970: 6e20 6d65 7461 6461 7461 2061 7420 7468  n metadata at th
-00006980: 6520 626f 7474 6f6d 206f 6620 7468 650a  e bottom of the.
-00006990: 2020 2020 2020 2020 6869 6572 6172 6368          hierarch
-000069a0: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
-000069b0: 2020 2020 2020 2073 6574 7469 6e67 7320         settings 
-000069c0: 3d20 6469 6374 2873 656c 662e 7365 7474  = dict(self.sett
-000069d0: 696e 6773 290a 0a20 2020 2020 2020 2077  ings)..        w
-000069e0: 6869 6c65 2073 6574 7469 6e67 732e 6765  hile settings.ge
-000069f0: 7428 2263 6869 6c64 2229 3a0a 2020 2020  t("child"):.    
-00006a00: 2020 2020 2020 2020 7365 7474 696e 6773          settings
-00006a10: 203d 2073 6574 7469 6e67 732e 6765 7428   = settings.get(
-00006a20: 2263 6869 6c64 2229 0a0a 2020 2020 2020  "child")..      
-00006a30: 2020 7265 7475 726e 2064 6963 7428 7365    return dict(se
-00006a40: 7474 696e 6773 290a 0a20 2020 2040 7072  ttings)..    @pr
-00006a50: 6f70 6572 7479 0a20 2020 2064 6566 206d  operty.    def m
-00006a60: 6574 6164 6174 6128 7365 6c66 2920 2d3e  etadata(self) ->
-00006a70: 2044 6963 743a 0a20 2020 2020 2020 2072   Dict:.        r
-00006a80: 6574 7572 6e20 6469 6374 2873 656c 662e  eturn dict(self.
-00006a90: 7365 7474 696e 6773 290a 0a20 2020 2064  settings)..    d
-00006aa0: 6566 2061 6464 5f70 6f72 7428 0a20 2020  ef add_port(.   
-00006ab0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00006ac0: 2020 206e 616d 653a 204f 7074 696f 6e61     name: Optiona
-00006ad0: 6c5b 556e 696f 6e5b 7374 722c 206f 626a  l[Union[str, obj
-00006ae0: 6563 745d 5d20 3d20 4e6f 6e65 2c0a 2020  ect]] = None,.  
-00006af0: 2020 2020 2020 6365 6e74 6572 3a20 4f70        center: Op
-00006b00: 7469 6f6e 616c 5b54 7570 6c65 5b66 6c6f  tional[Tuple[flo
-00006b10: 6174 2c20 666c 6f61 745d 5d20 3d20 4e6f  at, float]] = No
-00006b20: 6e65 2c0a 2020 2020 2020 2020 7769 6474  ne,.        widt
-00006b30: 683a 204f 7074 696f 6e61 6c5b 666c 6f61  h: Optional[floa
-00006b40: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
-00006b50: 2020 206f 7269 656e 7461 7469 6f6e 3a20     orientation: 
-00006b60: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d20  Optional[float] 
-00006b70: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-00006b80: 706f 7274 3a20 4f70 7469 6f6e 616c 5b50  port: Optional[P
-00006b90: 6f72 745d 203d 204e 6f6e 652c 0a20 2020  ort] = None,.   
-00006ba0: 2020 2020 206c 6179 6572 3a20 4c61 7965       layer: Laye
-00006bb0: 7253 7065 6320 3d20 4e6f 6e65 2c0a 2020  rSpec = None,.  
-00006bc0: 2020 2020 2020 706f 7274 5f74 7970 653a        port_type:
-00006bd0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00006be0: 204e 6f6e 652c 0a20 2020 2020 2020 2063   None,.        c
-00006bf0: 726f 7373 5f73 6563 7469 6f6e 3a20 4f70  ross_section: Op
-00006c00: 7469 6f6e 616c 5b43 726f 7373 5365 6374  tional[CrossSect
-00006c10: 696f 6e5d 203d 204e 6f6e 652c 0a20 2020  ion] = None,.   
-00006c20: 2029 202d 3e20 506f 7274 3a0a 2020 2020   ) -> Port:.    
-00006c30: 2020 2020 2222 2241 6464 2070 6f72 7420      """Add port 
-00006c40: 746f 2063 6f6d 706f 6e65 6e74 2e0a 0a20  to component... 
-00006c50: 2020 2020 2020 2059 6f75 2063 616e 2063         You can c
-00006c60: 6f70 7920 616e 2065 7869 7374 696e 6720  opy an existing 
-00006c70: 706f 7274 206c 696b 6520 6164 645f 706f  port like add_po
-00006c80: 7274 2870 6f72 7420 3d20 6578 6973 7469  rt(port = existi
-00006c90: 6e67 5f70 6f72 7429 206f 720a 2020 2020  ng_port) or.    
-00006ca0: 2020 2020 6372 6561 7465 2061 206e 6577      create a new
-00006cb0: 2070 6f72 7420 6164 645f 706f 7274 286d   port add_port(m
-00006cc0: 796e 616d 652c 206d 7963 656e 7465 722c  yname, mycenter,
-00006cd0: 206d 7977 6964 7468 2c20 6d79 6f72 6965   mywidth, myorie
-00006ce0: 6e74 6174 696f 6e29 2e0a 2020 2020 2020  ntation)..      
-00006cf0: 2020 596f 7520 6361 6e20 616c 736f 2063    You can also c
-00006d00: 6f70 7920 616e 2065 7869 7374 696e 6720  opy an existing 
-00006d10: 706f 7274 0a20 2020 2020 2020 2077 6974  port.        wit
-00006d20: 6820 6120 6e65 7720 6e61 6d65 2061 6464  h a new name add
-00006d30: 5f70 6f72 7428 706f 7274 203d 2065 7869  _port(port = exi
-00006d40: 7374 696e 675f 706f 7274 2c20 6e61 6d65  sting_port, name
-00006d50: 203d 206e 6577 5f6e 616d 6529 0a0a 2020   = new_name)..  
-00006d60: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-00006d70: 2020 2020 2020 2020 6e61 6d65 3a20 706f          name: po
-00006d80: 7274 206e 616d 652e 0a20 2020 2020 2020  rt name..       
-00006d90: 2020 2020 2063 656e 7465 723a 2078 2c20       center: x, 
-00006da0: 792e 0a20 2020 2020 2020 2020 2020 2077  y..            w
-00006db0: 6964 7468 3a20 696e 2075 6d2e 0a20 2020  idth: in um..   
-00006dc0: 2020 2020 2020 2020 206f 7269 656e 7461           orienta
-00006dd0: 7469 6f6e 3a20 696e 2064 6567 2e0a 2020  tion: in deg..  
-00006de0: 2020 2020 2020 2020 2020 706f 7274 3a20            port: 
-00006df0: 6f70 7469 6f6e 616c 2070 6f72 742e 0a20  optional port.. 
-00006e00: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00006e10: 3a20 706f 7274 206c 6179 6572 2e0a 2020  : port layer..  
-00006e20: 2020 2020 2020 2020 2020 706f 7274 5f74            port_t
-00006e30: 7970 653a 206f 7074 6963 616c 2c20 656c  ype: optical, el
-00006e40: 6563 7472 6963 616c 2c20 7665 7274 6963  ectrical, vertic
-00006e50: 616c 5f64 632c 2076 6572 7469 6361 6c5f  al_dc, vertical_
-00006e60: 7465 2c20 7665 7274 6963 616c 5f74 6d2e  te, vertical_tm.
-00006e70: 2044 6566 6175 6c74 7320 746f 206f 7074   Defaults to opt
-00006e80: 6963 616c 2e0a 2020 2020 2020 2020 2020  ical..          
-00006e90: 2020 6372 6f73 735f 7365 6374 696f 6e3a    cross_section:
-00006ea0: 2070 6f72 7420 6372 6f73 735f 7365 6374   port cross_sect
-00006eb0: 696f 6e2e 0a20 2020 2020 2020 2022 2222  ion..        """
-00006ec0: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-00006ed0: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
-00006ee0: 6f72 7420 6765 745f 6c61 7965 720a 0a20  ort get_layer.. 
-00006ef0: 2020 2020 2020 206c 6179 6572 203d 2067         layer = g
-00006f00: 6574 5f6c 6179 6572 286c 6179 6572 290a  et_layer(layer).
-00006f10: 0a20 2020 2020 2020 2069 6620 706f 7274  .        if port
-00006f20: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00006f30: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00006f40: 706f 7274 2c20 506f 7274 293a 0a20 2020  port, Port):.   
-00006f50: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00006f60: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-00006f70: 6164 645f 706f 7274 2829 206e 6565 6473  add_port() needs
-00006f80: 2061 2050 6f72 742c 2067 6f74 207b 7479   a Port, got {ty
-00006f90: 7065 2870 6f72 7429 7d22 290a 2020 2020  pe(port)}").    
-00006fa0: 2020 2020 2020 2020 7020 3d20 706f 7274          p = port
-00006fb0: 2e63 6f70 7928 290a 2020 2020 2020 2020  .copy().        
-00006fc0: 2020 2020 6966 206e 616d 6520 6973 206e      if name is n
-00006fd0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00006fe0: 2020 2020 2020 2020 2070 2e6e 616d 6520           p.name 
-00006ff0: 3d20 6e61 6d65 0a20 2020 2020 2020 2020  = name.         
-00007000: 2020 2069 6620 6365 6e74 6572 2069 7320     if center is 
-00007010: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00007020: 2020 2020 2020 2020 2020 702e 6365 6e74            p.cent
-00007030: 6572 203d 2063 656e 7465 720a 2020 2020  er = center.    
-00007040: 2020 2020 2020 2020 6966 2077 6964 7468          if width
-00007050: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00007060: 2020 2020 2020 2020 2020 2020 2020 702e                p.
-00007070: 7769 6474 6820 3d20 7769 6474 680a 2020  width = width.  
-00007080: 2020 2020 2020 2020 2020 6966 206f 7269            if ori
-00007090: 656e 7461 7469 6f6e 2069 7320 6e6f 7420  entation is not 
-000070a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000070b0: 2020 2020 2020 702e 6f72 6965 6e74 6174        p.orientat
-000070c0: 696f 6e20 3d20 6f72 6965 6e74 6174 696f  ion = orientatio
-000070d0: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
-000070e0: 2070 6f72 745f 7479 7065 2069 7320 6e6f   port_type is no
-000070f0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00007100: 2020 2020 2020 2020 702e 706f 7274 5f74          p.port_t
-00007110: 7970 6520 3d20 706f 7274 5f74 7970 650a  ype = port_type.
-00007120: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00007130: 6179 6572 2069 7320 6e6f 7420 4e6f 6e65  ayer is not None
-00007140: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007150: 2020 702e 6c61 7965 7220 3d20 6c61 7965    p.layer = laye
-00007160: 720a 2020 2020 2020 2020 2020 2020 702e  r.            p.
-00007170: 7061 7265 6e74 203d 2073 656c 660a 0a20  parent = self.. 
-00007180: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
-00007190: 7374 616e 6365 286e 616d 652c 2050 6f72  stance(name, Por
-000071a0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-000071b0: 7020 3d20 6e61 6d65 2e63 6f70 7928 290a  p = name.copy().
-000071c0: 2020 2020 2020 2020 2020 2020 702e 7061              p.pa
-000071d0: 7265 6e74 203d 2073 656c 660a 2020 2020  rent = self.    
-000071e0: 2020 2020 2020 2020 6e61 6d65 203d 2070          name = p
-000071f0: 2e6e 616d 650a 2020 2020 2020 2020 656c  .name.        el
-00007200: 6966 2063 656e 7465 7220 6973 204e 6f6e  if center is Non
-00007210: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00007220: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00007230: 2250 6f72 7420 6e65 6564 7320 6365 6e74  "Port needs cent
-00007240: 6572 2070 6172 616d 6574 6572 2028 782c  er parameter (x,
-00007250: 2079 2920 756d 2e22 290a 0a20 2020 2020   y) um.")..     
-00007260: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007270: 2020 2020 2070 203d 2050 6f72 7428 0a20       p = Port(. 
-00007280: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00007290: 616d 653d 6e61 6d65 2c0a 2020 2020 2020  ame=name,.      
-000072a0: 2020 2020 2020 2020 2020 6365 6e74 6572            center
-000072b0: 3d63 656e 7465 722c 0a20 2020 2020 2020  =center,.       
-000072c0: 2020 2020 2020 2020 2077 6964 7468 3d77           width=w
-000072d0: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
-000072e0: 2020 2020 2020 6f72 6965 6e74 6174 696f        orientatio
-000072f0: 6e3d 6f72 6965 6e74 6174 696f 6e2c 0a20  n=orientation,. 
-00007300: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00007310: 6172 656e 743d 7365 6c66 2c0a 2020 2020  arent=self,.    
-00007320: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00007330: 723d 6c61 7965 722c 0a20 2020 2020 2020  r=layer,.       
-00007340: 2020 2020 2020 2020 2070 6f72 745f 7479           port_ty
-00007350: 7065 3d70 6f72 745f 7479 7065 206f 7220  pe=port_type or 
-00007360: 226f 7074 6963 616c 222c 0a20 2020 2020  "optical",.     
-00007370: 2020 2020 2020 2020 2020 2063 726f 7373             cross
-00007380: 5f73 6563 7469 6f6e 3d63 726f 7373 5f73  _section=cross_s
-00007390: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
-000073a0: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-000073b0: 206e 616d 6520 6973 206e 6f74 204e 6f6e   name is not Non
-000073c0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-000073d0: 2e6e 616d 6520 3d20 6e61 6d65 0a20 2020  .name = name.   
-000073e0: 2020 2020 2069 6620 702e 6e61 6d65 2069       if p.name i
-000073f0: 6e20 7365 6c66 2e70 6f72 7473 3a0a 2020  n self.ports:.  
-00007400: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00007410: 5661 6c75 6545 7272 6f72 2866 2261 6464  ValueError(f"add
-00007420: 5f70 6f72 7428 2920 506f 7274 206e 616d  _port() Port nam
-00007430: 6520 7b70 2e6e 616d 6521 727d 2065 7869  e {p.name!r} exi
-00007440: 7374 7320 696e 207b 7365 6c66 2e6e 616d  sts in {self.nam
-00007450: 6521 727d 2229 0a0a 2020 2020 2020 2020  e!r}")..        
-00007460: 7365 6c66 2e70 6f72 7473 5b70 2e6e 616d  self.ports[p.nam
-00007470: 655d 203d 2070 0a20 2020 2020 2020 2072  e] = p.        r
-00007480: 6574 7572 6e20 700a 0a20 2020 2064 6566  eturn p..    def
-00007490: 2061 6464 5f70 6f72 7473 280a 2020 2020   add_ports(.    
-000074a0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-000074b0: 2020 706f 7274 733a 2055 6e69 6f6e 5b4c    ports: Union[L
-000074c0: 6973 745b 506f 7274 5d2c 2044 6963 745b  ist[Port], Dict[
-000074d0: 7374 722c 2050 6f72 745d 5d2c 0a20 2020  str, Port]],.   
-000074e0: 2020 2020 2070 7265 6669 783a 2073 7472       prefix: str
-000074f0: 203d 2022 222c 0a20 2020 2020 2020 2073   = "",.        s
-00007500: 7566 6669 783a 2073 7472 203d 2022 222c  uffix: str = "",
-00007510: 0a20 2020 2020 2020 202a 2a6b 7761 7267  .        **kwarg
-00007520: 732c 0a20 2020 2029 202d 3e20 4e6f 6e65  s,.    ) -> None
-00007530: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
-00007540: 2061 206c 6973 7420 6f72 2064 6963 7420   a list or dict 
-00007550: 6f66 2070 6f72 7473 2e0a 0a20 2020 2020  of ports...     
-00007560: 2020 2079 6f75 2063 616e 2069 6e63 6c75     you can inclu
-00007570: 6465 2061 2070 7265 6669 7820 746f 2061  de a prefix to a
-00007580: 6464 2074 6f20 7468 6520 6e65 7720 706f  dd to the new po
-00007590: 7274 206e 616d 6573 2074 6f20 6176 6f69  rt names to avoi
-000075a0: 6420 6e61 6d65 2063 6f6e 666c 6963 7473  d name conflicts
-000075b0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-000075c0: 0a20 2020 2020 2020 2020 2020 2070 6f72  .            por
-000075d0: 7473 3a20 6c69 7374 206f 7220 6469 6374  ts: list or dict
-000075e0: 206f 6620 706f 7274 732e 0a20 2020 2020   of ports..     
-000075f0: 2020 2020 2020 2070 7265 6669 783a 2074         prefix: t
-00007600: 6f20 7072 6570 656e 6420 746f 2065 6163  o prepend to eac
-00007610: 6820 706f 7274 206e 616d 652e 0a20 2020  h port name..   
-00007620: 2020 2020 2020 2020 2073 7566 6669 783a           suffix:
-00007630: 2074 6f20 6170 7065 6e64 2074 6f20 6561   to append to ea
-00007640: 6368 2070 6f72 7420 6e61 6d65 2e0a 2020  ch port name..  
-00007650: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00007660: 2020 706f 7274 7320 3d20 706f 7274 7320    ports = ports 
-00007670: 6966 2069 7369 6e73 7461 6e63 6528 706f  if isinstance(po
-00007680: 7274 732c 206c 6973 7429 2065 6c73 6520  rts, list) else 
-00007690: 706f 7274 732e 7661 6c75 6573 2829 0a20  ports.values(). 
-000076a0: 2020 2020 2020 2066 6f72 2070 6f72 7420         for port 
-000076b0: 696e 206c 6973 7428 706f 7274 7329 3a0a  in list(ports):.
-000076c0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-000076d0: 203d 2066 227b 7072 6566 6978 7d7b 706f   = f"{prefix}{po
-000076e0: 7274 2e6e 616d 657d 7b73 7566 6669 787d  rt.name}{suffix}
-000076f0: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
-00007700: 6c66 2e61 6464 5f70 6f72 7428 6e61 6d65  lf.add_port(name
-00007710: 3d6e 616d 652c 2070 6f72 743d 706f 7274  =name, port=port
-00007720: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
-00007730: 2064 6566 2073 6e61 705f 706f 7274 735f   def snap_ports_
-00007740: 746f 5f67 7269 6428 7365 6c66 2c20 6e6d  to_grid(self, nm
-00007750: 3a20 696e 7420 3d20 3129 202d 3e20 4e6f  : int = 1) -> No
-00007760: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
-00007770: 706f 7274 2069 6e20 7365 6c66 2e70 6f72  port in self.por
-00007780: 7473 2e76 616c 7565 7328 293a 0a20 2020  ts.values():.   
-00007790: 2020 2020 2020 2020 2070 6f72 742e 736e           port.sn
-000077a0: 6170 5f74 6f5f 6772 6964 286e 6d3d 6e6d  ap_to_grid(nm=nm
-000077b0: 290a 0a20 2020 2064 6566 2072 656d 6f76  )..    def remov
-000077c0: 655f 6c61 7965 7273 280a 2020 2020 2020  e_layers(.      
-000077d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000077e0: 6c61 7965 7273 3a20 4c69 7374 5b4c 6179  layers: List[Lay
-000077f0: 6572 5370 6563 5d2c 0a20 2020 2020 2020  erSpec],.       
-00007800: 2069 6e63 6c75 6465 5f6c 6162 656c 733a   include_labels:
-00007810: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-00007820: 2020 2020 2020 696e 7665 7274 5f73 656c        invert_sel
-00007830: 6563 7469 6f6e 3a20 626f 6f6c 203d 2046  ection: bool = F
-00007840: 616c 7365 2c0a 2020 2020 2020 2020 7265  alse,.        re
-00007850: 6375 7273 6976 653a 2062 6f6f 6c20 3d20  cursive: bool = 
-00007860: 5472 7565 2c0a 2020 2020 2920 2d3e 2043  True,.    ) -> C
-00007870: 6f6d 706f 6e65 6e74 3a0a 2020 2020 2020  omponent:.      
-00007880: 2020 2222 2252 656d 6f76 6520 6120 6c69    """Remove a li
-00007890: 7374 206f 6620 6c61 7965 7273 2061 6e64  st of layers and
-000078a0: 2072 6574 7572 6e73 2074 6865 2073 616d   returns the sam
-000078b0: 6520 436f 6d70 6f6e 656e 742e 0a0a 2020  e Component...  
-000078c0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-000078d0: 2020 2020 2020 2020 6c61 7965 7273 3a20          layers: 
-000078e0: 6c69 7374 206f 6620 6c61 7965 7273 2074  list of layers t
-000078f0: 6f20 7265 6d6f 7665 2e0a 2020 2020 2020  o remove..      
-00007900: 2020 2020 2020 696e 636c 7564 655f 6c61        include_la
-00007910: 6265 6c73 3a20 7265 6d6f 7665 206c 6162  bels: remove lab
-00007920: 656c 7320 6f6e 2074 686f 7365 206c 6179  els on those lay
-00007930: 6572 732e 0a20 2020 2020 2020 2020 2020  ers..           
-00007940: 2069 6e76 6572 745f 7365 6c65 6374 696f   invert_selectio
-00007950: 6e3a 2072 656d 6f76 6573 2061 6c6c 206c  n: removes all l
-00007960: 6179 6572 7320 6578 6365 7074 206c 6179  ayers except lay
-00007970: 6572 7320 7370 6563 6966 6965 642e 0a20  ers specified.. 
-00007980: 2020 2020 2020 2020 2020 2072 6563 7572             recur
-00007990: 7369 7665 3a20 6f70 6572 6174 6520 6f6e  sive: operate on
-000079a0: 2074 6865 2063 656c 6c73 2069 6e63 6c75   the cells inclu
-000079b0: 6465 6420 696e 2074 6869 7320 6365 6c6c  ded in this cell
-000079c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000079d0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-000079e0: 6374 6f72 7920 696d 706f 7274 2067 6574  ctory import get
-000079f0: 5f6c 6179 6572 0a0a 2020 2020 2020 2020  _layer..        
-00007a00: 636f 6d70 6f6e 656e 7420 3d20 7365 6c66  component = self
-00007a10: 2e66 6c61 7474 656e 2829 2069 6620 7265  .flatten() if re
-00007a20: 6375 7273 6976 6520 616e 6420 7365 6c66  cursive and self
-00007a30: 2e72 6566 6572 656e 6365 7320 656c 7365  .references else
-00007a40: 2073 656c 660a 2020 2020 2020 2020 6c61   self.        la
-00007a50: 7965 7273 203d 205b 6765 745f 6c61 7965  yers = [get_laye
-00007a60: 7228 6c61 7965 7229 2066 6f72 206c 6179  r(layer) for lay
-00007a70: 6572 2069 6e20 6c61 7965 7273 5d0a 0a20  er in layers].. 
-00007a80: 2020 2020 2020 2073 686f 756c 645f 7265         should_re
-00007a90: 6d6f 7665 203d 206e 6f74 2069 6e76 6572  move = not inver
-00007aa0: 745f 7365 6c65 6374 696f 6e0a 2020 2020  t_selection.    
-00007ab0: 2020 2020 636f 6d70 6f6e 656e 742e 5f63      component._c
-00007ac0: 656c 6c2e 6669 6c74 6572 280a 2020 2020  ell.filter(.    
-00007ad0: 2020 2020 2020 2020 7370 6563 3d6c 6179          spec=lay
-00007ae0: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-00007af0: 2072 656d 6f76 653d 7368 6f75 6c64 5f72   remove=should_r
-00007b00: 656d 6f76 652c 0a20 2020 2020 2020 2020  emove,.         
-00007b10: 2020 2070 6f6c 7967 6f6e 733d 5472 7565     polygons=True
-00007b20: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00007b30: 7468 733d 5472 7565 2c0a 2020 2020 2020  ths=True,.      
-00007b40: 2020 2020 2020 6c61 6265 6c73 3d69 6e63        labels=inc
-00007b50: 6c75 6465 5f6c 6162 656c 732c 0a20 2020  lude_labels,.   
-00007b60: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-00007b70: 6574 7572 6e20 636f 6d70 6f6e 656e 740a  eturn component.
-00007b80: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-00007b90: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00007ba0: 2020 2020 2020 2020 6c61 7965 7273 3a20          layers: 
-00007bb0: 4c69 7374 5b55 6e69 6f6e 5b54 7570 6c65  List[Union[Tuple
-00007bc0: 5b69 6e74 2c20 696e 745d 2c20 7374 725d  [int, int], str]
-00007bd0: 5d2c 0a20 2020 2029 202d 3e20 436f 6d70  ],.    ) -> Comp
-00007be0: 6f6e 656e 743a 0a20 2020 2020 2020 2022  onent:.        "
-00007bf0: 2222 4578 7472 6163 7420 706f 6c79 676f  ""Extract polygo
-00007c00: 6e73 2066 726f 6d20 6120 436f 6d70 6f6e  ns from a Compon
-00007c10: 656e 7420 616e 6420 7265 7475 726e 7320  ent and returns 
-00007c20: 6120 6e65 7720 436f 6d70 6f6e 656e 742e  a new Component.
-00007c30: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00007c40: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
-00007c50: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
-00007c60: 0a0a 2020 2020 2020 2020 6966 2074 7970  ..        if typ
-00007c70: 6528 6c61 7965 7273 2920 6e6f 7420 696e  e(layers) not in
-00007c80: 2028 6c69 7374 2c20 7475 706c 6529 3a0a   (list, tuple):.
-00007c90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00007ca0: 6520 5661 6c75 6545 7272 6f72 2866 226c  e ValueError(f"l
-00007cb0: 6179 6572 7320 7b6c 6179 6572 7321 727d  ayers {layers!r}
-00007cc0: 206e 6565 6473 2074 6f20 6265 2061 206c   needs to be a l
-00007cd0: 6973 7420 6f72 2074 7570 6c65 2229 0a0a  ist or tuple")..
-00007ce0: 2020 2020 2020 2020 6c61 7965 7273 203d          layers =
-00007cf0: 205b 6765 745f 6c61 7965 7228 6c61 7965   [get_layer(laye
-00007d00: 7229 2066 6f72 206c 6179 6572 2069 6e20  r) for layer in 
-00007d10: 6c61 7965 7273 5d0a 2020 2020 2020 2020  layers].        
-00007d20: 2320 636f 6d70 6f6e 656e 7420 3d20 7365  # component = se
-00007d30: 6c66 2e63 6f70 7928 290a 2020 2020 2020  lf.copy().      
-00007d40: 2020 2320 636f 6d70 6f6e 656e 742e 5f63    # component._c
-00007d50: 656c 6c2e 6669 6c74 6572 2873 7065 633d  ell.filter(spec=
-00007d60: 6c61 7965 7273 2c20 7265 6d6f 7665 3d46  layers, remove=F
-00007d70: 616c 7365 290a 0a20 2020 2020 2020 2063  alse)..        c
-00007d80: 6f6d 706f 6e65 6e74 203d 2043 6f6d 706f  omponent = Compo
-00007d90: 6e65 6e74 2829 0a20 2020 2020 2020 2070  nent().        p
-00007da0: 6f6c 795f 6469 6374 203d 2073 656c 662e  oly_dict = self.
-00007db0: 6765 745f 706f 6c79 676f 6e73 2862 795f  get_polygons(by_
-00007dc0: 7370 6563 3d54 7275 652c 2069 6e63 6c75  spec=True, inclu
-00007dd0: 6465 5f70 6174 6873 3d46 616c 7365 290a  de_paths=False).
-00007de0: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
-00007df0: 6572 2069 6e20 6c61 7965 7273 3a0a 2020  er in layers:.  
-00007e00: 2020 2020 2020 2020 2020 6966 206c 6179            if lay
-00007e10: 6572 2069 6e20 706f 6c79 5f64 6963 743a  er in poly_dict:
-00007e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007e30: 2070 6f6c 7967 6f6e 7320 3d20 706f 6c79   polygons = poly
-00007e40: 5f64 6963 745b 6c61 7965 725d 0a20 2020  _dict[layer].   
-00007e50: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00007e60: 2070 6f6c 7967 6f6e 2069 6e20 706f 6c79   polygon in poly
-00007e70: 676f 6e73 3a0a 2020 2020 2020 2020 2020  gons:.          
-00007e80: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-00007e90: 656e 742e 6164 645f 706f 6c79 676f 6e28  ent.add_polygon(
-00007ea0: 706f 6c79 676f 6e2c 206c 6179 6572 290a  polygon, layer).
-00007eb0: 0a20 2020 2020 2020 2066 6f72 206c 6179  .        for lay
-00007ec0: 6572 2069 6e20 6c61 7965 7273 3a0a 2020  er in layers:.  
-00007ed0: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-00007ee0: 7468 2069 6e20 7365 6c66 2e5f 6365 6c6c  th in self._cell
-00007ef0: 2e67 6574 5f70 6174 6873 286c 6179 6572  .get_paths(layer
-00007f00: 3d6c 6179 6572 293a 0a20 2020 2020 2020  =layer):.       
-00007f10: 2020 2020 2020 2020 2063 6f6d 706f 6e65           compone
-00007f20: 6e74 2e61 6464 2870 6174 6829 0a0a 2020  nt.add(path)..  
-00007f30: 2020 2020 2020 7265 7475 726e 2063 6f6d        return com
-00007f40: 706f 6e65 6e74 0a0a 2020 2020 6465 6620  ponent..    def 
-00007f50: 6164 645f 706f 6c79 676f 6e28 7365 6c66  add_polygon(self
-00007f60: 2c20 706f 696e 7473 2c20 6c61 7965 723d  , points, layer=
-00007f70: 6e70 2e6e 616e 293a 0a20 2020 2020 2020  np.nan):.       
-00007f80: 2022 2222 4164 6473 2061 2050 6f6c 7967   """Adds a Polyg
-00007f90: 6f6e 2074 6f20 7468 6520 436f 6d70 6f6e  on to the Compon
-00007fa0: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
-00007fb0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00007fc0: 706f 696e 7473 3a20 436f 6f72 6469 6e61  points: Coordina
-00007fd0: 7465 7320 6f66 2074 6865 2076 6572 7469  tes of the verti
-00007fe0: 6365 7320 6f66 2074 6865 2050 6f6c 7967  ces of the Polyg
-00007ff0: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
-00008000: 6c61 7965 723a 206c 6179 6572 2073 7065  layer: layer spe
-00008010: 6320 746f 2061 6464 2070 6f6c 7967 6f6e  c to add polygon
-00008020: 206f 6e2e 0a20 2020 2020 2020 2022 2222   on..        """
-00008030: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-00008040: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
-00008050: 6f72 7420 6765 745f 6c61 7965 720a 0a20  ort get_layer.. 
-00008060: 2020 2020 2020 206c 6179 6572 203d 2067         layer = g
-00008070: 6574 5f6c 6179 6572 286c 6179 6572 290a  et_layer(layer).
-00008080: 0a20 2020 2020 2020 2069 6620 6c61 7965  .        if laye
-00008090: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-000080a0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000080b0: 6e65 0a0a 2020 2020 2020 2020 7472 793a  ne..        try:
-000080c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000080d0: 6973 696e 7374 616e 6365 286c 6179 6572  isinstance(layer
-000080e0: 2c20 7365 7429 3a0a 2020 2020 2020 2020  , set):.        
-000080f0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00008100: 7365 6c66 2e61 6464 5f70 6f6c 7967 6f6e  self.add_polygon
-00008110: 2870 6f69 6e74 732c 206c 7929 2066 6f72  (points, ly) for
-00008120: 206c 7920 696e 206c 6179 6572 5d0a 2020   ly in layer].  
-00008130: 2020 2020 2020 2020 2020 656c 6966 2061            elif a
-00008140: 6c6c 2869 7369 6e73 7461 6e63 6528 6c79  ll(isinstance(ly
-00008150: 2c20 284c 6179 6572 2929 2066 6f72 206c  , (Layer)) for l
-00008160: 7920 696e 206c 6179 6572 293a 0a20 2020  y in layer):.   
-00008170: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00008180: 7572 6e20 5b73 656c 662e 6164 645f 706f  urn [self.add_po
-00008190: 6c79 676f 6e28 706f 696e 7473 2c20 6c79  lygon(points, ly
-000081a0: 2920 666f 7220 6c79 2069 6e20 6c61 7965  ) for ly in laye
-000081b0: 725d 0a20 2020 2020 2020 2020 2020 2065  r].            e
-000081c0: 6c69 6620 6c65 6e28 6c61 7965 7229 203e  lif len(layer) >
-000081d0: 2032 3a20 2023 2053 6f6d 656f 6e65 2077   2:  # Someone w
-000081e0: 726f 7465 2065 2e67 2e20 6c61 7965 7220  rote e.g. layer 
-000081f0: 3d20 5b31 2c34 2c35 5d0a 2020 2020 2020  = [1,4,5].      
-00008200: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00008210: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00008220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008230: 2222 2220 5b50 4849 444c 5d20 4966 2073  """ [PHIDL] If s
-00008240: 7065 6369 6679 696e 6720 6d75 6c74 6970  pecifying multip
-00008250: 6c65 206c 6179 6572 730a 2020 2020 2020  le layers.      
-00008260: 2020 2020 2020 2020 2020 796f 7520 6d75            you mu
-00008270: 7374 2075 7365 2073 6574 206e 6f74 6174  st use set notat
-00008280: 696f 6e2c 2065 2e67 2e20 7b31 2c35 2c38  ion, e.g. {1,5,8
-00008290: 7d20 2222 220a 2020 2020 2020 2020 2020  } """.          
-000082a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000082b0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000082c0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-000082d0: 7373 0a0a 2020 2020 2020 2020 6966 2069  ss..        if i
-000082e0: 7369 6e73 7461 6e63 6528 706f 696e 7473  sinstance(points
-000082f0: 2c20 6764 7374 6b2e 506f 6c79 676f 6e29  , gdstk.Polygon)
-00008300: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00008310: 6966 206c 6179 6572 2069 7320 756e 7370  if layer is unsp
-00008320: 6563 6966 6965 6420 6f72 206d 6174 6368  ecified or match
-00008330: 6573 206f 7269 6769 6e61 6c20 706f 6c79  es original poly
-00008340: 676f 6e2c 206a 7573 7420 6164 6420 6974  gon, just add it
-00008350: 2061 732d 6973 0a20 2020 2020 2020 2020   as-is.         
-00008360: 2020 2070 6f6c 7967 6f6e 203d 2070 6f69     polygon = poi
-00008370: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-00008380: 6966 206c 6179 6572 2069 7320 6e70 2e6e  if layer is np.n
-00008390: 616e 206f 7220 280a 2020 2020 2020 2020  an or (.        
-000083a0: 2020 2020 2020 2020 6973 696e 7374 616e          isinstan
-000083b0: 6365 286c 6179 6572 2c20 7475 706c 6529  ce(layer, tuple)
-000083c0: 2061 6e64 2028 706f 6c79 676f 6e2e 6c61   and (polygon.la
-000083d0: 7965 722c 2070 6f6c 7967 6f6e 2e64 6174  yer, polygon.dat
-000083e0: 6174 7970 6529 203d 3d20 6c61 7965 720a  atype) == layer.
-000083f0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-00008400: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00008410: 6f6c 7967 6f6e 203d 2050 6f6c 7967 6f6e  olygon = Polygon
-00008420: 2870 6f6c 7967 6f6e 2e70 6f69 6e74 732c  (polygon.points,
-00008430: 2070 6f6c 7967 6f6e 2e6c 6179 6572 2c20   polygon.layer, 
-00008440: 706f 6c79 676f 6e2e 6461 7461 7479 7065  polygon.datatype
-00008450: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00008460: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00008470: 2020 2020 6c61 7965 722c 2064 6174 6174      layer, datat
-00008480: 7970 6520 3d20 5f70 6172 7365 5f6c 6179  ype = _parse_lay
-00008490: 6572 286c 6179 6572 290a 2020 2020 2020  er(layer).      
-000084a0: 2020 2020 2020 2020 2020 706f 6c79 676f            polygo
-000084b0: 6e20 3d20 506f 6c79 676f 6e28 706f 6c79  n = Polygon(poly
-000084c0: 676f 6e2e 706f 696e 7473 2c20 6c61 7965  gon.points, laye
-000084d0: 722c 2064 6174 6174 7970 6529 0a20 2020  r, datatype).   
-000084e0: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-000084f0: 6464 5f70 6f6c 7967 6f6e 7328 706f 6c79  dd_polygons(poly
-00008500: 676f 6e29 0a20 2020 2020 2020 2020 2020  gon).           
-00008510: 2072 6574 7572 6e20 706f 6c79 676f 6e0a   return polygon.
-00008520: 0a20 2020 2020 2020 2070 6f69 6e74 7320  .        points 
-00008530: 3d20 6e70 2e61 7361 7272 6179 2870 6f69  = np.asarray(poi
-00008540: 6e74 7329 0a20 2020 2020 2020 2069 6620  nts).        if 
-00008550: 706f 696e 7473 2e6e 6469 6d20 3d3d 2031  points.ndim == 1
-00008560: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00008570: 7475 726e 205b 7365 6c66 2e61 6464 5f70  turn [self.add_p
-00008580: 6f6c 7967 6f6e 2870 6f6c 792c 206c 6179  olygon(poly, lay
-00008590: 6572 3d6c 6179 6572 2920 666f 7220 706f  er=layer) for po
-000085a0: 6c79 2069 6e20 706f 696e 7473 5d0a 2020  ly in points].  
-000085b0: 2020 2020 2020 6966 206c 6179 6572 2069        if layer i
-000085c0: 7320 6e70 2e6e 616e 3a0a 2020 2020 2020  s np.nan:.      
-000085d0: 2020 2020 2020 6c61 7965 7220 3d20 300a        layer = 0.
-000085e0: 0a20 2020 2020 2020 2069 6620 706f 696e  .        if poin
-000085f0: 7473 2e6e 6469 6d20 3d3d 2032 3a0a 2020  ts.ndim == 2:.  
-00008600: 2020 2020 2020 2020 2020 2320 6164 6420            # add 
-00008610: 7369 6e67 6c65 2070 6f6c 7967 6f6e 2066  single polygon f
-00008620: 726f 6d20 706f 696e 7473 0a20 2020 2020  rom points.     
-00008630: 2020 2020 2020 2069 6620 6c65 6e28 706f         if len(po
-00008640: 696e 7473 5b30 5d29 203e 2032 3a0a 2020  ints[0]) > 2:.  
-00008650: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00008660: 436f 6e76 6572 7420 746f 2066 6f72 6d20  Convert to form 
-00008670: 5b5b 312c 325d 2c5b 332c 345d 2c5b 352c  [[1,2],[3,4],[5,
-00008680: 365d 5d0a 2020 2020 2020 2020 2020 2020  6]].            
-00008690: 2020 2020 706f 696e 7473 203d 206e 702e      points = np.
-000086a0: 636f 6c75 6d6e 5f73 7461 636b 2870 6f69  column_stack(poi
-000086b0: 6e74 7329 0a20 2020 2020 2020 2020 2020  nts).           
-000086c0: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
-000086d0: 203d 205f 7061 7273 655f 6c61 7965 7228   = _parse_layer(
-000086e0: 6c61 7965 7229 0a20 2020 2020 2020 2020  layer).         
-000086f0: 2020 2070 6f6c 7967 6f6e 203d 2050 6f6c     polygon = Pol
-00008700: 7967 6f6e 2870 6f69 6e74 732c 206c 6179  ygon(points, lay
-00008710: 6572 3d6c 6179 6572 2c20 6461 7461 7479  er=layer, dataty
-00008720: 7065 3d64 6174 6174 7970 6529 0a20 2020  pe=datatype).   
-00008730: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-00008740: 6464 5f70 6f6c 7967 6f6e 7328 706f 6c79  dd_polygons(poly
-00008750: 676f 6e29 0a20 2020 2020 2020 2020 2020  gon).           
-00008760: 2072 6574 7572 6e20 706f 6c79 676f 6e0a   return polygon.
-00008770: 2020 2020 2020 2020 656c 6966 2070 6f69          elif poi
-00008780: 6e74 732e 6e64 696d 203d 3d20 333a 0a20  nts.ndim == 3:. 
-00008790: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-000087a0: 2c20 6461 7461 7479 7065 203d 205f 7061  , datatype = _pa
-000087b0: 7273 655f 6c61 7965 7228 6c61 7965 7229  rse_layer(layer)
-000087c0: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
-000087d0: 7967 6f6e 7320 3d20 5b0a 2020 2020 2020  ygons = [.      
-000087e0: 2020 2020 2020 2020 2020 506f 6c79 676f            Polygo
-000087f0: 6e28 7070 6f69 6e74 732c 206c 6179 6572  n(ppoints, layer
-00008800: 3d6c 6179 6572 2c20 6461 7461 7479 7065  =layer, datatype
-00008810: 3d64 6174 6174 7970 6529 2066 6f72 2070  =datatype) for p
-00008820: 706f 696e 7473 2069 6e20 706f 696e 7473  points in points
-00008830: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
-00008840: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008850: 5f61 6464 5f70 6f6c 7967 6f6e 7328 2a70  _add_polygons(*p
-00008860: 6f6c 7967 6f6e 7329 0a20 2020 2020 2020  olygons).       
-00008870: 2020 2020 2072 6574 7572 6e20 706f 6c79       return poly
-00008880: 676f 6e73 0a20 2020 2020 2020 2065 6c73  gons.        els
-00008890: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-000088a0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000088b0: 6622 556e 6162 6c65 2074 6f20 6164 6420  f"Unable to add 
-000088c0: 7b70 6f69 6e74 732e 6e64 696d 7d2d 6469  {points.ndim}-di
-000088d0: 6d65 6e73 696f 6e61 6c20 706f 696e 7473  mensional points
-000088e0: 206f 626a 6563 7422 290a 0a20 2020 2064   object")..    d
-000088f0: 6566 205f 6164 645f 706f 6c79 676f 6e73  ef _add_polygons
-00008900: 2873 656c 662c 202a 706f 6c79 676f 6e73  (self, *polygons
-00008910: 3a20 4c69 7374 5b50 6f6c 7967 6f6e 5d29  : List[Polygon])
-00008920: 3a0a 2020 2020 2020 2020 7365 6c66 2e69  :.        self.i
-00008930: 735f 756e 6c6f 636b 6564 2829 0a20 2020  s_unlocked().   
-00008940: 2020 2020 2073 656c 662e 5f63 656c 6c2e       self._cell.
-00008950: 6164 6428 2a70 6f6c 7967 6f6e 7329 0a0a  add(*polygons)..
-00008960: 2020 2020 6465 6620 636f 7079 2873 656c      def copy(sel
-00008970: 6629 202d 3e20 436f 6d70 6f6e 656e 743a  f) -> Component:
-00008980: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00008990: 636f 7079 2873 656c 6629 0a0a 2020 2020  copy(self)..    
-000089a0: 6465 6620 6164 645f 7265 665f 636f 6e74  def add_ref_cont
-000089b0: 6169 6e65 7228 7365 6c66 2c20 636f 6d70  ainer(self, comp
-000089c0: 6f6e 656e 743a 2043 6f6d 706f 6e65 6e74  onent: Component
-000089d0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
-000089e0: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
-000089f0: 2022 2222 4164 6420 7265 6665 7265 6e63   """Add referenc
-00008a00: 652c 2070 6f72 7473 2061 6e64 2063 6f70  e, ports and cop
-00008a10: 795f 6368 696c 645f 696e 666f 2e22 2222  y_child_info."""
-00008a20: 0a20 2020 2020 2020 2072 6566 203d 2073  .        ref = s
-00008a30: 656c 6620 3c3c 2063 6f6d 706f 6e65 6e74  elf << component
-00008a40: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-00008a50: 645f 706f 7274 7328 7265 662e 706f 7274  d_ports(ref.port
-00008a60: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00008a70: 636f 7079 5f63 6869 6c64 5f69 6e66 6f28  copy_child_info(
-00008a80: 636f 6d70 6f6e 656e 7429 0a20 2020 2020  component).     
-00008a90: 2020 2072 6574 7572 6e20 7265 660a 0a20     return ref.. 
-00008aa0: 2020 2064 6566 2063 6f70 795f 6368 696c     def copy_chil
-00008ab0: 645f 696e 666f 2873 656c 662c 2063 6f6d  d_info(self, com
-00008ac0: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
-00008ad0: 7429 202d 3e20 4e6f 6e65 3a0a 2020 2020  t) -> None:.    
-00008ae0: 2020 2020 2222 2243 6f70 7920 616e 6420      """Copy and 
-00008af0: 7365 7474 696e 6773 2069 6e66 6f20 6672  settings info fr
-00008b00: 6f6d 2063 6869 6c64 2063 6f6d 706f 6e65  om child compone
-00008b10: 6e74 2069 6e74 6f20 7061 7265 6e74 2e0a  nt into parent..
-00008b20: 0a20 2020 2020 2020 2050 6172 656e 7420  .        Parent 
-00008b30: 636f 6d70 6f6e 656e 7473 2063 616e 2061  components can a
-00008b40: 6363 6573 7320 6368 696c 6420 6365 6c6c  ccess child cell
-00008b50: 7320 7365 7474 696e 6773 2e0a 2020 2020  s settings..    
-00008b60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00008b70: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00008b80: 6528 636f 6d70 6f6e 656e 742c 2028 436f  e(component, (Co
-00008b90: 6d70 6f6e 656e 742c 2043 6f6d 706f 6e65  mponent, Compone
-00008ba0: 6e74 5265 6665 7265 6e63 6529 293a 0a20  ntReference)):. 
-00008bb0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00008bc0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00008bd0: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-00008be0: 7479 7065 2863 6f6d 706f 6e65 6e74 297d  type(component)}
-00008bf0: 2220 2269 7320 6e6f 7420 6120 436f 6d70  " "is not a Comp
-00008c00: 6f6e 656e 7420 6f72 2043 6f6d 706f 6e65  onent or Compone
-00008c10: 6e74 5265 6665 7265 6e63 6522 0a20 2020  ntReference".   
-00008c20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00008c30: 2020 2020 7365 6c66 2e67 6574 5f63 6869      self.get_chi
-00008c40: 6c64 5f6e 616d 6520 3d20 5472 7565 0a20  ld_name = True. 
-00008c50: 2020 2020 2020 2073 656c 662e 6368 696c         self.chil
-00008c60: 6420 3d20 636f 6d70 6f6e 656e 740a 2020  d = component.  
-00008c70: 2020 2020 2020 7365 6c66 2e69 6e66 6f2e        self.info.
-00008c80: 7570 6461 7465 2863 6f6d 706f 6e65 6e74  update(component
-00008c90: 2e69 6e66 6f29 0a20 2020 2020 2020 2073  .info).        s
-00008ca0: 656c 662e 7365 7474 696e 6773 2e75 7064  elf.settings.upd
-00008cb0: 6174 6528 636f 6d70 6f6e 656e 742e 7365  ate(component.se
-00008cc0: 7474 696e 6773 290a 0a20 2020 2040 7072  ttings)..    @pr
-00008cd0: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
-00008ce0: 697a 655f 696e 666f 2873 656c 6629 202d  ize_info(self) -
-00008cf0: 3e20 5369 7a65 496e 666f 3a0a 2020 2020  > SizeInfo:.    
-00008d00: 2020 2020 2222 2253 697a 6520 696e 666f      """Size info
-00008d10: 206f 6620 7468 6520 636f 6d70 6f6e 656e   of the componen
-00008d20: 742e 2222 220a 2020 2020 2020 2020 7265  t.""".        re
-00008d30: 7475 726e 2053 697a 6549 6e66 6f28 7365  turn SizeInfo(se
-00008d40: 6c66 2e62 626f 7829 0a0a 2020 2020 6465  lf.bbox)..    de
-00008d50: 6620 6765 745f 7365 7474 696e 6728 7365  f get_setting(se
-00008d60: 6c66 2c20 7365 7474 696e 673a 2073 7472  lf, setting: str
-00008d70: 2920 2d3e 2055 6e69 6f6e 5b73 7472 2c20  ) -> Union[str, 
-00008d80: 696e 742c 2066 6c6f 6174 5d3a 0a20 2020  int, float]:.   
-00008d90: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
-00008da0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00008db0: 6e66 6f2e 6765 7428 7365 7474 696e 6729  nfo.get(setting)
-00008dc0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-00008dd0: 7365 6c66 2e73 6574 7469 6e67 732e 6675  self.settings.fu
-00008de0: 6c6c 2e67 6574 2873 6574 7469 6e67 290a  ll.get(setting).
-00008df0: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
-00008e00: 656c 662e 6d65 7461 6461 7461 5f63 6869  elf.metadata_chi
-00008e10: 6c64 2e67 6574 2873 6574 7469 6e67 290a  ld.get(setting).
-00008e20: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00008e30: 6566 2069 735f 756e 6c6f 636b 6564 2873  ef is_unlocked(s
-00008e40: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00008e50: 2020 2020 2020 2222 2252 6169 7365 7320        """Raises 
-00008e60: 6572 726f 7220 6966 2043 6f6d 706f 6e65  error if Compone
-00008e70: 6e74 2069 7320 6c6f 636b 6564 2e22 2222  nt is locked."""
-00008e80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00008e90: 2e5f 6c6f 636b 6564 3a0a 2020 2020 2020  ._locked:.      
-00008ea0: 2020 2020 2020 7261 6973 6520 4d75 7461        raise Muta
-00008eb0: 6269 6c69 7479 4572 726f 7228 0a20 2020  bilityError(.   
-00008ec0: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
-00008ed0: 6f6d 706f 6e65 6e74 207b 7365 6c66 2e6e  omponent {self.n
-00008ee0: 616d 6521 727d 2063 616e 6e6f 7420 6265  ame!r} cannot be
-00008ef0: 206d 6f64 6966 6965 6420 6173 2069 7427   modified as it'
-00008f00: 7320 616c 7265 6164 7920 6f6e 2063 6163  s already on cac
-00008f10: 6865 2e20 220a 2020 2020 2020 2020 2020  he. ".          
-00008f20: 2020 2020 2020 2b20 6d75 7461 6269 6c69        + mutabili
-00008f30: 7479 5f65 7272 6f72 5f6d 6573 7361 6765  ty_error_message
-00008f40: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00008f50: 2020 2020 6465 6620 5f61 6464 2873 656c      def _add(sel
-00008f60: 662c 2065 6c65 6d65 6e74 2920 2d3e 204e  f, element) -> N
-00008f70: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00008f80: 4164 6420 6120 6e65 7720 656c 656d 656e  Add a new elemen
-00008f90: 7420 6f72 206c 6973 7420 6f66 2065 6c65  t or list of ele
-00008fa0: 6d65 6e74 7320 746f 2074 6869 7320 436f  ments to this Co
-00008fb0: 6d70 6f6e 656e 742e 0a0a 2020 2020 2020  mponent...      
-00008fc0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00008fd0: 2020 2020 656c 656d 656e 743a 2050 6f6c      element: Pol
-00008fe0: 7967 6f6e 2c20 436f 6d70 6f6e 656e 7452  ygon, ComponentR
-00008ff0: 6566 6572 656e 6365 206f 7220 6974 6572  eference or iter
-00009000: 6162 6c65 0a20 2020 2020 2020 2020 2020  able.           
-00009010: 2020 2020 2054 6865 2065 6c65 6d65 6e74       The element
-00009020: 206f 7220 6974 6572 6162 6c65 206f 6620   or iterable of 
-00009030: 656c 656d 656e 7473 2074 6f20 6265 2069  elements to be i
-00009040: 6e73 6572 7465 6420 696e 2074 6869 7320  nserted in this 
-00009050: 6365 6c6c 2e0a 0a20 2020 2020 2020 2052  cell...        R
-00009060: 6169 7365 733a 0a20 2020 2020 2020 2020  aises:.         
-00009070: 2020 204d 7574 6162 696c 6974 7945 7272     MutabilityErr
-00009080: 6f72 3a20 6966 2063 6f6d 706f 6e65 6e74  or: if component
-00009090: 2069 7320 6c6f 636b 6564 2e0a 2020 2020   is locked..    
-000090a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000090b0: 7365 6c66 2e69 735f 756e 6c6f 636b 6564  self.is_unlocked
-000090c0: 2829 0a20 2020 2020 2020 2069 6620 6973  ().        if is
-000090d0: 696e 7374 616e 6365 2865 6c65 6d65 6e74  instance(element
-000090e0: 2c20 436f 6d70 6f6e 656e 7452 6566 6572  , ComponentRefer
-000090f0: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
-00009100: 2020 2073 656c 662e 5f63 656c 6c2e 6164     self._cell.ad
-00009110: 6428 656c 656d 656e 742e 5f72 6566 6572  d(element._refer
-00009120: 656e 6365 290a 2020 2020 2020 2020 2020  ence).          
-00009130: 2020 7365 6c66 2e5f 7265 6665 7265 6e63    self._referenc
-00009140: 6573 2e61 7070 656e 6428 656c 656d 656e  es.append(elemen
-00009150: 7429 0a20 2020 2020 2020 2065 6c73 653a  t).        else:
-00009160: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00009170: 662e 5f63 656c 6c2e 6164 6428 656c 656d  f._cell.add(elem
-00009180: 656e 7429 0a0a 2020 2020 6465 6620 6164  ent)..    def ad
-00009190: 6428 7365 6c66 2c20 656c 656d 656e 7429  d(self, element)
-000091a0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000091b0: 2020 2222 2241 6464 2061 206e 6577 2065    """Add a new e
-000091c0: 6c65 6d65 6e74 206f 7220 6c69 7374 206f  lement or list o
-000091d0: 6620 656c 656d 656e 7473 2074 6f20 7468  f elements to th
-000091e0: 6973 2043 6f6d 706f 6e65 6e74 2e0a 0a20  is Component... 
-000091f0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00009200: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
-00009210: 3a20 506f 6c79 676f 6e2c 2043 6f6d 706f  : Polygon, Compo
-00009220: 6e65 6e74 5265 6665 7265 6e63 6520 6f72  nentReference or
-00009230: 2069 7465 7261 626c 650a 2020 2020 2020   iterable.      
-00009240: 2020 2020 2020 2020 2020 5468 6520 656c            The el
-00009250: 656d 656e 7420 6f72 2069 7465 7261 626c  ement or iterabl
-00009260: 6520 6f66 2065 6c65 6d65 6e74 7320 746f  e of elements to
-00009270: 2062 6520 696e 7365 7274 6564 2069 6e20   be inserted in 
-00009280: 7468 6973 2063 656c 6c2e 0a0a 2020 2020  this cell...    
-00009290: 2020 2020 5261 6973 6573 3a0a 2020 2020      Raises:.    
-000092a0: 2020 2020 2020 2020 4d75 7461 6269 6c69          Mutabili
-000092b0: 7479 4572 726f 723a 2069 6620 636f 6d70  tyError: if comp
-000092c0: 6f6e 656e 7420 6973 206c 6f63 6b65 642e  onent is locked.
-000092d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000092e0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-000092f0: 6365 2865 6c65 6d65 6e74 2c20 436f 6d70  ce(element, Comp
-00009300: 6f6e 656e 7452 6566 6572 656e 6365 293a  onentReference):
-00009310: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00009320: 662e 5f72 6567 6973 7465 725f 7265 6665  f._register_refe
-00009330: 7265 6e63 6528 656c 656d 656e 7429 0a20  rence(element). 
-00009340: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00009350: 5f61 6464 2865 6c65 6d65 6e74 290a 2020  _add(element).  
-00009360: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-00009370: 7461 6e63 6528 656c 656d 656e 742c 2049  tance(element, I
-00009380: 7465 7261 626c 6529 3a0a 2020 2020 2020  terable):.      
-00009390: 2020 2020 2020 666f 7220 7375 6265 6c65        for subele
-000093a0: 6d65 6e74 2069 6e20 656c 656d 656e 743a  ment in element:
-000093b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000093c0: 2073 656c 662e 6164 6428 7375 6265 6c65   self.add(subele
-000093d0: 6d65 6e74 290a 2020 2020 2020 2020 656c  ment).        el
-000093e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000093f0: 7365 6c66 2e5f 6164 6428 656c 656d 656e  self._add(elemen
-00009400: 7429 0a0a 2020 2020 6465 6620 6164 645f  t)..    def add_
-00009410: 6172 7261 7928 0a20 2020 2020 2020 2073  array(.        s
-00009420: 656c 662c 0a20 2020 2020 2020 2063 6f6d  elf,.        com
-00009430: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
-00009440: 742c 0a20 2020 2020 2020 2063 6f6c 756d  t,.        colum
-00009450: 6e73 3a20 696e 7420 3d20 322c 0a20 2020  ns: int = 2,.   
-00009460: 2020 2020 2072 6f77 733a 2069 6e74 203d       rows: int =
-00009470: 2032 2c0a 2020 2020 2020 2020 7370 6163   2,.        spac
-00009480: 696e 673a 2054 7570 6c65 5b66 6c6f 6174  ing: Tuple[float
-00009490: 2c20 666c 6f61 745d 203d 2028 3130 302c  , float] = (100,
-000094a0: 2031 3030 292c 0a20 2020 2020 2020 2061   100),.        a
-000094b0: 6c69 6173 3a20 4f70 7469 6f6e 616c 5b73  lias: Optional[s
-000094c0: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
-000094d0: 2920 2d3e 2043 6f6d 706f 6e65 6e74 5265  ) -> ComponentRe
-000094e0: 6665 7265 6e63 653a 0a20 2020 2020 2020  ference:.       
-000094f0: 2022 2222 4372 6561 7465 7320 6120 436f   """Creates a Co
-00009500: 6d70 6f6e 656e 7452 6566 6572 656e 6365  mponentReference
-00009510: 2072 6566 6572 656e 6365 2074 6f20 6120   reference to a 
-00009520: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
-00009530: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00009540: 2020 2020 2020 636f 6d70 6f6e 656e 743a        component:
-00009550: 2054 6865 2072 6566 6572 656e 6365 6420   The referenced 
-00009560: 636f 6d70 6f6e 656e 742e 0a20 2020 2020  component..     
-00009570: 2020 2020 2020 2063 6f6c 756d 6e73 3a20         columns: 
-00009580: 4e75 6d62 6572 206f 6620 636f 6c75 6d6e  Number of column
-00009590: 7320 696e 2074 6865 2061 7272 6179 2e0a  s in the array..
-000095a0: 2020 2020 2020 2020 2020 2020 726f 7773              rows
-000095b0: 3a20 4e75 6d62 6572 206f 6620 726f 7773  : Number of rows
-000095c0: 2069 6e20 7468 6520 6172 7261 792e 0a20   in the array.. 
-000095d0: 2020 2020 2020 2020 2020 2073 7061 6369             spaci
-000095e0: 6e67 3a20 6172 7261 792d 6c69 6b65 5b32  ng: array-like[2
-000095f0: 5d20 6f66 2069 6e74 206f 7220 666c 6f61  ] of int or floa
-00009600: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
-00009610: 2020 2044 6973 7461 6e63 6520 6265 7477     Distance betw
-00009620: 6565 6e20 6164 6a61 6365 6e74 2063 6f6c  een adjacent col
-00009630: 756d 6e73 2061 6e64 2061 646a 6163 656e  umns and adjacen
-00009640: 7420 726f 7773 2e0a 2020 2020 2020 2020  t rows..        
-00009650: 2020 2020 616c 6961 733a 2073 7472 206f      alias: str o
-00009660: 7220 4e6f 6e65 2e20 416c 6961 7320 6f66  r None. Alias of
-00009670: 2074 6865 2072 6566 6572 656e 6365 6420   the referenced 
-00009680: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
-00009690: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000096a0: 2020 2020 2020 2020 613a 2043 6f6d 706f          a: Compo
-000096b0: 6e65 6e74 5265 6665 7265 6e63 6520 636f  nentReference co
-000096c0: 6e74 6169 6e69 6e67 2072 6566 6572 656e  ntaining referen
-000096d0: 6365 7320 746f 2074 6865 2043 6f6d 706f  ces to the Compo
-000096e0: 6e65 6e74 2e0a 2020 2020 2020 2020 2222  nent..        ""
-000096f0: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-00009700: 2069 7369 6e73 7461 6e63 6528 636f 6d70   isinstance(comp
-00009710: 6f6e 656e 742c 2043 6f6d 706f 6e65 6e74  onent, Component
-00009720: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00009730: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
-00009740: 6164 645f 6172 7261 7928 2920 6e65 6564  add_array() need
-00009750: 7320 6120 436f 6d70 6f6e 656e 7420 6f62  s a Component ob
-00009760: 6a65 6374 2e22 290a 2020 2020 2020 2020  ject.").        
-00009770: 7265 6620 3d20 436f 6d70 6f6e 656e 7452  ref = ComponentR
-00009780: 6566 6572 656e 6365 280a 2020 2020 2020  eference(.      
-00009790: 2020 2020 2020 636f 6d70 6f6e 656e 743d        component=
-000097a0: 636f 6d70 6f6e 656e 742c 0a20 2020 2020  component,.     
-000097b0: 2020 2020 2020 2063 6f6c 756d 6e73 3d69         columns=i
-000097c0: 6e74 2872 6f75 6e64 2863 6f6c 756d 6e73  nt(round(columns
-000097d0: 2929 2c0a 2020 2020 2020 2020 2020 2020  )),.            
-000097e0: 726f 7773 3d69 6e74 2872 6f75 6e64 2872  rows=int(round(r
-000097f0: 6f77 7329 292c 0a20 2020 2020 2020 2020  ows)),.         
-00009800: 2020 2073 7061 6369 6e67 3d73 7061 6369     spacing=spaci
-00009810: 6e67 2c0a 2020 2020 2020 2020 290a 2020  ng,.        ).  
-00009820: 2020 2020 2020 7265 662e 6e61 6d65 203d        ref.name =
-00009830: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-00009840: 6c66 2e5f 6164 6428 7265 6629 0a20 2020  lf._add(ref).   
-00009850: 2020 2020 2073 656c 662e 5f72 6567 6973       self._regis
-00009860: 7465 725f 7265 6665 7265 6e63 6528 7265  ter_reference(re
-00009870: 6665 7265 6e63 653d 7265 662c 2061 6c69  ference=ref, ali
-00009880: 6173 3d61 6c69 6173 290a 2020 2020 2020  as=alias).      
-00009890: 2020 7265 7475 726e 2072 6566 0a0a 2020    return ref..  
-000098a0: 2020 6465 6620 6469 7374 7269 6275 7465    def distribute
-000098b0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-000098c0: 656c 656d 656e 7473 3d22 616c 6c22 2c20  elements="all", 
-000098d0: 6469 7265 6374 696f 6e3d 2278 222c 2073  direction="x", s
-000098e0: 7061 6369 6e67 3d31 3030 2c20 7365 7061  pacing=100, sepa
-000098f0: 7261 7469 6f6e 3d54 7275 652c 2065 6467  ration=True, edg
-00009900: 653d 2263 656e 7465 7222 0a20 2020 2029  e="center".    )
-00009910: 3a0a 2020 2020 2020 2020 2222 2244 6973  :.        """Dis
-00009920: 7472 6962 7574 6573 2074 6865 2073 7065  tributes the spe
-00009930: 6369 6669 6564 2065 6c65 6d65 6e74 7320  cified elements 
-00009940: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
-00009950: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00009960: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
-00009970: 6d65 6e74 7320 3a20 6172 7261 792d 6c69  ments : array-li
-00009980: 6b65 206f 6620 6f62 6a65 6374 7320 6f72  ke of objects or
-00009990: 2027 616c 6c27 0a20 2020 2020 2020 2020   'all'.         
-000099a0: 2020 2020 2020 2045 6c65 6d65 6e74 7320         Elements 
-000099b0: 746f 2064 6973 7472 6962 7574 652e 0a20  to distribute.. 
-000099c0: 2020 2020 2020 2020 2020 2064 6972 6563             direc
-000099d0: 7469 6f6e 203a 207b 2778 272c 2027 7927  tion : {'x', 'y'
-000099e0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-000099f0: 2020 4469 7265 6374 696f 6e20 6f66 2064    Direction of d
-00009a00: 6973 7472 6962 7574 696f 6e3b 2065 6974  istribution; eit
-00009a10: 6865 7220 6120 6c69 6e65 2069 6e20 7468  her a line in th
-00009a20: 6520 782d 6469 7265 6374 696f 6e20 6f72  e x-direction or
-00009a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009a40: 2079 2d64 6972 6563 7469 6f6e 2e0a 2020   y-direction..  
-00009a50: 2020 2020 2020 2020 2020 7370 6163 696e            spacin
-00009a60: 6720 3a20 696e 7420 6f72 2066 6c6f 6174  g : int or float
-00009a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009a80: 2044 6973 7461 6e63 6520 6265 7477 6565   Distance betwee
-00009a90: 6e20 656c 656d 656e 7473 2e0a 2020 2020  n elements..    
-00009aa0: 2020 2020 2020 2020 7365 7061 7261 7469          separati
-00009ab0: 6f6e 203a 2062 6f6f 6c0a 2020 2020 2020  on : bool.      
-00009ac0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-00009ad0: 652c 2067 7561 7261 6e74 6565 7320 656c  e, guarantees el
-00009ae0: 656d 656e 7473 2061 7265 2073 6570 6172  ements are separ
-00009af0: 6174 6564 2077 6974 6820 6120 6669 7865  ated with a fixe
-00009b00: 6420 7370 6163 696e 670a 2020 2020 2020  d spacing.      
-00009b10: 2020 2020 2020 2020 2020 6265 7477 6565            betwee
-00009b20: 6e3b 2069 6620 2046 616c 7365 2c20 656c  n; if  False, el
-00009b30: 656d 656e 7473 2061 7265 2073 7061 6365  ements are space
-00009b40: 6420 6576 656e 6c79 2061 6c6f 6e67 2061  d evenly along a
-00009b50: 2067 7269 642e 0a20 2020 2020 2020 2020   grid..         
-00009b60: 2020 2065 6467 6520 3a20 7b27 7827 2c20     edge : {'x', 
-00009b70: 2778 6d69 6e27 2c20 2778 6d61 7827 2c20  'xmin', 'xmax', 
-00009b80: 2779 272c 2027 796d 696e 272c 2027 796d  'y', 'ymin', 'ym
-00009b90: 6178 277d 0a20 2020 2020 2020 2020 2020  ax'}.           
-00009ba0: 2020 2020 2057 6869 6368 2065 6467 6520       Which edge 
-00009bb0: 746f 2070 6572 666f 726d 2074 6865 2064  to perform the d
-00009bc0: 6973 7472 6962 7574 696f 6e20 616c 6f6e  istribution alon
-00009bd0: 6720 2875 6e75 7365 6420 6966 0a20 2020  g (unused if.   
-00009be0: 2020 2020 2020 2020 2020 2020 2073 6570               sep
-00009bf0: 6172 6174 696f 6e20 3d3d 2054 7275 6529  aration == True)
-00009c00: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00009c10: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
-00009c20: 7320 3d3d 2022 616c 6c22 3a0a 2020 2020  s == "all":.    
-00009c30: 2020 2020 2020 2020 656c 656d 656e 7473          elements
-00009c40: 203d 2073 656c 662e 706f 6c79 676f 6e73   = self.polygons
-00009c50: 202b 2073 656c 662e 7265 6665 7265 6e63   + self.referenc
-00009c60: 6573 0a20 2020 2020 2020 205f 6469 7374  es.        _dist
-00009c70: 7269 6275 7465 280a 2020 2020 2020 2020  ribute(.        
-00009c80: 2020 2020 656c 656d 656e 7473 3d65 6c65      elements=ele
-00009c90: 6d65 6e74 732c 0a20 2020 2020 2020 2020  ments,.         
-00009ca0: 2020 2064 6972 6563 7469 6f6e 3d64 6972     direction=dir
-00009cb0: 6563 7469 6f6e 2c0a 2020 2020 2020 2020  ection,.        
-00009cc0: 2020 2020 7370 6163 696e 673d 7370 6163      spacing=spac
-00009cd0: 696e 672c 0a20 2020 2020 2020 2020 2020  ing,.           
-00009ce0: 2073 6570 6172 6174 696f 6e3d 7365 7061   separation=sepa
-00009cf0: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
-00009d00: 2020 2020 6564 6765 3d65 6467 652c 0a20      edge=edge,. 
-00009d10: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00009d20: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
-00009d30: 2020 6465 6620 616c 6967 6e28 7365 6c66    def align(self
-00009d40: 2c20 656c 656d 656e 7473 3d22 616c 6c22  , elements="all"
-00009d50: 2c20 616c 6967 6e6d 656e 743d 2279 6d61  , alignment="yma
-00009d60: 7822 293a 0a20 2020 2020 2020 2022 2222  x"):.        """
-00009d70: 416c 6967 6e20 656c 656d 656e 7473 2069  Align elements i
-00009d80: 6e20 7468 6520 436f 6d70 6f6e 656e 742e  n the Component.
-00009d90: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-00009da0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-00009db0: 656e 7473 203a 2061 7272 6179 2d6c 696b  ents : array-lik
-00009dc0: 6520 6f66 206f 626a 6563 7473 2c20 6f72  e of objects, or
-00009dd0: 2027 616c 6c27 0a20 2020 2020 2020 2020   'all'.         
-00009de0: 2020 2020 2020 2045 6c65 6d65 6e74 7320         Elements 
-00009df0: 696e 2074 6865 2043 6f6d 706f 6e65 6e74  in the Component
-00009e00: 2074 6f20 616c 6967 6e2e 0a20 2020 2020   to align..     
-00009e10: 2020 2020 2020 2061 6c69 676e 6d65 6e74         alignment
-00009e20: 203a 207b 2778 272c 2027 7927 2c20 2778   : {'x', 'y', 'x
-00009e30: 6d69 6e27 2c20 2778 6d61 7827 2c20 2779  min', 'xmax', 'y
-00009e40: 6d69 6e27 2c20 2779 6d61 7827 7d0a 2020  min', 'ymax'}.  
-00009e50: 2020 2020 2020 2020 2020 2020 2020 5768                Wh
-00009e60: 6963 6820 6564 6765 2074 6f20 616c 6967  ich edge to alig
-00009e70: 6e20 616c 6f6e 6720 2865 2e67 2e20 2779  n along (e.g. 'y
-00009e80: 6d61 7827 2077 696c 6c20 6d6f 7665 2074  max' will move t
-00009e90: 6865 2065 6c65 6d65 6e74 7320 7375 6368  he elements such
-00009ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009eb0: 2074 6861 7420 616c 6c20 6f66 2074 6865   that all of the
-00009ec0: 6972 2074 6f70 6d6f 7374 2070 6f69 6e74  ir topmost point
-00009ed0: 7320 6172 6520 616c 6967 6e65 6429 2e0a  s are aligned)..
-00009ee0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00009ef0: 2020 2020 6966 2065 6c65 6d65 6e74 7320      if elements 
-00009f00: 3d3d 2022 616c 6c22 3a0a 2020 2020 2020  == "all":.      
-00009f10: 2020 2020 2020 656c 656d 656e 7473 203d        elements =
-00009f20: 2073 656c 662e 706f 6c79 676f 6e73 202b   self.polygons +
-00009f30: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
-00009f40: 0a20 2020 2020 2020 205f 616c 6967 6e28  .        _align(
-00009f50: 656c 656d 656e 7473 2c20 616c 6967 6e6d  elements, alignm
-00009f60: 656e 743d 616c 6967 6e6d 656e 7429 0a20  ent=alignment). 
-00009f70: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00009f80: 6c66 0a0a 2020 2020 6465 6620 666c 6174  lf..    def flat
-00009f90: 7465 6e28 7365 6c66 2c20 7369 6e67 6c65  ten(self, single
-00009fa0: 5f6c 6179 6572 3a20 4f70 7469 6f6e 616c  _layer: Optional
-00009fb0: 5b4c 6179 6572 5370 6563 5d20 3d20 4e6f  [LayerSpec] = No
-00009fc0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00009fd0: 5265 7475 726e 7320 6120 666c 6174 7465  Returns a flatte
-00009fe0: 6e65 6420 636f 7079 206f 6620 7468 6520  ned copy of the 
-00009ff0: 636f 6d70 6f6e 656e 742e 0a0a 2020 2020  component...    
-0000a000: 2020 2020 466c 6174 7465 6e73 2074 6865      Flattens the
-0000a010: 2068 6965 7261 7263 6879 206f 6620 7468   hierarchy of th
-0000a020: 6520 436f 6d70 6f6e 656e 7420 7375 6368  e Component such
-0000a030: 2074 6861 7420 7468 6572 6520 6172 6520   that there are 
-0000a040: 6e6f 206c 6f6e 6765 720a 2020 2020 2020  no longer.      
-0000a050: 2020 616e 7920 7265 6665 7265 6e63 6573    any references
-0000a060: 2074 6f20 6f74 6865 7220 436f 6d70 6f6e   to other Compon
-0000a070: 656e 7473 2e20 416c 6c20 706f 6c79 676f  ents. All polygo
-0000a080: 6e73 2061 6e64 206c 6162 656c 7320 6672  ns and labels fr
-0000a090: 6f6d 0a20 2020 2020 2020 2075 6e64 6572  om.        under
-0000a0a0: 6c79 696e 6720 7265 6665 7265 6e63 6573  lying references
-0000a0b0: 2061 7265 2063 6f70 6965 6420 616e 6420   are copied and 
-0000a0c0: 706c 6163 6564 2069 6e20 7468 6520 746f  placed in the to
-0000a0d0: 702d 6c65 7665 6c20 436f 6d70 6f6e 656e  p-level Componen
-0000a0e0: 742e 0a20 2020 2020 2020 2049 6620 7369  t..        If si
-0000a0f0: 6e67 6c65 5f6c 6179 6572 2069 7320 7370  ngle_layer is sp
-0000a100: 6563 6966 6965 642c 2061 6c6c 2070 6f6c  ecified, all pol
-0000a110: 7967 6f6e 7320 6172 6520 6d6f 7665 6420  ygons are moved 
-0000a120: 746f 2074 6861 7420 6c61 7965 722e 0a0a  to that layer...
-0000a130: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-0000a140: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-0000a150: 5f6c 6179 6572 3a20 6d6f 7665 2061 6c6c  _layer: move all
-0000a160: 2070 6f6c 7967 6f6e 7320 6172 6520 6d6f   polygons are mo
-0000a170: 7665 6420 746f 2074 6865 2073 7065 6369  ved to the speci
-0000a180: 6669 6564 2028 6f70 7469 6f6e 616c 292e  fied (optional).
-0000a190: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000a1a0: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
-0000a1b0: 6c61 7420 3d20 436f 6d70 6f6e 656e 7428  lat = Component(
-0000a1c0: 290a 0a20 2020 2020 2020 205f 6365 6c6c  )..        _cell
-0000a1d0: 203d 2073 656c 662e 5f63 656c 6c2e 636f   = self._cell.co
-0000a1e0: 7079 286e 616d 653d 636f 6d70 6f6e 656e  py(name=componen
-0000a1f0: 745f 666c 6174 2e6e 616d 6529 0a20 2020  t_flat.name).   
-0000a200: 2020 2020 205f 6365 6c6c 203d 205f 6365       _cell = _ce
-0000a210: 6c6c 2e66 6c61 7474 656e 2829 0a20 2020  ll.flatten().   
-0000a220: 2020 2020 2063 6f6d 706f 6e65 6e74 5f66       component_f
-0000a230: 6c61 742e 5f63 656c 6c20 3d20 5f63 656c  lat._cell = _cel
-0000a240: 6c0a 2020 2020 2020 2020 6966 2073 696e  l.        if sin
-0000a250: 676c 655f 6c61 7965 7220 6973 206e 6f74  gle_layer is not
-0000a260: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000a270: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000a280: 7279 2069 6d70 6f72 7420 6765 745f 6c61  ry import get_la
-0000a290: 7965 720a 0a20 2020 2020 2020 2020 2020  yer..           
-0000a2a0: 206c 6179 6572 2c20 6461 7461 7479 7065   layer, datatype
-0000a2b0: 203d 2067 6574 5f6c 6179 6572 2873 696e   = get_layer(sin
-0000a2c0: 676c 655f 6c61 7965 7229 0a20 2020 2020  gle_layer).     
-0000a2d0: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
-0000a2e0: 6f6e 2069 6e20 5f63 656c 6c2e 706f 6c79  on in _cell.poly
-0000a2f0: 676f 6e73 3a0a 2020 2020 2020 2020 2020  gons:.          
-0000a300: 2020 2020 2020 706f 6c79 676f 6e2e 6c61        polygon.la
-0000a310: 7965 7220 3d20 6c61 7965 720a 2020 2020  yer = layer.    
-0000a320: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-0000a330: 676f 6e2e 6461 7461 7479 7065 203d 2064  gon.datatype = d
-0000a340: 6174 6174 7970 650a 2020 2020 2020 2020  atatype.        
-0000a350: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
-0000a360: 5f63 656c 6c2e 7061 7468 733a 0a20 2020  _cell.paths:.   
-0000a370: 2020 2020 2020 2020 2020 2020 2070 6174               pat
-0000a380: 682e 7365 745f 6c61 7965 7273 286c 6179  h.set_layers(lay
-0000a390: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-0000a3a0: 2020 2020 7061 7468 2e73 6574 5f64 6174      path.set_dat
-0000a3b0: 6174 7970 6573 2864 6174 6174 7970 6529  atypes(datatype)
-0000a3c0: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
-0000a3d0: 656e 745f 666c 6174 2e69 6e66 6f20 3d20  ent_flat.info = 
-0000a3e0: 7365 6c66 2e69 6e66 6f2e 636f 7079 2829  self.info.copy()
-0000a3f0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
-0000a400: 6e74 5f66 6c61 742e 6164 645f 706f 7274  nt_flat.add_port
-0000a410: 7328 7365 6c66 2e70 6f72 7473 290a 2020  s(self.ports).  
-0000a420: 2020 2020 2020 7265 7475 726e 2063 6f6d        return com
-0000a430: 706f 6e65 6e74 5f66 6c61 740a 0a20 2020  ponent_flat..   
-0000a440: 2064 6566 2066 6c61 7474 656e 5f72 6566   def flatten_ref
-0000a450: 6572 656e 6365 2873 656c 662c 2072 6566  erence(self, ref
-0000a460: 3a20 436f 6d70 6f6e 656e 7452 6566 6572  : ComponentRefer
-0000a470: 656e 6365 293a 0a20 2020 2020 2020 2022  ence):.        "
-0000a480: 2222 4672 6f6d 2065 7869 7374 696e 6720  ""From existing 
-0000a490: 6365 6c6c 2072 6570 6c61 6365 7320 7265  cell replaces re
-0000a4a0: 6665 7265 6e63 6520 7769 7468 2061 2066  ference with a f
-0000a4b0: 6c61 7474 656e 2072 6566 6572 656e 6365  latten reference
-0000a4c0: 205c 0a20 2020 2020 2020 2077 6869 6368   \.        which
-0000a4d0: 2068 6173 2074 6865 2074 7261 6e73 666f   has the transfo
-0000a4e0: 726d 6174 696f 6e73 2061 6c72 6561 6479  rmations already
-0000a4f0: 2061 7070 6c69 6564 2e0a 0a20 2020 2020   applied...     
-0000a500: 2020 2054 7261 6e73 666f 726d 6564 2072     Transformed r
-0000a510: 6566 6572 656e 6365 206b 6565 7073 2074  eference keeps t
-0000a520: 6865 206f 7269 6769 6e61 6c20 6e61 6d65  he original name
-0000a530: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-0000a540: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
-0000a550: 3a20 7468 6520 7265 6665 7265 6e63 6520  : the reference 
-0000a560: 746f 2066 6c61 7474 656e 2069 6e74 6f20  to flatten into 
-0000a570: 6120 6e65 7720 6365 6c6c 2e0a 0a20 2020  a new cell...   
-0000a580: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000a590: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-0000a5a0: 2e66 756e 6374 696f 6e73 2069 6d70 6f72  .functions impor
-0000a5b0: 7420 7472 616e 7366 6f72 6d65 640a 0a20  t transformed.. 
-0000a5c0: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-0000a5d0: 7665 2872 6566 290a 2020 2020 2020 2020  ve(ref).        
-0000a5e0: 6e65 775f 636f 6d70 6f6e 656e 7420 3d20  new_component = 
-0000a5f0: 7472 616e 7366 6f72 6d65 6428 7265 662c  transformed(ref,
-0000a600: 2064 6563 6f72 6174 6f72 3d4e 6f6e 6529   decorator=None)
-0000a610: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-0000a620: 645f 7265 6628 6e65 775f 636f 6d70 6f6e  d_ref(new_compon
-0000a630: 656e 742c 2061 6c69 6173 3d72 6566 2e6e  ent, alias=ref.n
-0000a640: 616d 6529 0a0a 2020 2020 6465 6620 6164  ame)..    def ad
-0000a650: 645f 7265 6628 0a20 2020 2020 2020 2073  d_ref(.        s
-0000a660: 656c 662c 2063 6f6d 706f 6e65 6e74 3a20  elf, component: 
-0000a670: 436f 6d70 6f6e 656e 742c 2061 6c69 6173  Component, alias
-0000a680: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-0000a690: 3d20 4e6f 6e65 2c20 2a2a 6b77 6172 6773  = None, **kwargs
-0000a6a0: 0a20 2020 2029 202d 3e20 436f 6d70 6f6e  .    ) -> Compon
-0000a6b0: 656e 7452 6566 6572 656e 6365 3a0a 2020  entReference:.  
-0000a6c0: 2020 2020 2020 2222 2241 6464 2043 6f6d        """Add Com
-0000a6d0: 706f 6e65 6e74 5265 6665 7265 6e63 6520  ponentReference 
-0000a6e0: 746f 2074 6865 2063 7572 7265 6e74 2043  to the current C
-0000a6f0: 6f6d 706f 6e65 6e74 2e0a 0a20 2020 2020  omponent...     
-0000a700: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-0000a710: 2020 2020 2063 6f6d 706f 6e65 6e74 3a20       component: 
-0000a720: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
-0000a730: 2020 2020 2020 2061 6c69 6173 3a20 6e61         alias: na
-0000a740: 6d65 645f 7265 6665 7265 6e63 6573 2e0a  med_references..
-0000a750: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
-0000a760: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0000a770: 2020 2063 6f6c 756d 6e73 3a20 4e75 6d62     columns: Numb
-0000a780: 6572 206f 6620 636f 6c75 6d6e 7320 696e  er of columns in
-0000a790: 2074 6865 2061 7272 6179 2e0a 2020 2020   the array..    
-0000a7a0: 2020 2020 2020 2020 726f 7773 3a20 4e75          rows: Nu
-0000a7b0: 6d62 6572 206f 6620 726f 7773 2069 6e20  mber of rows in 
-0000a7c0: 7468 6520 6172 7261 792e 0a20 2020 2020  the array..     
-0000a7d0: 2020 2020 2020 2073 7061 6369 6e67 3a20         spacing: 
-0000a7e0: 4469 7374 616e 6365 7320 6265 7477 6565  Distances betwee
-0000a7f0: 6e20 6164 6a61 6365 6e74 2063 6f6c 756d  n adjacent colum
-0000a800: 6e73 2061 6e64 2061 646a 6163 656e 7420  ns and adjacent 
-0000a810: 726f 7773 2e0a 2020 2020 2020 2020 2020  rows..          
-0000a820: 2020 6f72 6967 696e 3a20 6172 7261 792d    origin: array-
-0000a830: 6c69 6b65 5b32 5d20 6f66 2069 6e74 206f  like[2] of int o
-0000a840: 7220 666c 6f61 740a 2020 2020 2020 2020  r float.        
-0000a850: 2020 2020 2020 2020 506f 7369 7469 6f6e          Position
-0000a860: 2077 6865 7265 2074 6865 2063 656c 6c20   where the cell 
-0000a870: 6973 2069 6e73 6572 7465 642e 0a20 2020  is inserted..   
-0000a880: 2020 2020 2020 2020 2072 6f74 6174 696f           rotatio
-0000a890: 6e20 3a20 696e 7420 6f72 2066 6c6f 6174  n : int or float
-0000a8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a8b0: 2041 6e67 6c65 206f 6620 726f 7461 7469   Angle of rotati
-0000a8c0: 6f6e 206f 6620 7468 6520 7265 6665 7265  on of the refere
-0000a8d0: 6e63 6520 2869 6e20 6064 6567 7265 6573  nce (in `degrees
-0000a8e0: 6029 2e0a 2020 2020 2020 2020 2020 2020  `)..            
-0000a8f0: 6d61 676e 6966 6963 6174 696f 6e20 3a20  magnification : 
-0000a900: 696e 7420 6f72 2066 6c6f 6174 0a20 2020  int or float.   
-0000a910: 2020 2020 2020 2020 2020 2020 204d 6167               Mag
-0000a920: 6e69 6669 6361 7469 6f6e 2066 6163 746f  nification facto
-0000a930: 7220 666f 7220 7468 6520 7265 6665 7265  r for the refere
-0000a940: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
-0000a950: 2078 5f72 6566 6c65 6374 696f 6e20 3a20   x_reflection : 
-0000a960: 626f 6f6c 0a20 2020 2020 2020 2020 2020  bool.           
-0000a970: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0000a980: 6520 7265 6665 7265 6e63 6520 6973 2072  e reference is r
-0000a990: 6566 6c65 6374 6564 2070 6172 616c 6c65  eflected paralle
-0000a9a0: 6c20 746f 2074 6865 2078 2064 6972 6563  l to the x direc
-0000a9b0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0000a9c0: 2020 2020 2062 6566 6f72 6520 6265 696e       before bein
-0000a9d0: 6720 726f 7461 7465 642e 0a20 2020 2020  g rotated..     
-0000a9e0: 2020 2020 2020 206e 616d 6520 3a20 7374         name : st
-0000a9f0: 7220 286f 7074 696f 6e61 6c29 0a20 2020  r (optional).   
-0000aa00: 2020 2020 2020 2020 2020 2020 2041 206e               A n
-0000aa10: 616d 6520 666f 7220 7468 6520 7265 6665  ame for the refe
-0000aa20: 7265 6e63 6520 2869 6620 7072 6f76 6964  rence (if provid
-0000aa30: 6564 292e 0a0a 2020 2020 2020 2020 2222  ed)...        ""
-0000aa40: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-0000aa50: 2069 7369 6e73 7461 6e63 6528 636f 6d70   isinstance(comp
-0000aa60: 6f6e 656e 742c 2043 6f6d 706f 6e65 6e74  onent, Component
-0000aa70: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0000aa80: 6169 7365 2054 7970 6545 7272 6f72 2866  aise TypeError(f
-0000aa90: 2274 7970 6520 3d20 7b74 7970 6528 436f  "type = {type(Co
-0000aaa0: 6d70 6f6e 656e 7429 7d20 6e65 6564 7320  mponent)} needs 
-0000aab0: 746f 2062 6520 6120 436f 6d70 6f6e 656e  to be a Componen
-0000aac0: 742e 2229 0a20 2020 2020 2020 2072 6566  t.").        ref
-0000aad0: 203d 2043 6f6d 706f 6e65 6e74 5265 6665   = ComponentRefe
-0000aae0: 7265 6e63 6528 636f 6d70 6f6e 656e 742c  rence(component,
-0000aaf0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-0000ab00: 2020 2073 656c 662e 5f61 6464 2872 6566     self._add(ref
-0000ab10: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-0000ab20: 7265 6769 7374 6572 5f72 6566 6572 656e  register_referen
-0000ab30: 6365 2872 6566 6572 656e 6365 3d72 6566  ce(reference=ref
-0000ab40: 2c20 616c 6961 733d 616c 6961 7329 0a20  , alias=alias). 
-0000ab50: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0000ab60: 660a 0a20 2020 2064 6566 205f 7265 6769  f..    def _regi
-0000ab70: 7374 6572 5f72 6566 6572 656e 6365 280a  ster_reference(.
-0000ab80: 2020 2020 2020 2020 7365 6c66 2c20 7265          self, re
-0000ab90: 6665 7265 6e63 653a 2043 6f6d 706f 6e65  ference: Compone
-0000aba0: 6e74 5265 6665 7265 6e63 652c 2061 6c69  ntReference, ali
-0000abb0: 6173 3a20 4f70 7469 6f6e 616c 5b73 7472  as: Optional[str
-0000abc0: 5d20 3d20 4e6f 6e65 0a20 2020 2029 202d  ] = None.    ) -
-0000abd0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-0000abe0: 636f 6d70 6f6e 656e 7420 3d20 7265 6665  component = refe
-0000abf0: 7265 6e63 652e 7061 7265 6e74 0a20 2020  rence.parent.   
-0000ac00: 2020 2020 2072 6566 6572 656e 6365 2e6f       reference.o
-0000ac10: 776e 6572 203d 2073 656c 660a 0a20 2020  wner = self..   
-0000ac20: 2020 2020 2069 6620 616c 6961 7320 6973       if alias is
-0000ac30: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000ac40: 2020 2069 6620 7265 6665 7265 6e63 652e     if reference.
-0000ac50: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
-0000ac60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ac70: 2020 616c 6961 7320 3d20 7265 6665 7265    alias = refere
-0000ac80: 6e63 652e 6e61 6d65 0a20 2020 2020 2020  nce.name.       
-0000ac90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000aca0: 2020 2020 2020 2020 2020 2070 7265 6669             prefi
-0000acb0: 7820 3d20 280a 2020 2020 2020 2020 2020  x = (.          
-0000acc0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000acd0: 656e 742e 7365 7474 696e 6773 2e66 756e  ent.settings.fun
-0000ace0: 6374 696f 6e5f 6e61 6d65 0a20 2020 2020  ction_name.     
-0000acf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000ad00: 6620 6861 7361 7474 7228 636f 6d70 6f6e  f hasattr(compon
-0000ad10: 656e 742c 2022 7365 7474 696e 6773 2229  ent, "settings")
-0000ad20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad30: 2020 2020 2061 6e64 2068 6173 6174 7472       and hasattr
-0000ad40: 2863 6f6d 706f 6e65 6e74 2e73 6574 7469  (component.setti
-0000ad50: 6e67 732c 2022 6675 6e63 7469 6f6e 5f6e  ngs, "function_n
-0000ad60: 616d 6522 290a 2020 2020 2020 2020 2020  ame").          
-0000ad70: 2020 2020 2020 2020 2020 656c 7365 2063            else c
-0000ad80: 6f6d 706f 6e65 6e74 2e6e 616d 650a 2020  omponent.name.  
-0000ad90: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000067f0: 7428 706f 7274 290a 0a20 2020 2040 7072  t(port)..    @pr
+00006800: 6f70 6572 7479 0a20 2020 2064 6566 206d  operty.    def m
+00006810: 6574 6164 6174 615f 6368 696c 6428 7365  etadata_child(se
+00006820: 6c66 2920 2d3e 2044 6963 743a 0a20 2020  lf) -> Dict:.   
+00006830: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
+00006840: 6d65 7461 6461 7461 2066 726f 6d20 6368  metadata from ch
+00006850: 696c 6420 6966 2061 6e79 2c20 4f74 6865  ild if any, Othe
+00006860: 7277 6973 6520 7265 7475 726e 7320 636f  rwise returns co
+00006870: 6d70 6f6e 656e 7420 6f77 6e2e 0a0a 2020  mponent own...  
+00006880: 2020 2020 2020 6d65 7461 6461 7461 2047        metadata G
+00006890: 7265 6174 2074 6f20 6163 6365 7373 2074  reat to access t
+000068a0: 6865 2063 6869 6c64 7265 6e20 6d65 7461  he children meta
+000068b0: 6461 7461 2061 7420 7468 6520 626f 7474  data at the bott
+000068c0: 6f6d 206f 6620 7468 650a 2020 2020 2020  om of the.      
+000068d0: 2020 6869 6572 6172 6368 792e 0a20 2020    hierarchy..   
+000068e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000068f0: 2073 6574 7469 6e67 7320 3d20 6469 6374   settings = dict
+00006900: 2873 656c 662e 7365 7474 696e 6773 290a  (self.settings).
+00006910: 0a20 2020 2020 2020 2077 6869 6c65 2073  .        while s
+00006920: 6574 7469 6e67 732e 6765 7428 2263 6869  ettings.get("chi
+00006930: 6c64 2229 3a0a 2020 2020 2020 2020 2020  ld"):.          
+00006940: 2020 7365 7474 696e 6773 203d 2073 6574    settings = set
+00006950: 7469 6e67 732e 6765 7428 2263 6869 6c64  tings.get("child
+00006960: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
+00006970: 726e 2064 6963 7428 7365 7474 696e 6773  rn dict(settings
+00006980: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+00006990: 0a20 2020 2064 6566 206d 6574 6164 6174  .    def metadat
+000069a0: 6128 7365 6c66 2920 2d3e 2044 6963 743a  a(self) -> Dict:
+000069b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000069c0: 6469 6374 2873 656c 662e 7365 7474 696e  dict(self.settin
+000069d0: 6773 290a 0a20 2020 2064 6566 2061 6464  gs)..    def add
+000069e0: 5f70 6f72 7428 0a20 2020 2020 2020 2073  _port(.        s
+000069f0: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
+00006a00: 653a 204f 7074 696f 6e61 6c5b 556e 696f  e: Optional[Unio
+00006a10: 6e5b 7374 722c 206f 626a 6563 745d 5d20  n[str, object]] 
+00006a20: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00006a30: 6365 6e74 6572 3a20 4f70 7469 6f6e 616c  center: Optional
+00006a40: 5b54 7570 6c65 5b66 6c6f 6174 2c20 666c  [Tuple[float, fl
+00006a50: 6f61 745d 5d20 3d20 4e6f 6e65 2c0a 2020  oat]] = None,.  
+00006a60: 2020 2020 2020 7769 6474 683a 204f 7074        width: Opt
+00006a70: 696f 6e61 6c5b 666c 6f61 745d 203d 204e  ional[float] = N
+00006a80: 6f6e 652c 0a20 2020 2020 2020 206f 7269  one,.        ori
+00006a90: 656e 7461 7469 6f6e 3a20 4f70 7469 6f6e  entation: Option
+00006aa0: 616c 5b66 6c6f 6174 5d20 3d20 4e6f 6e65  al[float] = None
+00006ab0: 2c0a 2020 2020 2020 2020 706f 7274 3a20  ,.        port: 
+00006ac0: 4f70 7469 6f6e 616c 5b50 6f72 745d 203d  Optional[Port] =
+00006ad0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
+00006ae0: 6179 6572 3a20 4c61 7965 7253 7065 6320  ayer: LayerSpec 
+00006af0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00006b00: 706f 7274 5f74 7970 653a 204f 7074 696f  port_type: Optio
+00006b10: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
+00006b20: 0a20 2020 2020 2020 2063 726f 7373 5f73  .        cross_s
+00006b30: 6563 7469 6f6e 3a20 4f70 7469 6f6e 616c  ection: Optional
+00006b40: 5b43 726f 7373 5365 6374 696f 6e5d 203d  [CrossSection] =
+00006b50: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+00006b60: 506f 7274 3a0a 2020 2020 2020 2020 2222  Port:.        ""
+00006b70: 2241 6464 2070 6f72 7420 746f 2063 6f6d  "Add port to com
+00006b80: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+00006b90: 2059 6f75 2063 616e 2063 6f70 7920 616e   You can copy an
+00006ba0: 2065 7869 7374 696e 6720 706f 7274 206c   existing port l
+00006bb0: 696b 6520 6164 645f 706f 7274 2870 6f72  ike add_port(por
+00006bc0: 7420 3d20 6578 6973 7469 6e67 5f70 6f72  t = existing_por
+00006bd0: 7429 206f 720a 2020 2020 2020 2020 6372  t) or.        cr
+00006be0: 6561 7465 2061 206e 6577 2070 6f72 7420  eate a new port 
+00006bf0: 6164 645f 706f 7274 286d 796e 616d 652c  add_port(myname,
+00006c00: 206d 7963 656e 7465 722c 206d 7977 6964   mycenter, mywid
+00006c10: 7468 2c20 6d79 6f72 6965 6e74 6174 696f  th, myorientatio
+00006c20: 6e29 2e0a 2020 2020 2020 2020 596f 7520  n)..        You 
+00006c30: 6361 6e20 616c 736f 2063 6f70 7920 616e  can also copy an
+00006c40: 2065 7869 7374 696e 6720 706f 7274 0a20   existing port. 
+00006c50: 2020 2020 2020 2077 6974 6820 6120 6e65         with a ne
+00006c60: 7720 6e61 6d65 2061 6464 5f70 6f72 7428  w name add_port(
+00006c70: 706f 7274 203d 2065 7869 7374 696e 675f  port = existing_
+00006c80: 706f 7274 2c20 6e61 6d65 203d 206e 6577  port, name = new
+00006c90: 5f6e 616d 6529 0a0a 2020 2020 2020 2020  _name)..        
+00006ca0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00006cb0: 2020 6e61 6d65 3a20 706f 7274 206e 616d    name: port nam
+00006cc0: 652e 0a20 2020 2020 2020 2020 2020 2063  e..            c
+00006cd0: 656e 7465 723a 2078 2c20 792e 0a20 2020  enter: x, y..   
+00006ce0: 2020 2020 2020 2020 2077 6964 7468 3a20           width: 
+00006cf0: 696e 2075 6d2e 0a20 2020 2020 2020 2020  in um..         
+00006d00: 2020 206f 7269 656e 7461 7469 6f6e 3a20     orientation: 
+00006d10: 696e 2064 6567 2e0a 2020 2020 2020 2020  in deg..        
+00006d20: 2020 2020 706f 7274 3a20 6f70 7469 6f6e      port: option
+00006d30: 616c 2070 6f72 742e 0a20 2020 2020 2020  al port..       
+00006d40: 2020 2020 206c 6179 6572 3a20 706f 7274       layer: port
+00006d50: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00006d60: 2020 2020 706f 7274 5f74 7970 653a 206f      port_type: o
+00006d70: 7074 6963 616c 2c20 656c 6563 7472 6963  ptical, electric
+00006d80: 616c 2c20 7665 7274 6963 616c 5f64 632c  al, vertical_dc,
+00006d90: 2076 6572 7469 6361 6c5f 7465 2c20 7665   vertical_te, ve
+00006da0: 7274 6963 616c 5f74 6d2e 2044 6566 6175  rtical_tm. Defau
+00006db0: 6c74 7320 746f 206f 7074 6963 616c 2e0a  lts to optical..
+00006dc0: 2020 2020 2020 2020 2020 2020 6372 6f73              cros
+00006dd0: 735f 7365 6374 696f 6e3a 2070 6f72 7420  s_section: port 
+00006de0: 6372 6f73 735f 7365 6374 696f 6e2e 0a20  cross_section.. 
+00006df0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00006e00: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+00006e10: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
+00006e20: 745f 6c61 7965 720a 0a20 2020 2020 2020  t_layer..       
+00006e30: 206c 6179 6572 203d 2067 6574 5f6c 6179   layer = get_lay
+00006e40: 6572 286c 6179 6572 290a 0a20 2020 2020  er(layer)..     
+00006e50: 2020 2069 6620 706f 7274 3a0a 2020 2020     if port:.    
+00006e60: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00006e70: 7369 6e73 7461 6e63 6528 706f 7274 2c20  sinstance(port, 
+00006e80: 506f 7274 293a 0a20 2020 2020 2020 2020  Port):.         
+00006e90: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00006ea0: 7565 4572 726f 7228 6622 6164 645f 706f  ueError(f"add_po
+00006eb0: 7274 2829 206e 6565 6473 2061 2050 6f72  rt() needs a Por
+00006ec0: 742c 2067 6f74 207b 7479 7065 2870 6f72  t, got {type(por
+00006ed0: 7429 7d22 290a 2020 2020 2020 2020 2020  t)}").          
+00006ee0: 2020 7020 3d20 706f 7274 2e63 6f70 7928    p = port.copy(
+00006ef0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00006f00: 206e 616d 6520 6973 206e 6f74 204e 6f6e   name is not Non
+00006f10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00006f20: 2020 2070 2e6e 616d 6520 3d20 6e61 6d65     p.name = name
+00006f30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00006f40: 6365 6e74 6572 2069 7320 6e6f 7420 4e6f  center is not No
+00006f50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006f60: 2020 2020 702e 6365 6e74 6572 203d 2063      p.center = c
+00006f70: 656e 7465 720a 2020 2020 2020 2020 2020  enter.          
+00006f80: 2020 6966 2077 6964 7468 2069 7320 6e6f    if width is no
+00006f90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00006fa0: 2020 2020 2020 2020 702e 7769 6474 6820          p.width 
+00006fb0: 3d20 7769 6474 680a 2020 2020 2020 2020  = width.        
+00006fc0: 2020 2020 6966 206f 7269 656e 7461 7469      if orientati
+00006fd0: 6f6e 2069 7320 6e6f 7420 4e6f 6e65 3a0a  on is not None:.
+00006fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ff0: 702e 6f72 6965 6e74 6174 696f 6e20 3d20  p.orientation = 
+00007000: 6f72 6965 6e74 6174 696f 6e0a 2020 2020  orientation.    
+00007010: 2020 2020 2020 2020 6966 2070 6f72 745f          if port_
+00007020: 7479 7065 2069 7320 6e6f 7420 4e6f 6e65  type is not None
+00007030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007040: 2020 702e 706f 7274 5f74 7970 6520 3d20    p.port_type = 
+00007050: 706f 7274 5f74 7970 650a 2020 2020 2020  port_type.      
+00007060: 2020 2020 2020 6966 206c 6179 6572 2069        if layer i
+00007070: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00007080: 2020 2020 2020 2020 2020 2020 702e 6c61              p.la
+00007090: 7965 7220 3d20 6c61 7965 720a 2020 2020  yer = layer.    
+000070a0: 2020 2020 2020 2020 702e 7061 7265 6e74          p.parent
+000070b0: 203d 2073 656c 660a 0a20 2020 2020 2020   = self..       
+000070c0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+000070d0: 286e 616d 652c 2050 6f72 7429 3a0a 2020  (name, Port):.  
+000070e0: 2020 2020 2020 2020 2020 7020 3d20 6e61            p = na
+000070f0: 6d65 2e63 6f70 7928 290a 2020 2020 2020  me.copy().      
+00007100: 2020 2020 2020 702e 7061 7265 6e74 203d        p.parent =
+00007110: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
+00007120: 2020 6e61 6d65 203d 2070 2e6e 616d 650a    name = p.name.
+00007130: 2020 2020 2020 2020 656c 6966 2063 656e          elif cen
+00007140: 7465 7220 6973 204e 6f6e 653a 0a20 2020  ter is None:.   
+00007150: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00007160: 616c 7565 4572 726f 7228 2250 6f72 7420  alueError("Port 
+00007170: 6e65 6564 7320 6365 6e74 6572 2070 6172  needs center par
+00007180: 616d 6574 6572 2028 782c 2079 2920 756d  ameter (x, y) um
+00007190: 2e22 290a 0a20 2020 2020 2020 2065 6c73  .")..        els
+000071a0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+000071b0: 203d 2050 6f72 7428 0a20 2020 2020 2020   = Port(.       
+000071c0: 2020 2020 2020 2020 206e 616d 653d 6e61           name=na
+000071d0: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
+000071e0: 2020 2020 6365 6e74 6572 3d63 656e 7465      center=cente
+000071f0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00007200: 2020 2077 6964 7468 3d77 6964 7468 2c0a     width=width,.
+00007210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007220: 6f72 6965 6e74 6174 696f 6e3d 6f72 6965  orientation=orie
+00007230: 6e74 6174 696f 6e2c 0a20 2020 2020 2020  ntation,.       
+00007240: 2020 2020 2020 2020 2070 6172 656e 743d           parent=
+00007250: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00007260: 2020 2020 2020 6c61 7965 723d 6c61 7965        layer=laye
+00007270: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00007280: 2020 2070 6f72 745f 7479 7065 3d70 6f72     port_type=por
+00007290: 745f 7479 7065 206f 7220 226f 7074 6963  t_type or "optic
+000072a0: 616c 222c 0a20 2020 2020 2020 2020 2020  al",.           
+000072b0: 2020 2020 2063 726f 7373 5f73 6563 7469       cross_secti
+000072c0: 6f6e 3d63 726f 7373 5f73 6563 7469 6f6e  on=cross_section
+000072d0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+000072e0: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
+000072f0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00007300: 2020 2020 2020 2020 2070 2e6e 616d 6520           p.name 
+00007310: 3d20 6e61 6d65 0a20 2020 2020 2020 2069  = name.        i
+00007320: 6620 702e 6e61 6d65 2069 6e20 7365 6c66  f p.name in self
+00007330: 2e70 6f72 7473 3a0a 2020 2020 2020 2020  .ports:.        
+00007340: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00007350: 7272 6f72 2866 2261 6464 5f70 6f72 7428  rror(f"add_port(
+00007360: 2920 506f 7274 206e 616d 6520 7b70 2e6e  ) Port name {p.n
+00007370: 616d 6521 727d 2065 7869 7374 7320 696e  ame!r} exists in
+00007380: 207b 7365 6c66 2e6e 616d 6521 727d 2229   {self.name!r}")
+00007390: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
+000073a0: 6f72 7473 5b70 2e6e 616d 655d 203d 2070  orts[p.name] = p
+000073b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000073c0: 700a 0a20 2020 2064 6566 2061 6464 5f70  p..    def add_p
+000073d0: 6f72 7473 280a 2020 2020 2020 2020 7365  orts(.        se
+000073e0: 6c66 2c0a 2020 2020 2020 2020 706f 7274  lf,.        port
+000073f0: 733a 2055 6e69 6f6e 5b4c 6973 745b 506f  s: Union[List[Po
+00007400: 7274 5d2c 2044 6963 745b 7374 722c 2050  rt], Dict[str, P
+00007410: 6f72 745d 5d2c 0a20 2020 2020 2020 2070  ort]],.        p
+00007420: 7265 6669 783a 2073 7472 203d 2022 222c  refix: str = "",
+00007430: 0a20 2020 2020 2020 2073 7566 6669 783a  .        suffix:
+00007440: 2073 7472 203d 2022 222c 0a20 2020 2020   str = "",.     
+00007450: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+00007460: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
+00007470: 2020 2020 2222 2241 6464 2061 206c 6973      """Add a lis
+00007480: 7420 6f72 2064 6963 7420 6f66 2070 6f72  t or dict of por
+00007490: 7473 2e0a 0a20 2020 2020 2020 2079 6f75  ts...        you
+000074a0: 2063 616e 2069 6e63 6c75 6465 2061 2070   can include a p
+000074b0: 7265 6669 7820 746f 2061 6464 2074 6f20  refix to add to 
+000074c0: 7468 6520 6e65 7720 706f 7274 206e 616d  the new port nam
+000074d0: 6573 2074 6f20 6176 6f69 6420 6e61 6d65  es to avoid name
+000074e0: 2063 6f6e 666c 6963 7473 2e0a 0a20 2020   conflicts...   
+000074f0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+00007500: 2020 2020 2020 2070 6f72 7473 3a20 6c69         ports: li
+00007510: 7374 206f 7220 6469 6374 206f 6620 706f  st or dict of po
+00007520: 7274 732e 0a20 2020 2020 2020 2020 2020  rts..           
+00007530: 2070 7265 6669 783a 2074 6f20 7072 6570   prefix: to prep
+00007540: 656e 6420 746f 2065 6163 6820 706f 7274  end to each port
+00007550: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+00007560: 2020 2073 7566 6669 783a 2074 6f20 6170     suffix: to ap
+00007570: 7065 6e64 2074 6f20 6561 6368 2070 6f72  pend to each por
+00007580: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
+00007590: 2222 220a 2020 2020 2020 2020 706f 7274  """.        port
+000075a0: 7320 3d20 706f 7274 7320 6966 2069 7369  s = ports if isi
+000075b0: 6e73 7461 6e63 6528 706f 7274 732c 206c  nstance(ports, l
+000075c0: 6973 7429 2065 6c73 6520 706f 7274 732e  ist) else ports.
+000075d0: 7661 6c75 6573 2829 0a20 2020 2020 2020  values().       
+000075e0: 2066 6f72 2070 6f72 7420 696e 206c 6973   for port in lis
+000075f0: 7428 706f 7274 7329 3a0a 2020 2020 2020  t(ports):.      
+00007600: 2020 2020 2020 6e61 6d65 203d 2066 227b        name = f"{
+00007610: 7072 6566 6978 7d7b 706f 7274 2e6e 616d  prefix}{port.nam
+00007620: 657d 7b73 7566 6669 787d 220a 2020 2020  e}{suffix}".    
+00007630: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+00007640: 5f70 6f72 7428 6e61 6d65 3d6e 616d 652c  _port(name=name,
+00007650: 2070 6f72 743d 706f 7274 2c20 2a2a 6b77   port=port, **kw
+00007660: 6172 6773 290a 0a20 2020 2064 6566 2073  args)..    def s
+00007670: 6e61 705f 706f 7274 735f 746f 5f67 7269  nap_ports_to_gri
+00007680: 6428 7365 6c66 2c20 6e6d 3a20 696e 7420  d(self, nm: int 
+00007690: 3d20 3129 202d 3e20 4e6f 6e65 3a0a 2020  = 1) -> None:.  
+000076a0: 2020 2020 2020 666f 7220 706f 7274 2069        for port i
+000076b0: 6e20 7365 6c66 2e70 6f72 7473 2e76 616c  n self.ports.val
+000076c0: 7565 7328 293a 0a20 2020 2020 2020 2020  ues():.         
+000076d0: 2020 2070 6f72 742e 736e 6170 5f74 6f5f     port.snap_to_
+000076e0: 6772 6964 286e 6d3d 6e6d 290a 0a20 2020  grid(nm=nm)..   
+000076f0: 2064 6566 2072 656d 6f76 655f 6c61 7965   def remove_laye
+00007700: 7273 280a 2020 2020 2020 2020 7365 6c66  rs(.        self
+00007710: 2c0a 2020 2020 2020 2020 6c61 7965 7273  ,.        layers
+00007720: 3a20 4c69 7374 5b4c 6179 6572 5370 6563  : List[LayerSpec
+00007730: 5d2c 0a20 2020 2020 2020 2069 6e63 6c75  ],.        inclu
+00007740: 6465 5f6c 6162 656c 733a 2062 6f6f 6c20  de_labels: bool 
+00007750: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00007760: 696e 7665 7274 5f73 656c 6563 7469 6f6e  invert_selection
+00007770: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00007780: 2020 2020 2020 2020 7265 6375 7273 6976          recursiv
+00007790: 653a 2062 6f6f 6c20 3d20 5472 7565 2c0a  e: bool = True,.
+000077a0: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
+000077b0: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
+000077c0: 656d 6f76 6520 6120 6c69 7374 206f 6620  emove a list of 
+000077d0: 6c61 7965 7273 2061 6e64 2072 6574 7572  layers and retur
+000077e0: 6e73 2074 6865 2073 616d 6520 436f 6d70  ns the same Comp
+000077f0: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
+00007800: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+00007810: 2020 6c61 7965 7273 3a20 6c69 7374 206f    layers: list o
+00007820: 6620 6c61 7965 7273 2074 6f20 7265 6d6f  f layers to remo
+00007830: 7665 2e0a 2020 2020 2020 2020 2020 2020  ve..            
+00007840: 696e 636c 7564 655f 6c61 6265 6c73 3a20  include_labels: 
+00007850: 7265 6d6f 7665 206c 6162 656c 7320 6f6e  remove labels on
+00007860: 2074 686f 7365 206c 6179 6572 732e 0a20   those layers.. 
+00007870: 2020 2020 2020 2020 2020 2069 6e76 6572             inver
+00007880: 745f 7365 6c65 6374 696f 6e3a 2072 656d  t_selection: rem
+00007890: 6f76 6573 2061 6c6c 206c 6179 6572 7320  oves all layers 
+000078a0: 6578 6365 7074 206c 6179 6572 7320 7370  except layers sp
+000078b0: 6563 6966 6965 642e 0a20 2020 2020 2020  ecified..       
+000078c0: 2020 2020 2072 6563 7572 7369 7665 3a20       recursive: 
+000078d0: 6f70 6572 6174 6520 6f6e 2074 6865 2063  operate on the c
+000078e0: 656c 6c73 2069 6e63 6c75 6465 6420 696e  ells included in
+000078f0: 2074 6869 7320 6365 6c6c 2e0a 2020 2020   this cell..    
+00007900: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00007910: 6672 6f6d 2067 6473 6661 6374 6f72 7920  from gdsfactory 
+00007920: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+00007930: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
+00007940: 656e 7420 3d20 7365 6c66 2e66 6c61 7474  ent = self.flatt
+00007950: 656e 2829 2069 6620 7265 6375 7273 6976  en() if recursiv
+00007960: 6520 616e 6420 7365 6c66 2e72 6566 6572  e and self.refer
+00007970: 656e 6365 7320 656c 7365 2073 656c 660a  ences else self.
+00007980: 2020 2020 2020 2020 6c61 7965 7273 203d          layers =
+00007990: 205b 6765 745f 6c61 7965 7228 6c61 7965   [get_layer(laye
+000079a0: 7229 2066 6f72 206c 6179 6572 2069 6e20  r) for layer in 
+000079b0: 6c61 7965 7273 5d0a 0a20 2020 2020 2020  layers]..       
+000079c0: 2073 686f 756c 645f 7265 6d6f 7665 203d   should_remove =
+000079d0: 206e 6f74 2069 6e76 6572 745f 7365 6c65   not invert_sele
+000079e0: 6374 696f 6e0a 2020 2020 2020 2020 636f  ction.        co
+000079f0: 6d70 6f6e 656e 742e 5f63 656c 6c2e 6669  mponent._cell.fi
+00007a00: 6c74 6572 280a 2020 2020 2020 2020 2020  lter(.          
+00007a10: 2020 7370 6563 3d6c 6179 6572 732c 0a20    spec=layers,. 
+00007a20: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
+00007a30: 653d 7368 6f75 6c64 5f72 656d 6f76 652c  e=should_remove,
+00007a40: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+00007a50: 7967 6f6e 733d 5472 7565 2c0a 2020 2020  ygons=True,.    
+00007a60: 2020 2020 2020 2020 7061 7468 733d 5472          paths=Tr
+00007a70: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00007a80: 6c61 6265 6c73 3d69 6e63 6c75 6465 5f6c  labels=include_l
+00007a90: 6162 656c 732c 0a20 2020 2020 2020 2029  abels,.        )
+00007aa0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007ab0: 636f 6d70 6f6e 656e 740a 0a20 2020 2064  component..    d
+00007ac0: 6566 2065 7874 7261 6374 280a 2020 2020  ef extract(.    
+00007ad0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00007ae0: 2020 6c61 7965 7273 3a20 4c69 7374 5b55    layers: List[U
+00007af0: 6e69 6f6e 5b54 7570 6c65 5b69 6e74 2c20  nion[Tuple[int, 
+00007b00: 696e 745d 2c20 7374 725d 5d2c 0a20 2020  int], str]],.   
+00007b10: 2029 202d 3e20 436f 6d70 6f6e 656e 743a   ) -> Component:
+00007b20: 0a20 2020 2020 2020 2022 2222 4578 7472  .        """Extr
+00007b30: 6163 7420 706f 6c79 676f 6e73 2066 726f  act polygons fro
+00007b40: 6d20 6120 436f 6d70 6f6e 656e 7420 616e  m a Component an
+00007b50: 6420 7265 7475 726e 7320 6120 6e65 7720  d returns a new 
+00007b60: 436f 6d70 6f6e 656e 742e 2222 220a 2020  Component.""".  
+00007b70: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+00007b80: 6374 6f72 792e 7064 6b20 696d 706f 7274  ctory.pdk import
+00007b90: 2067 6574 5f6c 6179 6572 0a0a 2020 2020   get_layer..    
+00007ba0: 2020 2020 6966 2074 7970 6528 6c61 7965      if type(laye
+00007bb0: 7273 2920 6e6f 7420 696e 2028 6c69 7374  rs) not in (list
+00007bc0: 2c20 7475 706c 6529 3a0a 2020 2020 2020  , tuple):.      
+00007bd0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00007be0: 6545 7272 6f72 2866 226c 6179 6572 7320  eError(f"layers 
+00007bf0: 7b6c 6179 6572 7321 727d 206e 6565 6473  {layers!r} needs
+00007c00: 2074 6f20 6265 2061 206c 6973 7420 6f72   to be a list or
+00007c10: 2074 7570 6c65 2229 0a0a 2020 2020 2020   tuple")..      
+00007c20: 2020 6c61 7965 7273 203d 205b 6765 745f    layers = [get_
+00007c30: 6c61 7965 7228 6c61 7965 7229 2066 6f72  layer(layer) for
+00007c40: 206c 6179 6572 2069 6e20 6c61 7965 7273   layer in layers
+00007c50: 5d0a 2020 2020 2020 2020 2320 636f 6d70  ].        # comp
+00007c60: 6f6e 656e 7420 3d20 7365 6c66 2e63 6f70  onent = self.cop
+00007c70: 7928 290a 2020 2020 2020 2020 2320 636f  y().        # co
+00007c80: 6d70 6f6e 656e 742e 5f63 656c 6c2e 6669  mponent._cell.fi
+00007c90: 6c74 6572 2873 7065 633d 6c61 7965 7273  lter(spec=layers
+00007ca0: 2c20 7265 6d6f 7665 3d46 616c 7365 290a  , remove=False).
+00007cb0: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
+00007cc0: 6e74 203d 2043 6f6d 706f 6e65 6e74 2829  nt = Component()
+00007cd0: 0a20 2020 2020 2020 2070 6f6c 795f 6469  .        poly_di
+00007ce0: 6374 203d 2073 656c 662e 6765 745f 706f  ct = self.get_po
+00007cf0: 6c79 676f 6e73 2862 795f 7370 6563 3d54  lygons(by_spec=T
+00007d00: 7275 652c 2069 6e63 6c75 6465 5f70 6174  rue, include_pat
+00007d10: 6873 3d46 616c 7365 290a 0a20 2020 2020  hs=False)..     
+00007d20: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
+00007d30: 6c61 7965 7273 3a0a 2020 2020 2020 2020  layers:.        
+00007d40: 2020 2020 6966 206c 6179 6572 2069 6e20      if layer in 
+00007d50: 706f 6c79 5f64 6963 743a 0a20 2020 2020  poly_dict:.     
+00007d60: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00007d70: 6f6e 7320 3d20 706f 6c79 5f64 6963 745b  ons = poly_dict[
+00007d80: 6c61 7965 725d 0a20 2020 2020 2020 2020  layer].         
+00007d90: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
+00007da0: 6f6e 2069 6e20 706f 6c79 676f 6e73 3a0a  on in polygons:.
+00007db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007dc0: 2020 2020 636f 6d70 6f6e 656e 742e 6164      component.ad
+00007dd0: 645f 706f 6c79 676f 6e28 706f 6c79 676f  d_polygon(polygo
+00007de0: 6e2c 206c 6179 6572 290a 0a20 2020 2020  n, layer)..     
+00007df0: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
+00007e00: 6c61 7965 7273 3a0a 2020 2020 2020 2020  layers:.        
+00007e10: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
+00007e20: 7365 6c66 2e5f 6365 6c6c 2e67 6574 5f70  self._cell.get_p
+00007e30: 6174 6873 286c 6179 6572 3d6c 6179 6572  aths(layer=layer
+00007e40: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00007e50: 2020 2063 6f6d 706f 6e65 6e74 2e61 6464     component.add
+00007e60: 2870 6174 6829 0a0a 2020 2020 2020 2020  (path)..        
+00007e70: 7265 7475 726e 2063 6f6d 706f 6e65 6e74  return component
+00007e80: 0a0a 2020 2020 6465 6620 6164 645f 706f  ..    def add_po
+00007e90: 6c79 676f 6e28 7365 6c66 2c20 706f 696e  lygon(self, poin
+00007ea0: 7473 2c20 6c61 7965 723d 6e70 2e6e 616e  ts, layer=np.nan
+00007eb0: 293a 0a20 2020 2020 2020 2022 2222 4164  ):.        """Ad
+00007ec0: 6473 2061 2050 6f6c 7967 6f6e 2074 6f20  ds a Polygon to 
+00007ed0: 7468 6520 436f 6d70 6f6e 656e 742e 0a0a  the Component...
+00007ee0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00007ef0: 2020 2020 2020 2020 2020 706f 696e 7473            points
+00007f00: 3a20 436f 6f72 6469 6e61 7465 7320 6f66  : Coordinates of
+00007f10: 2074 6865 2076 6572 7469 6365 7320 6f66   the vertices of
+00007f20: 2074 6865 2050 6f6c 7967 6f6e 2e0a 2020   the Polygon..  
+00007f30: 2020 2020 2020 2020 2020 6c61 7965 723a            layer:
+00007f40: 206c 6179 6572 2073 7065 6320 746f 2061   layer spec to a
+00007f50: 6464 2070 6f6c 7967 6f6e 206f 6e2e 0a20  dd polygon on.. 
+00007f60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007f70: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
+00007f80: 7279 2e70 646b 2069 6d70 6f72 7420 6765  ry.pdk import ge
+00007f90: 745f 6c61 7965 720a 0a20 2020 2020 2020  t_layer..       
+00007fa0: 206c 6179 6572 203d 2067 6574 5f6c 6179   layer = get_lay
+00007fb0: 6572 286c 6179 6572 290a 0a20 2020 2020  er(layer)..     
+00007fc0: 2020 2069 6620 6c61 7965 7220 6973 204e     if layer is N
+00007fd0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00007fe0: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
+00007ff0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00008000: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00008010: 616e 6365 286c 6179 6572 2c20 7365 7429  ance(layer, set)
+00008020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008030: 2020 7265 7475 726e 205b 7365 6c66 2e61    return [self.a
+00008040: 6464 5f70 6f6c 7967 6f6e 2870 6f69 6e74  dd_polygon(point
+00008050: 732c 206c 7929 2066 6f72 206c 7920 696e  s, ly) for ly in
+00008060: 206c 6179 6572 5d0a 2020 2020 2020 2020   layer].        
+00008070: 2020 2020 656c 6966 2061 6c6c 2869 7369      elif all(isi
+00008080: 6e73 7461 6e63 6528 6c79 2c20 284c 6179  nstance(ly, (Lay
+00008090: 6572 2929 2066 6f72 206c 7920 696e 206c  er)) for ly in l
+000080a0: 6179 6572 293a 0a20 2020 2020 2020 2020  ayer):.         
+000080b0: 2020 2020 2020 2072 6574 7572 6e20 5b73         return [s
+000080c0: 656c 662e 6164 645f 706f 6c79 676f 6e28  elf.add_polygon(
+000080d0: 706f 696e 7473 2c20 6c79 2920 666f 7220  points, ly) for 
+000080e0: 6c79 2069 6e20 6c61 7965 725d 0a20 2020  ly in layer].   
+000080f0: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
+00008100: 6e28 6c61 7965 7229 203e 2032 3a20 2023  n(layer) > 2:  #
+00008110: 2053 6f6d 656f 6e65 2077 726f 7465 2065   Someone wrote e
+00008120: 2e67 2e20 6c61 7965 7220 3d20 5b31 2c34  .g. layer = [1,4
+00008130: 2c35 5d0a 2020 2020 2020 2020 2020 2020  ,5].            
+00008140: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00008150: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00008160: 2020 2020 2020 2020 2020 2222 2220 5b50            """ [P
+00008170: 4849 444c 5d20 4966 2073 7065 6369 6679  HIDL] If specify
+00008180: 696e 6720 6d75 6c74 6970 6c65 206c 6179  ing multiple lay
+00008190: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
+000081a0: 2020 2020 796f 7520 6d75 7374 2075 7365      you must use
+000081b0: 2073 6574 206e 6f74 6174 696f 6e2c 2065   set notation, e
+000081c0: 2e67 2e20 7b31 2c35 2c38 7d20 2222 220a  .g. {1,5,8} """.
+000081d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081e0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+000081f0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00008200: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+00008210: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00008220: 6e63 6528 706f 696e 7473 2c20 6764 7374  nce(points, gdst
+00008230: 6b2e 506f 6c79 676f 6e29 3a0a 2020 2020  k.Polygon):.    
+00008240: 2020 2020 2020 2020 2320 6966 206c 6179          # if lay
+00008250: 6572 2069 7320 756e 7370 6563 6966 6965  er is unspecifie
+00008260: 6420 6f72 206d 6174 6368 6573 206f 7269  d or matches ori
+00008270: 6769 6e61 6c20 706f 6c79 676f 6e2c 206a  ginal polygon, j
+00008280: 7573 7420 6164 6420 6974 2061 732d 6973  ust add it as-is
+00008290: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+000082a0: 7967 6f6e 203d 2070 6f69 6e74 730a 2020  ygon = points.  
+000082b0: 2020 2020 2020 2020 2020 6966 206c 6179            if lay
+000082c0: 6572 2069 7320 6e70 2e6e 616e 206f 7220  er is np.nan or 
+000082d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+000082e0: 2020 6973 696e 7374 616e 6365 286c 6179    isinstance(lay
+000082f0: 6572 2c20 7475 706c 6529 2061 6e64 2028  er, tuple) and (
+00008300: 706f 6c79 676f 6e2e 6c61 7965 722c 2070  polygon.layer, p
+00008310: 6f6c 7967 6f6e 2e64 6174 6174 7970 6529  olygon.datatype)
+00008320: 203d 3d20 6c61 7965 720a 2020 2020 2020   == layer.      
+00008330: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00008340: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00008350: 203d 2050 6f6c 7967 6f6e 2870 6f6c 7967   = Polygon(polyg
+00008360: 6f6e 2e70 6f69 6e74 732c 2070 6f6c 7967  on.points, polyg
+00008370: 6f6e 2e6c 6179 6572 2c20 706f 6c79 676f  on.layer, polygo
+00008380: 6e2e 6461 7461 7479 7065 290a 2020 2020  n.datatype).    
+00008390: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000083a0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+000083b0: 7965 722c 2064 6174 6174 7970 6520 3d20  yer, datatype = 
+000083c0: 5f70 6172 7365 5f6c 6179 6572 286c 6179  _parse_layer(lay
+000083d0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+000083e0: 2020 2020 706f 6c79 676f 6e20 3d20 506f      polygon = Po
+000083f0: 6c79 676f 6e28 706f 6c79 676f 6e2e 706f  lygon(polygon.po
+00008400: 696e 7473 2c20 6c61 7965 722c 2064 6174  ints, layer, dat
+00008410: 6174 7970 6529 0a20 2020 2020 2020 2020  atype).         
+00008420: 2020 2073 656c 662e 5f61 6464 5f70 6f6c     self._add_pol
+00008430: 7967 6f6e 7328 706f 6c79 676f 6e29 0a20  ygons(polygon). 
+00008440: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00008450: 6e20 706f 6c79 676f 6e0a 0a20 2020 2020  n polygon..     
+00008460: 2020 2070 6f69 6e74 7320 3d20 6e70 2e61     points = np.a
+00008470: 7361 7272 6179 2870 6f69 6e74 7329 0a20  sarray(points). 
+00008480: 2020 2020 2020 2069 6620 706f 696e 7473         if points
+00008490: 2e6e 6469 6d20 3d3d 2031 3a0a 2020 2020  .ndim == 1:.    
+000084a0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+000084b0: 7365 6c66 2e61 6464 5f70 6f6c 7967 6f6e  self.add_polygon
+000084c0: 2870 6f6c 792c 206c 6179 6572 3d6c 6179  (poly, layer=lay
+000084d0: 6572 2920 666f 7220 706f 6c79 2069 6e20  er) for poly in 
+000084e0: 706f 696e 7473 5d0a 2020 2020 2020 2020  points].        
+000084f0: 6966 206c 6179 6572 2069 7320 6e70 2e6e  if layer is np.n
+00008500: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
+00008510: 6c61 7965 7220 3d20 300a 0a20 2020 2020  layer = 0..     
+00008520: 2020 2069 6620 706f 696e 7473 2e6e 6469     if points.ndi
+00008530: 6d20 3d3d 2032 3a0a 2020 2020 2020 2020  m == 2:.        
+00008540: 2020 2020 2320 6164 6420 7369 6e67 6c65      # add single
+00008550: 2070 6f6c 7967 6f6e 2066 726f 6d20 706f   polygon from po
+00008560: 696e 7473 0a20 2020 2020 2020 2020 2020  ints.           
+00008570: 2069 6620 6c65 6e28 706f 696e 7473 5b30   if len(points[0
+00008580: 5d29 203e 2032 3a0a 2020 2020 2020 2020  ]) > 2:.        
+00008590: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
+000085a0: 7420 746f 2066 6f72 6d20 5b5b 312c 325d  t to form [[1,2]
+000085b0: 2c5b 332c 345d 2c5b 352c 365d 5d0a 2020  ,[3,4],[5,6]].  
+000085c0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+000085d0: 696e 7473 203d 206e 702e 636f 6c75 6d6e  ints = np.column
+000085e0: 5f73 7461 636b 2870 6f69 6e74 7329 0a20  _stack(points). 
+000085f0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00008600: 2c20 6461 7461 7479 7065 203d 205f 7061  , datatype = _pa
+00008610: 7273 655f 6c61 7965 7228 6c61 7965 7229  rse_layer(layer)
+00008620: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+00008630: 7967 6f6e 203d 2050 6f6c 7967 6f6e 2870  ygon = Polygon(p
+00008640: 6f69 6e74 732c 206c 6179 6572 3d6c 6179  oints, layer=lay
+00008650: 6572 2c20 6461 7461 7479 7065 3d64 6174  er, datatype=dat
+00008660: 6174 7970 6529 0a20 2020 2020 2020 2020  atype).         
+00008670: 2020 2073 656c 662e 5f61 6464 5f70 6f6c     self._add_pol
+00008680: 7967 6f6e 7328 706f 6c79 676f 6e29 0a20  ygons(polygon). 
+00008690: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000086a0: 6e20 706f 6c79 676f 6e0a 2020 2020 2020  n polygon.      
+000086b0: 2020 656c 6966 2070 6f69 6e74 732e 6e64    elif points.nd
+000086c0: 696d 203d 3d20 333a 0a20 2020 2020 2020  im == 3:.       
+000086d0: 2020 2020 206c 6179 6572 2c20 6461 7461       layer, data
+000086e0: 7479 7065 203d 205f 7061 7273 655f 6c61  type = _parse_la
+000086f0: 7965 7228 6c61 7965 7229 0a20 2020 2020  yer(layer).     
+00008700: 2020 2020 2020 2070 6f6c 7967 6f6e 7320         polygons 
+00008710: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00008720: 2020 2020 506f 6c79 676f 6e28 7070 6f69      Polygon(ppoi
+00008730: 6e74 732c 206c 6179 6572 3d6c 6179 6572  nts, layer=layer
+00008740: 2c20 6461 7461 7479 7065 3d64 6174 6174  , datatype=datat
+00008750: 7970 6529 2066 6f72 2070 706f 696e 7473  ype) for ppoints
+00008760: 2069 6e20 706f 696e 7473 0a20 2020 2020   in points.     
+00008770: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00008780: 2020 2020 2073 656c 662e 5f61 6464 5f70       self._add_p
+00008790: 6f6c 7967 6f6e 7328 2a70 6f6c 7967 6f6e  olygons(*polygon
+000087a0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+000087b0: 6574 7572 6e20 706f 6c79 676f 6e73 0a20  eturn polygons. 
+000087c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000087d0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000087e0: 616c 7565 4572 726f 7228 6622 556e 6162  alueError(f"Unab
+000087f0: 6c65 2074 6f20 6164 6420 7b70 6f69 6e74  le to add {point
+00008800: 732e 6e64 696d 7d2d 6469 6d65 6e73 696f  s.ndim}-dimensio
+00008810: 6e61 6c20 706f 696e 7473 206f 626a 6563  nal points objec
+00008820: 7422 290a 0a20 2020 2064 6566 205f 6164  t")..    def _ad
+00008830: 645f 706f 6c79 676f 6e73 2873 656c 662c  d_polygons(self,
+00008840: 202a 706f 6c79 676f 6e73 3a20 4c69 7374   *polygons: List
+00008850: 5b50 6f6c 7967 6f6e 5d29 3a0a 2020 2020  [Polygon]):.    
+00008860: 2020 2020 7365 6c66 2e69 735f 756e 6c6f      self.is_unlo
+00008870: 636b 6564 2829 0a20 2020 2020 2020 2073  cked().        s
+00008880: 656c 662e 5f63 656c 6c2e 6164 6428 2a70  elf._cell.add(*p
+00008890: 6f6c 7967 6f6e 7329 0a0a 2020 2020 6465  olygons)..    de
+000088a0: 6620 636f 7079 2873 656c 6629 202d 3e20  f copy(self) -> 
+000088b0: 436f 6d70 6f6e 656e 743a 0a20 2020 2020  Component:.     
+000088c0: 2020 2072 6574 7572 6e20 636f 7079 2873     return copy(s
+000088d0: 656c 6629 0a0a 2020 2020 6465 6620 6164  elf)..    def ad
+000088e0: 645f 7265 665f 636f 6e74 6169 6e65 7228  d_ref_container(
+000088f0: 7365 6c66 2c20 636f 6d70 6f6e 656e 743a  self, component:
+00008900: 2043 6f6d 706f 6e65 6e74 2920 2d3e 2043   Component) -> C
+00008910: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00008920: 653a 0a20 2020 2020 2020 2022 2222 4164  e:.        """Ad
+00008930: 6420 7265 6665 7265 6e63 652c 2070 6f72  d reference, por
+00008940: 7473 2061 6e64 2063 6f70 795f 6368 696c  ts and copy_chil
+00008950: 645f 696e 666f 2e22 2222 0a20 2020 2020  d_info.""".     
+00008960: 2020 2072 6566 203d 2073 656c 6620 3c3c     ref = self <<
+00008970: 2063 6f6d 706f 6e65 6e74 0a20 2020 2020   component.     
+00008980: 2020 2073 656c 662e 6164 645f 706f 7274     self.add_port
+00008990: 7328 7265 662e 706f 7274 7329 0a20 2020  s(ref.ports).   
+000089a0: 2020 2020 2073 656c 662e 636f 7079 5f63       self.copy_c
+000089b0: 6869 6c64 5f69 6e66 6f28 636f 6d70 6f6e  hild_info(compon
+000089c0: 656e 7429 0a20 2020 2020 2020 2072 6574  ent).        ret
+000089d0: 7572 6e20 7265 660a 0a20 2020 2064 6566  urn ref..    def
+000089e0: 2063 6f70 795f 6368 696c 645f 696e 666f   copy_child_info
+000089f0: 2873 656c 662c 2063 6f6d 706f 6e65 6e74  (self, component
+00008a00: 3a20 436f 6d70 6f6e 656e 7429 202d 3e20  : Component) -> 
+00008a10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00008a20: 2243 6f70 7920 616e 6420 7365 7474 696e  "Copy and settin
+00008a30: 6773 2069 6e66 6f20 6672 6f6d 2063 6869  gs info from chi
+00008a40: 6c64 2063 6f6d 706f 6e65 6e74 2069 6e74  ld component int
+00008a50: 6f20 7061 7265 6e74 2e0a 0a20 2020 2020  o parent...     
+00008a60: 2020 2050 6172 656e 7420 636f 6d70 6f6e     Parent compon
+00008a70: 656e 7473 2063 616e 2061 6363 6573 7320  ents can access 
+00008a80: 6368 696c 6420 6365 6c6c 7320 7365 7474  child cells sett
+00008a90: 696e 6773 2e0a 2020 2020 2020 2020 2222  ings..        ""
+00008aa0: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+00008ab0: 2069 7369 6e73 7461 6e63 6528 636f 6d70   isinstance(comp
+00008ac0: 6f6e 656e 742c 2028 436f 6d70 6f6e 656e  onent, (Componen
+00008ad0: 742c 2043 6f6d 706f 6e65 6e74 5265 6665  t, ComponentRefe
+00008ae0: 7265 6e63 6529 293a 0a20 2020 2020 2020  rence)):.       
+00008af0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00008b00: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00008b10: 2020 2020 2020 2066 227b 7479 7065 2863         f"{type(c
+00008b20: 6f6d 706f 6e65 6e74 297d 2220 2269 7320  omponent)}" "is 
+00008b30: 6e6f 7420 6120 436f 6d70 6f6e 656e 7420  not a Component 
+00008b40: 6f72 2043 6f6d 706f 6e65 6e74 5265 6665  or ComponentRefe
+00008b50: 7265 6e63 6522 0a20 2020 2020 2020 2020  rence".         
+00008b60: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+00008b70: 6c66 2e67 6574 5f63 6869 6c64 5f6e 616d  lf.get_child_nam
+00008b80: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+00008b90: 2073 656c 662e 6368 696c 6420 3d20 636f   self.child = co
+00008ba0: 6d70 6f6e 656e 740a 2020 2020 2020 2020  mponent.        
+00008bb0: 7365 6c66 2e69 6e66 6f2e 7570 6461 7465  self.info.update
+00008bc0: 2863 6f6d 706f 6e65 6e74 2e69 6e66 6f29  (component.info)
+00008bd0: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
+00008be0: 7474 696e 6773 2e75 7064 6174 6528 636f  ttings.update(co
+00008bf0: 6d70 6f6e 656e 742e 7365 7474 696e 6773  mponent.settings
+00008c00: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+00008c10: 0a20 2020 2064 6566 2073 697a 655f 696e  .    def size_in
+00008c20: 666f 2873 656c 6629 202d 3e20 5369 7a65  fo(self) -> Size
+00008c30: 496e 666f 3a0a 2020 2020 2020 2020 2222  Info:.        ""
+00008c40: 2253 697a 6520 696e 666f 206f 6620 7468  "Size info of th
+00008c50: 6520 636f 6d70 6f6e 656e 742e 2222 220a  e component.""".
+00008c60: 2020 2020 2020 2020 7265 7475 726e 2053          return S
+00008c70: 697a 6549 6e66 6f28 7365 6c66 2e62 626f  izeInfo(self.bbo
+00008c80: 7829 0a0a 2020 2020 6465 6620 6765 745f  x)..    def get_
+00008c90: 7365 7474 696e 6728 7365 6c66 2c20 7365  setting(self, se
+00008ca0: 7474 696e 673a 2073 7472 2920 2d3e 2055  tting: str) -> U
+00008cb0: 6e69 6f6e 5b73 7472 2c20 696e 742c 2066  nion[str, int, f
+00008cc0: 6c6f 6174 5d3a 0a20 2020 2020 2020 2072  loat]:.        r
+00008cd0: 6574 7572 6e20 280a 2020 2020 2020 2020  eturn (.        
+00008ce0: 2020 2020 7365 6c66 2e69 6e66 6f2e 6765      self.info.ge
+00008cf0: 7428 7365 7474 696e 6729 0a20 2020 2020  t(setting).     
+00008d00: 2020 2020 2020 206f 7220 7365 6c66 2e73         or self.s
+00008d10: 6574 7469 6e67 732e 6675 6c6c 2e67 6574  ettings.full.get
+00008d20: 2873 6574 7469 6e67 290a 2020 2020 2020  (setting).      
+00008d30: 2020 2020 2020 6f72 2073 656c 662e 6d65        or self.me
+00008d40: 7461 6461 7461 5f63 6869 6c64 2e67 6574  tadata_child.get
+00008d50: 2873 6574 7469 6e67 290a 2020 2020 2020  (setting).      
+00008d60: 2020 290a 0a20 2020 2064 6566 2069 735f    )..    def is_
+00008d70: 756e 6c6f 636b 6564 2873 656c 6629 202d  unlocked(self) -
+00008d80: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00008d90: 2222 2252 6169 7365 7320 6572 726f 7220  """Raises error 
+00008da0: 6966 2043 6f6d 706f 6e65 6e74 2069 7320  if Component is 
+00008db0: 6c6f 636b 6564 2e22 2222 0a20 2020 2020  locked.""".     
+00008dc0: 2020 2069 6620 7365 6c66 2e5f 6c6f 636b     if self._lock
+00008dd0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00008de0: 7261 6973 6520 4d75 7461 6269 6c69 7479  raise Mutability
+00008df0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00008e00: 2020 2020 2020 2066 2243 6f6d 706f 6e65         f"Compone
+00008e10: 6e74 207b 7365 6c66 2e6e 616d 6521 727d  nt {self.name!r}
+00008e20: 2063 616e 6e6f 7420 6265 206d 6f64 6966   cannot be modif
+00008e30: 6965 6420 6173 2069 7427 7320 616c 7265  ied as it's alre
+00008e40: 6164 7920 6f6e 2063 6163 6865 2e20 220a  ady on cache. ".
+00008e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e60: 2b20 6d75 7461 6269 6c69 7479 5f65 7272  + mutability_err
+00008e70: 6f72 5f6d 6573 7361 6765 0a20 2020 2020  or_message.     
+00008e80: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00008e90: 6620 5f61 6464 2873 656c 662c 2065 6c65  f _add(self, ele
+00008ea0: 6d65 6e74 2920 2d3e 204e 6f6e 653a 0a20  ment) -> None:. 
+00008eb0: 2020 2020 2020 2022 2222 4164 6420 6120         """Add a 
+00008ec0: 6e65 7720 656c 656d 656e 7420 6f72 206c  new element or l
+00008ed0: 6973 7420 6f66 2065 6c65 6d65 6e74 7320  ist of elements 
+00008ee0: 746f 2074 6869 7320 436f 6d70 6f6e 656e  to this Componen
+00008ef0: 742e 0a0a 2020 2020 2020 2020 4172 6773  t...        Args
+00008f00: 3a0a 2020 2020 2020 2020 2020 2020 656c  :.            el
+00008f10: 656d 656e 743a 2050 6f6c 7967 6f6e 2c20  ement: Polygon, 
+00008f20: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
+00008f30: 6365 206f 7220 6974 6572 6162 6c65 0a20  ce or iterable. 
+00008f40: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+00008f50: 6865 2065 6c65 6d65 6e74 206f 7220 6974  he element or it
+00008f60: 6572 6162 6c65 206f 6620 656c 656d 656e  erable of elemen
+00008f70: 7473 2074 6f20 6265 2069 6e73 6572 7465  ts to be inserte
+00008f80: 6420 696e 2074 6869 7320 6365 6c6c 2e0a  d in this cell..
+00008f90: 0a20 2020 2020 2020 2052 6169 7365 733a  .        Raises:
+00008fa0: 0a20 2020 2020 2020 2020 2020 204d 7574  .            Mut
+00008fb0: 6162 696c 6974 7945 7272 6f72 3a20 6966  abilityError: if
+00008fc0: 2063 6f6d 706f 6e65 6e74 2069 7320 6c6f   component is lo
+00008fd0: 636b 6564 2e0a 2020 2020 2020 2020 2222  cked..        ""
+00008fe0: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
+00008ff0: 735f 756e 6c6f 636b 6564 2829 0a20 2020  s_unlocked().   
+00009000: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00009010: 6365 2865 6c65 6d65 6e74 2c20 436f 6d70  ce(element, Comp
+00009020: 6f6e 656e 7452 6566 6572 656e 6365 293a  onentReference):
+00009030: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00009040: 662e 5f63 656c 6c2e 6164 6428 656c 656d  f._cell.add(elem
+00009050: 656e 742e 5f72 6566 6572 656e 6365 290a  ent._reference).
+00009060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00009070: 2e5f 7265 6665 7265 6e63 6573 2e61 7070  ._references.app
+00009080: 656e 6428 656c 656d 656e 7429 0a20 2020  end(element).   
+00009090: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000090a0: 2020 2020 2020 2073 656c 662e 5f63 656c         self._cel
+000090b0: 6c2e 6164 6428 656c 656d 656e 7429 0a0a  l.add(element)..
+000090c0: 2020 2020 6465 6620 6164 6428 7365 6c66      def add(self
+000090d0: 2c20 656c 656d 656e 7429 202d 3e20 4e6f  , element) -> No
+000090e0: 6e65 3a0a 2020 2020 2020 2020 2222 2241  ne:.        """A
+000090f0: 6464 2061 206e 6577 2065 6c65 6d65 6e74  dd a new element
+00009100: 206f 7220 6c69 7374 206f 6620 656c 656d   or list of elem
+00009110: 656e 7473 2074 6f20 7468 6973 2043 6f6d  ents to this Com
+00009120: 706f 6e65 6e74 2e0a 0a20 2020 2020 2020  ponent...       
+00009130: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00009140: 2020 2065 6c65 6d65 6e74 3a20 506f 6c79     element: Poly
+00009150: 676f 6e2c 2043 6f6d 706f 6e65 6e74 5265  gon, ComponentRe
+00009160: 6665 7265 6e63 6520 6f72 2069 7465 7261  ference or itera
+00009170: 626c 650a 2020 2020 2020 2020 2020 2020  ble.            
+00009180: 2020 2020 5468 6520 656c 656d 656e 7420      The element 
+00009190: 6f72 2069 7465 7261 626c 6520 6f66 2065  or iterable of e
+000091a0: 6c65 6d65 6e74 7320 746f 2062 6520 696e  lements to be in
+000091b0: 7365 7274 6564 2069 6e20 7468 6973 2063  serted in this c
+000091c0: 656c 6c2e 0a0a 2020 2020 2020 2020 5261  ell...        Ra
+000091d0: 6973 6573 3a0a 2020 2020 2020 2020 2020  ises:.          
+000091e0: 2020 4d75 7461 6269 6c69 7479 4572 726f    MutabilityErro
+000091f0: 723a 2069 6620 636f 6d70 6f6e 656e 7420  r: if component 
+00009200: 6973 206c 6f63 6b65 642e 0a20 2020 2020  is locked..     
+00009210: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00009220: 6620 6973 696e 7374 616e 6365 2865 6c65  f isinstance(ele
+00009230: 6d65 6e74 2c20 436f 6d70 6f6e 656e 7452  ment, ComponentR
+00009240: 6566 6572 656e 6365 293a 0a20 2020 2020  eference):.     
+00009250: 2020 2020 2020 2073 656c 662e 5f72 6567         self._reg
+00009260: 6973 7465 725f 7265 6665 7265 6e63 6528  ister_reference(
+00009270: 656c 656d 656e 7429 0a20 2020 2020 2020  element).       
+00009280: 2020 2020 2073 656c 662e 5f61 6464 2865       self._add(e
+00009290: 6c65 6d65 6e74 290a 2020 2020 2020 2020  lement).        
+000092a0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+000092b0: 656c 656d 656e 742c 2049 7465 7261 626c  element, Iterabl
+000092c0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000092d0: 666f 7220 7375 6265 6c65 6d65 6e74 2069  for subelement i
+000092e0: 6e20 656c 656d 656e 743a 0a20 2020 2020  n element:.     
+000092f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00009300: 6164 6428 7375 6265 6c65 6d65 6e74 290a  add(subelement).
+00009310: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00009320: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00009330: 6164 6428 656c 656d 656e 7429 0a0a 2020  add(element)..  
+00009340: 2020 6465 6620 6164 645f 6172 7261 7928    def add_array(
+00009350: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00009360: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
+00009370: 3a20 436f 6d70 6f6e 656e 742c 0a20 2020  : Component,.   
+00009380: 2020 2020 2063 6f6c 756d 6e73 3a20 696e       columns: in
+00009390: 7420 3d20 322c 0a20 2020 2020 2020 2072  t = 2,.        r
+000093a0: 6f77 733a 2069 6e74 203d 2032 2c0a 2020  ows: int = 2,.  
+000093b0: 2020 2020 2020 7370 6163 696e 673a 2054        spacing: T
+000093c0: 7570 6c65 5b66 6c6f 6174 2c20 666c 6f61  uple[float, floa
+000093d0: 745d 203d 2028 3130 302c 2031 3030 292c  t] = (100, 100),
+000093e0: 0a20 2020 2020 2020 2061 6c69 6173 3a20  .        alias: 
+000093f0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00009400: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 2043  None,.    ) -> C
+00009410: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
+00009420: 653a 0a20 2020 2020 2020 2022 2222 4372  e:.        """Cr
+00009430: 6561 7465 7320 6120 436f 6d70 6f6e 656e  eates a Componen
+00009440: 7452 6566 6572 656e 6365 2072 6566 6572  tReference refer
+00009450: 656e 6365 2074 6f20 6120 436f 6d70 6f6e  ence to a Compon
+00009460: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
+00009470: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00009480: 636f 6d70 6f6e 656e 743a 2054 6865 2072  component: The r
+00009490: 6566 6572 656e 6365 6420 636f 6d70 6f6e  eferenced compon
+000094a0: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
+000094b0: 2063 6f6c 756d 6e73 3a20 4e75 6d62 6572   columns: Number
+000094c0: 206f 6620 636f 6c75 6d6e 7320 696e 2074   of columns in t
+000094d0: 6865 2061 7272 6179 2e0a 2020 2020 2020  he array..      
+000094e0: 2020 2020 2020 726f 7773 3a20 4e75 6d62        rows: Numb
+000094f0: 6572 206f 6620 726f 7773 2069 6e20 7468  er of rows in th
+00009500: 6520 6172 7261 792e 0a20 2020 2020 2020  e array..       
+00009510: 2020 2020 2073 7061 6369 6e67 3a20 6172       spacing: ar
+00009520: 7261 792d 6c69 6b65 5b32 5d20 6f66 2069  ray-like[2] of i
+00009530: 6e74 206f 7220 666c 6f61 742e 0a20 2020  nt or float..   
+00009540: 2020 2020 2020 2020 2020 2020 2044 6973               Dis
+00009550: 7461 6e63 6520 6265 7477 6565 6e20 6164  tance between ad
+00009560: 6a61 6365 6e74 2063 6f6c 756d 6e73 2061  jacent columns a
+00009570: 6e64 2061 646a 6163 656e 7420 726f 7773  nd adjacent rows
+00009580: 2e0a 2020 2020 2020 2020 2020 2020 616c  ..            al
+00009590: 6961 733a 2073 7472 206f 7220 4e6f 6e65  ias: str or None
+000095a0: 2e20 416c 6961 7320 6f66 2074 6865 2072  . Alias of the r
+000095b0: 6566 6572 656e 6365 6420 436f 6d70 6f6e  eferenced Compon
+000095c0: 656e 742e 0a0a 2020 2020 2020 2020 5265  ent...        Re
+000095d0: 7475 726e 730a 2020 2020 2020 2020 2020  turns.          
+000095e0: 2020 613a 2043 6f6d 706f 6e65 6e74 5265    a: ComponentRe
+000095f0: 6665 7265 6e63 6520 636f 6e74 6169 6e69  ference containi
+00009600: 6e67 2072 6566 6572 656e 6365 7320 746f  ng references to
+00009610: 2074 6865 2043 6f6d 706f 6e65 6e74 2e0a   the Component..
+00009620: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00009630: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00009640: 7461 6e63 6528 636f 6d70 6f6e 656e 742c  tance(component,
+00009650: 2043 6f6d 706f 6e65 6e74 293a 0a20 2020   Component):.   
+00009660: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00009670: 7970 6545 7272 6f72 2822 6164 645f 6172  ypeError("add_ar
+00009680: 7261 7928 2920 6e65 6564 7320 6120 436f  ray() needs a Co
+00009690: 6d70 6f6e 656e 7420 6f62 6a65 6374 2e22  mponent object."
+000096a0: 290a 2020 2020 2020 2020 7265 6620 3d20  ).        ref = 
+000096b0: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
+000096c0: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+000096d0: 636f 6d70 6f6e 656e 743d 636f 6d70 6f6e  component=compon
+000096e0: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+000096f0: 2063 6f6c 756d 6e73 3d69 6e74 2872 6f75   columns=int(rou
+00009700: 6e64 2863 6f6c 756d 6e73 2929 2c0a 2020  nd(columns)),.  
+00009710: 2020 2020 2020 2020 2020 726f 7773 3d69            rows=i
+00009720: 6e74 2872 6f75 6e64 2872 6f77 7329 292c  nt(round(rows)),
+00009730: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
+00009740: 6369 6e67 3d73 7061 6369 6e67 2c0a 2020  cing=spacing,.  
+00009750: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00009760: 7265 662e 6e61 6d65 203d 204e 6f6e 650a  ref.name = None.
+00009770: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
+00009780: 6428 7265 6629 0a20 2020 2020 2020 2073  d(ref).        s
+00009790: 656c 662e 5f72 6567 6973 7465 725f 7265  elf._register_re
+000097a0: 6665 7265 6e63 6528 7265 6665 7265 6e63  ference(referenc
+000097b0: 653d 7265 662c 2061 6c69 6173 3d61 6c69  e=ref, alias=ali
+000097c0: 6173 290a 2020 2020 2020 2020 7265 7475  as).        retu
+000097d0: 726e 2072 6566 0a0a 2020 2020 6465 6620  rn ref..    def 
+000097e0: 6469 7374 7269 6275 7465 280a 2020 2020  distribute(.    
+000097f0: 2020 2020 7365 6c66 2c20 656c 656d 656e      self, elemen
+00009800: 7473 3d22 616c 6c22 2c20 6469 7265 6374  ts="all", direct
+00009810: 696f 6e3d 2278 222c 2073 7061 6369 6e67  ion="x", spacing
+00009820: 3d31 3030 2c20 7365 7061 7261 7469 6f6e  =100, separation
+00009830: 3d54 7275 652c 2065 6467 653d 2263 656e  =True, edge="cen
+00009840: 7465 7222 0a20 2020 2029 3a0a 2020 2020  ter".    ):.    
+00009850: 2020 2020 2222 2244 6973 7472 6962 7574      """Distribut
+00009860: 6573 2074 6865 2073 7065 6369 6669 6564  es the specified
+00009870: 2065 6c65 6d65 6e74 7320 696e 2074 6865   elements in the
+00009880: 2043 6f6d 706f 6e65 6e74 2e0a 0a20 2020   Component...   
+00009890: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+000098a0: 2020 2020 2020 2065 6c65 6d65 6e74 7320         elements 
+000098b0: 3a20 6172 7261 792d 6c69 6b65 206f 6620  : array-like of 
+000098c0: 6f62 6a65 6374 7320 6f72 2027 616c 6c27  objects or 'all'
+000098d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000098e0: 2045 6c65 6d65 6e74 7320 746f 2064 6973   Elements to dis
+000098f0: 7472 6962 7574 652e 0a20 2020 2020 2020  tribute..       
+00009900: 2020 2020 2064 6972 6563 7469 6f6e 203a       direction :
+00009910: 207b 2778 272c 2027 7927 7d0a 2020 2020   {'x', 'y'}.    
+00009920: 2020 2020 2020 2020 2020 2020 4469 7265              Dire
+00009930: 6374 696f 6e20 6f66 2064 6973 7472 6962  ction of distrib
+00009940: 7574 696f 6e3b 2065 6974 6865 7220 6120  ution; either a 
+00009950: 6c69 6e65 2069 6e20 7468 6520 782d 6469  line in the x-di
+00009960: 7265 6374 696f 6e20 6f72 0a20 2020 2020  rection or.     
+00009970: 2020 2020 2020 2020 2020 2079 2d64 6972             y-dir
+00009980: 6563 7469 6f6e 2e0a 2020 2020 2020 2020  ection..        
+00009990: 2020 2020 7370 6163 696e 6720 3a20 696e      spacing : in
+000099a0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+000099b0: 2020 2020 2020 2020 2020 2044 6973 7461             Dista
+000099c0: 6e63 6520 6265 7477 6565 6e20 656c 656d  nce between elem
+000099d0: 656e 7473 2e0a 2020 2020 2020 2020 2020  ents..          
+000099e0: 2020 7365 7061 7261 7469 6f6e 203a 2062    separation : b
+000099f0: 6f6f 6c0a 2020 2020 2020 2020 2020 2020  ool.            
+00009a00: 2020 2020 4966 2054 7275 652c 2067 7561      If True, gua
+00009a10: 7261 6e74 6565 7320 656c 656d 656e 7473  rantees elements
+00009a20: 2061 7265 2073 6570 6172 6174 6564 2077   are separated w
+00009a30: 6974 6820 6120 6669 7865 6420 7370 6163  ith a fixed spac
+00009a40: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+00009a50: 2020 2020 6265 7477 6565 6e3b 2069 6620      between; if 
+00009a60: 2046 616c 7365 2c20 656c 656d 656e 7473   False, elements
+00009a70: 2061 7265 2073 7061 6365 6420 6576 656e   are spaced even
+00009a80: 6c79 2061 6c6f 6e67 2061 2067 7269 642e  ly along a grid.
+00009a90: 0a20 2020 2020 2020 2020 2020 2065 6467  .            edg
+00009aa0: 6520 3a20 7b27 7827 2c20 2778 6d69 6e27  e : {'x', 'xmin'
+00009ab0: 2c20 2778 6d61 7827 2c20 2779 272c 2027  , 'xmax', 'y', '
+00009ac0: 796d 696e 272c 2027 796d 6178 277d 0a20  ymin', 'ymax'}. 
+00009ad0: 2020 2020 2020 2020 2020 2020 2020 2057                 W
+00009ae0: 6869 6368 2065 6467 6520 746f 2070 6572  hich edge to per
+00009af0: 666f 726d 2074 6865 2064 6973 7472 6962  form the distrib
+00009b00: 7574 696f 6e20 616c 6f6e 6720 2875 6e75  ution along (unu
+00009b10: 7365 6420 6966 0a20 2020 2020 2020 2020  sed if.         
+00009b20: 2020 2020 2020 2073 6570 6172 6174 696f         separatio
+00009b30: 6e20 3d3d 2054 7275 6529 0a0a 2020 2020  n == True)..    
+00009b40: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00009b50: 6966 2065 6c65 6d65 6e74 7320 3d3d 2022  if elements == "
+00009b60: 616c 6c22 3a0a 2020 2020 2020 2020 2020  all":.          
+00009b70: 2020 656c 656d 656e 7473 203d 2073 656c    elements = sel
+00009b80: 662e 706f 6c79 676f 6e73 202b 2073 656c  f.polygons + sel
+00009b90: 662e 7265 6665 7265 6e63 6573 0a20 2020  f.references.   
+00009ba0: 2020 2020 205f 6469 7374 7269 6275 7465       _distribute
+00009bb0: 280a 2020 2020 2020 2020 2020 2020 656c  (.            el
+00009bc0: 656d 656e 7473 3d65 6c65 6d65 6e74 732c  ements=elements,
+00009bd0: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
+00009be0: 6563 7469 6f6e 3d64 6972 6563 7469 6f6e  ection=direction
+00009bf0: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
+00009c00: 6163 696e 673d 7370 6163 696e 672c 0a20  acing=spacing,. 
+00009c10: 2020 2020 2020 2020 2020 2073 6570 6172             separ
+00009c20: 6174 696f 6e3d 7365 7061 7261 7469 6f6e  ation=separation
+00009c30: 2c0a 2020 2020 2020 2020 2020 2020 6564  ,.            ed
+00009c40: 6765 3d65 6467 652c 0a20 2020 2020 2020  ge=edge,.       
+00009c50: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00009c60: 6e20 7365 6c66 0a0a 2020 2020 6465 6620  n self..    def 
+00009c70: 616c 6967 6e28 7365 6c66 2c20 656c 656d  align(self, elem
+00009c80: 656e 7473 3d22 616c 6c22 2c20 616c 6967  ents="all", alig
+00009c90: 6e6d 656e 743d 2279 6d61 7822 293a 0a20  nment="ymax"):. 
+00009ca0: 2020 2020 2020 2022 2222 416c 6967 6e20         """Align 
+00009cb0: 656c 656d 656e 7473 2069 6e20 7468 6520  elements in the 
+00009cc0: 436f 6d70 6f6e 656e 742e 0a0a 2020 2020  Component...    
+00009cd0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00009ce0: 2020 2020 2020 656c 656d 656e 7473 203a        elements :
+00009cf0: 2061 7272 6179 2d6c 696b 6520 6f66 206f   array-like of o
+00009d00: 626a 6563 7473 2c20 6f72 2027 616c 6c27  bjects, or 'all'
+00009d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009d20: 2045 6c65 6d65 6e74 7320 696e 2074 6865   Elements in the
+00009d30: 2043 6f6d 706f 6e65 6e74 2074 6f20 616c   Component to al
+00009d40: 6967 6e2e 0a20 2020 2020 2020 2020 2020  ign..           
+00009d50: 2061 6c69 676e 6d65 6e74 203a 207b 2778   alignment : {'x
+00009d60: 272c 2027 7927 2c20 2778 6d69 6e27 2c20  ', 'y', 'xmin', 
+00009d70: 2778 6d61 7827 2c20 2779 6d69 6e27 2c20  'xmax', 'ymin', 
+00009d80: 2779 6d61 7827 7d0a 2020 2020 2020 2020  'ymax'}.        
+00009d90: 2020 2020 2020 2020 5768 6963 6820 6564          Which ed
+00009da0: 6765 2074 6f20 616c 6967 6e20 616c 6f6e  ge to align alon
+00009db0: 6720 2865 2e67 2e20 2779 6d61 7827 2077  g (e.g. 'ymax' w
+00009dc0: 696c 6c20 6d6f 7665 2074 6865 2065 6c65  ill move the ele
+00009dd0: 6d65 6e74 7320 7375 6368 0a20 2020 2020  ments such.     
+00009de0: 2020 2020 2020 2020 2020 2074 6861 7420             that 
+00009df0: 616c 6c20 6f66 2074 6865 6972 2074 6f70  all of their top
+00009e00: 6d6f 7374 2070 6f69 6e74 7320 6172 6520  most points are 
+00009e10: 616c 6967 6e65 6429 2e0a 2020 2020 2020  aligned)..      
+00009e20: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00009e30: 2065 6c65 6d65 6e74 7320 3d3d 2022 616c   elements == "al
+00009e40: 6c22 3a0a 2020 2020 2020 2020 2020 2020  l":.            
+00009e50: 656c 656d 656e 7473 203d 2073 656c 662e  elements = self.
+00009e60: 706f 6c79 676f 6e73 202b 2073 656c 662e  polygons + self.
+00009e70: 7265 6665 7265 6e63 6573 0a20 2020 2020  references.     
+00009e80: 2020 205f 616c 6967 6e28 656c 656d 656e     _align(elemen
+00009e90: 7473 2c20 616c 6967 6e6d 656e 743d 616c  ts, alignment=al
+00009ea0: 6967 6e6d 656e 7429 0a20 2020 2020 2020  ignment).       
+00009eb0: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+00009ec0: 2020 6465 6620 666c 6174 7465 6e28 7365    def flatten(se
+00009ed0: 6c66 2c20 7369 6e67 6c65 5f6c 6179 6572  lf, single_layer
+00009ee0: 3a20 4f70 7469 6f6e 616c 5b4c 6179 6572  : Optional[Layer
+00009ef0: 5370 6563 5d20 3d20 4e6f 6e65 293a 0a20  Spec] = None):. 
+00009f00: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00009f10: 7320 6120 666c 6174 7465 6e65 6420 636f  s a flattened co
+00009f20: 7079 206f 6620 7468 6520 636f 6d70 6f6e  py of the compon
+00009f30: 656e 742e 0a0a 2020 2020 2020 2020 466c  ent...        Fl
+00009f40: 6174 7465 6e73 2074 6865 2068 6965 7261  attens the hiera
+00009f50: 7263 6879 206f 6620 7468 6520 436f 6d70  rchy of the Comp
+00009f60: 6f6e 656e 7420 7375 6368 2074 6861 7420  onent such that 
+00009f70: 7468 6572 6520 6172 6520 6e6f 206c 6f6e  there are no lon
+00009f80: 6765 720a 2020 2020 2020 2020 616e 7920  ger.        any 
+00009f90: 7265 6665 7265 6e63 6573 2074 6f20 6f74  references to ot
+00009fa0: 6865 7220 436f 6d70 6f6e 656e 7473 2e20  her Components. 
+00009fb0: 416c 6c20 706f 6c79 676f 6e73 2061 6e64  All polygons and
+00009fc0: 206c 6162 656c 7320 6672 6f6d 0a20 2020   labels from.   
+00009fd0: 2020 2020 2075 6e64 6572 6c79 696e 6720       underlying 
+00009fe0: 7265 6665 7265 6e63 6573 2061 7265 2063  references are c
+00009ff0: 6f70 6965 6420 616e 6420 706c 6163 6564  opied and placed
+0000a000: 2069 6e20 7468 6520 746f 702d 6c65 7665   in the top-leve
+0000a010: 6c20 436f 6d70 6f6e 656e 742e 0a20 2020  l Component..   
+0000a020: 2020 2020 2049 6620 7369 6e67 6c65 5f6c       If single_l
+0000a030: 6179 6572 2069 7320 7370 6563 6966 6965  ayer is specifie
+0000a040: 642c 2061 6c6c 2070 6f6c 7967 6f6e 7320  d, all polygons 
+0000a050: 6172 6520 6d6f 7665 6420 746f 2074 6861  are moved to tha
+0000a060: 7420 6c61 7965 722e 0a0a 2020 2020 2020  t layer...      
+0000a070: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+0000a080: 2020 2020 7369 6e67 6c65 5f6c 6179 6572      single_layer
+0000a090: 3a20 6d6f 7665 2061 6c6c 2070 6f6c 7967  : move all polyg
+0000a0a0: 6f6e 7320 6172 6520 6d6f 7665 6420 746f  ons are moved to
+0000a0b0: 2074 6865 2073 7065 6369 6669 6564 2028   the specified (
+0000a0c0: 6f70 7469 6f6e 616c 292e 0a20 2020 2020  optional)..     
+0000a0d0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
+0000a0e0: 6f6d 706f 6e65 6e74 5f66 6c61 7420 3d20  omponent_flat = 
+0000a0f0: 436f 6d70 6f6e 656e 7428 290a 0a20 2020  Component()..   
+0000a100: 2020 2020 205f 6365 6c6c 203d 2073 656c       _cell = sel
+0000a110: 662e 5f63 656c 6c2e 636f 7079 286e 616d  f._cell.copy(nam
+0000a120: 653d 636f 6d70 6f6e 656e 745f 666c 6174  e=component_flat
+0000a130: 2e6e 616d 6529 0a20 2020 2020 2020 205f  .name).        _
+0000a140: 6365 6c6c 203d 205f 6365 6c6c 2e66 6c61  cell = _cell.fla
+0000a150: 7474 656e 2829 0a20 2020 2020 2020 2063  tten().        c
+0000a160: 6f6d 706f 6e65 6e74 5f66 6c61 742e 5f63  omponent_flat._c
+0000a170: 656c 6c20 3d20 5f63 656c 6c0a 2020 2020  ell = _cell.    
+0000a180: 2020 2020 6966 2073 696e 676c 655f 6c61      if single_la
+0000a190: 7965 7220 6973 206e 6f74 204e 6f6e 653a  yer is not None:
+0000a1a0: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+0000a1b0: 6d20 6764 7366 6163 746f 7279 2069 6d70  m gdsfactory imp
+0000a1c0: 6f72 7420 6765 745f 6c61 7965 720a 0a20  ort get_layer.. 
+0000a1d0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+0000a1e0: 2c20 6461 7461 7479 7065 203d 2067 6574  , datatype = get
+0000a1f0: 5f6c 6179 6572 2873 696e 676c 655f 6c61  _layer(single_la
+0000a200: 7965 7229 0a20 2020 2020 2020 2020 2020  yer).           
+0000a210: 2066 6f72 2070 6f6c 7967 6f6e 2069 6e20   for polygon in 
+0000a220: 5f63 656c 6c2e 706f 6c79 676f 6e73 3a0a  _cell.polygons:.
+0000a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a240: 706f 6c79 676f 6e2e 6c61 7965 7220 3d20  polygon.layer = 
+0000a250: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
+0000a260: 2020 2020 2020 706f 6c79 676f 6e2e 6461        polygon.da
+0000a270: 7461 7479 7065 203d 2064 6174 6174 7970  tatype = datatyp
+0000a280: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+0000a290: 7220 7061 7468 2069 6e20 5f63 656c 6c2e  r path in _cell.
+0000a2a0: 7061 7468 733a 0a20 2020 2020 2020 2020  paths:.         
+0000a2b0: 2020 2020 2020 2070 6174 682e 7365 745f         path.set_
+0000a2c0: 6c61 7965 7273 286c 6179 6572 290a 2020  layers(layer).  
+0000a2d0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000a2e0: 7468 2e73 6574 5f64 6174 6174 7970 6573  th.set_datatypes
+0000a2f0: 2864 6174 6174 7970 6529 0a0a 2020 2020  (datatype)..    
+0000a300: 2020 2020 636f 6d70 6f6e 656e 745f 666c      component_fl
+0000a310: 6174 2e69 6e66 6f20 3d20 7365 6c66 2e69  at.info = self.i
+0000a320: 6e66 6f2e 636f 7079 2829 0a20 2020 2020  nfo.copy().     
+0000a330: 2020 2063 6f6d 706f 6e65 6e74 5f66 6c61     component_fla
+0000a340: 742e 6164 645f 706f 7274 7328 7365 6c66  t.add_ports(self
+0000a350: 2e70 6f72 7473 290a 2020 2020 2020 2020  .ports).        
+0000a360: 7265 7475 726e 2063 6f6d 706f 6e65 6e74  return component
+0000a370: 5f66 6c61 740a 0a20 2020 2064 6566 2066  _flat..    def f
+0000a380: 6c61 7474 656e 5f72 6566 6572 656e 6365  latten_reference
+0000a390: 2873 656c 662c 2072 6566 3a20 436f 6d70  (self, ref: Comp
+0000a3a0: 6f6e 656e 7452 6566 6572 656e 6365 293a  onentReference):
+0000a3b0: 0a20 2020 2020 2020 2022 2222 4672 6f6d  .        """From
+0000a3c0: 2065 7869 7374 696e 6720 6365 6c6c 2072   existing cell r
+0000a3d0: 6570 6c61 6365 7320 7265 6665 7265 6e63  eplaces referenc
+0000a3e0: 6520 7769 7468 2061 2066 6c61 7474 656e  e with a flatten
+0000a3f0: 2072 6566 6572 656e 6365 205c 0a20 2020   reference \.   
+0000a400: 2020 2020 2077 6869 6368 2068 6173 2074       which has t
+0000a410: 6865 2074 7261 6e73 666f 726d 6174 696f  he transformatio
+0000a420: 6e73 2061 6c72 6561 6479 2061 7070 6c69  ns already appli
+0000a430: 6564 2e0a 0a20 2020 2020 2020 2054 7261  ed...        Tra
+0000a440: 6e73 666f 726d 6564 2072 6566 6572 656e  nsformed referen
+0000a450: 6365 206b 6565 7073 2074 6865 206f 7269  ce keeps the ori
+0000a460: 6769 6e61 6c20 6e61 6d65 2e0a 0a20 2020  ginal name...   
+0000a470: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000a480: 2020 2020 2020 2072 6566 3a20 7468 6520         ref: the 
+0000a490: 7265 6665 7265 6e63 6520 746f 2066 6c61  reference to fla
+0000a4a0: 7474 656e 2069 6e74 6f20 6120 6e65 7720  tten into a new 
+0000a4b0: 6365 6c6c 2e0a 0a20 2020 2020 2020 2022  cell...        "
+0000a4c0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+0000a4d0: 6764 7366 6163 746f 7279 2e66 756e 6374  gdsfactory.funct
+0000a4e0: 696f 6e73 2069 6d70 6f72 7420 7472 616e  ions import tran
+0000a4f0: 7366 6f72 6d65 640a 0a20 2020 2020 2020  sformed..       
+0000a500: 2073 656c 662e 7265 6d6f 7665 2872 6566   self.remove(ref
+0000a510: 290a 2020 2020 2020 2020 6e65 775f 636f  ).        new_co
+0000a520: 6d70 6f6e 656e 7420 3d20 7472 616e 7366  mponent = transf
+0000a530: 6f72 6d65 6428 7265 662c 2064 6563 6f72  ormed(ref, decor
+0000a540: 6174 6f72 3d4e 6f6e 6529 0a20 2020 2020  ator=None).     
+0000a550: 2020 2073 656c 662e 6164 645f 7265 6628     self.add_ref(
+0000a560: 6e65 775f 636f 6d70 6f6e 656e 742c 2061  new_component, a
+0000a570: 6c69 6173 3d72 6566 2e6e 616d 6529 0a0a  lias=ref.name)..
+0000a580: 2020 2020 6465 6620 6164 645f 7265 6628      def add_ref(
+0000a590: 0a20 2020 2020 2020 2073 656c 662c 2063  .        self, c
+0000a5a0: 6f6d 706f 6e65 6e74 3a20 436f 6d70 6f6e  omponent: Compon
+0000a5b0: 656e 742c 2061 6c69 6173 3a20 4f70 7469  ent, alias: Opti
+0000a5c0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+0000a5d0: 2c20 2a2a 6b77 6172 6773 0a20 2020 2029  , **kwargs.    )
+0000a5e0: 202d 3e20 436f 6d70 6f6e 656e 7452 6566   -> ComponentRef
+0000a5f0: 6572 656e 6365 3a0a 2020 2020 2020 2020  erence:.        
+0000a600: 2222 2241 6464 2043 6f6d 706f 6e65 6e74  """Add Component
+0000a610: 5265 6665 7265 6e63 6520 746f 2074 6865  Reference to the
+0000a620: 2063 7572 7265 6e74 2043 6f6d 706f 6e65   current Compone
+0000a630: 6e74 2e0a 0a20 2020 2020 2020 2041 7267  nt...        Arg
+0000a640: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+0000a650: 6f6d 706f 6e65 6e74 3a20 436f 6d70 6f6e  omponent: Compon
+0000a660: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
+0000a670: 2061 6c69 6173 3a20 6e61 6d65 645f 7265   alias: named_re
+0000a680: 6665 7265 6e63 6573 2e0a 0a20 2020 2020  ferences...     
+0000a690: 2020 204b 6579 776f 7264 2041 7267 733a     Keyword Args:
+0000a6a0: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
+0000a6b0: 756d 6e73 3a20 4e75 6d62 6572 206f 6620  umns: Number of 
+0000a6c0: 636f 6c75 6d6e 7320 696e 2074 6865 2061  columns in the a
+0000a6d0: 7272 6179 2e0a 2020 2020 2020 2020 2020  rray..          
+0000a6e0: 2020 726f 7773 3a20 4e75 6d62 6572 206f    rows: Number o
+0000a6f0: 6620 726f 7773 2069 6e20 7468 6520 6172  f rows in the ar
+0000a700: 7261 792e 0a20 2020 2020 2020 2020 2020  ray..           
+0000a710: 2073 7061 6369 6e67 3a20 4469 7374 616e   spacing: Distan
+0000a720: 6365 7320 6265 7477 6565 6e20 6164 6a61  ces between adja
+0000a730: 6365 6e74 2063 6f6c 756d 6e73 2061 6e64  cent columns and
+0000a740: 2061 646a 6163 656e 7420 726f 7773 2e0a   adjacent rows..
+0000a750: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
+0000a760: 696e 3a20 6172 7261 792d 6c69 6b65 5b32  in: array-like[2
+0000a770: 5d20 6f66 2069 6e74 206f 7220 666c 6f61  ] of int or floa
+0000a780: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000a790: 2020 506f 7369 7469 6f6e 2077 6865 7265    Position where
+0000a7a0: 2074 6865 2063 656c 6c20 6973 2069 6e73   the cell is ins
+0000a7b0: 6572 7465 642e 0a20 2020 2020 2020 2020  erted..         
+0000a7c0: 2020 2072 6f74 6174 696f 6e20 3a20 696e     rotation : in
+0000a7d0: 7420 6f72 2066 6c6f 6174 0a20 2020 2020  t or float.     
+0000a7e0: 2020 2020 2020 2020 2020 2041 6e67 6c65             Angle
+0000a7f0: 206f 6620 726f 7461 7469 6f6e 206f 6620   of rotation of 
+0000a800: 7468 6520 7265 6665 7265 6e63 6520 2869  the reference (i
+0000a810: 6e20 6064 6567 7265 6573 6029 2e0a 2020  n `degrees`)..  
+0000a820: 2020 2020 2020 2020 2020 6d61 676e 6966            magnif
+0000a830: 6963 6174 696f 6e20 3a20 696e 7420 6f72  ication : int or
+0000a840: 2066 6c6f 6174 0a20 2020 2020 2020 2020   float.         
+0000a850: 2020 2020 2020 204d 6167 6e69 6669 6361         Magnifica
+0000a860: 7469 6f6e 2066 6163 746f 7220 666f 7220  tion factor for 
+0000a870: 7468 6520 7265 6665 7265 6e63 652e 0a20  the reference.. 
+0000a880: 2020 2020 2020 2020 2020 2078 5f72 6566             x_ref
+0000a890: 6c65 6374 696f 6e20 3a20 626f 6f6c 0a20  lection : bool. 
+0000a8a0: 2020 2020 2020 2020 2020 2020 2020 2049                 I
+0000a8b0: 6620 5472 7565 2c20 7468 6520 7265 6665  f True, the refe
+0000a8c0: 7265 6e63 6520 6973 2072 6566 6c65 6374  rence is reflect
+0000a8d0: 6564 2070 6172 616c 6c65 6c20 746f 2074  ed parallel to t
+0000a8e0: 6865 2078 2064 6972 6563 7469 6f6e 0a20  he x direction. 
+0000a8f0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000a900: 6566 6f72 6520 6265 696e 6720 726f 7461  efore being rota
+0000a910: 7465 642e 0a20 2020 2020 2020 2020 2020  ted..           
+0000a920: 206e 616d 6520 3a20 7374 7220 286f 7074   name : str (opt
+0000a930: 696f 6e61 6c29 0a20 2020 2020 2020 2020  ional).         
+0000a940: 2020 2020 2020 2041 206e 616d 6520 666f         A name fo
+0000a950: 7220 7468 6520 7265 6665 7265 6e63 6520  r the reference 
+0000a960: 2869 6620 7072 6f76 6964 6564 292e 0a0a  (if provided)...
+0000a970: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000a980: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+0000a990: 7461 6e63 6528 636f 6d70 6f6e 656e 742c  tance(component,
+0000a9a0: 2043 6f6d 706f 6e65 6e74 293a 0a20 2020   Component):.   
+0000a9b0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0000a9c0: 7970 6545 7272 6f72 2866 2274 7970 6520  ypeError(f"type 
+0000a9d0: 3d20 7b74 7970 6528 436f 6d70 6f6e 656e  = {type(Componen
+0000a9e0: 7429 7d20 6e65 6564 7320 746f 2062 6520  t)} needs to be 
+0000a9f0: 6120 436f 6d70 6f6e 656e 742e 2229 0a20  a Component."). 
+0000aa00: 2020 2020 2020 2072 6566 203d 2043 6f6d         ref = Com
+0000aa10: 706f 6e65 6e74 5265 6665 7265 6e63 6528  ponentReference(
+0000aa20: 636f 6d70 6f6e 656e 742c 202a 2a6b 7761  component, **kwa
+0000aa30: 7267 7329 0a20 2020 2020 2020 2073 656c  rgs).        sel
+0000aa40: 662e 5f61 6464 2872 6566 290a 2020 2020  f._add(ref).    
+0000aa50: 2020 2020 7365 6c66 2e5f 7265 6769 7374      self._regist
+0000aa60: 6572 5f72 6566 6572 656e 6365 2872 6566  er_reference(ref
+0000aa70: 6572 656e 6365 3d72 6566 2c20 616c 6961  erence=ref, alia
+0000aa80: 733d 616c 6961 7329 0a20 2020 2020 2020  s=alias).       
+0000aa90: 2072 6574 7572 6e20 7265 660a 0a20 2020   return ref..   
+0000aaa0: 2064 6566 205f 7265 6769 7374 6572 5f72   def _register_r
+0000aab0: 6566 6572 656e 6365 280a 2020 2020 2020  eference(.      
+0000aac0: 2020 7365 6c66 2c20 7265 6665 7265 6e63    self, referenc
+0000aad0: 653a 2043 6f6d 706f 6e65 6e74 5265 6665  e: ComponentRefe
+0000aae0: 7265 6e63 652c 2061 6c69 6173 3a20 4f70  rence, alias: Op
+0000aaf0: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+0000ab00: 6e65 0a20 2020 2029 202d 3e20 4e6f 6e65  ne.    ) -> None
+0000ab10: 3a0a 2020 2020 2020 2020 636f 6d70 6f6e  :.        compon
+0000ab20: 656e 7420 3d20 7265 6665 7265 6e63 652e  ent = reference.
+0000ab30: 7061 7265 6e74 0a20 2020 2020 2020 2072  parent.        r
+0000ab40: 6566 6572 656e 6365 2e6f 776e 6572 203d  eference.owner =
+0000ab50: 2073 656c 660a 0a20 2020 2020 2020 2069   self..        i
+0000ab60: 6620 616c 6961 7320 6973 204e 6f6e 653a  f alias is None:
+0000ab70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000ab80: 7265 6665 7265 6e63 652e 6e61 6d65 2069  reference.name i
+0000ab90: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000aba0: 2020 2020 2020 2020 2020 2020 616c 6961              alia
+0000abb0: 7320 3d20 7265 6665 7265 6e63 652e 6e61  s = reference.na
+0000abc0: 6d65 0a20 2020 2020 2020 2020 2020 2065  me.            e
+0000abd0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000abe0: 2020 2020 2070 7265 6669 7820 3d20 280a       prefix = (.
+0000abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ac00: 2020 2020 636f 6d70 6f6e 656e 742e 7365      component.se
+0000ac10: 7474 696e 6773 2e66 756e 6374 696f 6e5f  ttings.function_
+0000ac20: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
+0000ac30: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+0000ac40: 7474 7228 636f 6d70 6f6e 656e 742c 2022  ttr(component, "
+0000ac50: 7365 7474 696e 6773 2229 0a20 2020 2020  settings").     
+0000ac60: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000ac70: 6e64 2068 6173 6174 7472 2863 6f6d 706f  nd hasattr(compo
+0000ac80: 6e65 6e74 2e73 6574 7469 6e67 732c 2022  nent.settings, "
+0000ac90: 6675 6e63 7469 6f6e 5f6e 616d 6522 290a  function_name").
+0000aca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000acb0: 2020 2020 656c 7365 2063 6f6d 706f 6e65      else compone
+0000acc0: 6e74 2e6e 616d 650a 2020 2020 2020 2020  nt.name.        
+0000acd0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ace0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000acf0: 7265 6665 7265 6e63 655f 6e61 6d65 735f  reference_names_
+0000ad00: 636f 756e 7465 722e 7570 6461 7465 287b  counter.update({
+0000ad10: 7072 6566 6978 3a20 317d 290a 2020 2020  prefix: 1}).    
+0000ad20: 2020 2020 2020 2020 2020 2020 616c 6961              alia
+0000ad30: 7320 3d20 6622 7b70 7265 6669 787d 5f7b  s = f"{prefix}_{
+0000ad40: 7365 6c66 2e5f 7265 6665 7265 6e63 655f  self._reference_
+0000ad50: 6e61 6d65 735f 636f 756e 7465 725b 7072  names_counter[pr
+0000ad60: 6566 6978 5d7d 220a 0a20 2020 2020 2020  efix]}"..       
+0000ad70: 2020 2020 2020 2020 2077 6869 6c65 2061           while a
+0000ad80: 6c69 6173 2069 6e20 7365 6c66 2e5f 6e61  lias in self._na
+0000ad90: 6d65 645f 7265 6665 7265 6e63 6573 3a0a  med_references:.
 0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adb0: 7365 6c66 2e5f 7265 6665 7265 6e63 655f  self._reference_
-0000adc0: 6e61 6d65 735f 636f 756e 7465 722e 7570  names_counter.up
-0000add0: 6461 7465 287b 7072 6566 6978 3a20 317d  date({prefix: 1}
-0000ade0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000adf0: 2020 616c 6961 7320 3d20 6622 7b70 7265    alias = f"{pre
-0000ae00: 6669 787d 5f7b 7365 6c66 2e5f 7265 6665  fix}_{self._refe
-0000ae10: 7265 6e63 655f 6e61 6d65 735f 636f 756e  rence_names_coun
-0000ae20: 7465 725b 7072 6566 6978 5d7d 220a 0a20  ter[prefix]}".. 
-0000ae30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000ae40: 6869 6c65 2061 6c69 6173 2069 6e20 7365  hile alias in se
-0000ae50: 6c66 2e5f 6e61 6d65 645f 7265 6665 7265  lf._named_refere
-0000ae60: 6e63 6573 3a0a 2020 2020 2020 2020 2020  nces:.          
-0000ae70: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000ae80: 7265 6665 7265 6e63 655f 6e61 6d65 735f  reference_names_
-0000ae90: 636f 756e 7465 722e 7570 6461 7465 287b  counter.update({
-0000aea0: 7072 6566 6978 3a20 317d 290a 2020 2020  prefix: 1}).    
-0000aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aec0: 616c 6961 7320 3d20 6622 7b70 7265 6669  alias = f"{prefi
-0000aed0: 787d 5f7b 7365 6c66 2e5f 7265 6665 7265  x}_{self._refere
-0000aee0: 6e63 655f 6e61 6d65 735f 636f 756e 7465  nce_names_counte
-0000aef0: 725b 7072 6566 6978 5d7d 220a 0a20 2020  r[prefix]}"..   
-0000af00: 2020 2020 2072 6566 6572 656e 6365 2e6e       reference.n
-0000af10: 616d 6520 3d20 616c 6961 730a 2020 2020  ame = alias.    
-0000af20: 2020 2020 7365 6c66 2e5f 6e61 6d65 645f      self._named_
-0000af30: 7265 6665 7265 6e63 6573 5b61 6c69 6173  references[alias
-0000af40: 5d20 3d20 7265 6665 7265 6e63 650a 0a20  ] = reference.. 
-0000af50: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000af60: 2064 6566 206c 6179 6572 7328 7365 6c66   def layers(self
-0000af70: 2920 2d3e 2053 6574 5b54 7570 6c65 5b69  ) -> Set[Tuple[i
-0000af80: 6e74 2c20 696e 745d 5d3a 0a20 2020 2020  nt, int]]:.     
-0000af90: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-0000afa0: 7365 7420 6f66 2074 6865 204c 6179 6572  set of the Layer
-0000afb0: 7320 696e 2074 6865 2043 6f6d 706f 6e65  s in the Compone
-0000afc0: 6e74 2e22 2222 0a20 2020 2020 2020 2072  nt.""".        r
-0000afd0: 6574 7572 6e20 7365 6c66 2e67 6574 5f6c  eturn self.get_l
-0000afe0: 6179 6572 7328 290a 0a20 2020 2064 6566  ayers()..    def
-0000aff0: 2067 6574 5f6c 6179 6572 7328 7365 6c66   get_layers(self
-0000b000: 2920 2d3e 2053 6574 5b54 7570 6c65 5b69  ) -> Set[Tuple[i
-0000b010: 6e74 2c20 696e 745d 5d3a 0a20 2020 2020  nt, int]]:.     
-0000b020: 2020 2022 2222 5265 7475 726e 2061 2073     """Return a s
-0000b030: 6574 206f 6620 286c 6179 6572 2c20 6461  et of (layer, da
-0000b040: 7461 7479 7065 292e 0a0a 2020 2020 2020  tatype)...      
-0000b050: 2020 2e2e 2063 6f64 6520 3a3a 0a0a 2020    .. code ::..  
-0000b060: 2020 2020 2020 2020 2020 696d 706f 7274            import
-0000b070: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
-0000b080: 660a 2020 2020 2020 2020 2020 2020 6766  f.            gf
-0000b090: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
-0000b0a0: 6967 6874 2829 2e67 6574 5f6c 6179 6572  ight().get_layer
-0000b0b0: 7328 2920 3d3d 207b 2831 2c20 3029 2c20  s() == {(1, 0), 
-0000b0c0: 2831 3131 2c20 3029 7d0a 2020 2020 2020  (111, 0)}.      
-0000b0d0: 2020 2222 220a 2020 2020 2020 2020 706f    """.        po
-0000b0e0: 6c79 676f 6e73 203d 2073 656c 662e 5f63  lygons = self._c
-0000b0f0: 656c 6c2e 6765 745f 706f 6c79 676f 6e73  ell.get_polygons
-0000b100: 2864 6570 7468 3d4e 6f6e 6529 0a20 2020  (depth=None).   
-0000b110: 2020 2020 2072 6574 7572 6e20 7b28 706f       return {(po
-0000b120: 6c79 676f 6e2e 6c61 7965 722c 2070 6f6c  lygon.layer, pol
-0000b130: 7967 6f6e 2e64 6174 6174 7970 6529 2066  ygon.datatype) f
-0000b140: 6f72 2070 6f6c 7967 6f6e 2069 6e20 706f  or polygon in po
-0000b150: 6c79 676f 6e73 7d0a 0a20 2020 2064 6566  lygons}..    def
-0000b160: 2067 6574 5f6c 6179 6572 5f6e 616d 6573   get_layer_names
-0000b170: 2873 656c 6629 202d 3e20 4c69 7374 5b54  (self) -> List[T
-0000b180: 7570 6c65 5b69 6e74 2c20 696e 745d 5d3a  uple[int, int]]:
-0000b190: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0000b1a0: 726e 206c 6179 6572 206e 616d 6573 2075  rn layer names u
-0000b1b0: 7365 6420 696e 2074 6865 2064 6573 6967  sed in the desig
-0000b1c0: 6e2e 0a0a 2020 2020 2020 2020 2e2e 2063  n...        .. c
-0000b1d0: 6f64 6520 3a3a 0a0a 2020 2020 2020 2020  ode ::..        
-0000b1e0: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
-0000b1f0: 6374 6f72 7920 6173 2067 660a 2020 2020  ctory as gf.    
-0000b200: 2020 2020 2020 2020 6766 2e63 6f6d 706f          gf.compo
-0000b210: 6e65 6e74 732e 7374 7261 6967 6874 2829  nents.straight()
-0000b220: 2e67 6574 5f6e 616d 6573 2829 203d 3d20  .get_names() == 
-0000b230: 5b27 5747 275d 0a20 2020 2020 2020 2022  ['WG'].        "
-0000b240: 2222 0a20 2020 2020 2020 2069 6d70 6f72  "".        impor
-0000b250: 7420 6764 7366 6163 746f 7279 2061 7320  t gdsfactory as 
-0000b260: 6766 0a0a 2020 2020 2020 2020 5044 4b20  gf..        PDK 
-0000b270: 3d20 6766 2e67 6574 5f61 6374 6976 655f  = gf.get_active_
-0000b280: 7064 6b28 290a 2020 2020 2020 2020 4c41  pdk().        LA
-0000b290: 5945 5253 203d 2050 444b 2e6c 6179 6572  YERS = PDK.layer
-0000b2a0: 730a 2020 2020 2020 2020 6e61 6d65 5f74  s.        name_t
-0000b2b0: 6f5f 6c61 7965 7220 3d20 6469 6374 284c  o_layer = dict(L
-0000b2c0: 4159 4552 5329 0a20 2020 2020 2020 206c  AYERS).        l
-0000b2d0: 6179 6572 5f74 6f5f 6e61 6d65 203d 207b  ayer_to_name = {
-0000b2e0: 763a 206b 2066 6f72 206b 2c20 7620 696e  v: k for k, v in
-0000b2f0: 206e 616d 655f 746f 5f6c 6179 6572 2e69   name_to_layer.i
-0000b300: 7465 6d73 2829 7d0a 2020 2020 2020 2020  tems()}.        
-0000b310: 6c61 7965 725f 6e61 6d65 7320 3d20 5b5d  layer_names = []
-0000b320: 0a0a 2020 2020 2020 2020 666f 7220 6c61  ..        for la
-0000b330: 7965 7220 696e 2073 656c 662e 6c61 7965  yer in self.laye
-0000b340: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-0000b350: 6966 206c 6179 6572 206e 6f74 2069 6e20  if layer not in 
-0000b360: 6c61 7965 725f 746f 5f6e 616d 653a 0a20  layer_to_name:. 
-0000b370: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0000b380: 6172 6e69 6e67 732e 7761 726e 2866 227b  arnings.warn(f"{
-0000b390: 6c61 7965 727d 206e 6f74 2069 6e20 4c61  layer} not in La
-0000b3a0: 7965 724d 6170 2e2e 2229 0a20 2020 2020  yerMap..").     
-0000b3b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000b3c0: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-0000b3d0: 6572 5f6e 616d 6573 2e61 7070 656e 6428  er_names.append(
-0000b3e0: 6c61 7965 725f 746f 5f6e 616d 655b 6c61  layer_to_name[la
-0000b3f0: 7965 725d 290a 2020 2020 2020 2020 7265  yer]).        re
-0000b400: 7475 726e 206c 6179 6572 5f6e 616d 6573  turn layer_names
-0000b410: 0a0a 2020 2020 6465 6620 5f69 7079 7468  ..    def _ipyth
-0000b420: 6f6e 5f64 6973 706c 6179 5f28 7365 6c66  on_display_(self
-0000b430: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000b440: 2020 2022 2222 5368 6f77 2067 656f 6d65     """Show geome
-0000b450: 7472 7920 696e 204b 4c61 796f 7574 2061  try in KLayout a
-0000b460: 6e64 2069 6e20 6d61 7470 6c6f 746c 6962  nd in matplotlib
-0000b470: 2066 6f72 204a 7570 7974 6572 204e 6f74   for Jupyter Not
-0000b480: 6562 6f6f 6b73 2e22 2222 0a20 2020 2020  ebooks.""".     
-0000b490: 2020 2073 656c 662e 7368 6f77 2873 686f     self.show(sho
-0000b4a0: 775f 706f 7274 733d 5472 7565 2920 2023  w_ports=True)  #
-0000b4b0: 2073 686f 7720 696e 206b 6c61 796f 7574   show in klayout
-0000b4c0: 0a20 2020 2020 2020 2073 656c 662e 706c  .        self.pl
-0000b4d0: 6f74 5f6b 6c61 796f 7574 2829 0a20 2020  ot_klayout().   
-0000b4e0: 2020 2020 2070 7269 6e74 2873 656c 6629       print(self)
-0000b4f0: 0a0a 2020 2020 6465 6620 6164 645f 7069  ..    def add_pi
-0000b500: 6e73 5f74 7269 616e 676c 6528 0a20 2020  ns_triangle(.   
-0000b510: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000b520: 2020 2070 6f72 745f 6d61 726b 6572 5f6c     port_marker_l
-0000b530: 6179 6572 3a20 4c61 7965 7220 3d20 2831  ayer: Layer = (1
-0000b540: 2c20 3130 292c 0a20 2020 2029 3a0a 2020  , 10),.    ):.  
-0000b550: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-0000b560: 2063 6f6d 706f 6e65 6e74 2077 6974 6820   component with 
-0000b570: 7472 6961 6e67 756c 6172 2070 696e 732e  triangular pins.
-0000b580: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-0000b590: 2067 6473 6661 6374 6f72 792e 6164 645f   gdsfactory.add_
-0000b5a0: 7069 6e73 2069 6d70 6f72 7420 6164 645f  pins import add_
-0000b5b0: 7069 6e73 5f74 7269 616e 676c 650a 0a20  pins_triangle.. 
-0000b5c0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-0000b5d0: 203d 2073 656c 662e 636f 7079 2829 0a20   = self.copy(). 
-0000b5e0: 2020 2020 2020 2063 6f6d 706f 6e65 6e74         component
-0000b5f0: 2e6e 616d 6520 3d20 7365 6c66 2e6e 616d  .name = self.nam
-0000b600: 650a 2020 2020 2020 2020 6164 645f 7069  e.        add_pi
-0000b610: 6e73 5f74 7269 616e 676c 6528 636f 6d70  ns_triangle(comp
-0000b620: 6f6e 656e 743d 636f 6d70 6f6e 656e 742c  onent=component,
-0000b630: 206c 6179 6572 3d70 6f72 745f 6d61 726b   layer=port_mark
-0000b640: 6572 5f6c 6179 6572 290a 2020 2020 2020  er_layer).      
-0000b650: 2020 7265 7475 726e 2063 6f6d 706f 6e65    return compone
-0000b660: 6e74 0a0a 2020 2020 6465 6620 706c 6f74  nt..    def plot
-0000b670: 5f77 6964 6765 7428 0a20 2020 2020 2020  _widget(.       
-0000b680: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
-0000b690: 686f 775f 706f 7274 733a 2062 6f6f 6c20  how_ports: bool 
-0000b6a0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-0000b6b0: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
-0000b6c0: 723a 204c 6179 6572 203d 2028 312c 2031  r: Layer = (1, 1
-0000b6d0: 3029 2c0a 2020 2020 293a 0a20 2020 2020  0),.    ):.     
-0000b6e0: 2020 2022 2222 5265 7475 726e 7320 6970     """Returns ip
-0000b6f0: 7974 686f 6e20 7769 6467 6574 2066 6f72  ython widget for
-0000b700: 206b 6c61 796f 7574 2076 6973 7561 6c69   klayout visuali
-0000b710: 7a61 7469 6f6e 2e0a 0a20 2020 2020 2020  zation...       
-0000b720: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0000b730: 2020 2073 686f 775f 706f 7274 733a 2073     show_ports: s
-0000b740: 686f 7773 2063 6f6d 706f 6e65 6e74 2077  hows component w
-0000b750: 6974 6820 706f 7274 206d 6172 6b65 7273  ith port markers
-0000b760: 2061 6e64 206c 6162 656c 732e 0a20 2020   and labels..   
-0000b770: 2020 2020 2020 2020 2070 6f72 745f 6d61           port_ma
-0000b780: 726b 6572 5f6c 6179 6572 3a20 666f 7220  rker_layer: for 
-0000b790: 7468 6520 706f 7274 732e 0a20 2020 2020  the ports..     
-0000b7a0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-0000b7b0: 726f 6d20 6764 7366 6163 746f 7279 2e70  rom gdsfactory.p
-0000b7c0: 646b 2069 6d70 6f72 7420 6765 745f 6c61  dk import get_la
-0000b7d0: 7965 725f 7669 6577 730a 2020 2020 2020  yer_views.      
-0000b7e0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-0000b7f0: 792e 7769 6467 6574 732e 6c61 796f 7574  y.widgets.layout
-0000b800: 5f76 6965 7765 7220 696d 706f 7274 204c  _viewer import L
-0000b810: 6179 6f75 7456 6965 7765 720a 2020 2020  ayoutViewer.    
-0000b820: 2020 2020 6672 6f6d 2049 5079 7468 6f6e      from IPython
-0000b830: 2e64 6973 706c 6179 2069 6d70 6f72 7420  .display import 
-0000b840: 6469 7370 6c61 790a 0a20 2020 2020 2020  display..       
-0000b850: 2063 6f6d 706f 6e65 6e74 203d 2028 0a20   component = (. 
-0000b860: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b870: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
-0000b880: 6528 706f 7274 5f6d 6172 6b65 725f 6c61  e(port_marker_la
-0000b890: 7965 723d 706f 7274 5f6d 6172 6b65 725f  yer=port_marker_
-0000b8a0: 6c61 7965 7229 0a20 2020 2020 2020 2020  layer).         
-0000b8b0: 2020 2069 6620 7368 6f77 5f70 6f72 7473     if show_ports
-0000b8c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000b8d0: 6520 7365 6c66 0a20 2020 2020 2020 2029  e self.        )
-0000b8e0: 0a0a 2020 2020 2020 2020 6764 7370 6174  ..        gdspat
-0000b8f0: 6820 3d20 636f 6d70 6f6e 656e 742e 7772  h = component.wr
-0000b900: 6974 655f 6764 7328 6c6f 6767 696e 673d  ite_gds(logging=
-0000b910: 4661 6c73 6529 0a20 2020 2020 2020 206c  False).        l
-0000b920: 7970 5f70 6174 6820 3d20 6764 7370 6174  yp_path = gdspat
-0000b930: 682e 7769 7468 5f73 7566 6669 7828 222e  h.with_suffix(".
-0000b940: 6c79 7022 290a 0a20 2020 2020 2020 206c  lyp")..        l
-0000b950: 6179 6572 5f76 6965 7773 203d 2067 6574  ayer_views = get
-0000b960: 5f6c 6179 6572 5f76 6965 7773 2829 0a20  _layer_views(). 
-0000b970: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
-0000b980: 7773 2e74 6f5f 6c79 7028 6669 6c65 7061  ws.to_lyp(filepa
-0000b990: 7468 3d6c 7970 5f70 6174 6829 0a0a 2020  th=lyp_path)..  
-0000b9a0: 2020 2020 2020 6c61 796f 7574 203d 204c        layout = L
-0000b9b0: 6179 6f75 7456 6965 7765 7228 6764 7370  ayoutViewer(gdsp
-0000b9c0: 6174 682c 206c 7970 5f70 6174 6829 0a20  ath, lyp_path). 
-0000b9d0: 2020 2020 2020 2064 6973 706c 6179 286c         display(l
-0000b9e0: 6179 6f75 742e 7769 6467 6574 290a 0a20  ayout.widget).. 
-0000b9f0: 2020 2064 6566 2070 6c6f 745f 6b6c 6179     def plot_klay
-0000ba00: 6f75 7428 0a20 2020 2020 2020 2073 656c  out(.        sel
-0000ba10: 662c 0a20 2020 2020 2020 2073 686f 775f  f,.        show_
-0000ba20: 706f 7274 733a 2062 6f6f 6c20 3d20 5472  ports: bool = Tr
-0000ba30: 7565 2c0a 2020 2020 2020 2020 706f 7274  ue,.        port
-0000ba40: 5f6d 6172 6b65 725f 6c61 7965 723a 204c  _marker_layer: L
-0000ba50: 6179 6572 203d 2028 312c 2031 3029 2c0a  ayer = (1, 10),.
-0000ba60: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-0000ba70: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-0000ba80: 7320 6b6c 6179 6f75 7420 696d 6167 652e  s klayout image.
-0000ba90: 0a0a 2020 2020 2020 2020 4966 2069 7420  ..        If it 
-0000baa0: 6661 696c 7320 746f 2069 6d70 6f72 7420  fails to import 
-0000bab0: 6b6c 6179 6f75 7420 6465 6661 756c 7473  klayout defaults
-0000bac0: 2074 6f20 6d61 7470 6c6f 746c 6962 2e0a   to matplotlib..
-0000bad0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
-0000bae0: 2020 2020 2020 2020 2020 2073 686f 775f             show_
-0000baf0: 706f 7274 733a 2073 686f 7773 2063 6f6d  ports: shows com
-0000bb00: 706f 6e65 6e74 2077 6974 6820 706f 7274  ponent with port
-0000bb10: 206d 6172 6b65 7273 2061 6e64 206c 6162   markers and lab
-0000bb20: 656c 732e 0a20 2020 2020 2020 2020 2020  els..           
-0000bb30: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
-0000bb40: 6572 3a20 666f 7220 7468 6520 706f 7274  er: for the port
-0000bb50: 732e 0a20 2020 2020 2020 2022 2222 0a0a  s..        """..
-0000bb60: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-0000bb70: 7420 3d20 280a 2020 2020 2020 2020 2020  t = (.          
-0000bb80: 2020 7365 6c66 2e61 6464 5f70 696e 735f    self.add_pins_
-0000bb90: 7472 6961 6e67 6c65 2870 6f72 745f 6d61  triangle(port_ma
-0000bba0: 726b 6572 5f6c 6179 6572 3d70 6f72 745f  rker_layer=port_
-0000bbb0: 6d61 726b 6572 5f6c 6179 6572 290a 2020  marker_layer).  
-0000bbc0: 2020 2020 2020 2020 2020 6966 2073 686f            if sho
-0000bbd0: 775f 706f 7274 730a 2020 2020 2020 2020  w_ports.        
-0000bbe0: 2020 2020 656c 7365 2073 656c 660a 2020      else self.  
-0000bbf0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000bc00: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000bc10: 2020 696d 706f 7274 206b 6c61 796f 7574    import klayout
-0000bc20: 2e64 6220 6173 2064 6220 2023 206e 6f71  .db as db  # noq
-0000bc30: 613a 2046 3430 310a 2020 2020 2020 2020  a: F401.        
-0000bc40: 2020 2020 696d 706f 7274 206b 6c61 796f      import klayo
-0000bc50: 7574 2e6c 6179 2061 7320 6c61 790a 2020  ut.lay as lay.  
-0000bc60: 2020 2020 2020 2020 2020 6672 6f6d 2067            from g
-0000bc70: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
-0000bc80: 706f 7274 2067 6574 5f6c 6179 6572 5f76  port get_layer_v
-0000bc90: 6965 7773 0a20 2020 2020 2020 2020 2020  iews.           
-0000bca0: 2066 726f 6d20 4950 7974 686f 6e2e 6469   from IPython.di
-0000bcb0: 7370 6c61 7920 696d 706f 7274 2064 6973  splay import dis
-0000bcc0: 706c 6179 0a20 2020 2020 2020 2020 2020  play.           
-0000bcd0: 2066 726f 6d20 6970 7977 6964 6765 7473   from ipywidgets
-0000bce0: 2069 6d70 6f72 7420 496d 6167 650a 0a20   import Image.. 
-0000bcf0: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
-0000bd00: 7468 203d 2063 6f6d 706f 6e65 6e74 2e77  th = component.w
-0000bd10: 7269 7465 5f67 6473 286c 6f67 6769 6e67  rite_gds(logging
-0000bd20: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
-0000bd30: 2020 2020 6c79 705f 7061 7468 203d 2067      lyp_path = g
-0000bd40: 6473 7061 7468 2e77 6974 685f 7375 6666  dspath.with_suff
-0000bd50: 6978 2822 2e6c 7970 2229 0a0a 2020 2020  ix(".lyp")..    
-0000bd60: 2020 2020 2020 2020 6c61 7965 725f 7669          layer_vi
-0000bd70: 6577 7320 3d20 6765 745f 6c61 7965 725f  ews = get_layer_
-0000bd80: 7669 6577 7328 290a 2020 2020 2020 2020  views().        
-0000bd90: 2020 2020 6c61 7965 725f 7669 6577 732e      layer_views.
-0000bda0: 746f 5f6c 7970 2866 696c 6570 6174 683d  to_lyp(filepath=
-0000bdb0: 6c79 705f 7061 7468 290a 0a20 2020 2020  lyp_path)..     
-0000bdc0: 2020 2020 2020 206c 6179 6f75 745f 7669         layout_vi
-0000bdd0: 6577 203d 206c 6179 2e4c 6179 6f75 7456  ew = lay.LayoutV
-0000bde0: 6965 7728 290a 2020 2020 2020 2020 2020  iew().          
-0000bdf0: 2020 6c61 796f 7574 5f76 6965 772e 6c6f    layout_view.lo
-0000be00: 6164 5f6c 6179 6f75 7428 7374 7228 6764  ad_layout(str(gd
-0000be10: 7370 6174 682e 6162 736f 6c75 7465 2829  spath.absolute()
-0000be20: 2929 0a20 2020 2020 2020 2020 2020 206c  )).            l
-0000be30: 6179 6f75 745f 7669 6577 2e6d 6178 5f68  ayout_view.max_h
-0000be40: 6965 7228 290a 2020 2020 2020 2020 2020  ier().          
-0000be50: 2020 6c61 796f 7574 5f76 6965 772e 6c6f    layout_view.lo
-0000be60: 6164 5f6c 6179 6572 5f70 726f 7073 2873  ad_layer_props(s
-0000be70: 7472 286c 7970 5f70 6174 6829 290a 0a20  tr(lyp_path)).. 
-0000be80: 2020 2020 2020 2020 2020 2070 6978 656c             pixel
-0000be90: 5f62 7566 6665 7220 3d20 6c61 796f 7574  _buffer = layout
-0000bea0: 5f76 6965 772e 6765 745f 7069 7865 6c73  _view.get_pixels
-0000beb0: 5f77 6974 685f 6f70 7469 6f6e 7328 3830  _with_options(80
-0000bec0: 302c 2036 3030 290a 2020 2020 2020 2020  0, 600).        
-0000bed0: 2020 2020 706e 675f 6461 7461 203d 2070      png_data = p
-0000bee0: 6978 656c 5f62 7566 6665 722e 746f 5f70  ixel_buffer.to_p
-0000bef0: 6e67 5f64 6174 6128 290a 2020 2020 2020  ng_data().      
-0000bf00: 2020 2020 2020 696d 6167 6520 3d20 496d        image = Im
-0000bf10: 6167 6528 7661 6c75 653d 706e 675f 6461  age(value=png_da
-0000bf20: 7461 2c20 666f 726d 6174 3d22 706e 6722  ta, format="png"
-0000bf30: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
-0000bf40: 7370 6c61 7928 696d 6167 6529 0a0a 2020  splay(image)..  
-0000bf50: 2020 2020 2020 6578 6365 7074 2049 6d70        except Imp
-0000bf60: 6f72 7445 7272 6f72 3a0a 2020 2020 2020  ortError:.      
-0000bf70: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-0000bf80: 2020 2020 2020 2020 2020 2020 2022 596f               "Yo
-0000bf90: 7520 6361 6e20 696e 7374 616c 6c20 6070  u can install `p
-0000bfa0: 6970 2069 6e73 7461 6c6c 2067 6473 6661  ip install gdsfa
-0000bfb0: 6374 6f72 795b 6675 6c6c 5d60 2066 6f72  ctory[full]` for
-0000bfc0: 2062 6574 7465 7220 7669 7375 616c 697a   better visualiz
-0000bfd0: 6174 696f 6e22 0a20 2020 2020 2020 2020  ation".         
-0000bfe0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000bff0: 2063 6f6d 706f 6e65 6e74 2e70 6c6f 7428   component.plot(
-0000c000: 706c 6f74 7465 723d 226d 6174 706c 6f74  plotter="matplot
-0000c010: 6c69 6222 290a 0a20 2020 2064 6566 2070  lib")..    def p
-0000c020: 6c6f 745f 6a75 7079 7465 7228 7365 6c66  lot_jupyter(self
-0000c030: 293a 0a20 2020 2020 2020 2022 2222 5368  ):.        """Sh
-0000c040: 6f77 7320 6375 7272 656e 7420 6764 7320  ows current gds 
-0000c050: 696e 206b 6c61 796f 7574 2e20 5573 6573  in klayout. Uses
-0000c060: 204b 7765 6220 6966 2073 6572 7665 7220   Kweb if server 
-0000c070: 7275 6e6e 696e 672e 0a0a 2020 2020 2020  running...      
-0000c080: 2020 6966 206e 6f74 2074 7269 6573 2075    if not tries u
-0000c090: 7369 6e67 204b 6c61 796f 7574 2077 6964  sing Klayout wid
-0000c0a0: 6765 7420 616e 6420 6669 6e61 6c6c 7920  get and finally 
-0000c0b0: 6465 6661 756c 7473 2074 6f20 6d61 7470  defaults to matp
-0000c0c0: 6c6f 746c 6962 2e0a 2020 2020 2020 2020  lotlib..        
-0000c0d0: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
-0000c0e0: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-0000c0f0: 6f72 7420 6f73 0a20 2020 2020 2020 2020  ort os.         
-0000c100: 2020 2066 726f 6d20 6764 7366 6163 746f     from gdsfacto
-0000c110: 7279 2e63 6f6e 6669 6720 696d 706f 7274  ry.config import
-0000c120: 2050 4154 480a 2020 2020 2020 2020 2020   PATH.          
-0000c130: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-0000c140: 792e 7064 6b20 696d 706f 7274 2067 6574  y.pdk import get
-0000c150: 5f6c 6179 6572 5f76 6965 7773 0a20 2020  _layer_views.   
-0000c160: 2020 2020 2020 2020 2066 726f 6d20 4950           from IP
-0000c170: 7974 686f 6e2e 6469 7370 6c61 7920 696d  ython.display im
-0000c180: 706f 7274 2049 4672 616d 650a 2020 2020  port IFrame.    
-0000c190: 2020 2020 2020 2020 696d 706f 7274 206b          import k
-0000c1a0: 7765 622e 7365 7276 6572 5f6a 7570 7974  web.server_jupyt
-0000c1b0: 6572 2061 7320 6b6a 0a20 2020 2020 2020  er as kj.       
-0000c1c0: 2020 2020 2066 726f 6d20 6874 6d6c 2069       from html i
-0000c1d0: 6d70 6f72 7420 6573 6361 7065 0a0a 2020  mport escape..  
-0000c1e0: 2020 2020 2020 2020 2020 6764 7370 6174            gdspat
-0000c1f0: 6820 3d20 7365 6c66 2e77 7269 7465 5f67  h = self.write_g
-0000c200: 6473 2867 6473 6469 723d 5041 5448 2e67  ds(gdsdir=PATH.g
-0000c210: 6473 6c69 6220 2f20 2265 7874 7261 222c  dslib / "extra",
-0000c220: 206c 6f67 6769 6e67 3d46 616c 7365 290a   logging=False).
-0000c230: 0a20 2020 2020 2020 2020 2020 2064 6972  .            dir
-0000c240: 7061 7468 203d 2070 6174 686c 6962 2e50  path = pathlib.P
-0000c250: 6174 6828 7465 6d70 6669 6c65 2e54 656d  ath(tempfile.Tem
-0000c260: 706f 7261 7279 4469 7265 6374 6f72 7928  poraryDirectory(
-0000c270: 292e 6e61 6d65 2920 2f20 2267 6473 6661  ).name) / "gdsfa
-0000c280: 6374 6f72 7922 0a20 2020 2020 2020 2020  ctory".         
-0000c290: 2020 2064 6972 7061 7468 2e6d 6b64 6972     dirpath.mkdir
-0000c2a0: 2865 7869 7374 5f6f 6b3d 5472 7565 2c20  (exist_ok=True, 
-0000c2b0: 7061 7265 6e74 733d 5472 7565 290a 2020  parents=True).  
-0000c2c0: 2020 2020 2020 2020 2020 6c79 705f 7061            lyp_pa
-0000c2d0: 7468 203d 2064 6972 7061 7468 202f 2022  th = dirpath / "
-0000c2e0: 6c61 7965 7273 2e6c 7970 220a 0a20 2020  layers.lyp"..   
-0000c2f0: 2020 2020 2020 2020 206c 6179 6572 5f70           layer_p
-0000c300: 726f 7073 203d 2067 6574 5f6c 6179 6572  rops = get_layer
-0000c310: 5f76 6965 7773 2829 0a20 2020 2020 2020  _views().       
-0000c320: 2020 2020 206c 6179 6572 5f70 726f 7073       layer_props
-0000c330: 2e74 6f5f 6c79 7028 6669 6c65 7061 7468  .to_lyp(filepath
-0000c340: 3d6c 7970 5f70 6174 6829 0a0a 2020 2020  =lyp_path)..    
-0000c350: 2020 2020 2020 2020 7372 6320 3d20 6622          src = f"
-0000c360: 6874 7470 3a2f 2f31 3237 2e30 2e30 2e31  http://127.0.0.1
-0000c370: 3a7b 6b6a 2e70 6f72 747d 2f67 6473 3f67  :{kj.port}/gds?g
-0000c380: 6473 5f66 696c 653d 7b65 7363 6170 6528  ds_file={escape(
-0000c390: 7374 7228 6764 7370 6174 6829 297d 266c  str(gdspath))}&l
-0000c3a0: 6179 6572 5f70 726f 7073 3d7b 6573 6361  ayer_props={esca
-0000c3b0: 7065 2873 7472 286c 7970 5f70 6174 6829  pe(str(lyp_path)
-0000c3c0: 297d 220a 2020 2020 2020 2020 2020 2020  )}".            
-0000c3d0: 6c6f 6767 6572 2e64 6562 7567 2873 7263  logger.debug(src
-0000c3e0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-0000c3f0: 6620 6b6a 2e6a 7570 7974 6572 5f73 6572  f kj.jupyter_ser
-0000c400: 7665 7220 616e 6420 6e6f 7420 6f73 2e65  ver and not os.e
-0000c410: 6e76 6972 6f6e 2e67 6574 2822 444f 4353  nviron.get("DOCS
-0000c420: 222c 2046 616c 7365 293a 0a20 2020 2020  ", False):.     
-0000c430: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000c440: 6e20 4946 7261 6d65 280a 2020 2020 2020  n IFrame(.      
-0000c450: 2020 2020 2020 2020 2020 2020 2020 7372                sr
-0000c460: 633d 7372 632c 0a20 2020 2020 2020 2020  c=src,.         
-0000c470: 2020 2020 2020 2020 2020 2077 6964 7468             width
-0000c480: 3d31 3430 302c 0a20 2020 2020 2020 2020  =1400,.         
-0000c490: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-0000c4a0: 743d 3630 302c 0a20 2020 2020 2020 2020  t=600,.         
-0000c4b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000c4c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c4d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000c4e0: 6e20 7365 6c66 2e70 6c6f 745f 6b6c 6179  n self.plot_klay
-0000c4f0: 6f75 7428 290a 2020 2020 2020 2020 6578  out().        ex
-0000c500: 6365 7074 2049 6d70 6f72 7445 7272 6f72  cept ImportError
-0000c510: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0000c520: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-0000c530: 2020 2020 2022 596f 7520 6361 6e20 696e       "You can in
-0000c540: 7374 616c 6c20 6070 6970 2069 6e73 7461  stall `pip insta
-0000c550: 6c6c 2067 6473 6661 6374 6f72 795b 6675  ll gdsfactory[fu
-0000c560: 6c6c 5d60 2066 6f72 2062 6574 7465 7220  ll]` for better 
-0000c570: 7669 7375 616c 697a 6174 696f 6e22 0a20  visualization". 
-0000c580: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0000c590: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000c5a0: 7365 6c66 2e70 6c6f 745f 6b6c 6179 6f75  self.plot_klayou
-0000c5b0: 7428 290a 0a20 2020 2064 6566 2070 6c6f  t()..    def plo
-0000c5c0: 745f 6d61 7470 6c6f 746c 6962 2873 656c  t_matplotlib(sel
-0000c5d0: 662c 202a 2a6b 7761 7267 7329 202d 3e20  f, **kwargs) -> 
-0000c5e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000c5f0: 2250 6c6f 7420 636f 6d70 6f6e 656e 7420  "Plot component 
-0000c600: 7573 696e 6720 6d61 7470 6c6f 746c 6962  using matplotlib
-0000c610: 2e0a 0a20 2020 2020 2020 204b 6579 776f  ...        Keywo
-0000c620: 7264 2041 7267 733a 0a20 2020 2020 2020  rd Args:.       
-0000c630: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
-0000c640: 2053 6574 7320 7768 6574 6865 7220 706f   Sets whether po
-0000c650: 7274 7320 6172 6520 6472 6177 6e2e 0a20  rts are drawn.. 
-0000c660: 2020 2020 2020 2020 2020 2073 686f 775f             show_
-0000c670: 7375 6270 6f72 7473 3a20 5365 7473 2077  subports: Sets w
-0000c680: 6865 7468 6572 2073 7562 706f 7274 7320  hether subports 
-0000c690: 2870 6f72 7473 2074 6861 7420 6265 6c6f  (ports that belo
-0000c6a0: 6e67 2074 6f20 7265 6665 7265 6e63 6573  ng to references
-0000c6b0: 2920 6172 6520 6472 6177 6e2e 0a20 2020  ) are drawn..   
-0000c6c0: 2020 2020 2020 2020 206c 6162 656c 5f61           label_a
-0000c6d0: 6c69 6173 6573 3a20 5365 7473 2077 6865  liases: Sets whe
-0000c6e0: 7468 6572 2061 6c69 6173 6573 2061 7265  ther aliases are
-0000c6f0: 206c 6162 656c 6564 2077 6974 6820 6120   labeled with a 
-0000c700: 7465 7874 206e 616d 652e 0a20 2020 2020  text name..     
-0000c710: 2020 2020 2020 206e 6577 5f77 696e 646f         new_windo
-0000c720: 773a 2049 6620 5472 7565 2c20 6561 6368  w: If True, each
-0000c730: 2063 616c 6c20 746f 2071 7569 636b 706c   call to quickpl
-0000c740: 6f74 2829 2077 696c 6c20 6765 6e65 7261  ot() will genera
-0000c750: 7465 2061 2073 6570 6172 6174 6520 7769  te a separate wi
-0000c760: 6e64 6f77 2e0a 2020 2020 2020 2020 2020  ndow..          
-0000c770: 2020 626c 6f63 6b69 6e67 3a20 4966 2054    blocking: If T
-0000c780: 7275 652c 2063 616c 6c69 6e67 2071 7569  rue, calling qui
-0000c790: 636b 706c 6f74 2829 2077 696c 6c20 7061  ckplot() will pa
-0000c7a0: 7573 6520 6578 6563 7574 696f 6e20 6f66  use execution of
-0000c7b0: 2028 2262 6c6f 636b 2229 2074 6865 0a20   ("block") the. 
-0000c7c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c7d0: 656d 6169 6e64 6572 206f 6620 7468 6520  emainder of the 
-0000c7e0: 7079 7468 6f6e 2063 6f64 6520 756e 7469  python code unti
-0000c7f0: 6c20 7468 6520 7175 6963 6b70 6c6f 7428  l the quickplot(
-0000c800: 2920 7769 6e64 6f77 2069 7320 636c 6f73  ) window is clos
-0000c810: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0000c820: 2020 2020 4966 2046 616c 7365 2c20 7468      If False, th
-0000c830: 6520 7769 6e64 6f77 2077 696c 6c20 6265  e window will be
-0000c840: 206f 7065 6e65 6420 616e 6420 636f 6465   opened and code
-0000c850: 2077 696c 6c20 636f 6e74 696e 7565 2074   will continue t
-0000c860: 6f20 7275 6e2e 0a20 2020 2020 2020 2020  o run..         
-0000c870: 2020 207a 6f6f 6d5f 6661 6374 6f72 3a20     zoom_factor: 
-0000c880: 5365 7473 2074 6865 2073 6361 6c69 6e67  Sets the scaling
-0000c890: 2066 6163 746f 7220 7768 656e 207a 6f6f   factor when zoo
-0000c8a0: 6d69 6e67 2074 6865 2071 7569 636b 706c  ming the quickpl
-0000c8b0: 6f74 2077 696e 646f 7720 7769 7468 2074  ot window with t
-0000c8c0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-0000c8d0: 2020 206d 6f75 7365 7768 6565 6c2f 7472     mousewheel/tr
-0000c8e0: 6163 6b70 6164 2e0a 2020 2020 2020 2020  ackpad..        
-0000c8f0: 2020 2020 696e 7465 7261 6374 6976 655f      interactive_
-0000c900: 7a6f 6f6d 3a20 456e 6162 6c65 7320 7573  zoom: Enables us
-0000c910: 696e 6720 6d6f 7573 6577 6865 656c 2f74  ing mousewheel/t
-0000c920: 7261 636b 7061 6420 746f 207a 6f6f 6d2e  rackpad to zoom.
-0000c930: 0a20 2020 2020 2020 2020 2020 2066 6f6e  .            fon
-0000c940: 7473 697a 653a 2066 6f72 206c 6162 656c  tsize: for label
-0000c950: 732e 0a20 2020 2020 2020 2020 2020 206c  s..            l
-0000c960: 6179 6572 735f 6578 636c 7564 6564 3a20  ayers_excluded: 
-0000c970: 6c69 7374 206f 6620 6c61 7965 7273 2074  list of layers t
-0000c980: 6f20 6578 636c 7564 652e 0a20 2020 2020  o exclude..     
-0000c990: 2020 2020 2020 206c 6179 6572 5f76 6965         layer_vie
-0000c9a0: 7773 3a20 6c61 7965 725f 7669 6577 7320  ws: layer_views 
-0000c9b0: 636f 6c6f 7273 206c 6f61 6465 6420 6672  colors loaded fr
-0000c9c0: 6f6d 204b 6c61 796f 7574 2e0a 2020 2020  om Klayout..    
-0000c9d0: 2020 2020 2020 2020 6d69 6e5f 6173 7065          min_aspe
-0000c9e0: 6374 3a20 6d69 6e69 6d75 6d20 6173 7065  ct: minimum aspe
-0000c9f0: 6374 2072 6174 696f 2e0a 2020 2020 2020  ct ratio..      
-0000ca00: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-0000ca10: 6f6d 2067 6473 6661 6374 6f72 792e 7175  om gdsfactory.qu
-0000ca20: 6963 6b70 6c6f 7474 6572 2069 6d70 6f72  ickplotter impor
-0000ca30: 7420 7175 6963 6b70 6c6f 740a 0a20 2020  t quickplot..   
-0000ca40: 2020 2020 2071 7569 636b 706c 6f74 2873       quickplot(s
-0000ca50: 656c 662c 202a 2a6b 7761 7267 7329 0a0a  elf, **kwargs)..
-0000ca60: 2020 2020 6465 6620 706c 6f74 2873 656c      def plot(sel
-0000ca70: 662c 2070 6c6f 7474 6572 3a20 4f70 7469  f, plotter: Opti
-0000ca80: 6f6e 616c 5b50 6c6f 7474 6572 5d20 3d20  onal[Plotter] = 
-0000ca90: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 2920  None, **kwargs) 
-0000caa0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000cab0: 2022 2222 5265 7475 726e 7320 636f 6d70   """Returns comp
-0000cac0: 6f6e 656e 7420 706c 6f74 2075 7369 6e67  onent plot using
-0000cad0: 206b 6c61 796f 7574 2c20 6d61 7470 6c6f   klayout, matplo
-0000cae0: 746c 6962 2c20 686f 6c6f 7669 6577 7320  tlib, holoviews 
-0000caf0: 6f72 2071 742e 0a0a 2020 2020 2020 2020  or qt...        
-0000cb00: 5765 2072 6563 6f6d 6d65 6e64 2075 7369  We recommend usi
-0000cb10: 6e67 206b 6c61 796f 7574 2e0a 0a20 2020  ng klayout...   
-0000cb20: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-0000cb30: 2020 2020 2020 2070 6c6f 7474 6572 3a20         plotter: 
-0000cb40: 706c 6f74 2062 6163 6b65 6e64 2028 2768  plot backend ('h
-0000cb50: 6f6c 6f76 6965 7773 272c 2027 6d61 7470  oloviews', 'matp
-0000cb60: 6c6f 746c 6962 272c 2027 7174 272c 2027  lotlib', 'qt', '
-0000cb70: 6b6c 6179 6f75 7427 292e 0a20 2020 2020  klayout')..     
-0000cb80: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-0000cb90: 6c6f 7474 6572 203d 2070 6c6f 7474 6572  lotter = plotter
-0000cba0: 206f 7220 434f 4e46 2e67 6574 2822 706c   or CONF.get("pl
-0000cbb0: 6f74 7465 7222 2c20 226d 6174 706c 6f74  otter", "matplot
-0000cbc0: 6c69 6222 290a 0a20 2020 2020 2020 2069  lib")..        i
-0000cbd0: 6620 706c 6f74 7465 7220 3d3d 2022 6b6c  f plotter == "kl
-0000cbe0: 6179 6f75 7422 3a0a 2020 2020 2020 2020  ayout":.        
-0000cbf0: 2020 2020 7365 6c66 2e70 6c6f 745f 6b6c      self.plot_kl
-0000cc00: 6179 6f75 7428 290a 2020 2020 2020 2020  ayout().        
-0000cc10: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-0000cc20: 2020 2020 656c 6966 2070 6c6f 7474 6572      elif plotter
-0000cc30: 203d 3d20 226d 6174 706c 6f74 6c69 6222   == "matplotlib"
-0000cc40: 3a0a 2020 2020 2020 2020 2020 2020 6672  :.            fr
-0000cc50: 6f6d 2067 6473 6661 6374 6f72 792e 7175  om gdsfactory.qu
-0000cc60: 6963 6b70 6c6f 7474 6572 2069 6d70 6f72  ickplotter impor
-0000cc70: 7420 7175 6963 6b70 6c6f 740a 0a20 2020  t quickplot..   
-0000cc80: 2020 2020 2020 2020 2071 7569 636b 706c           quickpl
-0000cc90: 6f74 2873 656c 662c 202a 2a6b 7761 7267  ot(self, **kwarg
-0000cca0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-0000ccb0: 6574 7572 6e0a 0a20 2020 2020 2020 2065  eturn..        e
-0000ccc0: 6c69 6620 706c 6f74 7465 7220 3d3d 2022  lif plotter == "
-0000ccd0: 686f 6c6f 7669 6577 7322 3a0a 2020 2020  holoviews":.    
-0000cce0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000ccf0: 2020 2020 2020 2020 2020 2020 2069 6d70               imp
-0000cd00: 6f72 7420 686f 6c6f 7669 6577 7320 6173  ort holoviews as
-0000cd10: 2068 760a 0a20 2020 2020 2020 2020 2020   hv..           
-0000cd20: 2020 2020 2068 762e 6578 7465 6e73 696f       hv.extensio
-0000cd30: 6e28 2262 6f6b 6568 2229 0a20 2020 2020  n("bokeh").     
-0000cd40: 2020 2020 2020 2065 7863 6570 7420 496d         except Im
-0000cd50: 706f 7274 4572 726f 7220 6173 2065 3a0a  portError as e:.
-0000cd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd70: 7072 696e 7428 2279 6f75 206e 6565 6420  print("you need 
-0000cd80: 746f 2060 7069 7020 696e 7374 616c 6c20  to `pip install 
-0000cd90: 686f 6c6f 7669 6577 7360 2229 0a20 2020  holoviews`").   
-0000cda0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000cdb0: 7365 2065 0a20 2020 2020 2020 2020 2020  se e.           
-0000cdc0: 2072 6574 7572 6e20 7365 6c66 2e70 6c6f   return self.plo
-0000cdd0: 745f 686f 6c6f 7669 6577 7328 2a2a 6b77  t_holoviews(**kw
-0000cde0: 6172 6773 290a 0a20 2020 2020 2020 2065  args)..        e
-0000cdf0: 6c69 6620 706c 6f74 7465 7220 3d3d 2022  lif plotter == "
-0000ce00: 7174 223a 0a20 2020 2020 2020 2020 2020  qt":.           
-0000ce10: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
-0000ce20: 2e71 7569 636b 706c 6f74 7465 7220 696d  .quickplotter im
-0000ce30: 706f 7274 2071 7569 636b 706c 6f74 320a  port quickplot2.
-0000ce40: 0a20 2020 2020 2020 2020 2020 2071 7569  .            qui
-0000ce50: 636b 706c 6f74 3228 7365 6c66 290a 2020  ckplot2(self).  
-0000ce60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000ce70: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000ce80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000ce90: 2056 616c 7565 4572 726f 7228 6622 7b70   ValueError(f"{p
-0000cea0: 6c6f 7474 6572 2172 7d20 6e6f 7420 696e  lotter!r} not in
-0000ceb0: 207b 506c 6f74 7465 727d 2229 0a0a 2020   {Plotter}")..  
-0000cec0: 2020 6465 6620 706c 6f74 5f68 6f6c 6f76    def plot_holov
-0000ced0: 6965 7773 280a 2020 2020 2020 2020 7365  iews(.        se
-0000cee0: 6c66 2c0a 2020 2020 2020 2020 6c61 7965  lf,.        laye
-0000cef0: 7273 5f65 7863 6c75 6465 643a 204f 7074  rs_excluded: Opt
-0000cf00: 696f 6e61 6c5b 4c61 7965 7273 5d20 3d20  ional[Layers] = 
-0000cf10: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
-0000cf20: 7965 725f 7669 6577 733a 204f 7074 696f  yer_views: Optio
-0000cf30: 6e61 6c5b 4c61 7965 7256 6965 7773 5d20  nal[LayerViews] 
-0000cf40: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000cf50: 6d69 6e5f 6173 7065 6374 3a20 666c 6f61  min_aspect: floa
-0000cf60: 7420 3d20 302e 3235 2c0a 2020 2020 2020  t = 0.25,.      
-0000cf70: 2020 7061 6464 696e 673a 2066 6c6f 6174    padding: float
-0000cf80: 203d 2030 2e35 2c0a 2020 2020 293a 0a20   = 0.5,.    ):. 
-0000cf90: 2020 2020 2020 2022 2222 506c 6f74 2063         """Plot c
-0000cfa0: 6f6d 706f 6e65 6e74 2069 6e20 686f 6c6f  omponent in holo
-0000cfb0: 7669 6577 732e 0a0a 2020 2020 2020 2020  views...        
-0000cfc0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-0000cfd0: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
-0000cfe0: 643a 206c 6973 7420 6f66 206c 6179 6572  d: list of layer
-0000cff0: 7320 746f 2065 7863 6c75 6465 2e0a 2020  s to exclude..  
-0000d000: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
-0000d010: 7669 6577 733a 206c 6179 6572 5f76 6965  views: layer_vie
-0000d020: 7773 2063 6f6c 6f72 7320 6c6f 6164 6564  ws colors loaded
-0000d030: 2066 726f 6d20 4b6c 6179 6f75 742e 0a20   from Klayout.. 
-0000d040: 2020 2020 2020 2020 2020 206d 696e 5f61             min_a
-0000d050: 7370 6563 743a 206d 696e 696d 756d 2061  spect: minimum a
-0000d060: 7370 6563 7420 7261 7469 6f2e 0a20 2020  spect ratio..   
-0000d070: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
-0000d080: 3a20 6172 6f75 6e64 2062 6f75 6e64 696e  : around boundin
-0000d090: 6720 626f 782e 0a0a 2020 2020 2020 2020  g box...        
-0000d0a0: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
-0000d0b0: 2020 2020 2048 6f6c 6f76 6965 7773 204f       Holoviews O
-0000d0c0: 7665 726c 6179 2074 6f20 6469 7370 6c61  verlay to displa
-0000d0d0: 7920 616c 6c20 706f 6c79 676f 6e73 2e0a  y all polygons..
-0000d0e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000d0f0: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
-0000d100: 6f72 792e 6164 645f 7069 6e73 2069 6d70  ory.add_pins imp
-0000d110: 6f72 7420 6765 745f 7069 6e5f 7472 6961  ort get_pin_tria
-0000d120: 6e67 6c65 5f70 6f6c 7967 6f6e 5f74 6970  ngle_polygon_tip
-0000d130: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
-0000d140: 7366 6163 746f 7279 2e67 656e 6572 6963  sfactory.generic
-0000d150: 5f74 6563 6820 696d 706f 7274 204c 4159  _tech import LAY
-0000d160: 4552 5f56 4945 5753 0a0a 2020 2020 2020  ER_VIEWS..      
-0000d170: 2020 6966 206c 6179 6572 5f76 6965 7773    if layer_views
-0000d180: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000d190: 2020 2020 2020 6c61 7965 725f 7669 6577        layer_view
-0000d1a0: 7320 3d20 4c41 5945 525f 5649 4557 530a  s = LAYER_VIEWS.
-0000d1b0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000d1c0: 2020 2020 2020 2020 2020 696d 706f 7274            import
-0000d1d0: 2068 6f6c 6f76 6965 7773 2061 7320 6876   holoviews as hv
-0000d1e0: 0a0a 2020 2020 2020 2020 2020 2020 6876  ..            hv
-0000d1f0: 2e65 7874 656e 7369 6f6e 2822 626f 6b65  .extension("boke
-0000d200: 6822 290a 2020 2020 2020 2020 6578 6365  h").        exce
-0000d210: 7074 2049 6d70 6f72 7445 7272 6f72 2061  pt ImportError a
-0000d220: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000d230: 2070 7269 6e74 2822 796f 7520 6e65 6564   print("you need
-0000d240: 2074 6f20 6070 6970 2069 6e73 7461 6c6c   to `pip install
-0000d250: 2068 6f6c 6f76 6965 7773 6022 290a 2020   holoviews`").  
-0000d260: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000d270: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0000d280: 5f62 625f 7661 6c69 6420 3d20 4661 6c73  _bb_valid = Fals
-0000d290: 6520 2023 2072 6563 6f6d 7075 7465 2074  e  # recompute t
-0000d2a0: 6865 2062 6f75 6e64 696e 6720 626f 780a  he bounding box.
-0000d2b0: 2020 2020 2020 2020 6220 3d20 7365 6c66          b = self
-0000d2c0: 2e62 626f 7820 2b20 2828 2d70 6164 6469  .bbox + ((-paddi
-0000d2d0: 6e67 2c20 2d70 6164 6469 6e67 292c 2028  ng, -padding), (
-0000d2e0: 7061 6464 696e 672c 2070 6164 6469 6e67  padding, padding
-0000d2f0: 2929 0a20 2020 2020 2020 2062 203d 206e  )).        b = n
-0000d300: 702e 6172 7261 7928 622e 666c 6174 290a  p.array(b.flat).
-0000d310: 2020 2020 2020 2020 6365 6e74 6572 203d          center =
-0000d320: 206e 702e 6172 7261 7928 286e 702e 7375   np.array((np.su
-0000d330: 6d28 625b 3a3a 325d 2920 2f20 322c 206e  m(b[::2]) / 2, n
-0000d340: 702e 7375 6d28 625b 313a 3a32 5d29 202f  p.sum(b[1::2]) /
-0000d350: 2032 2929 0a20 2020 2020 2020 2073 697a   2)).        siz
-0000d360: 6520 3d20 6e70 2e61 7272 6179 2828 6e70  e = np.array((np
-0000d370: 2e61 6273 2862 5b32 5d20 2d20 625b 305d  .abs(b[2] - b[0]
-0000d380: 292c 206e 702e 6162 7328 625b 335d 202d  ), np.abs(b[3] -
-0000d390: 2062 5b31 5d29 2929 0a20 2020 2020 2020   b[1]))).       
-0000d3a0: 2064 7820 3d20 6e70 2e61 7272 6179 280a   dx = np.array(.
-0000d3b0: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-0000d3c0: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-0000d3d0: 2e6d 6178 696d 756d 286d 696e 5f61 7370  .maximum(min_asp
-0000d3e0: 6563 7420 2a20 7369 7a65 5b31 5d2c 2073  ect * size[1], s
-0000d3f0: 697a 655b 305d 2920 2f20 322c 0a20 2020  ize[0]) / 2,.   
-0000d400: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-0000d410: 6d61 7869 6d75 6d28 7369 7a65 5b31 5d2c  maximum(size[1],
-0000d420: 206d 696e 5f61 7370 6563 7420 2a20 7369   min_aspect * si
-0000d430: 7a65 5b30 5d29 202f 2032 2c0a 2020 2020  ze[0]) / 2,.    
-0000d440: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d450: 2020 290a 2020 2020 2020 2020 6220 3d20    ).        b = 
-0000d460: 6e70 2e68 7374 6163 6b28 2863 656e 7465  np.hstack((cente
-0000d470: 7220 2d20 6478 2c20 6365 6e74 6572 202b  r - dx, center +
-0000d480: 2064 7829 290a 0a20 2020 2020 2020 2070   dx))..        p
-0000d490: 6c6f 7473 5f74 6f5f 6f76 6572 6c61 7920  lots_to_overlay 
-0000d4a0: 3d20 5b5d 0a20 2020 2020 2020 206c 6179  = [].        lay
-0000d4b0: 6572 735f 6578 636c 7564 6564 203d 205b  ers_excluded = [
-0000d4c0: 5d20 6966 206c 6179 6572 735f 6578 636c  ] if layers_excl
-0000d4d0: 7564 6564 2069 7320 4e6f 6e65 2065 6c73  uded is None els
-0000d4e0: 6520 6c61 7965 7273 5f65 7863 6c75 6465  e layers_exclude
-0000d4f0: 640a 0a20 2020 2020 2020 2066 6f72 206c  d..        for l
-0000d500: 6179 6572 2c20 706f 6c79 676f 6e20 696e  ayer, polygon in
-0000d510: 2073 656c 662e 6765 745f 706f 6c79 676f   self.get_polygo
-0000d520: 6e73 2862 795f 7370 6563 3d54 7275 6529  ns(by_spec=True)
-0000d530: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0000d540: 2020 2020 2020 6966 206c 6179 6572 2069        if layer i
-0000d550: 6e20 6c61 7965 7273 5f65 7863 6c75 6465  n layers_exclude
-0000d560: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0000d570: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-0000d580: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000d590: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0000d5a0: 7965 725f 7669 6577 203d 206c 6179 6572  yer_view = layer
-0000d5b0: 5f76 6965 7773 2e67 6574 5f66 726f 6d5f  _views.get_from_
-0000d5c0: 7475 706c 6528 6c61 7965 7229 0a20 2020  tuple(layer).   
-0000d5d0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0000d5e0: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
-0000d5f0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-0000d600: 7273 203d 206c 6973 7428 6c61 7965 725f  rs = list(layer_
-0000d610: 7669 6577 732e 6765 745f 6c61 7965 725f  views.get_layer_
-0000d620: 7669 6577 7328 292e 6b65 7973 2829 290a  views().keys()).
-0000d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d640: 7761 726e 696e 6773 2e77 6172 6e28 6622  warnings.warn(f"
-0000d650: 7b6c 6179 6572 2172 7d20 6e6f 7420 6465  {layer!r} not de
-0000d660: 6669 6e65 6420 696e 207b 6c61 7965 7273  fined in {layers
-0000d670: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000d680: 2020 2020 6c61 7965 725f 7669 6577 203d      layer_view =
-0000d690: 204c 6179 6572 5669 6577 286c 6179 6572   LayerView(layer
-0000d6a0: 3d6c 6179 6572 290a 2020 2020 2020 2020  =layer).        
-0000d6b0: 2020 2020 2320 544f 444f 3a20 4d61 7463      # TODO: Matc
-0000d6c0: 6820 7570 206f 7074 696f 6e73 2077 6974  h up options wit
-0000d6d0: 6820 4c61 7965 7256 6965 7773 0a20 2020  h LayerViews.   
-0000d6e0: 2020 2020 2020 2020 2070 6c6f 7473 5f74           plots_t
-0000d6f0: 6f5f 6f76 6572 6c61 792e 6170 7065 6e64  o_overlay.append
-0000d700: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d710: 2020 6876 2e50 6f6c 7967 6f6e 7328 706f    hv.Polygons(po
-0000d720: 6c79 676f 6e2c 206c 6162 656c 3d73 7472  lygon, label=str
-0000d730: 286c 6179 6572 5f76 6965 772e 6e61 6d65  (layer_view.name
-0000d740: 2929 2e6f 7074 7328 0a20 2020 2020 2020  )).opts(.       
-0000d750: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0000d760: 615f 6173 7065 6374 3d31 2c0a 2020 2020  a_aspect=1,.    
+0000adb0: 2020 2020 7365 6c66 2e5f 7265 6665 7265      self._refere
+0000adc0: 6e63 655f 6e61 6d65 735f 636f 756e 7465  nce_names_counte
+0000add0: 722e 7570 6461 7465 287b 7072 6566 6978  r.update({prefix
+0000ade0: 3a20 317d 290a 2020 2020 2020 2020 2020  : 1}).          
+0000adf0: 2020 2020 2020 2020 2020 616c 6961 7320            alias 
+0000ae00: 3d20 6622 7b70 7265 6669 787d 5f7b 7365  = f"{prefix}_{se
+0000ae10: 6c66 2e5f 7265 6665 7265 6e63 655f 6e61  lf._reference_na
+0000ae20: 6d65 735f 636f 756e 7465 725b 7072 6566  mes_counter[pref
+0000ae30: 6978 5d7d 220a 0a20 2020 2020 2020 2072  ix]}"..        r
+0000ae40: 6566 6572 656e 6365 2e6e 616d 6520 3d20  eference.name = 
+0000ae50: 616c 6961 730a 2020 2020 2020 2020 7365  alias.        se
+0000ae60: 6c66 2e5f 6e61 6d65 645f 7265 6665 7265  lf._named_refere
+0000ae70: 6e63 6573 5b61 6c69 6173 5d20 3d20 7265  nces[alias] = re
+0000ae80: 6665 7265 6e63 650a 0a20 2020 2040 7072  ference..    @pr
+0000ae90: 6f70 6572 7479 0a20 2020 2064 6566 206c  operty.    def l
+0000aea0: 6179 6572 7328 7365 6c66 2920 2d3e 2053  ayers(self) -> S
+0000aeb0: 6574 5b54 7570 6c65 5b69 6e74 2c20 696e  et[Tuple[int, in
+0000aec0: 745d 5d3a 0a20 2020 2020 2020 2022 2222  t]]:.        """
+0000aed0: 5265 7475 726e 7320 6120 7365 7420 6f66  Returns a set of
+0000aee0: 2074 6865 204c 6179 6572 7320 696e 2074   the Layers in t
+0000aef0: 6865 2043 6f6d 706f 6e65 6e74 2e22 2222  he Component."""
+0000af00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000af10: 7365 6c66 2e67 6574 5f6c 6179 6572 7328  self.get_layers(
+0000af20: 290a 0a20 2020 2064 6566 2067 6574 5f6c  )..    def get_l
+0000af30: 6179 6572 7328 7365 6c66 2920 2d3e 2053  ayers(self) -> S
+0000af40: 6574 5b54 7570 6c65 5b69 6e74 2c20 696e  et[Tuple[int, in
+0000af50: 745d 5d3a 0a20 2020 2020 2020 2022 2222  t]]:.        """
+0000af60: 5265 7475 726e 2061 2073 6574 206f 6620  Return a set of 
+0000af70: 286c 6179 6572 2c20 6461 7461 7479 7065  (layer, datatype
+0000af80: 292e 0a0a 2020 2020 2020 2020 2e2e 2063  )...        .. c
+0000af90: 6f64 6520 3a3a 0a0a 2020 2020 2020 2020  ode ::..        
+0000afa0: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+0000afb0: 6374 6f72 7920 6173 2067 660a 2020 2020  ctory as gf.    
+0000afc0: 2020 2020 2020 2020 6766 2e63 6f6d 706f          gf.compo
+0000afd0: 6e65 6e74 732e 7374 7261 6967 6874 2829  nents.straight()
+0000afe0: 2e67 6574 5f6c 6179 6572 7328 2920 3d3d  .get_layers() ==
+0000aff0: 207b 2831 2c20 3029 2c20 2831 3131 2c20   {(1, 0), (111, 
+0000b000: 3029 7d0a 2020 2020 2020 2020 2222 220a  0)}.        """.
+0000b010: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+0000b020: 203d 2073 656c 662e 5f63 656c 6c2e 6765   = self._cell.ge
+0000b030: 745f 706f 6c79 676f 6e73 2864 6570 7468  t_polygons(depth
+0000b040: 3d4e 6f6e 6529 0a20 2020 2020 2020 2072  =None).        r
+0000b050: 6574 7572 6e20 7b28 706f 6c79 676f 6e2e  eturn {(polygon.
+0000b060: 6c61 7965 722c 2070 6f6c 7967 6f6e 2e64  layer, polygon.d
+0000b070: 6174 6174 7970 6529 2066 6f72 2070 6f6c  atatype) for pol
+0000b080: 7967 6f6e 2069 6e20 706f 6c79 676f 6e73  ygon in polygons
+0000b090: 7d0a 0a20 2020 2064 6566 2067 6574 5f6c  }..    def get_l
+0000b0a0: 6179 6572 5f6e 616d 6573 2873 656c 6629  ayer_names(self)
+0000b0b0: 202d 3e20 4c69 7374 5b54 7570 6c65 5b69   -> List[Tuple[i
+0000b0c0: 6e74 2c20 696e 745d 5d3a 0a20 2020 2020  nt, int]]:.     
+0000b0d0: 2020 2022 2222 5265 7475 726e 206c 6179     """Return lay
+0000b0e0: 6572 206e 616d 6573 2075 7365 6420 696e  er names used in
+0000b0f0: 2074 6865 2064 6573 6967 6e2e 0a0a 2020   the design...  
+0000b100: 2020 2020 2020 2e2e 2063 6f64 6520 3a3a        .. code ::
+0000b110: 0a0a 2020 2020 2020 2020 2020 2020 696d  ..            im
+0000b120: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
+0000b130: 6173 2067 660a 2020 2020 2020 2020 2020  as gf.          
+0000b140: 2020 6766 2e63 6f6d 706f 6e65 6e74 732e    gf.components.
+0000b150: 7374 7261 6967 6874 2829 2e67 6574 5f6e  straight().get_n
+0000b160: 616d 6573 2829 203d 3d20 5b27 5747 275d  ames() == ['WG']
+0000b170: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000b180: 2020 2020 2069 6d70 6f72 7420 6764 7366       import gdsf
+0000b190: 6163 746f 7279 2061 7320 6766 0a0a 2020  actory as gf..  
+0000b1a0: 2020 2020 2020 5044 4b20 3d20 6766 2e67        PDK = gf.g
+0000b1b0: 6574 5f61 6374 6976 655f 7064 6b28 290a  et_active_pdk().
+0000b1c0: 2020 2020 2020 2020 4c41 5945 5253 203d          LAYERS =
+0000b1d0: 2050 444b 2e6c 6179 6572 730a 2020 2020   PDK.layers.    
+0000b1e0: 2020 2020 6e61 6d65 5f74 6f5f 6c61 7965      name_to_laye
+0000b1f0: 7220 3d20 6469 6374 284c 4159 4552 5329  r = dict(LAYERS)
+0000b200: 0a20 2020 2020 2020 206c 6179 6572 5f74  .        layer_t
+0000b210: 6f5f 6e61 6d65 203d 207b 763a 206b 2066  o_name = {v: k f
+0000b220: 6f72 206b 2c20 7620 696e 206e 616d 655f  or k, v in name_
+0000b230: 746f 5f6c 6179 6572 2e69 7465 6d73 2829  to_layer.items()
+0000b240: 7d0a 2020 2020 2020 2020 6c61 7965 725f  }.        layer_
+0000b250: 6e61 6d65 7320 3d20 5b5d 0a0a 2020 2020  names = []..    
+0000b260: 2020 2020 666f 7220 6c61 7965 7220 696e      for layer in
+0000b270: 2073 656c 662e 6c61 7965 7273 3a0a 2020   self.layers:.  
+0000b280: 2020 2020 2020 2020 2020 6966 206c 6179            if lay
+0000b290: 6572 206e 6f74 2069 6e20 6c61 7965 725f  er not in layer_
+0000b2a0: 746f 5f6e 616d 653a 0a20 2020 2020 2020  to_name:.       
+0000b2b0: 2020 2020 2020 2020 2077 6172 6e69 6e67           warning
+0000b2c0: 732e 7761 726e 2866 227b 6c61 7965 727d  s.warn(f"{layer}
+0000b2d0: 206e 6f74 2069 6e20 4c61 7965 724d 6170   not in LayerMap
+0000b2e0: 2e2e 2229 0a20 2020 2020 2020 2020 2020  ..").           
+0000b2f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000b300: 2020 2020 2020 206c 6179 6572 5f6e 616d         layer_nam
+0000b310: 6573 2e61 7070 656e 6428 6c61 7965 725f  es.append(layer_
+0000b320: 746f 5f6e 616d 655b 6c61 7965 725d 290a  to_name[layer]).
+0000b330: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0000b340: 6179 6572 5f6e 616d 6573 0a0a 2020 2020  ayer_names..    
+0000b350: 6465 6620 5f69 7079 7468 6f6e 5f64 6973  def _ipython_dis
+0000b360: 706c 6179 5f28 7365 6c66 2920 2d3e 204e  play_(self) -> N
+0000b370: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000b380: 5368 6f77 2067 656f 6d65 7472 7920 696e  Show geometry in
+0000b390: 204b 4c61 796f 7574 2061 6e64 2069 6e20   KLayout and in 
+0000b3a0: 6d61 7470 6c6f 746c 6962 2066 6f72 204a  matplotlib for J
+0000b3b0: 7570 7974 6572 204e 6f74 6562 6f6f 6b73  upyter Notebooks
+0000b3c0: 2e22 2222 0a20 2020 2020 2020 2073 656c  .""".        sel
+0000b3d0: 662e 7368 6f77 2873 686f 775f 706f 7274  f.show(show_port
+0000b3e0: 733d 5472 7565 2920 2023 2073 686f 7720  s=True)  # show 
+0000b3f0: 696e 206b 6c61 796f 7574 0a20 2020 2020  in klayout.     
+0000b400: 2020 2073 656c 662e 706c 6f74 5f6b 6c61     self.plot_kla
+0000b410: 796f 7574 2829 0a20 2020 2020 2020 2070  yout().        p
+0000b420: 7269 6e74 2873 656c 6629 0a0a 2020 2020  rint(self)..    
+0000b430: 6465 6620 6164 645f 7069 6e73 5f74 7269  def add_pins_tri
+0000b440: 616e 676c 6528 0a20 2020 2020 2020 2073  angle(.        s
+0000b450: 656c 662c 0a20 2020 2020 2020 2070 6f72  elf,.        por
+0000b460: 745f 6d61 726b 6572 5f6c 6179 6572 3a20  t_marker_layer: 
+0000b470: 4c61 7965 7220 3d20 2831 2c20 3130 292c  Layer = (1, 10),
+0000b480: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0000b490: 2222 2252 6574 7572 6e73 2063 6f6d 706f  """Returns compo
+0000b4a0: 6e65 6e74 2077 6974 6820 7472 6961 6e67  nent with triang
+0000b4b0: 756c 6172 2070 696e 732e 2222 220a 2020  ular pins.""".  
+0000b4c0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+0000b4d0: 6374 6f72 792e 6164 645f 7069 6e73 2069  ctory.add_pins i
+0000b4e0: 6d70 6f72 7420 6164 645f 7069 6e73 5f74  mport add_pins_t
+0000b4f0: 7269 616e 676c 650a 0a20 2020 2020 2020  riangle..       
+0000b500: 2063 6f6d 706f 6e65 6e74 203d 2073 656c   component = sel
+0000b510: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0000b520: 2063 6f6d 706f 6e65 6e74 2e6e 616d 6520   component.name 
+0000b530: 3d20 7365 6c66 2e6e 616d 650a 2020 2020  = self.name.    
+0000b540: 2020 2020 6164 645f 7069 6e73 5f74 7269      add_pins_tri
+0000b550: 616e 676c 6528 636f 6d70 6f6e 656e 743d  angle(component=
+0000b560: 636f 6d70 6f6e 656e 742c 206c 6179 6572  component, layer
+0000b570: 3d70 6f72 745f 6d61 726b 6572 5f6c 6179  =port_marker_lay
+0000b580: 6572 290a 2020 2020 2020 2020 7265 7475  er).        retu
+0000b590: 726e 2063 6f6d 706f 6e65 6e74 0a0a 2020  rn component..  
+0000b5a0: 2020 6465 6620 706c 6f74 5f77 6964 6765    def plot_widge
+0000b5b0: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
+0000b5c0: 0a20 2020 2020 2020 2073 686f 775f 706f  .        show_po
+0000b5d0: 7274 733a 2062 6f6f 6c20 3d20 5472 7565  rts: bool = True
+0000b5e0: 2c0a 2020 2020 2020 2020 706f 7274 5f6d  ,.        port_m
+0000b5f0: 6172 6b65 725f 6c61 7965 723a 204c 6179  arker_layer: Lay
+0000b600: 6572 203d 2028 312c 2031 3029 2c0a 2020  er = (1, 10),.  
+0000b610: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000b620: 5265 7475 726e 7320 6970 7974 686f 6e20  Returns ipython 
+0000b630: 7769 6467 6574 2066 6f72 206b 6c61 796f  widget for klayo
+0000b640: 7574 2076 6973 7561 6c69 7a61 7469 6f6e  ut visualization
+0000b650: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+0000b660: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+0000b670: 775f 706f 7274 733a 2073 686f 7773 2063  w_ports: shows c
+0000b680: 6f6d 706f 6e65 6e74 2077 6974 6820 706f  omponent with po
+0000b690: 7274 206d 6172 6b65 7273 2061 6e64 206c  rt markers and l
+0000b6a0: 6162 656c 732e 0a20 2020 2020 2020 2020  abels..         
+0000b6b0: 2020 2070 6f72 745f 6d61 726b 6572 5f6c     port_marker_l
+0000b6c0: 6179 6572 3a20 666f 7220 7468 6520 706f  ayer: for the po
+0000b6d0: 7274 732e 0a20 2020 2020 2020 2022 2222  rts..        """
+0000b6e0: 0a20 2020 2020 2020 2066 726f 6d20 6764  .        from gd
+0000b6f0: 7366 6163 746f 7279 2e70 646b 2069 6d70  sfactory.pdk imp
+0000b700: 6f72 7420 6765 745f 6c61 7965 725f 7669  ort get_layer_vi
+0000b710: 6577 730a 2020 2020 2020 2020 6672 6f6d  ews.        from
+0000b720: 2067 6473 6661 6374 6f72 792e 7769 6467   gdsfactory.widg
+0000b730: 6574 732e 6c61 796f 7574 5f76 6965 7765  ets.layout_viewe
+0000b740: 7220 696d 706f 7274 204c 6179 6f75 7456  r import LayoutV
+0000b750: 6965 7765 720a 2020 2020 2020 2020 6672  iewer.        fr
+0000b760: 6f6d 2049 5079 7468 6f6e 2e64 6973 706c  om IPython.displ
+0000b770: 6179 2069 6d70 6f72 7420 6469 7370 6c61  ay import displa
+0000b780: 790a 0a20 2020 2020 2020 2063 6f6d 706f  y..        compo
+0000b790: 6e65 6e74 203d 2028 0a20 2020 2020 2020  nent = (.       
+0000b7a0: 2020 2020 2073 656c 662e 6164 645f 7069       self.add_pi
+0000b7b0: 6e73 5f74 7269 616e 676c 6528 706f 7274  ns_triangle(port
+0000b7c0: 5f6d 6172 6b65 725f 6c61 7965 723d 706f  _marker_layer=po
+0000b7d0: 7274 5f6d 6172 6b65 725f 6c61 7965 7229  rt_marker_layer)
+0000b7e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000b7f0: 7368 6f77 5f70 6f72 7473 0a20 2020 2020  show_ports.     
+0000b800: 2020 2020 2020 2065 6c73 6520 7365 6c66         else self
+0000b810: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000b820: 2020 2020 6764 7370 6174 6820 3d20 636f      gdspath = co
+0000b830: 6d70 6f6e 656e 742e 7772 6974 655f 6764  mponent.write_gd
+0000b840: 7328 6c6f 6767 696e 673d 4661 6c73 6529  s(logging=False)
+0000b850: 0a20 2020 2020 2020 206c 7970 5f70 6174  .        lyp_pat
+0000b860: 6820 3d20 6764 7370 6174 682e 7769 7468  h = gdspath.with
+0000b870: 5f73 7566 6669 7828 222e 6c79 7022 290a  _suffix(".lyp").
+0000b880: 0a20 2020 2020 2020 206c 6179 6572 5f76  .        layer_v
+0000b890: 6965 7773 203d 2067 6574 5f6c 6179 6572  iews = get_layer
+0000b8a0: 5f76 6965 7773 2829 0a20 2020 2020 2020  _views().       
+0000b8b0: 206c 6179 6572 5f76 6965 7773 2e74 6f5f   layer_views.to_
+0000b8c0: 6c79 7028 6669 6c65 7061 7468 3d6c 7970  lyp(filepath=lyp
+0000b8d0: 5f70 6174 6829 0a0a 2020 2020 2020 2020  _path)..        
+0000b8e0: 6c61 796f 7574 203d 204c 6179 6f75 7456  layout = LayoutV
+0000b8f0: 6965 7765 7228 6764 7370 6174 682c 206c  iewer(gdspath, l
+0000b900: 7970 5f70 6174 6829 0a20 2020 2020 2020  yp_path).       
+0000b910: 2064 6973 706c 6179 286c 6179 6f75 742e   display(layout.
+0000b920: 7769 6467 6574 290a 0a20 2020 2064 6566  widget)..    def
+0000b930: 2070 6c6f 745f 6b6c 6179 6f75 7428 0a20   plot_klayout(. 
+0000b940: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000b950: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
+0000b960: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+0000b970: 2020 2020 2020 706f 7274 5f6d 6172 6b65        port_marke
+0000b980: 725f 6c61 7965 723a 204c 6179 6572 203d  r_layer: Layer =
+0000b990: 2028 312c 2031 3029 2c0a 2020 2020 2920   (1, 10),.    ) 
+0000b9a0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000b9b0: 2022 2222 5265 7475 726e 7320 6b6c 6179   """Returns klay
+0000b9c0: 6f75 7420 696d 6167 652e 0a0a 2020 2020  out image...    
+0000b9d0: 2020 2020 4966 2069 7420 6661 696c 7320      If it fails 
+0000b9e0: 746f 2069 6d70 6f72 7420 6b6c 6179 6f75  to import klayou
+0000b9f0: 7420 6465 6661 756c 7473 2074 6f20 6d61  t defaults to ma
+0000ba00: 7470 6c6f 746c 6962 2e0a 0a20 2020 2020  tplotlib...     
+0000ba10: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+0000ba20: 2020 2020 2073 686f 775f 706f 7274 733a       show_ports:
+0000ba30: 2073 686f 7773 2063 6f6d 706f 6e65 6e74   shows component
+0000ba40: 2077 6974 6820 706f 7274 206d 6172 6b65   with port marke
+0000ba50: 7273 2061 6e64 206c 6162 656c 732e 0a20  rs and labels.. 
+0000ba60: 2020 2020 2020 2020 2020 2070 6f72 745f             port_
+0000ba70: 6d61 726b 6572 5f6c 6179 6572 3a20 666f  marker_layer: fo
+0000ba80: 7220 7468 6520 706f 7274 732e 0a20 2020  r the ports..   
+0000ba90: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000baa0: 2020 636f 6d70 6f6e 656e 7420 3d20 280a    component = (.
+0000bab0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bac0: 2e61 6464 5f70 696e 735f 7472 6961 6e67  .add_pins_triang
+0000bad0: 6c65 2870 6f72 745f 6d61 726b 6572 5f6c  le(port_marker_l
+0000bae0: 6179 6572 3d70 6f72 745f 6d61 726b 6572  ayer=port_marker
+0000baf0: 5f6c 6179 6572 290a 2020 2020 2020 2020  _layer).        
+0000bb00: 2020 2020 6966 2073 686f 775f 706f 7274      if show_port
+0000bb10: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
+0000bb20: 7365 2073 656c 660a 2020 2020 2020 2020  se self.        
+0000bb30: 290a 0a20 2020 2020 2020 2074 7279 3a0a  )..        try:.
+0000bb40: 2020 2020 2020 2020 2020 2020 696d 706f              impo
+0000bb50: 7274 206b 6c61 796f 7574 2e64 6220 6173  rt klayout.db as
+0000bb60: 2064 6220 2023 206e 6f71 613a 2046 3430   db  # noqa: F40
+0000bb70: 310a 2020 2020 2020 2020 2020 2020 696d  1.            im
+0000bb80: 706f 7274 206b 6c61 796f 7574 2e6c 6179  port klayout.lay
+0000bb90: 2061 7320 6c61 790a 2020 2020 2020 2020   as lay.        
+0000bba0: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+0000bbb0: 6f72 792e 7064 6b20 696d 706f 7274 2067  ory.pdk import g
+0000bbc0: 6574 5f6c 6179 6572 5f76 6965 7773 0a20  et_layer_views. 
+0000bbd0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+0000bbe0: 4950 7974 686f 6e2e 6469 7370 6c61 7920  IPython.display 
+0000bbf0: 696d 706f 7274 2064 6973 706c 6179 0a20  import display. 
+0000bc00: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+0000bc10: 6970 7977 6964 6765 7473 2069 6d70 6f72  ipywidgets impor
+0000bc20: 7420 496d 6167 650a 0a20 2020 2020 2020  t Image..       
+0000bc30: 2020 2020 2067 6473 7061 7468 203d 2063       gdspath = c
+0000bc40: 6f6d 706f 6e65 6e74 2e77 7269 7465 5f67  omponent.write_g
+0000bc50: 6473 286c 6f67 6769 6e67 3d46 616c 7365  ds(logging=False
+0000bc60: 290a 2020 2020 2020 2020 2020 2020 6c79  ).            ly
+0000bc70: 705f 7061 7468 203d 2067 6473 7061 7468  p_path = gdspath
+0000bc80: 2e77 6974 685f 7375 6666 6978 2822 2e6c  .with_suffix(".l
+0000bc90: 7970 2229 0a0a 2020 2020 2020 2020 2020  yp")..          
+0000bca0: 2020 6c61 7965 725f 7669 6577 7320 3d20    layer_views = 
+0000bcb0: 6765 745f 6c61 7965 725f 7669 6577 7328  get_layer_views(
+0000bcc0: 290a 2020 2020 2020 2020 2020 2020 6c61  ).            la
+0000bcd0: 7965 725f 7669 6577 732e 746f 5f6c 7970  yer_views.to_lyp
+0000bce0: 2866 696c 6570 6174 683d 6c79 705f 7061  (filepath=lyp_pa
+0000bcf0: 7468 290a 0a20 2020 2020 2020 2020 2020  th)..           
+0000bd00: 206c 6179 6f75 745f 7669 6577 203d 206c   layout_view = l
+0000bd10: 6179 2e4c 6179 6f75 7456 6965 7728 290a  ay.LayoutView().
+0000bd20: 2020 2020 2020 2020 2020 2020 6c61 796f              layo
+0000bd30: 7574 5f76 6965 772e 6c6f 6164 5f6c 6179  ut_view.load_lay
+0000bd40: 6f75 7428 7374 7228 6764 7370 6174 682e  out(str(gdspath.
+0000bd50: 6162 736f 6c75 7465 2829 2929 0a20 2020  absolute())).   
+0000bd60: 2020 2020 2020 2020 206c 6179 6f75 745f           layout_
+0000bd70: 7669 6577 2e6d 6178 5f68 6965 7228 290a  view.max_hier().
+0000bd80: 2020 2020 2020 2020 2020 2020 6c61 796f              layo
+0000bd90: 7574 5f76 6965 772e 6c6f 6164 5f6c 6179  ut_view.load_lay
+0000bda0: 6572 5f70 726f 7073 2873 7472 286c 7970  er_props(str(lyp
+0000bdb0: 5f70 6174 6829 290a 0a20 2020 2020 2020  _path))..       
+0000bdc0: 2020 2020 2070 6978 656c 5f62 7566 6665       pixel_buffe
+0000bdd0: 7220 3d20 6c61 796f 7574 5f76 6965 772e  r = layout_view.
+0000bde0: 6765 745f 7069 7865 6c73 5f77 6974 685f  get_pixels_with_
+0000bdf0: 6f70 7469 6f6e 7328 3830 302c 2036 3030  options(800, 600
+0000be00: 290a 2020 2020 2020 2020 2020 2020 706e  ).            pn
+0000be10: 675f 6461 7461 203d 2070 6978 656c 5f62  g_data = pixel_b
+0000be20: 7566 6665 722e 746f 5f70 6e67 5f64 6174  uffer.to_png_dat
+0000be30: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
+0000be40: 696d 6167 6520 3d20 496d 6167 6528 7661  image = Image(va
+0000be50: 6c75 653d 706e 675f 6461 7461 2c20 666f  lue=png_data, fo
+0000be60: 726d 6174 3d22 706e 6722 290a 2020 2020  rmat="png").    
+0000be70: 2020 2020 2020 2020 6469 7370 6c61 7928          display(
+0000be80: 696d 6167 6529 0a0a 2020 2020 2020 2020  image)..        
+0000be90: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
+0000bea0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0000beb0: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+0000bec0: 2020 2020 2020 2022 596f 7520 6361 6e20         "You can 
+0000bed0: 696e 7374 616c 6c20 6070 6970 2069 6e73  install `pip ins
+0000bee0: 7461 6c6c 2067 6473 6661 6374 6f72 795b  tall gdsfactory[
+0000bef0: 6675 6c6c 5d60 2066 6f72 2062 6574 7465  full]` for bette
+0000bf00: 7220 7669 7375 616c 697a 6174 696f 6e22  r visualization"
+0000bf10: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000bf20: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
+0000bf30: 6e65 6e74 2e70 6c6f 7428 706c 6f74 7465  nent.plot(plotte
+0000bf40: 723d 226d 6174 706c 6f74 6c69 6222 290a  r="matplotlib").
+0000bf50: 0a20 2020 2064 6566 2070 6c6f 745f 6a75  .    def plot_ju
+0000bf60: 7079 7465 7228 7365 6c66 293a 0a20 2020  pyter(self):.   
+0000bf70: 2020 2020 2022 2222 5368 6f77 7320 6375       """Shows cu
+0000bf80: 7272 656e 7420 6764 7320 696e 206b 6c61  rrent gds in kla
+0000bf90: 796f 7574 2e20 5573 6573 204b 7765 6220  yout. Uses Kweb 
+0000bfa0: 6966 2073 6572 7665 7220 7275 6e6e 696e  if server runnin
+0000bfb0: 672e 0a0a 2020 2020 2020 2020 6966 206e  g...        if n
+0000bfc0: 6f74 2074 7269 6573 2075 7369 6e67 204b  ot tries using K
+0000bfd0: 6c61 796f 7574 2077 6964 6765 7420 616e  layout widget an
+0000bfe0: 6420 6669 6e61 6c6c 7920 6465 6661 756c  d finally defaul
+0000bff0: 7473 2074 6f20 6d61 7470 6c6f 746c 6962  ts to matplotlib
+0000c000: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000c010: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000c020: 2020 2020 2020 2069 6d70 6f72 7420 6f73         import os
+0000c030: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+0000c040: 6d20 6764 7366 6163 746f 7279 2e63 6f6e  m gdsfactory.con
+0000c050: 6669 6720 696d 706f 7274 2050 4154 480a  fig import PATH.
+0000c060: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+0000c070: 2067 6473 6661 6374 6f72 792e 7064 6b20   gdsfactory.pdk 
+0000c080: 696d 706f 7274 2067 6574 5f6c 6179 6572  import get_layer
+0000c090: 5f76 6965 7773 0a20 2020 2020 2020 2020  _views.         
+0000c0a0: 2020 2066 726f 6d20 4950 7974 686f 6e2e     from IPython.
+0000c0b0: 6469 7370 6c61 7920 696d 706f 7274 2049  display import I
+0000c0c0: 4672 616d 650a 2020 2020 2020 2020 2020  Frame.          
+0000c0d0: 2020 696d 706f 7274 206b 7765 622e 7365    import kweb.se
+0000c0e0: 7276 6572 5f6a 7570 7974 6572 2061 7320  rver_jupyter as 
+0000c0f0: 6b6a 0a20 2020 2020 2020 2020 2020 2066  kj.            f
+0000c100: 726f 6d20 6874 6d6c 2069 6d70 6f72 7420  rom html import 
+0000c110: 6573 6361 7065 0a0a 2020 2020 2020 2020  escape..        
+0000c120: 2020 2020 6764 7370 6174 6820 3d20 7365      gdspath = se
+0000c130: 6c66 2e77 7269 7465 5f67 6473 2867 6473  lf.write_gds(gds
+0000c140: 6469 723d 5041 5448 2e67 6473 6c69 6220  dir=PATH.gdslib 
+0000c150: 2f20 2265 7874 7261 222c 206c 6f67 6769  / "extra", loggi
+0000c160: 6e67 3d46 616c 7365 290a 0a20 2020 2020  ng=False)..     
+0000c170: 2020 2020 2020 2064 6972 7061 7468 203d         dirpath =
+0000c180: 2047 4453 4449 525f 5445 4d50 0a20 2020   GDSDIR_TEMP.   
+0000c190: 2020 2020 2020 2020 2064 6972 7061 7468           dirpath
+0000c1a0: 2e6d 6b64 6972 2865 7869 7374 5f6f 6b3d  .mkdir(exist_ok=
+0000c1b0: 5472 7565 2c20 7061 7265 6e74 733d 5472  True, parents=Tr
+0000c1c0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0000c1d0: 6c79 705f 7061 7468 203d 2064 6972 7061  lyp_path = dirpa
+0000c1e0: 7468 202f 2022 6c61 7965 7273 2e6c 7970  th / "layers.lyp
+0000c1f0: 220a 0a20 2020 2020 2020 2020 2020 206c  "..            l
+0000c200: 6179 6572 5f70 726f 7073 203d 2067 6574  ayer_props = get
+0000c210: 5f6c 6179 6572 5f76 6965 7773 2829 0a20  _layer_views(). 
+0000c220: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+0000c230: 5f70 726f 7073 2e74 6f5f 6c79 7028 6669  _props.to_lyp(fi
+0000c240: 6c65 7061 7468 3d6c 7970 5f70 6174 6829  lepath=lyp_path)
+0000c250: 0a0a 2020 2020 2020 2020 2020 2020 7372  ..            sr
+0000c260: 6320 3d20 6622 6874 7470 3a2f 2f31 3237  c = f"http://127
+0000c270: 2e30 2e30 2e31 3a7b 6b6a 2e70 6f72 747d  .0.0.1:{kj.port}
+0000c280: 2f67 6473 3f67 6473 5f66 696c 653d 7b65  /gds?gds_file={e
+0000c290: 7363 6170 6528 7374 7228 6764 7370 6174  scape(str(gdspat
+0000c2a0: 6829 297d 266c 6179 6572 5f70 726f 7073  h))}&layer_props
+0000c2b0: 3d7b 6573 6361 7065 2873 7472 286c 7970  ={escape(str(lyp
+0000c2c0: 5f70 6174 6829 297d 220a 2020 2020 2020  _path))}".      
+0000c2d0: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+0000c2e0: 7567 2873 7263 290a 0a20 2020 2020 2020  ug(src)..       
+0000c2f0: 2020 2020 2069 6620 6b6a 2e6a 7570 7974       if kj.jupyt
+0000c300: 6572 5f73 6572 7665 7220 616e 6420 6e6f  er_server and no
+0000c310: 7420 6f73 2e65 6e76 6972 6f6e 2e67 6574  t os.environ.get
+0000c320: 2822 444f 4353 222c 2046 616c 7365 293a  ("DOCS", False):
+0000c330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c340: 2072 6574 7572 6e20 4946 7261 6d65 280a   return IFrame(.
+0000c350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c360: 2020 2020 7372 633d 7372 632c 0a20 2020      src=src,.   
+0000c370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c380: 2077 6964 7468 3d31 3430 302c 0a20 2020   width=1400,.   
+0000c390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3a0: 2068 6569 6768 743d 3630 302c 0a20 2020   height=600,.   
+0000c3b0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000c3c0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000c3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c3e0: 2072 6574 7572 6e20 7365 6c66 2e70 6c6f   return self.plo
+0000c3f0: 745f 6b6c 6179 6f75 7428 290a 2020 2020  t_klayout().    
+0000c400: 2020 2020 6578 6365 7074 2049 6d70 6f72      except Impor
+0000c410: 7445 7272 6f72 3a0a 2020 2020 2020 2020  tError:.        
+0000c420: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+0000c430: 2020 2020 2020 2020 2020 2022 596f 7520             "You 
+0000c440: 6361 6e20 696e 7374 616c 6c20 6070 6970  can install `pip
+0000c450: 2069 6e73 7461 6c6c 2067 6473 6661 6374   install gdsfact
+0000c460: 6f72 795b 6675 6c6c 5d60 2066 6f72 2062  ory[full]` for b
+0000c470: 6574 7465 7220 7669 7375 616c 697a 6174  etter visualizat
+0000c480: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
+0000c490: 2029 0a20 2020 2020 2020 2020 2020 2072   ).            r
+0000c4a0: 6574 7572 6e20 7365 6c66 2e70 6c6f 745f  eturn self.plot_
+0000c4b0: 6b6c 6179 6f75 7428 290a 0a20 2020 2064  klayout()..    d
+0000c4c0: 6566 2070 6c6f 745f 6d61 7470 6c6f 746c  ef plot_matplotl
+0000c4d0: 6962 2873 656c 662c 202a 2a6b 7761 7267  ib(self, **kwarg
+0000c4e0: 7329 202d 3e20 4e6f 6e65 3a0a 2020 2020  s) -> None:.    
+0000c4f0: 2020 2020 2222 2250 6c6f 7420 636f 6d70      """Plot comp
+0000c500: 6f6e 656e 7420 7573 696e 6720 6d61 7470  onent using matp
+0000c510: 6c6f 746c 6962 2e0a 0a20 2020 2020 2020  lotlib...       
+0000c520: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
+0000c530: 2020 2020 2020 2020 2020 2073 686f 775f             show_
+0000c540: 706f 7274 733a 2053 6574 7320 7768 6574  ports: Sets whet
+0000c550: 6865 7220 706f 7274 7320 6172 6520 6472  her ports are dr
+0000c560: 6177 6e2e 0a20 2020 2020 2020 2020 2020  awn..           
+0000c570: 2073 686f 775f 7375 6270 6f72 7473 3a20   show_subports: 
+0000c580: 5365 7473 2077 6865 7468 6572 2073 7562  Sets whether sub
+0000c590: 706f 7274 7320 2870 6f72 7473 2074 6861  ports (ports tha
+0000c5a0: 7420 6265 6c6f 6e67 2074 6f20 7265 6665  t belong to refe
+0000c5b0: 7265 6e63 6573 2920 6172 6520 6472 6177  rences) are draw
+0000c5c0: 6e2e 0a20 2020 2020 2020 2020 2020 206c  n..            l
+0000c5d0: 6162 656c 5f61 6c69 6173 6573 3a20 5365  abel_aliases: Se
+0000c5e0: 7473 2077 6865 7468 6572 2061 6c69 6173  ts whether alias
+0000c5f0: 6573 2061 7265 206c 6162 656c 6564 2077  es are labeled w
+0000c600: 6974 6820 6120 7465 7874 206e 616d 652e  ith a text name.
+0000c610: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+0000c620: 5f77 696e 646f 773a 2049 6620 5472 7565  _window: If True
+0000c630: 2c20 6561 6368 2063 616c 6c20 746f 2071  , each call to q
+0000c640: 7569 636b 706c 6f74 2829 2077 696c 6c20  uickplot() will 
+0000c650: 6765 6e65 7261 7465 2061 2073 6570 6172  generate a separ
+0000c660: 6174 6520 7769 6e64 6f77 2e0a 2020 2020  ate window..    
+0000c670: 2020 2020 2020 2020 626c 6f63 6b69 6e67          blocking
+0000c680: 3a20 4966 2054 7275 652c 2063 616c 6c69  : If True, calli
+0000c690: 6e67 2071 7569 636b 706c 6f74 2829 2077  ng quickplot() w
+0000c6a0: 696c 6c20 7061 7573 6520 6578 6563 7574  ill pause execut
+0000c6b0: 696f 6e20 6f66 2028 2262 6c6f 636b 2229  ion of ("block")
+0000c6c0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+0000c6d0: 2020 2020 2072 656d 6169 6e64 6572 206f       remainder o
+0000c6e0: 6620 7468 6520 7079 7468 6f6e 2063 6f64  f the python cod
+0000c6f0: 6520 756e 7469 6c20 7468 6520 7175 6963  e until the quic
+0000c700: 6b70 6c6f 7428 2920 7769 6e64 6f77 2069  kplot() window i
+0000c710: 7320 636c 6f73 6564 2e0a 2020 2020 2020  s closed..      
+0000c720: 2020 2020 2020 2020 2020 4966 2046 616c            If Fal
+0000c730: 7365 2c20 7468 6520 7769 6e64 6f77 2077  se, the window w
+0000c740: 696c 6c20 6265 206f 7065 6e65 6420 616e  ill be opened an
+0000c750: 6420 636f 6465 2077 696c 6c20 636f 6e74  d code will cont
+0000c760: 696e 7565 2074 6f20 7275 6e2e 0a20 2020  inue to run..   
+0000c770: 2020 2020 2020 2020 207a 6f6f 6d5f 6661           zoom_fa
+0000c780: 6374 6f72 3a20 5365 7473 2074 6865 2073  ctor: Sets the s
+0000c790: 6361 6c69 6e67 2066 6163 746f 7220 7768  caling factor wh
+0000c7a0: 656e 207a 6f6f 6d69 6e67 2074 6865 2071  en zooming the q
+0000c7b0: 7569 636b 706c 6f74 2077 696e 646f 7720  uickplot window 
+0000c7c0: 7769 7468 2074 6865 0a20 2020 2020 2020  with the.       
+0000c7d0: 2020 2020 2020 2020 206d 6f75 7365 7768           mousewh
+0000c7e0: 6565 6c2f 7472 6163 6b70 6164 2e0a 2020  eel/trackpad..  
+0000c7f0: 2020 2020 2020 2020 2020 696e 7465 7261            intera
+0000c800: 6374 6976 655f 7a6f 6f6d 3a20 456e 6162  ctive_zoom: Enab
+0000c810: 6c65 7320 7573 696e 6720 6d6f 7573 6577  les using mousew
+0000c820: 6865 656c 2f74 7261 636b 7061 6420 746f  heel/trackpad to
+0000c830: 207a 6f6f 6d2e 0a20 2020 2020 2020 2020   zoom..         
+0000c840: 2020 2066 6f6e 7473 697a 653a 2066 6f72     fontsize: for
+0000c850: 206c 6162 656c 732e 0a20 2020 2020 2020   labels..       
+0000c860: 2020 2020 206c 6179 6572 735f 6578 636c       layers_excl
+0000c870: 7564 6564 3a20 6c69 7374 206f 6620 6c61  uded: list of la
+0000c880: 7965 7273 2074 6f20 6578 636c 7564 652e  yers to exclude.
+0000c890: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+0000c8a0: 6572 5f76 6965 7773 3a20 6c61 7965 725f  er_views: layer_
+0000c8b0: 7669 6577 7320 636f 6c6f 7273 206c 6f61  views colors loa
+0000c8c0: 6465 6420 6672 6f6d 204b 6c61 796f 7574  ded from Klayout
+0000c8d0: 2e0a 2020 2020 2020 2020 2020 2020 6d69  ..            mi
+0000c8e0: 6e5f 6173 7065 6374 3a20 6d69 6e69 6d75  n_aspect: minimu
+0000c8f0: 6d20 6173 7065 6374 2072 6174 696f 2e0a  m aspect ratio..
+0000c900: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000c910: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+0000c920: 6f72 792e 7175 6963 6b70 6c6f 7474 6572  ory.quickplotter
+0000c930: 2069 6d70 6f72 7420 7175 6963 6b70 6c6f   import quickplo
+0000c940: 740a 0a20 2020 2020 2020 2071 7569 636b  t..        quick
+0000c950: 706c 6f74 2873 656c 662c 202a 2a6b 7761  plot(self, **kwa
+0000c960: 7267 7329 0a0a 2020 2020 6465 6620 706c  rgs)..    def pl
+0000c970: 6f74 2873 656c 662c 2070 6c6f 7474 6572  ot(self, plotter
+0000c980: 3a20 4f70 7469 6f6e 616c 5b50 6c6f 7474  : Optional[Plott
+0000c990: 6572 5d20 3d20 4e6f 6e65 2c20 2a2a 6b77  er] = None, **kw
+0000c9a0: 6172 6773 2920 2d3e 204e 6f6e 653a 0a20  args) -> None:. 
+0000c9b0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+0000c9c0: 7320 636f 6d70 6f6e 656e 7420 706c 6f74  s component plot
+0000c9d0: 2075 7369 6e67 206b 6c61 796f 7574 2c20   using klayout, 
+0000c9e0: 6d61 7470 6c6f 746c 6962 2c20 686f 6c6f  matplotlib, holo
+0000c9f0: 7669 6577 7320 6f72 2071 742e 0a0a 2020  views or qt...  
+0000ca00: 2020 2020 2020 5765 2072 6563 6f6d 6d65        We recomme
+0000ca10: 6e64 2075 7369 6e67 206b 6c61 796f 7574  nd using klayout
+0000ca20: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+0000ca30: 0a20 2020 2020 2020 2020 2020 2070 6c6f  .            plo
+0000ca40: 7474 6572 3a20 706c 6f74 2062 6163 6b65  tter: plot backe
+0000ca50: 6e64 2028 2768 6f6c 6f76 6965 7773 272c  nd ('holoviews',
+0000ca60: 2027 6d61 7470 6c6f 746c 6962 272c 2027   'matplotlib', '
+0000ca70: 7174 272c 2027 6b6c 6179 6f75 7427 292e  qt', 'klayout').
+0000ca80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ca90: 2020 2020 2070 6c6f 7474 6572 203d 2070       plotter = p
+0000caa0: 6c6f 7474 6572 206f 7220 434f 4e46 2e67  lotter or CONF.g
+0000cab0: 6574 2822 706c 6f74 7465 7222 2c20 226d  et("plotter", "m
+0000cac0: 6174 706c 6f74 6c69 6222 290a 0a20 2020  atplotlib")..   
+0000cad0: 2020 2020 2069 6620 706c 6f74 7465 7220       if plotter 
+0000cae0: 3d3d 2022 6b6c 6179 6f75 7422 3a0a 2020  == "klayout":.  
+0000caf0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000cb00: 6c6f 745f 6b6c 6179 6f75 7428 290a 2020  lot_klayout().  
+0000cb10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000cb20: 0a0a 2020 2020 2020 2020 656c 6966 2070  ..        elif p
+0000cb30: 6c6f 7474 6572 203d 3d20 226d 6174 706c  lotter == "matpl
+0000cb40: 6f74 6c69 6222 3a0a 2020 2020 2020 2020  otlib":.        
+0000cb50: 2020 2020 6672 6f6d 2067 6473 6661 6374      from gdsfact
+0000cb60: 6f72 792e 7175 6963 6b70 6c6f 7474 6572  ory.quickplotter
+0000cb70: 2069 6d70 6f72 7420 7175 6963 6b70 6c6f   import quickplo
+0000cb80: 740a 0a20 2020 2020 2020 2020 2020 2071  t..            q
+0000cb90: 7569 636b 706c 6f74 2873 656c 662c 202a  uickplot(self, *
+0000cba0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+0000cbb0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+0000cbc0: 2020 2020 2065 6c69 6620 706c 6f74 7465       elif plotte
+0000cbd0: 7220 3d3d 2022 686f 6c6f 7669 6577 7322  r == "holoviews"
+0000cbe0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+0000cbf0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000cc00: 2020 2069 6d70 6f72 7420 686f 6c6f 7669     import holovi
+0000cc10: 6577 7320 6173 2068 760a 0a20 2020 2020  ews as hv..     
+0000cc20: 2020 2020 2020 2020 2020 2068 762e 6578             hv.ex
+0000cc30: 7465 6e73 696f 6e28 2262 6f6b 6568 2229  tension("bokeh")
+0000cc40: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0000cc50: 6570 7420 496d 706f 7274 4572 726f 7220  ept ImportError 
+0000cc60: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000cc70: 2020 2020 2020 7072 696e 7428 2279 6f75        print("you
+0000cc80: 206e 6565 6420 746f 2060 7069 7020 696e   need to `pip in
+0000cc90: 7374 616c 6c20 686f 6c6f 7669 6577 7360  stall holoviews`
+0000cca0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000ccb0: 2020 2072 6169 7365 2065 0a20 2020 2020     raise e.     
+0000ccc0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000ccd0: 6c66 2e70 6c6f 745f 686f 6c6f 7669 6577  lf.plot_holoview
+0000cce0: 7328 2a2a 6b77 6172 6773 290a 0a20 2020  s(**kwargs)..   
+0000ccf0: 2020 2020 2065 6c69 6620 706c 6f74 7465       elif plotte
+0000cd00: 7220 3d3d 2022 7174 223a 0a20 2020 2020  r == "qt":.     
+0000cd10: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
+0000cd20: 6163 746f 7279 2e71 7569 636b 706c 6f74  actory.quickplot
+0000cd30: 7465 7220 696d 706f 7274 2071 7569 636b  ter import quick
+0000cd40: 706c 6f74 320a 0a20 2020 2020 2020 2020  plot2..         
+0000cd50: 2020 2071 7569 636b 706c 6f74 3228 7365     quickplot2(se
+0000cd60: 6c66 290a 2020 2020 2020 2020 2020 2020  lf).            
+0000cd70: 7265 7475 726e 0a20 2020 2020 2020 2065  return.        e
+0000cd80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000cd90: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000cda0: 7228 6622 7b70 6c6f 7474 6572 2172 7d20  r(f"{plotter!r} 
+0000cdb0: 6e6f 7420 696e 207b 506c 6f74 7465 727d  not in {Plotter}
+0000cdc0: 2229 0a0a 2020 2020 6465 6620 706c 6f74  ")..    def plot
+0000cdd0: 5f68 6f6c 6f76 6965 7773 280a 2020 2020  _holoviews(.    
+0000cde0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0000cdf0: 2020 6c61 7965 7273 5f65 7863 6c75 6465    layers_exclude
+0000ce00: 643a 204f 7074 696f 6e61 6c5b 4c61 7965  d: Optional[Laye
+0000ce10: 7273 5d20 3d20 4e6f 6e65 2c0a 2020 2020  rs] = None,.    
+0000ce20: 2020 2020 6c61 7965 725f 7669 6577 733a      layer_views:
+0000ce30: 204f 7074 696f 6e61 6c5b 4c61 7965 7256   Optional[LayerV
+0000ce40: 6965 7773 5d20 3d20 4e6f 6e65 2c0a 2020  iews] = None,.  
+0000ce50: 2020 2020 2020 6d69 6e5f 6173 7065 6374        min_aspect
+0000ce60: 3a20 666c 6f61 7420 3d20 302e 3235 2c0a  : float = 0.25,.
+0000ce70: 2020 2020 2020 2020 7061 6464 696e 673a          padding:
+0000ce80: 2066 6c6f 6174 203d 2030 2e35 2c0a 2020   float = 0.5,.  
+0000ce90: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000cea0: 506c 6f74 2063 6f6d 706f 6e65 6e74 2069  Plot component i
+0000ceb0: 6e20 686f 6c6f 7669 6577 732e 0a0a 2020  n holoviews...  
+0000cec0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0000ced0: 2020 2020 2020 2020 6c61 7965 7273 5f65          layers_e
+0000cee0: 7863 6c75 6465 643a 206c 6973 7420 6f66  xcluded: list of
+0000cef0: 206c 6179 6572 7320 746f 2065 7863 6c75   layers to exclu
+0000cf00: 6465 2e0a 2020 2020 2020 2020 2020 2020  de..            
+0000cf10: 6c61 7965 725f 7669 6577 733a 206c 6179  layer_views: lay
+0000cf20: 6572 5f76 6965 7773 2063 6f6c 6f72 7320  er_views colors 
+0000cf30: 6c6f 6164 6564 2066 726f 6d20 4b6c 6179  loaded from Klay
+0000cf40: 6f75 742e 0a20 2020 2020 2020 2020 2020  out..           
+0000cf50: 206d 696e 5f61 7370 6563 743a 206d 696e   min_aspect: min
+0000cf60: 696d 756d 2061 7370 6563 7420 7261 7469  imum aspect rati
+0000cf70: 6f2e 0a20 2020 2020 2020 2020 2020 2070  o..            p
+0000cf80: 6164 6469 6e67 3a20 6172 6f75 6e64 2062  adding: around b
+0000cf90: 6f75 6e64 696e 6720 626f 782e 0a0a 2020  ounding box...  
+0000cfa0: 2020 2020 2020 5265 7475 726e 733a 0a20        Returns:. 
+0000cfb0: 2020 2020 2020 2020 2020 2048 6f6c 6f76             Holov
+0000cfc0: 6965 7773 204f 7665 726c 6179 2074 6f20  iews Overlay to 
+0000cfd0: 6469 7370 6c61 7920 616c 6c20 706f 6c79  display all poly
+0000cfe0: 676f 6e73 2e0a 2020 2020 2020 2020 2222  gons..        ""
+0000cff0: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
+0000d000: 6473 6661 6374 6f72 792e 6164 645f 7069  dsfactory.add_pi
+0000d010: 6e73 2069 6d70 6f72 7420 6765 745f 7069  ns import get_pi
+0000d020: 6e5f 7472 6961 6e67 6c65 5f70 6f6c 7967  n_triangle_polyg
+0000d030: 6f6e 5f74 6970 0a20 2020 2020 2020 2066  on_tip.        f
+0000d040: 726f 6d20 6764 7366 6163 746f 7279 2e67  rom gdsfactory.g
+0000d050: 656e 6572 6963 5f74 6563 6820 696d 706f  eneric_tech impo
+0000d060: 7274 204c 4159 4552 5f56 4945 5753 0a0a  rt LAYER_VIEWS..
+0000d070: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
+0000d080: 5f76 6965 7773 2069 7320 4e6f 6e65 3a0a  _views is None:.
+0000d090: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
+0000d0a0: 725f 7669 6577 7320 3d20 4c41 5945 525f  r_views = LAYER_
+0000d0b0: 5649 4557 530a 0a20 2020 2020 2020 2074  VIEWS..        t
+0000d0c0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000d0d0: 696d 706f 7274 2068 6f6c 6f76 6965 7773  import holoviews
+0000d0e0: 2061 7320 6876 0a0a 2020 2020 2020 2020   as hv..        
+0000d0f0: 2020 2020 6876 2e65 7874 656e 7369 6f6e      hv.extension
+0000d100: 2822 626f 6b65 6822 290a 2020 2020 2020  ("bokeh").      
+0000d110: 2020 6578 6365 7074 2049 6d70 6f72 7445    except ImportE
+0000d120: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+0000d130: 2020 2020 2020 2070 7269 6e74 2822 796f         print("yo
+0000d140: 7520 6e65 6564 2074 6f20 6070 6970 2069  u need to `pip i
+0000d150: 6e73 7461 6c6c 2068 6f6c 6f76 6965 7773  nstall holoviews
+0000d160: 6022 290a 2020 2020 2020 2020 2020 2020  `").            
+0000d170: 7261 6973 6520 650a 0a20 2020 2020 2020  raise e..       
+0000d180: 2073 656c 662e 5f62 625f 7661 6c69 6420   self._bb_valid 
+0000d190: 3d20 4661 6c73 6520 2023 2072 6563 6f6d  = False  # recom
+0000d1a0: 7075 7465 2074 6865 2062 6f75 6e64 696e  pute the boundin
+0000d1b0: 6720 626f 780a 2020 2020 2020 2020 6220  g box.        b 
+0000d1c0: 3d20 7365 6c66 2e62 626f 7820 2b20 2828  = self.bbox + ((
+0000d1d0: 2d70 6164 6469 6e67 2c20 2d70 6164 6469  -padding, -paddi
+0000d1e0: 6e67 292c 2028 7061 6464 696e 672c 2070  ng), (padding, p
+0000d1f0: 6164 6469 6e67 2929 0a20 2020 2020 2020  adding)).       
+0000d200: 2062 203d 206e 702e 6172 7261 7928 622e   b = np.array(b.
+0000d210: 666c 6174 290a 2020 2020 2020 2020 6365  flat).        ce
+0000d220: 6e74 6572 203d 206e 702e 6172 7261 7928  nter = np.array(
+0000d230: 286e 702e 7375 6d28 625b 3a3a 325d 2920  (np.sum(b[::2]) 
+0000d240: 2f20 322c 206e 702e 7375 6d28 625b 313a  / 2, np.sum(b[1:
+0000d250: 3a32 5d29 202f 2032 2929 0a20 2020 2020  :2]) / 2)).     
+0000d260: 2020 2073 697a 6520 3d20 6e70 2e61 7272     size = np.arr
+0000d270: 6179 2828 6e70 2e61 6273 2862 5b32 5d20  ay((np.abs(b[2] 
+0000d280: 2d20 625b 305d 292c 206e 702e 6162 7328  - b[0]), np.abs(
+0000d290: 625b 335d 202d 2062 5b31 5d29 2929 0a20  b[3] - b[1]))). 
+0000d2a0: 2020 2020 2020 2064 7820 3d20 6e70 2e61         dx = np.a
+0000d2b0: 7272 6179 280a 2020 2020 2020 2020 2020  rray(.          
+0000d2c0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+0000d2d0: 2020 2020 6e70 2e6d 6178 696d 756d 286d      np.maximum(m
+0000d2e0: 696e 5f61 7370 6563 7420 2a20 7369 7a65  in_aspect * size
+0000d2f0: 5b31 5d2c 2073 697a 655b 305d 2920 2f20  [1], size[0]) / 
+0000d300: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+0000d310: 2020 206e 702e 6d61 7869 6d75 6d28 7369     np.maximum(si
+0000d320: 7a65 5b31 5d2c 206d 696e 5f61 7370 6563  ze[1], min_aspec
+0000d330: 7420 2a20 7369 7a65 5b30 5d29 202f 2032  t * size[0]) / 2
+0000d340: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0000d350: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000d360: 2020 6220 3d20 6e70 2e68 7374 6163 6b28    b = np.hstack(
+0000d370: 2863 656e 7465 7220 2d20 6478 2c20 6365  (center - dx, ce
+0000d380: 6e74 6572 202b 2064 7829 290a 0a20 2020  nter + dx))..   
+0000d390: 2020 2020 2070 6c6f 7473 5f74 6f5f 6f76       plots_to_ov
+0000d3a0: 6572 6c61 7920 3d20 5b5d 0a20 2020 2020  erlay = [].     
+0000d3b0: 2020 206c 6179 6572 735f 6578 636c 7564     layers_exclud
+0000d3c0: 6564 203d 205b 5d20 6966 206c 6179 6572  ed = [] if layer
+0000d3d0: 735f 6578 636c 7564 6564 2069 7320 4e6f  s_excluded is No
+0000d3e0: 6e65 2065 6c73 6520 6c61 7965 7273 5f65  ne else layers_e
+0000d3f0: 7863 6c75 6465 640a 0a20 2020 2020 2020  xcluded..       
+0000d400: 2066 6f72 206c 6179 6572 2c20 706f 6c79   for layer, poly
+0000d410: 676f 6e20 696e 2073 656c 662e 6765 745f  gon in self.get_
+0000d420: 706f 6c79 676f 6e73 2862 795f 7370 6563  polygons(by_spec
+0000d430: 3d54 7275 6529 2e69 7465 6d73 2829 3a0a  =True).items():.
+0000d440: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000d450: 6179 6572 2069 6e20 6c61 7965 7273 5f65  ayer in layers_e
+0000d460: 7863 6c75 6465 643a 0a20 2020 2020 2020  xcluded:.       
+0000d470: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0000d480: 650a 0a20 2020 2020 2020 2020 2020 2074  e..            t
+0000d490: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000d4a0: 2020 2020 6c61 7965 725f 7669 6577 203d      layer_view =
+0000d4b0: 206c 6179 6572 5f76 6965 7773 2e67 6574   layer_views.get
+0000d4c0: 5f66 726f 6d5f 7475 706c 6528 6c61 7965  _from_tuple(laye
+0000d4d0: 7229 0a20 2020 2020 2020 2020 2020 2065  r).            e
+0000d4e0: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+0000d4f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d500: 2020 6c61 7965 7273 203d 206c 6973 7428    layers = list(
+0000d510: 6c61 7965 725f 7669 6577 732e 6765 745f  layer_views.get_
+0000d520: 6c61 7965 725f 7669 6577 7328 292e 6b65  layer_views().ke
+0000d530: 7973 2829 290a 2020 2020 2020 2020 2020  ys()).          
+0000d540: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+0000d550: 6172 6e28 6622 7b6c 6179 6572 2172 7d20  arn(f"{layer!r} 
+0000d560: 6e6f 7420 6465 6669 6e65 6420 696e 207b  not defined in {
+0000d570: 6c61 7965 7273 7d22 290a 2020 2020 2020  layers}").      
+0000d580: 2020 2020 2020 2020 2020 6c61 7965 725f            layer_
+0000d590: 7669 6577 203d 204c 6179 6572 5669 6577  view = LayerView
+0000d5a0: 286c 6179 6572 3d6c 6179 6572 290a 2020  (layer=layer).  
+0000d5b0: 2020 2020 2020 2020 2020 2320 544f 444f            # TODO
+0000d5c0: 3a20 4d61 7463 6820 7570 206f 7074 696f  : Match up optio
+0000d5d0: 6e73 2077 6974 6820 4c61 7965 7256 6965  ns with LayerVie
+0000d5e0: 7773 0a20 2020 2020 2020 2020 2020 2070  ws.            p
+0000d5f0: 6c6f 7473 5f74 6f5f 6f76 6572 6c61 792e  lots_to_overlay.
+0000d600: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
+0000d610: 2020 2020 2020 2020 6876 2e50 6f6c 7967          hv.Polyg
+0000d620: 6f6e 7328 706f 6c79 676f 6e2c 206c 6162  ons(polygon, lab
+0000d630: 656c 3d73 7472 286c 6179 6572 5f76 6965  el=str(layer_vie
+0000d640: 772e 6e61 6d65 2929 2e6f 7074 7328 0a20  w.name)).opts(. 
+0000d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d660: 2020 2064 6174 615f 6173 7065 6374 3d31     data_aspect=1
+0000d670: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000d680: 2020 2020 2020 6672 616d 655f 7769 6474        frame_widt
+0000d690: 683d 3530 302c 0a20 2020 2020 2020 2020  h=500,.         
+0000d6a0: 2020 2020 2020 2020 2020 2079 6c69 6d3d             ylim=
+0000d6b0: 2862 5b31 5d2c 2062 5b33 5d29 2c0a 2020  (b[1], b[3]),.  
+0000d6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6d0: 2020 786c 696d 3d28 625b 305d 2c20 625b    xlim=(b[0], b[
+0000d6e0: 325d 292c 0a20 2020 2020 2020 2020 2020  2]),.           
+0000d6f0: 2020 2020 2020 2020 2066 696c 6c5f 636f           fill_co
+0000d700: 6c6f 723d 6c61 7965 725f 7669 6577 2e66  lor=layer_view.f
+0000d710: 696c 6c5f 636f 6c6f 722e 6173 5f72 6762  ill_color.as_rgb
+0000d720: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
+0000d730: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0000d740: 6e65 5f63 6f6c 6f72 3d6c 6179 6572 5f76  ne_color=layer_v
+0000d750: 6965 772e 6672 616d 655f 636f 6c6f 722e  iew.frame_color.
+0000d760: 6173 5f72 6762 2829 206f 7220 2222 2c0a  as_rgb() or "",.
 0000d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d780: 6672 616d 655f 7769 6474 683d 3530 302c  frame_width=500,
-0000d790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d7a0: 2020 2020 2079 6c69 6d3d 2862 5b31 5d2c       ylim=(b[1],
-0000d7b0: 2062 5b33 5d29 2c0a 2020 2020 2020 2020   b[3]),.        
-0000d7c0: 2020 2020 2020 2020 2020 2020 786c 696d              xlim
-0000d7d0: 3d28 625b 305d 2c20 625b 325d 292c 0a20  =(b[0], b[2]),. 
-0000d7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7f0: 2020 2066 696c 6c5f 636f 6c6f 723d 6c61     fill_color=la
-0000d800: 7965 725f 7669 6577 2e66 696c 6c5f 636f  yer_view.fill_co
-0000d810: 6c6f 722e 6173 5f72 6762 2829 206f 7220  lor.as_rgb() or 
-0000d820: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0000d830: 2020 2020 2020 2020 6c69 6e65 5f63 6f6c          line_col
-0000d840: 6f72 3d6c 6179 6572 5f76 6965 772e 6672  or=layer_view.fr
-0000d850: 616d 655f 636f 6c6f 722e 6173 5f72 6762  ame_color.as_rgb
-0000d860: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
-0000d870: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000d880: 6c6c 5f61 6c70 6861 3d6c 6179 6572 5f76  ll_alpha=layer_v
-0000d890: 6965 772e 6765 745f 616c 7068 6128 2920  iew.get_alpha() 
-0000d8a0: 6f72 2022 222c 0a20 2020 2020 2020 2020  or "",.         
-0000d8b0: 2020 2020 2020 2020 2020 206c 696e 655f             line_
-0000d8c0: 616c 7068 613d 6c61 7965 725f 7669 6577  alpha=layer_view
-0000d8d0: 2e67 6574 5f61 6c70 6861 2829 206f 7220  .get_alpha() or 
-0000d8e0: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
-0000d8f0: 2020 2020 2020 2020 746f 6f6c 733d 5b22          tools=["
-0000d900: 686f 7665 7222 5d2c 0a20 2020 2020 2020  hover"],.       
-0000d910: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000d920: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000d930: 2066 6f72 206e 616d 652c 2070 6f72 7420   for name, port 
-0000d940: 696e 2073 656c 662e 706f 7274 732e 6974  in self.ports.it
-0000d950: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0000d960: 2020 206e 616d 6520 3d20 7374 7228 6e61     name = str(na
-0000d970: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000d980: 706f 6c79 676f 6e2c 2070 7469 7020 3d20  polygon, ptip = 
-0000d990: 6765 745f 7069 6e5f 7472 6961 6e67 6c65  get_pin_triangle
-0000d9a0: 5f70 6f6c 7967 6f6e 5f74 6970 2870 6f72  _polygon_tip(por
-0000d9b0: 743d 706f 7274 290a 0a20 2020 2020 2020  t=port)..       
-0000d9c0: 2020 2020 2070 6c6f 7473 5f74 6f5f 6f76       plots_to_ov
-0000d9d0: 6572 6c61 792e 6170 7065 6e64 280a 2020  erlay.append(.  
-0000d9e0: 2020 2020 2020 2020 2020 2020 2020 6876                hv
-0000d9f0: 2e50 6f6c 7967 6f6e 7328 706f 6c79 676f  .Polygons(polygo
-0000da00: 6e2c 206c 6162 656c 3d6e 616d 6529 2e6f  n, label=name).o
-0000da10: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
-0000da20: 2020 2020 2020 2020 2064 6174 615f 6173           data_as
-0000da30: 7065 6374 3d31 2c0a 2020 2020 2020 2020  pect=1,.        
-0000da40: 2020 2020 2020 2020 2020 2020 6672 616d              fram
-0000da50: 655f 7769 6474 683d 3530 302c 0a20 2020  e_width=500,.   
-0000da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da70: 2066 696c 6c5f 616c 7068 613d 302c 0a20   fill_alpha=0,. 
-0000da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da90: 2020 2079 6c69 6d3d 2862 5b31 5d2c 2062     ylim=(b[1], b
-0000daa0: 5b33 5d29 2c0a 2020 2020 2020 2020 2020  [3]),.          
-0000dab0: 2020 2020 2020 2020 2020 786c 696d 3d28            xlim=(
-0000dac0: 625b 305d 2c20 625b 325d 292c 0a20 2020  b[0], b[2]),.   
-0000dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dae0: 2063 6f6c 6f72 3d22 7265 6422 2c0a 2020   color="red",.  
-0000daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db00: 2020 6c69 6e65 5f61 6c70 6861 3d6c 6179    line_alpha=lay
-0000db10: 6572 5f76 6965 772e 6765 745f 616c 7068  er_view.get_alph
-0000db20: 6128 2920 6f72 2022 222c 0a20 2020 2020  a() or "",.     
-0000db30: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000db40: 6f6f 6c73 3d5b 2268 6f76 6572 225d 2c0a  ools=["hover"],.
-0000db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000db70: 2020 2a20 6876 2e54 6578 7428 7074 6970    * hv.Text(ptip
-0000db80: 5b30 5d2c 2070 7469 705b 315d 2c20 6e61  [0], ptip[1], na
-0000db90: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0000dba0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000dbb0: 6e20 6876 2e4f 7665 726c 6179 2870 6c6f  n hv.Overlay(plo
-0000dbc0: 7473 5f74 6f5f 6f76 6572 6c61 7929 2e6f  ts_to_overlay).o
-0000dbd0: 7074 7328 0a20 2020 2020 2020 2020 2020  pts(.           
-0000dbe0: 2073 686f 775f 6c65 6765 6e64 3d54 7275   show_legend=Tru
-0000dbf0: 652c 2073 6861 7265 645f 6178 6573 3d46  e, shared_axes=F
-0000dc00: 616c 7365 2c20 796c 696d 3d28 625b 315d  alse, ylim=(b[1]
-0000dc10: 2c20 625b 335d 292c 2078 6c69 6d3d 2862  , b[3]), xlim=(b
-0000dc20: 5b30 5d2c 2062 5b32 5d29 0a20 2020 2020  [0], b[2]).     
-0000dc30: 2020 2029 0a0a 2020 2020 6465 6620 7368     )..    def sh
-0000dc40: 6f77 280a 2020 2020 2020 2020 7365 6c66  ow(.        self
-0000dc50: 2c0a 2020 2020 2020 2020 7368 6f77 5f70  ,.        show_p
-0000dc60: 6f72 7473 3a20 626f 6f6c 203d 2046 616c  orts: bool = Fal
-0000dc70: 7365 2c0a 2020 2020 2020 2020 7368 6f77  se,.        show
-0000dc80: 5f73 7562 706f 7274 733a 2062 6f6f 6c20  _subports: bool 
-0000dc90: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0000dca0: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
-0000dcb0: 6572 3a20 4c61 7965 7220 3d20 2831 2c20  er: Layer = (1, 
-0000dcc0: 3130 292c 0a20 2020 2020 2020 202a 2a6b  10),.        **k
-0000dcd0: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
-0000dce0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000dcf0: 2253 686f 7720 636f 6d70 6f6e 656e 7420  "Show component 
-0000dd00: 696e 204b 4c61 796f 7574 2e0a 0a20 2020  in KLayout...   
-0000dd10: 2020 2020 2072 6574 7572 6e73 2061 2063       returns a c
-0000dd20: 6f70 7920 6f66 2074 6865 2043 6f6d 706f  opy of the Compo
-0000dd30: 6e65 6e74 2c20 736f 2074 6865 206f 7269  nent, so the ori
-0000dd40: 6769 6e61 6c20 636f 6d70 6f6e 656e 7420  ginal component 
-0000dd50: 7265 6d61 696e 7320 696e 7461 6374 2e0a  remains intact..
-0000dd60: 2020 2020 2020 2020 7769 7468 2070 696e          with pin
-0000dd70: 7320 6d61 726b 6572 7320 6f6e 2065 6163  s markers on eac
-0000dd80: 6820 706f 7274 2073 686f 775f 706f 7274  h port show_port
-0000dd90: 7320 3d20 5472 7565 2c20 616e 6420 6f70  s = True, and op
-0000dda0: 7469 6f6e 616c 6c79 2061 6c73 6f0a 2020  tionally also.  
-0000ddb0: 2020 2020 2020 7468 6520 706f 7274 7320        the ports 
-0000ddc0: 6672 6f6d 2074 6865 2072 6566 6572 656e  from the referen
-0000ddd0: 6365 7320 2873 686f 775f 7375 6270 6f72  ces (show_subpor
-0000dde0: 7473 3d54 7275 6529 0a0a 2020 2020 2020  ts=True)..      
-0000ddf0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-0000de00: 2020 2020 7368 6f77 5f70 6f72 7473 3a20      show_ports: 
-0000de10: 7368 6f77 7320 636f 6d70 6f6e 656e 7420  shows component 
-0000de20: 7769 7468 2070 6f72 7420 6d61 726b 6572  with port marker
-0000de30: 7320 616e 6420 6c61 6265 6c73 2e0a 2020  s and labels..  
-0000de40: 2020 2020 2020 2020 2020 7368 6f77 5f73            show_s
-0000de50: 7562 706f 7274 733a 2061 6464 2070 6f72  ubports: add por
-0000de60: 7473 206d 6172 6b65 7273 2061 6e64 206c  ts markers and l
-0000de70: 6162 656c 7320 746f 2072 6566 6572 656e  abels to referen
-0000de80: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
-0000de90: 2070 6f72 745f 6d61 726b 6572 5f6c 6179   port_marker_lay
-0000dea0: 6572 3a20 666f 7220 7468 6520 706f 7274  er: for the port
-0000deb0: 732e 0a0a 2020 2020 2020 2020 4b65 7977  s...        Keyw
-0000dec0: 6f72 6420 4172 6773 3a0a 2020 2020 2020  ord Args:.      
-0000ded0: 2020 2020 2020 6764 7370 6174 683a 2047        gdspath: G
-0000dee0: 4453 2066 696c 6520 7061 7468 2074 6f20  DS file path to 
-0000def0: 7772 6974 6520 746f 2e0a 2020 2020 2020  write to..      
-0000df00: 2020 2020 2020 6764 7364 6972 3a20 6469        gdsdir: di
-0000df10: 7265 6374 6f72 7920 666f 7220 7468 6520  rectory for the 
-0000df20: 4744 5320 6669 6c65 2e20 4465 6661 756c  GDS file. Defaul
-0000df30: 7473 2074 6f20 2f74 6d70 2f2e 0a20 2020  ts to /tmp/..   
-0000df40: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
-0000df50: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
-0000df60: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
-0000df70: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
-0000df80: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-0000df90: 6369 7369 6f6e 3a20 666f 7220 6f62 6a65  cision: for obje
-0000dfa0: 6374 2064 696d 656e 7369 6f6e 7320 696e  ct dimensions in
-0000dfb0: 2074 6865 206c 6962 7261 7279 2028 6d29   the library (m)
-0000dfc0: 2e20 316e 6d20 6279 2064 6566 6175 6c74  . 1nm by default
-0000dfd0: 2e0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
-0000dfe0: 6d65 7374 616d 703a 2044 6566 6175 6c74  mestamp: Default
-0000dff0: 7320 746f 2032 3031 392d 3130 2d32 352e  s to 2019-10-25.
-0000e000: 2049 6620 4e6f 6e65 2075 7365 7320 6375   If None uses cu
-0000e010: 7272 656e 7420 7469 6d65 2e0a 2020 2020  rrent time..    
-0000e020: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e030: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
-0000e040: 6164 645f 7069 6e73 2069 6d70 6f72 7420  add_pins import 
-0000e050: 6164 645f 7069 6e73 5f74 7269 616e 676c  add_pins_triangl
-0000e060: 650a 2020 2020 2020 2020 6672 6f6d 2067  e.        from g
-0000e070: 6473 6661 6374 6f72 792e 7368 6f77 2069  dsfactory.show i
-0000e080: 6d70 6f72 7420 7368 6f77 0a0a 2020 2020  mport show..    
-0000e090: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
-0000e0a0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-0000e0b0: 6c66 2e61 6464 5f70 696e 735f 7472 6961  lf.add_pins_tria
-0000e0c0: 6e67 6c65 2870 6f72 745f 6d61 726b 6572  ngle(port_marker
-0000e0d0: 5f6c 6179 6572 3d70 6f72 745f 6d61 726b  _layer=port_mark
-0000e0e0: 6572 5f6c 6179 6572 290a 2020 2020 2020  er_layer).      
-0000e0f0: 2020 2020 2020 6966 2073 686f 775f 706f        if show_po
-0000e100: 7274 730a 2020 2020 2020 2020 2020 2020  rts.            
-0000e110: 656c 7365 2073 656c 660a 2020 2020 2020  else self.      
-0000e120: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
-0000e130: 7368 6f77 5f73 7562 706f 7274 733a 0a20  show_subports:. 
-0000e140: 2020 2020 2020 2020 2020 2063 6f6d 706f             compo
-0000e150: 6e65 6e74 203d 2073 656c 662e 636f 7079  nent = self.copy
-0000e160: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
-0000e170: 6f6d 706f 6e65 6e74 2e6e 616d 6520 3d20  omponent.name = 
-0000e180: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
-0000e190: 2020 2020 2020 666f 7220 7265 6665 7265        for refere
-0000e1a0: 6e63 6520 696e 2063 6f6d 706f 6e65 6e74  nce in component
-0000e1b0: 2e72 6566 6572 656e 6365 733a 0a20 2020  .references:.   
-0000e1c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000e1d0: 6973 696e 7374 616e 6365 2863 6f6d 706f  isinstance(compo
-0000e1e0: 6e65 6e74 2c20 436f 6d70 6f6e 656e 7452  nent, ComponentR
-0000e1f0: 6566 6572 656e 6365 293a 0a20 2020 2020  eference):.     
-0000e200: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000e210: 6464 5f70 696e 735f 7472 6961 6e67 6c65  dd_pins_triangle
-0000e220: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000e230: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000e240: 656e 743d 636f 6d70 6f6e 656e 742c 0a20  ent=component,. 
-0000e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e260: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-0000e270: 3d72 6566 6572 656e 6365 2c0a 2020 2020  =reference,.    
-0000e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e290: 2020 2020 6c61 7965 723d 706f 7274 5f6d      layer=port_m
-0000e2a0: 6172 6b65 725f 6c61 7965 722c 0a20 2020  arker_layer,.   
-0000e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2c0: 2029 0a0a 2020 2020 2020 2020 7368 6f77   )..        show
-0000e2d0: 2863 6f6d 706f 6e65 6e74 2c20 2a2a 6b77  (component, **kw
-0000e2e0: 6172 6773 290a 0a20 2020 2064 6566 205f  args)..    def _
-0000e2f0: 7772 6974 655f 6c69 6272 6172 7928 0a20  write_library(. 
-0000e300: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0000e310: 2020 2020 2067 6473 7061 7468 3a20 4f70       gdspath: Op
-0000e320: 7469 6f6e 616c 5b50 6174 6854 7970 655d  tional[PathType]
-0000e330: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000e340: 2067 6473 6469 723a 204f 7074 696f 6e61   gdsdir: Optiona
-0000e350: 6c5b 5061 7468 5479 7065 5d20 3d20 4e6f  l[PathType] = No
-0000e360: 6e65 2c0a 2020 2020 2020 2020 7469 6d65  ne,.        time
-0000e370: 7374 616d 703a 204f 7074 696f 6e61 6c5b  stamp: Optional[
-0000e380: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-0000e390: 655d 203d 205f 7469 6d65 7374 616d 7032  e] = _timestamp2
-0000e3a0: 3031 392c 0a20 2020 2020 2020 206c 6f67  019,.        log
-0000e3b0: 6769 6e67 3a20 626f 6f6c 203d 2054 7275  ging: bool = Tru
-0000e3c0: 652c 0a20 2020 2020 2020 2077 6974 685f  e,.        with_
-0000e3d0: 6f61 7369 733a 2062 6f6f 6c20 3d20 4661  oasis: bool = Fa
-0000e3e0: 6c73 652c 0a20 2020 2020 2020 202a 2a6b  lse,.        **k
-0000e3f0: 7761 7267 732c 0a20 2020 2029 202d 3e20  wargs,.    ) -> 
-0000e400: 5061 7468 3a0a 2020 2020 2020 2020 2222  Path:.        ""
-0000e410: 2257 7269 7465 2063 6f6d 706f 6e65 6e74  "Write component
-0000e420: 2074 6f20 4744 5320 6f72 204f 4153 4953   to GDS or OASIS
-0000e430: 2061 6e64 2072 6574 7572 6e73 2067 6473   and returns gds
-0000e440: 7061 7468 2e0a 0a20 2020 2020 2020 2041  path...        A
-0000e450: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-0000e460: 2067 6473 7061 7468 3a20 4744 5320 6669   gdspath: GDS fi
-0000e470: 6c65 2070 6174 6820 746f 2077 7269 7465  le path to write
-0000e480: 2074 6f2e 0a20 2020 2020 2020 2020 2020   to..           
-0000e490: 2067 6473 6469 723a 2064 6972 6563 746f   gdsdir: directo
-0000e4a0: 7279 2066 6f72 2074 6865 2047 4453 2066  ry for the GDS f
-0000e4b0: 696c 652e 2044 6566 6175 6c74 7320 746f  ile. Defaults to
-0000e4c0: 202f 746d 702f 7261 6e64 6f6d 4669 6c65   /tmp/randomFile
-0000e4d0: 2f67 6473 6661 6374 6f72 792e 0a20 2020  /gdsfactory..   
-0000e4e0: 2020 2020 2020 2020 2074 696d 6573 7461           timesta
-0000e4f0: 6d70 3a20 4465 6661 756c 7473 2074 6f20  mp: Defaults to 
-0000e500: 3230 3139 2d31 302d 3235 2066 6f72 2063  2019-10-25 for c
-0000e510: 6f6e 7369 7374 656e 7420 6861 7368 2e0a  onsistent hash..
-0000e520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e530: 4966 204e 6f6e 6520 7573 6573 2063 7572  If None uses cur
-0000e540: 7265 6e74 2074 696d 652e 0a20 2020 2020  rent time..     
-0000e550: 2020 2020 2020 206c 6f67 6769 6e67 3a20         logging: 
-0000e560: 6469 7361 626c 6520 4744 5320 7061 7468  disable GDS path
-0000e570: 206c 6f67 6769 6e67 2c20 666f 7220 6578   logging, for ex
-0000e580: 616d 706c 6520 666f 7220 7368 6f77 696e  ample for showin
-0000e590: 6720 6974 2069 6e20 4b4c 6179 6f75 742e  g it in KLayout.
-0000e5a0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-0000e5b0: 685f 6f61 7369 733a 2049 6620 5472 7565  h_oasis: If True
-0000e5c0: 2c20 6669 6c65 2077 696c 6c20 6265 2077  , file will be w
-0000e5d0: 7269 7474 656e 2074 6f20 4f41 5349 532e  ritten to OASIS.
-0000e5e0: 204f 7468 6572 7769 7365 2c20 6669 6c65   Otherwise, file
-0000e5f0: 2077 696c 6c20 6265 2077 7269 7474 656e   will be written
-0000e600: 2074 6f20 4744 532e 0a0a 2020 2020 2020   to GDS...      
-0000e610: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
-0000e620: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
-0000e630: 6f72 6420 6172 6775 6d65 6e74 7320 7769  ord arguments wi
-0000e640: 6c6c 206f 7665 7272 6964 6520 7468 6520  ll override the 
-0000e650: 6163 7469 7665 2050 444b 2773 2064 6566  active PDK's def
-0000e660: 6175 6c74 2047 6473 5772 6974 6553 6574  ault GdsWriteSet
-0000e670: 7469 6e67 7320 616e 6420 4f61 7369 7357  tings and OasisW
-0000e680: 7269 7465 5365 7474 696e 6773 2e0a 0a20  riteSettings... 
-0000e690: 2020 2020 2020 2020 2020 2047 6473 2073             Gds s
-0000e6a0: 6574 7469 6e67 733a 0a20 2020 2020 2020  ettings:.       
-0000e6b0: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
-0000e6c0: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
-0000e6d0: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
-0000e6e0: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
-0000e6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e700: 2070 7265 6369 7369 6f6e 3a20 666f 7220   precision: for 
-0000e710: 6469 6d65 6e73 696f 6e73 2069 6e20 7468  dimensions in th
-0000e720: 6520 6c69 6272 6172 7920 286d 292e 2031  e library (m). 1
-0000e730: 6e6d 2062 7920 6465 6661 756c 742e 0a20  nm by default.. 
-0000e740: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000e750: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
-0000e760: 3a20 7370 6563 6966 7920 686f 7720 746f  : specify how to
-0000e770: 2072 6573 6f6c 7665 2064 7570 6c69 6361   resolve duplica
-0000e780: 7465 2d6e 616d 6564 2063 656c 6c73 2e20  te-named cells. 
-0000e790: 4368 6f6f 7365 206f 6e65 206f 6620 7468  Choose one of th
-0000e7a0: 6520 666f 6c6c 6f77 696e 673a 0a20 2020  e following:.   
-0000e7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e7c0: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
-0000e7d0: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
-0000e7e0: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-0000e7f0: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
-0000e800: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
-0000e810: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
-0000e820: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000e830: 6572 726f 7222 3a20 7468 726f 7720 6120  error": throw a 
-0000e840: 5661 6c75 6545 7272 6f72 2077 6865 6e20  ValueError when 
-0000e850: 6174 7465 6d70 7469 6e67 2074 6f20 7772  attempting to wr
-0000e860: 6974 6520 6120 6764 7320 7769 7468 2064  ite a gds with d
-0000e870: 7570 6c69 6361 7465 2063 656c 6c73 2e0a  uplicate cells..
-0000e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e890: 2020 2020 226f 7665 7277 7269 7465 223a      "overwrite":
-0000e8a0: 206f 7665 7277 7269 7465 2061 6c6c 2064   overwrite all d
-0000e8b0: 7570 6c69 6361 7465 2063 656c 6c73 2077  uplicate cells w
-0000e8c0: 6974 6820 6f6e 6520 6f66 2074 6865 2064  ith one of the d
-0000e8d0: 7570 6c69 6361 7465 732c 2077 6974 686f  uplicates, witho
-0000e8e0: 7574 2077 6172 6e69 6e67 2e0a 2020 2020  ut warning..    
-0000e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e900: 4e6f 6e65 3a20 646f 206e 6f74 2074 7279  None: do not try
-0000e910: 2074 6f20 7265 736f 6c76 6520 2861 7420   to resolve (at 
-0000e920: 796f 7572 206f 776e 2072 6973 6b21 290a  your own risk!).
-0000e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e940: 666c 6174 7465 6e5f 696e 7661 6c69 645f  flatten_invalid_
-0000e950: 7265 6673 3a20 666c 6174 7465 6e73 2063  refs: flattens c
-0000e960: 6f6d 706f 6e65 6e74 2072 6566 6572 656e  omponent referen
-0000e970: 6365 7320 7768 6963 6820 6861 7665 2069  ces which have i
-0000e980: 6e76 616c 6964 2074 7261 6e73 666f 726d  nvalid transform
-0000e990: 6174 696f 6e73 2e0a 2020 2020 2020 2020  ations..        
-0000e9a0: 2020 2020 2020 2020 6d61 785f 706f 696e          max_poin
-0000e9b0: 7473 3a20 4d61 7869 6d61 6c20 6e75 6d62  ts: Maximal numb
-0000e9c0: 6572 206f 6620 7665 7274 6963 6573 2070  er of vertices p
-0000e9d0: 6572 2070 6f6c 7967 6f6e 2e20 506f 6c79  er polygon. Poly
-0000e9e0: 676f 6e73 2077 6974 6820 6d6f 7265 2076  gons with more v
-0000e9f0: 6572 7469 6365 7320 7468 6174 2074 6869  ertices that thi
-0000ea00: 7320 6172 6520 6175 746f 6d61 7469 6361  s are automatica
-0000ea10: 6c6c 7920 6672 6163 7475 7265 642e 0a0a  lly fractured...
-0000ea20: 2020 2020 2020 2020 2020 2020 4f61 7369              Oasi
-0000ea30: 7320 7365 7474 696e 6773 3a0a 2020 2020  s settings:.    
-0000ea40: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-0000ea50: 7265 7373 696f 6e5f 6c65 7665 6c3a 204c  ression_level: L
-0000ea60: 6576 656c 206f 6620 636f 6d70 7265 7373  evel of compress
-0000ea70: 696f 6e20 666f 7220 6365 6c6c 7320 2862  ion for cells (b
-0000ea80: 6574 7765 656e 2030 2061 6e64 2039 292e  etween 0 and 9).
-0000ea90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000eaa0: 2020 2020 2053 6574 7469 6e67 2074 6f20       Setting to 
-0000eab0: 3020 7769 6c6c 2064 6973 6162 6c65 2063  0 will disable c
-0000eac0: 656c 6c20 636f 6d70 7265 7373 696f 6e2c  ell compression,
-0000ead0: 2031 2067 6976 6573 2074 6865 2062 6573   1 gives the bes
-0000eae0: 7420 7370 6565 6420 616e 6420 392c 2074  t speed and 9, t
-0000eaf0: 6865 2062 6573 7420 636f 6d70 7265 7373  he best compress
-0000eb00: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
-0000eb10: 2020 2020 2064 6574 6563 745f 7265 6374       detect_rect
-0000eb20: 616e 676c 6573 3a20 5374 6f72 6520 7265  angles: Store re
-0000eb30: 6374 616e 676c 6573 2069 6e20 636f 6d70  ctangles in comp
-0000eb40: 7265 7373 6564 2066 6f72 6d61 742e 0a20  ressed format.. 
-0000eb50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000eb60: 6574 6563 745f 7472 6170 657a 6f69 6473  etect_trapezoids
-0000eb70: 3a20 5374 6f72 6520 7472 6170 657a 6f69  : Store trapezoi
-0000eb80: 6473 2069 6e20 636f 6d70 7265 7373 6564  ds in compressed
-0000eb90: 2066 6f72 6d61 742e 0a20 2020 2020 2020   format..       
-0000eba0: 2020 2020 2020 2020 2063 6972 636c 655f           circle_
-0000ebb0: 746f 6c65 7261 6e63 653a 2054 6f6c 6572  tolerance: Toler
-0000ebc0: 616e 6365 2066 6f72 2064 6574 6563 7469  ance for detecti
-0000ebd0: 6e67 2063 6972 636c 6573 2e20 4966 206c  ng circles. If l
-0000ebe0: 6573 7320 6f72 2065 7175 616c 2074 6f20  ess or equal to 
-0000ebf0: 302c 206e 6f20 6465 7465 6374 696f 6e20  0, no detection 
-0000ec00: 6973 2070 6572 666f 726d 6564 2e20 4369  is performed. Ci
-0000ec10: 7263 6c65 7320 6172 6520 7374 6f72 6564  rcles are stored
-0000ec20: 2069 6e20 636f 6d70 7265 7373 6564 2066   in compressed f
-0000ec30: 6f72 6d61 742e 0a20 2020 2020 2020 2020  ormat..         
-0000ec40: 2020 2020 2020 2076 616c 6964 6174 696f         validatio
-0000ec50: 6e20 2822 6372 6333 3222 2c20 2263 6865  n ("crc32", "che
-0000ec60: 636b 7375 6d33 3222 2c20 4e6f 6e65 293a  cksum32", None):
-0000ec70: 2074 7970 6520 6f66 2076 616c 6964 6174   type of validat
-0000ec80: 696f 6e20 746f 2069 6e63 6c75 6465 2069  ion to include i
-0000ec90: 6e20 7468 6520 7361 7665 6420 6669 6c65  n the saved file
-0000eca0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000ecb0: 2020 7374 616e 6461 7264 5f70 726f 7065    standard_prope
-0000ecc0: 7274 6965 733a 2053 746f 7265 2073 7461  rties: Store sta
-0000ecd0: 6e64 6172 6420 4f41 5349 5320 7072 6f70  ndard OASIS prop
-0000ece0: 6572 7469 6573 2069 6e20 7468 6520 6669  erties in the fi
-0000ecf0: 6c65 2e0a 0a20 2020 2020 2020 2022 2222  le...        """
-0000ed00: 0a0a 2020 2020 2020 2020 6672 6f6d 2067  ..        from g
-0000ed10: 6473 6661 6374 6f72 792e 7064 6b20 696d  dsfactory.pdk im
-0000ed20: 706f 7274 2067 6574 5f61 6374 6976 655f  port get_active_
-0000ed30: 7064 6b0a 0a20 2020 2020 2020 2069 6620  pdk..        if 
-0000ed40: 6764 7370 6174 6820 616e 6420 6764 7364  gdspath and gdsd
-0000ed50: 6972 3a0a 2020 2020 2020 2020 2020 2020  ir:.            
-0000ed60: 7761 726e 696e 6773 2e77 6172 6e28 0a20  warnings.warn(. 
-0000ed70: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000ed80: 6764 7370 6174 6820 616e 6420 6764 7364  gdspath and gdsd
-0000ed90: 6972 2068 6176 6520 626f 7468 2062 6565  ir have both bee
-0000eda0: 6e20 7370 6563 6966 6965 642e 2067 6473  n specified. gds
-0000edb0: 7061 7468 2077 696c 6c20 7461 6b65 2070  path will take p
-0000edc0: 7265 6365 6465 6e63 6520 616e 6420 6764  recedence and gd
-0000edd0: 7364 6972 2077 696c 6c20 6265 2069 676e  sdir will be ign
-0000ede0: 6f72 6564 2e22 0a20 2020 2020 2020 2020  ored.".         
-0000edf0: 2020 2029 0a0a 2020 2020 2020 2020 6465     )..        de
-0000ee00: 6661 756c 745f 7365 7474 696e 6773 203d  fault_settings =
-0000ee10: 2067 6574 5f61 6374 6976 655f 7064 6b28   get_active_pdk(
-0000ee20: 292e 6764 735f 7772 6974 655f 7365 7474  ).gds_write_sett
-0000ee30: 696e 6773 0a20 2020 2020 2020 2064 6566  ings.        def
-0000ee40: 6175 6c74 5f6f 6173 6973 5f73 6574 7469  ault_oasis_setti
-0000ee50: 6e67 7320 3d20 6765 745f 6163 7469 7665  ngs = get_active
-0000ee60: 5f70 646b 2829 2e6f 6173 6973 5f73 6574  _pdk().oasis_set
-0000ee70: 7469 6e67 730a 0a20 2020 2020 2020 2065  tings..        e
-0000ee80: 7870 6c69 6369 745f 6764 735f 7365 7474  xplicit_gds_sett
-0000ee90: 696e 6773 203d 207b 0a20 2020 2020 2020  ings = {.       
-0000eea0: 2020 2020 206b 3a20 760a 2020 2020 2020       k: v.      
-0000eeb0: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
-0000eec0: 6e20 6b77 6172 6773 2e69 7465 6d73 2829  n kwargs.items()
-0000eed0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000eee0: 7620 6973 206e 6f74 204e 6f6e 6520 616e  v is not None an
-0000eef0: 6420 6b20 696e 2064 6566 6175 6c74 5f73  d k in default_s
-0000ef00: 6574 7469 6e67 732e 6469 6374 2829 0a20  ettings.dict(). 
-0000ef10: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-0000ef20: 2065 7870 6c69 6369 745f 6f61 735f 7365   explicit_oas_se
-0000ef30: 7474 696e 6773 203d 207b 0a20 2020 2020  ttings = {.     
-0000ef40: 2020 2020 2020 206b 3a20 760a 2020 2020         k: v.    
-0000ef50: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-0000ef60: 2069 6e20 6b77 6172 6773 2e69 7465 6d73   in kwargs.items
-0000ef70: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
-0000ef80: 6620 7620 6973 206e 6f74 204e 6f6e 6520  f v is not None 
-0000ef90: 616e 6420 6b20 696e 2064 6566 6175 6c74  and k in default
-0000efa0: 5f6f 6173 6973 5f73 6574 7469 6e67 732e  _oasis_settings.
-0000efb0: 6469 6374 2829 0a20 2020 2020 2020 207d  dict().        }
-0000efc0: 0a20 2020 2020 2020 2023 2075 7064 6174  .        # updat
-0000efd0: 6520 7468 6520 7772 6974 6520 7365 7474  e the write sett
-0000efe0: 696e 6773 2077 6974 6820 616e 7920 7365  ings with any se
-0000eff0: 7474 696e 6773 2065 7870 6c69 6369 746c  ttings explicitl
-0000f000: 7920 7061 7373 6564 0a20 2020 2020 2020  y passed.       
-0000f010: 2077 7269 7465 5f73 6574 7469 6e67 7320   write_settings 
-0000f020: 3d20 6465 6661 756c 745f 7365 7474 696e  = default_settin
-0000f030: 6773 2e63 6f70 7928 7570 6461 7465 3d65  gs.copy(update=e
-0000f040: 7870 6c69 6369 745f 6764 735f 7365 7474  xplicit_gds_sett
-0000f050: 696e 6773 290a 2020 2020 2020 2020 6f61  ings).        oa
-0000f060: 7369 735f 7365 7474 696e 6773 203d 2064  sis_settings = d
-0000f070: 6566 6175 6c74 5f6f 6173 6973 5f73 6574  efault_oasis_set
-0000f080: 7469 6e67 732e 636f 7079 2875 7064 6174  tings.copy(updat
-0000f090: 653d 6578 706c 6963 6974 5f6f 6173 5f73  e=explicit_oas_s
-0000f0a0: 6574 7469 6e67 7329 0a0a 2020 2020 2020  ettings)..      
-0000f0b0: 2020 5f63 6865 636b 5f75 6e63 6163 6865    _check_uncache
-0000f0c0: 645f 636f 6d70 6f6e 656e 7473 280a 2020  d_components(.  
-0000f0d0: 2020 2020 2020 2020 2020 636f 6d70 6f6e            compon
-0000f0e0: 656e 743d 7365 6c66 2c20 6d6f 6465 3d77  ent=self, mode=w
-0000f0f0: 7269 7465 5f73 6574 7469 6e67 732e 6f6e  rite_settings.on
-0000f100: 5f75 6e63 6163 6865 645f 636f 6d70 6f6e  _uncached_compon
-0000f110: 656e 740a 2020 2020 2020 2020 290a 0a20  ent.        ).. 
-0000f120: 2020 2020 2020 2069 6620 7772 6974 655f         if write_
-0000f130: 7365 7474 696e 6773 2e66 6c61 7474 656e  settings.flatten
-0000f140: 5f69 6e76 616c 6964 5f72 6566 733a 0a20  _invalid_refs:. 
-0000f150: 2020 2020 2020 2020 2020 2074 6f70 5f63             top_c
-0000f160: 656c 6c20 3d20 666c 6174 7465 6e5f 696e  ell = flatten_in
-0000f170: 7661 6c69 645f 7265 6673 5f72 6563 7572  valid_refs_recur
-0000f180: 7369 7665 2873 656c 6629 0a20 2020 2020  sive(self).     
-0000f190: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000f1a0: 2020 2020 2074 6f70 5f63 656c 6c20 3d20       top_cell = 
-0000f1b0: 7365 6c66 0a0a 2020 2020 2020 2020 6764  self..        gd
-0000f1c0: 7364 6972 203d 2067 6473 6469 7220 6f72  sdir = gdsdir or
-0000f1d0: 2047 4453 4449 525f 5445 4d50 0a20 2020   GDSDIR_TEMP.   
-0000f1e0: 2020 2020 2067 6473 6469 7220 3d20 7061       gdsdir = pa
-0000f1f0: 7468 6c69 622e 5061 7468 2867 6473 6469  thlib.Path(gdsdi
-0000f200: 7229 0a20 2020 2020 2020 2069 6620 7769  r).        if wi
-0000f210: 7468 5f6f 6173 6973 3a0a 2020 2020 2020  th_oasis:.      
-0000f220: 2020 2020 2020 6764 7370 6174 6820 3d20        gdspath = 
-0000f230: 6764 7370 6174 6820 6f72 2067 6473 6469  gdspath or gdsdi
-0000f240: 7220 2f20 6622 7b74 6f70 5f63 656c 6c2e  r / f"{top_cell.
-0000f250: 6e61 6d65 7d2e 6f61 7322 0a20 2020 2020  name}.oas".     
-0000f260: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000f270: 2020 2020 2067 6473 7061 7468 203d 2067       gdspath = g
-0000f280: 6473 7061 7468 206f 7220 6764 7364 6972  dspath or gdsdir
-0000f290: 202f 2066 227b 746f 705f 6365 6c6c 2e6e   / f"{top_cell.n
-0000f2a0: 616d 657d 2e67 6473 220a 2020 2020 2020  ame}.gds".      
-0000f2b0: 2020 6764 7370 6174 6820 3d20 7061 7468    gdspath = path
-0000f2c0: 6c69 622e 5061 7468 2867 6473 7061 7468  lib.Path(gdspath
-0000f2d0: 290a 2020 2020 2020 2020 6764 7364 6972  ).        gdsdir
-0000f2e0: 203d 2067 6473 7061 7468 2e70 6172 656e   = gdspath.paren
-0000f2f0: 740a 2020 2020 2020 2020 6764 7364 6972  t.        gdsdir
-0000f300: 2e6d 6b64 6972 2865 7869 7374 5f6f 6b3d  .mkdir(exist_ok=
-0000f310: 5472 7565 2c20 7061 7265 6e74 733d 5472  True, parents=Tr
-0000f320: 7565 290a 0a20 2020 2020 2020 2063 656c  ue)..        cel
-0000f330: 6c73 203d 2074 6f70 5f63 656c 6c2e 6765  ls = top_cell.ge
-0000f340: 745f 6465 7065 6e64 656e 6369 6573 2872  t_dependencies(r
-0000f350: 6563 7572 7369 7665 3d54 7275 6529 0a20  ecursive=True). 
-0000f360: 2020 2020 2020 2063 656c 6c5f 6e61 6d65         cell_name
-0000f370: 7320 3d20 5b63 656c 6c2e 6e61 6d65 2066  s = [cell.name f
-0000f380: 6f72 2063 656c 6c20 696e 206c 6973 7428  or cell in list(
-0000f390: 6365 6c6c 7329 5d0a 2020 2020 2020 2020  cells)].        
-0000f3a0: 6365 6c6c 5f6e 616d 6573 5f75 6e69 7175  cell_names_uniqu
-0000f3b0: 6520 3d20 7365 7428 6365 6c6c 5f6e 616d  e = set(cell_nam
-0000f3c0: 6573 290a 0a20 2020 2020 2020 2069 6620  es)..        if 
-0000f3d0: 6c65 6e28 6365 6c6c 5f6e 616d 6573 2920  len(cell_names) 
-0000f3e0: 213d 206c 656e 2873 6574 2863 656c 6c5f  != len(set(cell_
-0000f3f0: 6e61 6d65 7329 293a 0a20 2020 2020 2020  names)):.       
-0000f400: 2020 2020 2066 6f72 2063 656c 6c5f 6e61       for cell_na
-0000f410: 6d65 2069 6e20 6365 6c6c 5f6e 616d 6573  me in cell_names
-0000f420: 5f75 6e69 7175 653a 0a20 2020 2020 2020  _unique:.       
-0000f430: 2020 2020 2020 2020 2063 656c 6c5f 6e61           cell_na
-0000f440: 6d65 732e 7265 6d6f 7665 2863 656c 6c5f  mes.remove(cell_
-0000f450: 6e61 6d65 290a 0a20 2020 2020 2020 2020  name)..         
-0000f460: 2020 2069 6620 7772 6974 655f 7365 7474     if write_sett
-0000f470: 696e 6773 2e6f 6e5f 6475 706c 6963 6174  ings.on_duplicat
-0000f480: 655f 6365 6c6c 203d 3d20 2265 7272 6f72  e_cell == "error
-0000f490: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0000f4a0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000f4b0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000f4c0: 2020 2020 2020 2020 2066 2244 7570 6c69           f"Dupli
-0000f4d0: 6361 7465 6420 6365 6c6c 206e 616d 6573  cated cell names
-0000f4e0: 2069 6e20 7b74 6f70 5f63 656c 6c2e 6e61   in {top_cell.na
-0000f4f0: 6d65 2172 7d3a 207b 6365 6c6c 5f6e 616d  me!r}: {cell_nam
-0000f500: 6573 2172 7d22 0a20 2020 2020 2020 2020  es!r}".         
-0000f510: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000f520: 2020 2020 2065 6c69 6620 7772 6974 655f       elif write_
-0000f530: 7365 7474 696e 6773 2e6f 6e5f 6475 706c  settings.on_dupl
-0000f540: 6963 6174 655f 6365 6c6c 2069 6e20 7b22  icate_cell in {"
-0000f550: 7761 726e 222c 2022 6f76 6572 7772 6974  warn", "overwrit
-0000f560: 6522 7d3a 0a20 2020 2020 2020 2020 2020  e"}:.           
-0000f570: 2020 2020 2069 6620 7772 6974 655f 7365       if write_se
-0000f580: 7474 696e 6773 2e6f 6e5f 6475 706c 6963  ttings.on_duplic
-0000f590: 6174 655f 6365 6c6c 203d 3d20 2277 6172  ate_cell == "war
-0000f5a0: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
-0000f5b0: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
-0000f5c0: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
-0000f5d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000f5e0: 2244 7570 6c69 6361 7465 6420 6365 6c6c  "Duplicated cell
-0000f5f0: 206e 616d 6573 2069 6e20 7b74 6f70 5f63   names in {top_c
-0000f600: 656c 6c2e 6e61 6d65 2172 7d3a 2020 7b63  ell.name!r}:  {c
-0000f610: 656c 6c5f 6e61 6d65 737d 222c 0a20 2020  ell_names}",.   
-0000f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f630: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000f640: 2020 2063 656c 6c73 5f64 6963 7420 3d20     cells_dict = 
-0000f650: 7b63 656c 6c2e 6e61 6d65 3a20 6365 6c6c  {cell.name: cell
-0000f660: 2e5f 6365 6c6c 2066 6f72 2063 656c 6c20  ._cell for cell 
-0000f670: 696e 2063 656c 6c73 7d0a 2020 2020 2020  in cells}.      
-0000f680: 2020 2020 2020 2020 2020 6365 6c6c 7320            cells 
-0000f690: 3d20 6365 6c6c 735f 6469 6374 2e76 616c  = cells_dict.val
-0000f6a0: 7565 7328 290a 2020 2020 2020 2020 2020  ues().          
-0000f6b0: 2020 656c 6966 2077 7269 7465 5f73 6574    elif write_set
-0000f6c0: 7469 6e67 732e 6f6e 5f64 7570 6c69 6361  tings.on_duplica
-0000f6d0: 7465 5f63 656c 6c20 6973 206e 6f74 204e  te_cell is not N
-0000f6e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000f6f0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0000f700: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000f710: 2020 2020 2020 2020 2020 2066 226f 6e5f             f"on_
-0000f720: 6475 706c 6963 6174 655f 6365 6c6c 3a20  duplicate_cell: 
-0000f730: 7b77 7269 7465 5f73 6574 7469 6e67 732e  {write_settings.
-0000f740: 6f6e 5f64 7570 6c69 6361 7465 5f63 656c  on_duplicate_cel
-0000f750: 6c21 727d 206e 6f74 2069 6e20 284e 6f6e  l!r} not in (Non
-0000f760: 652c 2077 6172 6e2c 2065 7272 6f72 2c20  e, warn, error, 
-0000f770: 6f76 6572 7772 6974 6529 220a 2020 2020  overwrite)".    
-0000f780: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000f790: 2020 2020 2020 2061 6c6c 5f63 656c 6c73         all_cells
-0000f7a0: 203d 205b 746f 705f 6365 6c6c 2e5f 6365   = [top_cell._ce
-0000f7b0: 6c6c 5d20 2b20 736f 7274 6564 2863 656c  ll] + sorted(cel
-0000f7c0: 6c73 2c20 6b65 793d 6c61 6d62 6461 2063  ls, key=lambda c
-0000f7d0: 633a 2063 632e 6e61 6d65 290a 0a20 2020  c: cc.name)..   
-0000f7e0: 2020 2020 206e 6f5f 6e61 6d65 5f63 656c       no_name_cel
-0000f7f0: 6c73 203d 205b 0a20 2020 2020 2020 2020  ls = [.         
-0000f800: 2020 2063 656c 6c2e 6e61 6d65 2066 6f72     cell.name for
-0000f810: 2063 656c 6c20 696e 2061 6c6c 5f63 656c   cell in all_cel
-0000f820: 6c73 2069 6620 6365 6c6c 2e6e 616d 652e  ls if cell.name.
-0000f830: 7374 6172 7473 7769 7468 2822 556e 6e61  startswith("Unna
-0000f840: 6d65 6422 290a 2020 2020 2020 2020 5d0a  med").        ].
-0000f850: 0a20 2020 2020 2020 2069 6620 6e6f 5f6e  .        if no_n
-0000f860: 616d 655f 6365 6c6c 733a 0a20 2020 2020  ame_cells:.     
-0000f870: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
-0000f880: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
-0000f890: 2020 2020 2020 6622 436f 6d70 6f6e 656e        f"Componen
-0000f8a0: 7420 7b74 6f70 5f63 656c 6c2e 6e61 6d65  t {top_cell.name
-0000f8b0: 2172 7d20 636f 6e74 6169 6e73 207b 6c65  !r} contains {le
-0000f8c0: 6e28 6e6f 5f6e 616d 655f 6365 6c6c 7329  n(no_name_cells)
-0000f8d0: 7d20 556e 6e61 6d65 6420 6365 6c6c 7322  } Unnamed cells"
-0000f8e0: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-0000f8f0: 2020 2020 2020 2020 2320 666f 7220 6365          # for ce
-0000f900: 6c6c 2069 6e20 616c 6c5f 6365 6c6c 733a  ll in all_cells:
-0000f910: 0a20 2020 2020 2020 2023 2020 2020 2070  .        #     p
-0000f920: 7269 6e74 2863 656c 6c2e 6e61 6d65 2c20  rint(cell.name, 
-0000f930: 7479 7065 2863 656c 6c29 290a 0a20 2020  type(cell))..   
-0000f940: 2020 2020 206c 6962 203d 2067 6473 746b       lib = gdstk
-0000f950: 2e4c 6962 7261 7279 280a 2020 2020 2020  .Library(.      
-0000f960: 2020 2020 2020 756e 6974 3d77 7269 7465        unit=write
-0000f970: 5f73 6574 7469 6e67 732e 756e 6974 2c20  _settings.unit, 
-0000f980: 7072 6563 6973 696f 6e3d 7772 6974 655f  precision=write_
-0000f990: 7365 7474 696e 6773 2e70 7265 6369 7369  settings.precisi
-0000f9a0: 6f6e 0a20 2020 2020 2020 2029 0a20 2020  on.        ).   
-0000f9b0: 2020 2020 206c 6962 2e61 6464 2874 6f70       lib.add(top
-0000f9c0: 5f63 656c 6c2e 5f63 656c 6c29 0a20 2020  _cell._cell).   
-0000f9d0: 2020 2020 206c 6962 2e61 6464 282a 746f       lib.add(*to
-0000f9e0: 705f 6365 6c6c 2e5f 6365 6c6c 2e64 6570  p_cell._cell.dep
-0000f9f0: 656e 6465 6e63 6965 7328 5472 7565 2929  endencies(True))
-0000fa00: 0a0a 2020 2020 2020 2020 6966 2077 6974  ..        if wit
-0000fa10: 685f 6f61 7369 733a 0a20 2020 2020 2020  h_oasis:.       
-0000fa20: 2020 2020 206c 6962 2e77 7269 7465 5f6f       lib.write_o
-0000fa30: 6173 2867 6473 7061 7468 2c20 2a2a 6f61  as(gdspath, **oa
-0000fa40: 7369 735f 7365 7474 696e 6773 2e64 6963  sis_settings.dic
-0000fa50: 7428 2929 0a20 2020 2020 2020 2065 6c73  t()).        els
-0000fa60: 653a 0a20 2020 2020 2020 2020 2020 206c  e:.            l
-0000fa70: 6962 2e77 7269 7465 5f67 6473 280a 2020  ib.write_gds(.  
-0000fa80: 2020 2020 2020 2020 2020 2020 2020 6764                gd
-0000fa90: 7370 6174 682c 2074 696d 6573 7461 6d70  spath, timestamp
-0000faa0: 3d74 696d 6573 7461 6d70 2c20 6d61 785f  =timestamp, max_
-0000fab0: 706f 696e 7473 3d77 7269 7465 5f73 6574  points=write_set
-0000fac0: 7469 6e67 732e 6d61 785f 706f 696e 7473  tings.max_points
-0000fad0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000fae0: 2020 2020 2020 2069 6620 6c6f 6767 696e         if loggin
-0000faf0: 673a 0a20 2020 2020 2020 2020 2020 206c  g:.            l
-0000fb00: 6f67 6765 722e 696e 666f 2866 2257 726f  ogger.info(f"Wro
-0000fb10: 7465 2074 6f20 7b73 7472 2867 6473 7061  te to {str(gdspa
-0000fb20: 7468 2921 727d 2229 0a20 2020 2020 2020  th)!r}").       
-0000fb30: 2072 6574 7572 6e20 6764 7370 6174 680a   return gdspath.
-0000fb40: 0a20 2020 2064 6566 2077 7269 7465 5f67  .    def write_g
-0000fb50: 6473 280a 2020 2020 2020 2020 7365 6c66  ds(.        self
-0000fb60: 2c0a 2020 2020 2020 2020 6764 7370 6174  ,.        gdspat
-0000fb70: 683a 204f 7074 696f 6e61 6c5b 5061 7468  h: Optional[Path
-0000fb80: 5479 7065 5d20 3d20 4e6f 6e65 2c0a 2020  Type] = None,.  
-0000fb90: 2020 2020 2020 6764 7364 6972 3a20 4f70        gdsdir: Op
-0000fba0: 7469 6f6e 616c 5b50 6174 6854 7970 655d  tional[PathType]
-0000fbb0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-0000fbc0: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
-0000fbd0: 202d 3e20 5061 7468 3a0a 2020 2020 2020   -> Path:.      
-0000fbe0: 2020 2222 2257 7269 7465 2063 6f6d 706f    """Write compo
-0000fbf0: 6e65 6e74 2074 6f20 4744 5320 616e 6420  nent to GDS and 
-0000fc00: 7265 7475 726e 7320 6764 7370 6174 682e  returns gdspath.
-0000fc10: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
-0000fc20: 2020 2020 2020 2020 2020 2020 6764 7370              gdsp
-0000fc30: 6174 683a 2047 4453 2066 696c 6520 7061  ath: GDS file pa
-0000fc40: 7468 2074 6f20 7772 6974 6520 746f 2e0a  th to write to..
-0000fc50: 2020 2020 2020 2020 2020 2020 6764 7364              gdsd
-0000fc60: 6972 3a20 6469 7265 6374 6f72 7920 666f  ir: directory fo
-0000fc70: 7220 7468 6520 4744 5320 6669 6c65 2e20  r the GDS file. 
-0000fc80: 4465 6661 756c 7473 2074 6f20 2f74 6d70  Defaults to /tmp
-0000fc90: 2f72 616e 646f 6d46 696c 652f 6764 7366  /randomFile/gdsf
-0000fca0: 6163 746f 7279 2e0a 0a20 2020 2020 2020  actory...       
-0000fcb0: 204b 6579 776f 7264 2041 7267 733a 0a20   Keyword Args:. 
-0000fcc0: 2020 2020 2020 2020 2020 2075 6e69 743a             unit:
-0000fcd0: 2075 6e69 7420 7369 7a65 2066 6f72 206f   unit size for o
-0000fce0: 626a 6563 7473 2069 6e20 6c69 6272 6172  bjects in librar
-0000fcf0: 792e 2031 756d 2062 7920 6465 6661 756c  y. 1um by defaul
-0000fd00: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
-0000fd10: 7265 6369 7369 6f6e 3a20 666f 7220 6469  recision: for di
-0000fd20: 6d65 6e73 696f 6e73 2069 6e20 7468 6520  mensions in the 
-0000fd30: 6c69 6272 6172 7920 286d 292e 2031 6e6d  library (m). 1nm
-0000fd40: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
-0000fd50: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
-0000fd60: 3a20 6469 7361 626c 6520 4744 5320 7061  : disable GDS pa
-0000fd70: 7468 206c 6f67 6769 6e67 2c20 666f 7220  th logging, for 
-0000fd80: 6578 616d 706c 6520 666f 7220 7368 6f77  example for show
-0000fd90: 696e 6720 6974 2069 6e20 4b4c 6179 6f75  ing it in KLayou
-0000fda0: 742e 0a20 2020 2020 2020 2020 2020 206f  t..            o
-0000fdb0: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
-0000fdc0: 3a20 7370 6563 6966 7920 686f 7720 746f  : specify how to
-0000fdd0: 2072 6573 6f6c 7665 2064 7570 6c69 6361   resolve duplica
-0000fde0: 7465 2d6e 616d 6564 2063 656c 6c73 2e20  te-named cells. 
-0000fdf0: 4368 6f6f 7365 206f 6e65 206f 6620 7468  Choose one of th
-0000fe00: 6520 666f 6c6c 6f77 696e 673a 0a20 2020  e following:.   
-0000fe10: 2020 2020 2020 2020 2020 2020 2022 7761               "wa
-0000fe20: 726e 2220 2864 6566 6175 6c74 293a 206f  rn" (default): o
-0000fe30: 7665 7277 7269 7465 2061 6c6c 2064 7570  verwrite all dup
-0000fe40: 6c69 6361 7465 2063 656c 6c73 2077 6974  licate cells wit
-0000fe50: 6820 6f6e 6520 6f66 2074 6865 2064 7570  h one of the dup
-0000fe60: 6c69 6361 7465 7320 2861 7262 6974 7261  licates (arbitra
-0000fe70: 7269 6c79 292e 0a20 2020 2020 2020 2020  rily)..         
-0000fe80: 2020 2020 2020 2022 6572 726f 7222 3a20         "error": 
-0000fe90: 7468 726f 7720 6120 5661 6c75 6545 7272  throw a ValueErr
-0000fea0: 6f72 2077 6865 6e20 6174 7465 6d70 7469  or when attempti
-0000feb0: 6e67 2074 6f20 7772 6974 6520 6120 6764  ng to write a gd
-0000fec0: 7320 7769 7468 2064 7570 6c69 6361 7465  s with duplicate
-0000fed0: 2063 656c 6c73 2e0a 2020 2020 2020 2020   cells..        
-0000fee0: 2020 2020 2020 2020 226f 7665 7277 7269          "overwri
-0000fef0: 7465 223a 206f 7665 7277 7269 7465 2061  te": overwrite a
-0000ff00: 6c6c 2064 7570 6c69 6361 7465 2063 656c  ll duplicate cel
-0000ff10: 6c73 2077 6974 6820 6f6e 6520 6f66 2074  ls with one of t
-0000ff20: 6865 2064 7570 6c69 6361 7465 732c 2077  he duplicates, w
-0000ff30: 6974 686f 7574 2077 6172 6e69 6e67 2e0a  ithout warning..
-0000ff40: 2020 2020 2020 2020 2020 2020 6f6e 5f75              on_u
-0000ff50: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
-0000ff60: 743a 204c 6974 6572 616c 5b22 7761 726e  t: Literal["warn
-0000ff70: 222c 2022 6572 726f 7222 5d20 3d20 2277  ", "error"] = "w
-0000ff80: 6172 6e22 0a20 2020 2020 2020 2020 2020  arn".           
-0000ff90: 2066 6c61 7474 656e 5f69 6e76 616c 6964   flatten_invalid
-0000ffa0: 5f72 6566 733a 2066 6c61 7474 656e 7320  _refs: flattens 
-0000ffb0: 636f 6d70 6f6e 656e 7420 7265 6665 7265  component refere
-0000ffc0: 6e63 6573 2077 6869 6368 2068 6176 6520  nces which have 
-0000ffd0: 696e 7661 6c69 6420 7472 616e 7366 6f72  invalid transfor
-0000ffe0: 6d61 7469 6f6e 732e 0a20 2020 2020 2020  mations..       
-0000fff0: 2020 2020 206d 6178 5f70 6f69 6e74 733a       max_points:
-00010000: 204d 6178 696d 616c 206e 756d 6265 7220   Maximal number 
-00010010: 6f66 2076 6572 7469 6365 7320 7065 7220  of vertices per 
-00010020: 706f 6c79 676f 6e2e 0a20 2020 2020 2020  polygon..       
-00010030: 2020 2020 2020 2020 2050 6f6c 7967 6f6e           Polygon
-00010040: 7320 7769 7468 206d 6f72 6520 7665 7274  s with more vert
-00010050: 6963 6573 2074 6861 7420 7468 6973 2061  ices that this a
-00010060: 7265 2061 7574 6f6d 6174 6963 616c 6c79  re automatically
-00010070: 2066 7261 6374 7572 6564 2e0a 2020 2020   fractured..    
-00010080: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00010090: 2072 6574 7572 6e20 7365 6c66 2e5f 7772   return self._wr
-000100a0: 6974 655f 6c69 6272 6172 7928 0a20 2020  ite_library(.   
-000100b0: 2020 2020 2020 2020 2067 6473 7061 7468           gdspath
-000100c0: 3d67 6473 7061 7468 2c20 6764 7364 6972  =gdspath, gdsdir
-000100d0: 3d67 6473 6469 722c 2077 6974 685f 6f61  =gdsdir, with_oa
-000100e0: 7369 733d 4661 6c73 652c 202a 2a6b 7761  sis=False, **kwa
-000100f0: 7267 730a 2020 2020 2020 2020 290a 0a20  rgs.        ).. 
-00010100: 2020 2064 6566 2077 7269 7465 5f6f 6173     def write_oas
-00010110: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00010120: 2020 2020 2020 2020 6764 7370 6174 683a          gdspath:
-00010130: 204f 7074 696f 6e61 6c5b 5061 7468 5479   Optional[PathTy
-00010140: 7065 5d20 3d20 4e6f 6e65 2c0a 2020 2020  pe] = None,.    
-00010150: 2020 2020 6764 7364 6972 3a20 4f70 7469      gdsdir: Opti
-00010160: 6f6e 616c 5b50 6174 6854 7970 655d 203d  onal[PathType] =
-00010170: 204e 6f6e 652c 0a20 2020 2020 2020 202a   None,.        *
-00010180: 2a6b 7761 7267 732c 0a20 2020 2029 202d  *kwargs,.    ) -
-00010190: 3e20 5061 7468 3a0a 2020 2020 2020 2020  > Path:.        
-000101a0: 2222 2257 7269 7465 2063 6f6d 706f 6e65  """Write compone
-000101b0: 6e74 2074 6f20 4744 5320 616e 6420 7265  nt to GDS and re
-000101c0: 7475 726e 7320 6764 7370 6174 682e 0a0a  turns gdspath...
-000101d0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-000101e0: 2020 2020 2020 2020 2020 6764 7370 6174            gdspat
-000101f0: 683a 2047 4453 2066 696c 6520 7061 7468  h: GDS file path
-00010200: 2074 6f20 7772 6974 6520 746f 2e0a 2020   to write to..  
-00010210: 2020 2020 2020 2020 2020 6764 7364 6972            gdsdir
-00010220: 3a20 6469 7265 6374 6f72 7920 666f 7220  : directory for 
-00010230: 7468 6520 4744 5320 6669 6c65 2e20 4465  the GDS file. De
-00010240: 6661 756c 7473 2074 6f20 2f74 6d70 2f72  faults to /tmp/r
-00010250: 616e 646f 6d46 696c 652f 6764 7366 6163  andomFile/gdsfac
-00010260: 746f 7279 2e0a 0a20 2020 2020 2020 204b  tory...        K
-00010270: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-00010280: 2020 2020 2020 2020 2075 6e69 743a 2075           unit: u
-00010290: 6e69 7420 7369 7a65 2066 6f72 206f 626a  nit size for obj
-000102a0: 6563 7473 2069 6e20 6c69 6272 6172 792e  ects in library.
-000102b0: 2031 756d 2062 7920 6465 6661 756c 742e   1um by default.
-000102c0: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-000102d0: 6369 7369 6f6e 3a20 666f 7220 6469 6d65  cision: for dime
-000102e0: 6e73 696f 6e73 2069 6e20 7468 6520 6c69  nsions in the li
-000102f0: 6272 6172 7920 286d 292e 2031 6e6d 2062  brary (m). 1nm b
-00010300: 7920 6465 6661 756c 742e 0a20 2020 2020  y default..     
-00010310: 2020 2020 2020 206c 6f67 6769 6e67 3a20         logging: 
-00010320: 6469 7361 626c 6520 4744 5320 7061 7468  disable GDS path
-00010330: 206c 6f67 6769 6e67 2c20 666f 7220 6578   logging, for ex
-00010340: 616d 706c 6520 666f 7220 7368 6f77 696e  ample for showin
-00010350: 6720 6974 2069 6e20 4b4c 6179 6f75 742e  g it in KLayout.
-00010360: 0a20 2020 2020 2020 2020 2020 206f 6e5f  .            on_
-00010370: 6475 706c 6963 6174 655f 6365 6c6c 3a20  duplicate_cell: 
-00010380: 7370 6563 6966 7920 686f 7720 746f 2072  specify how to r
-00010390: 6573 6f6c 7665 2064 7570 6c69 6361 7465  esolve duplicate
-000103a0: 2d6e 616d 6564 2063 656c 6c73 2e20 4368  -named cells. Ch
-000103b0: 6f6f 7365 206f 6e65 206f 6620 7468 6520  oose one of the 
-000103c0: 666f 6c6c 6f77 696e 673a 0a20 2020 2020  following:.     
-000103d0: 2020 2020 2020 2020 2020 2022 7761 726e             "warn
-000103e0: 2220 2864 6566 6175 6c74 293a 206f 7665  " (default): ove
-000103f0: 7277 7269 7465 2061 6c6c 2064 7570 6c69  rwrite all dupli
-00010400: 6361 7465 2063 656c 6c73 2077 6974 6820  cate cells with 
-00010410: 6f6e 6520 6f66 2074 6865 2064 7570 6c69  one of the dupli
-00010420: 6361 7465 7320 2861 7262 6974 7261 7269  cates (arbitrari
-00010430: 6c79 292e 0a20 2020 2020 2020 2020 2020  ly)..           
-00010440: 2020 2020 2022 6572 726f 7222 3a20 7468       "error": th
-00010450: 726f 7720 6120 5661 6c75 6545 7272 6f72  row a ValueError
-00010460: 2077 6865 6e20 6174 7465 6d70 7469 6e67   when attempting
-00010470: 2074 6f20 7772 6974 6520 6120 6764 7320   to write a gds 
-00010480: 7769 7468 2064 7570 6c69 6361 7465 2063  with duplicate c
-00010490: 656c 6c73 2e0a 2020 2020 2020 2020 2020  ells..          
-000104a0: 2020 2020 2020 226f 7665 7277 7269 7465        "overwrite
-000104b0: 223a 206f 7665 7277 7269 7465 2061 6c6c  ": overwrite all
-000104c0: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
-000104d0: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
-000104e0: 2064 7570 6c69 6361 7465 732c 2077 6974   duplicates, wit
-000104f0: 686f 7574 2077 6172 6e69 6e67 2e0a 2020  hout warning..  
-00010500: 2020 2020 2020 2020 2020 2020 2020 4e6f                No
-00010510: 6e65 3a20 646f 206e 6f74 2074 7279 2074  ne: do not try t
-00010520: 6f20 7265 736f 6c76 6520 2861 7420 796f  o resolve (at yo
-00010530: 7572 206f 776e 2072 6973 6b21 290a 2020  ur own risk!).  
-00010540: 2020 2020 2020 2020 2020 6f6e 5f75 6e63            on_unc
-00010550: 6163 6865 645f 636f 6d70 6f6e 656e 743a  ached_component:
-00010560: 204c 6974 6572 616c 5b22 7761 726e 222c   Literal["warn",
-00010570: 2022 6572 726f 7222 5d20 3d20 2277 6172   "error"] = "war
-00010580: 6e22 0a20 2020 2020 2020 2020 2020 2066  n".            f
-00010590: 6c61 7474 656e 5f69 6e76 616c 6964 5f72  latten_invalid_r
-000105a0: 6566 733a 2066 6c61 7474 656e 7320 636f  efs: flattens co
-000105b0: 6d70 6f6e 656e 7420 7265 6665 7265 6e63  mponent referenc
-000105c0: 6573 2077 6869 6368 2068 6176 6520 696e  es which have in
-000105d0: 7661 6c69 6420 7472 616e 7366 6f72 6d61  valid transforma
-000105e0: 7469 6f6e 732e 0a20 2020 2020 2020 2020  tions..         
-000105f0: 2020 2063 6f6d 7072 6573 7369 6f6e 5f6c     compression_l
-00010600: 6576 656c 3a20 4c65 7665 6c20 6f66 2063  evel: Level of c
-00010610: 6f6d 7072 6573 7369 6f6e 2066 6f72 2063  ompression for c
-00010620: 656c 6c73 2028 6265 7477 6565 6e20 3020  ells (between 0 
-00010630: 616e 6420 3929 2e0a 2020 2020 2020 2020  and 9)..        
-00010640: 2020 2020 2020 2020 5365 7474 696e 6720          Setting 
-00010650: 746f 2030 2077 696c 6c20 6469 7361 626c  to 0 will disabl
-00010660: 6520 6365 6c6c 2063 6f6d 7072 6573 7369  e cell compressi
-00010670: 6f6e 2c20 3120 6769 7665 7320 7468 6520  on, 1 gives the 
-00010680: 6265 7374 2073 7065 6564 2061 6e64 2039  best speed and 9
-00010690: 2c20 7468 6520 6265 7374 2063 6f6d 7072  , the best compr
-000106a0: 6573 7369 6f6e 2e0a 2020 2020 2020 2020  ession..        
-000106b0: 2020 2020 6465 7465 6374 5f72 6563 7461      detect_recta
-000106c0: 6e67 6c65 733a 2053 746f 7265 2072 6563  ngles: Store rec
-000106d0: 7461 6e67 6c65 7320 696e 2063 6f6d 7072  tangles in compr
-000106e0: 6573 7365 6420 666f 726d 6174 2e0a 2020  essed format..  
-000106f0: 2020 2020 2020 2020 2020 6465 7465 6374            detect
-00010700: 5f74 7261 7065 7a6f 6964 733a 2053 746f  _trapezoids: Sto
-00010710: 7265 2074 7261 7065 7a6f 6964 7320 696e  re trapezoids in
-00010720: 2063 6f6d 7072 6573 7365 6420 666f 726d   compressed form
-00010730: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
-00010740: 6369 7263 6c65 5f74 6f6c 6572 616e 6365  circle_tolerance
-00010750: 3a20 546f 6c65 7261 6e63 6520 666f 7220  : Tolerance for 
-00010760: 6465 7465 6374 696e 6720 6369 7263 6c65  detecting circle
-00010770: 732e 2049 6620 6c65 7373 206f 7220 6571  s. If less or eq
-00010780: 7561 6c20 746f 2030 2c20 6e6f 2064 6574  ual to 0, no det
-00010790: 6563 7469 6f6e 2069 7320 7065 7266 6f72  ection is perfor
-000107a0: 6d65 642e 0a20 2020 2020 2020 2020 2020  med..           
-000107b0: 2020 2020 2043 6972 636c 6573 2061 7265       Circles are
-000107c0: 2073 746f 7265 6420 696e 2063 6f6d 7072   stored in compr
-000107d0: 6573 7365 6420 666f 726d 6174 2e0a 2020  essed format..  
-000107e0: 2020 2020 2020 2020 2020 7661 6c69 6461            valida
-000107f0: 7469 6f6e 2028 2263 7263 3332 222c 2022  tion ("crc32", "
-00010800: 6368 6563 6b73 756d 3332 222c 204e 6f6e  checksum32", Non
-00010810: 6529 20e2 8093 2074 7970 6520 6f66 2076  e) ... type of v
-00010820: 616c 6964 6174 696f 6e20 746f 2069 6e63  alidation to inc
-00010830: 6c75 6465 2069 6e20 7468 6520 7361 7665  lude in the save
-00010840: 6420 6669 6c65 2e0a 2020 2020 2020 2020  d file..        
-00010850: 2020 2020 7374 616e 6461 7264 5f70 726f      standard_pro
-00010860: 7065 7274 6965 733a 2053 746f 7265 2073  perties: Store s
-00010870: 7461 6e64 6172 6420 4f41 5349 5320 7072  tandard OASIS pr
-00010880: 6f70 6572 7469 6573 2069 6e20 7468 6520  operties in the 
-00010890: 6669 6c65 2e0a 2020 2020 2020 2020 2222  file..        ""
-000108a0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-000108b0: 2073 656c 662e 5f77 7269 7465 5f6c 6962   self._write_lib
-000108c0: 7261 7279 280a 2020 2020 2020 2020 2020  rary(.          
-000108d0: 2020 6764 7370 6174 683d 6764 7370 6174    gdspath=gdspat
-000108e0: 682c 0a20 2020 2020 2020 2020 2020 2067  h,.            g
-000108f0: 6473 6469 723d 6764 7364 6972 2c0a 2020  dsdir=gdsdir,.  
-00010900: 2020 2020 2020 2020 2020 7769 7468 5f6f            with_o
-00010910: 6173 6973 3d54 7275 652c 0a20 2020 2020  asis=True,.     
-00010920: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
-00010930: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00010940: 6465 6620 7772 6974 655f 6764 735f 7769  def write_gds_wi
-00010950: 7468 5f6d 6574 6164 6174 6128 7365 6c66  th_metadata(self
-00010960: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
-00010970: 7329 202d 3e20 5061 7468 3a0a 2020 2020  s) -> Path:.    
-00010980: 2020 2020 2222 2257 7269 7465 2063 6f6d      """Write com
-00010990: 706f 6e65 6e74 2069 6e20 4744 5320 616e  ponent in GDS an
-000109a0: 6420 6d65 7461 6461 7461 2028 636f 6d70  d metadata (comp
-000109b0: 6f6e 656e 7420 7365 7474 696e 6773 2920  onent settings) 
-000109c0: 696e 2059 414d 4c2e 2222 220a 2020 2020  in YAML.""".    
-000109d0: 2020 2020 6764 7370 6174 6820 3d20 7365      gdspath = se
-000109e0: 6c66 2e77 7269 7465 5f67 6473 282a 6172  lf.write_gds(*ar
-000109f0: 6773 2c20 2a2a 6b77 6172 6773 290a 2020  gs, **kwargs).  
-00010a00: 2020 2020 2020 6d65 7461 6461 7461 203d        metadata =
-00010a10: 2067 6473 7061 7468 2e77 6974 685f 7375   gdspath.with_su
-00010a20: 6666 6978 2822 2e79 6d6c 2229 0a20 2020  ffix(".yml").   
-00010a30: 2020 2020 206d 6574 6164 6174 612e 7772       metadata.wr
-00010a40: 6974 655f 7465 7874 2873 656c 662e 746f  ite_text(self.to
-00010a50: 5f79 616d 6c28 7769 7468 5f63 656c 6c73  _yaml(with_cells
-00010a60: 3d54 7275 652c 2077 6974 685f 706f 7274  =True, with_port
-00010a70: 733d 5472 7565 2929 0a20 2020 2020 2020  s=True)).       
-00010a80: 206c 6f67 6765 722e 696e 666f 2866 2257   logger.info(f"W
-00010a90: 7269 7465 2059 414d 4c20 6d65 7461 6461  rite YAML metada
-00010aa0: 7461 2074 6f20 7b73 7472 286d 6574 6164  ta to {str(metad
-00010ab0: 6174 6129 2172 7d22 290a 2020 2020 2020  ata)!r}").      
-00010ac0: 2020 7265 7475 726e 2067 6473 7061 7468    return gdspath
-00010ad0: 0a0a 2020 2020 6465 6620 746f 5f64 6963  ..    def to_dic
-00010ae0: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-00010af0: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
-00010b00: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
-00010b10: 783a 204f 7074 696f 6e61 6c5b 4c69 7374  x: Optional[List
-00010b20: 5b73 7472 5d5d 203d 204e 6f6e 652c 0a20  [str]] = None,. 
-00010b30: 2020 2020 2020 2069 676e 6f72 655f 6675         ignore_fu
-00010b40: 6e63 7469 6f6e 735f 7072 6566 6978 3a20  nctions_prefix: 
-00010b50: 4f70 7469 6f6e 616c 5b4c 6973 745b 7374  Optional[List[st
-00010b60: 725d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  r]] = None,.    
-00010b70: 2020 2020 7769 7468 5f63 656c 6c73 3a20      with_cells: 
-00010b80: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-00010b90: 2020 2020 2020 7769 7468 5f70 6f72 7473        with_ports
-00010ba0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
-00010bb0: 2020 2029 202d 3e20 4469 6374 5b73 7472     ) -> Dict[str
-00010bc0: 2c20 416e 795d 3a0a 2020 2020 2020 2020  , Any]:.        
-00010bd0: 2222 2252 6574 7572 6e73 2044 6963 7420  """Returns Dict 
-00010be0: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
-00010bf0: 6620 6120 636f 6d70 6f6e 656e 742e 0a0a  f a component...
-00010c00: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00010c10: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
-00010c20: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
-00010c30: 6978 3a20 666f 7220 636f 6d70 6f6e 656e  ix: for componen
-00010c40: 7473 2074 6f20 6967 6e6f 7265 2077 6865  ts to ignore whe
-00010c50: 6e20 6578 706f 7274 696e 672e 0a20 2020  n exporting..   
-00010c60: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-00010c70: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
-00010c80: 3a20 666f 7220 6675 6e63 7469 6f6e 7320  : for functions 
-00010c90: 746f 2069 676e 6f72 6520 7768 656e 2065  to ignore when e
-00010ca0: 7870 6f72 7469 6e67 2e0a 2020 2020 2020  xporting..      
-00010cb0: 2020 2020 2020 7769 7468 5f63 656c 6c73        with_cells
-00010cc0: 3a20 7772 6974 6520 6365 6c6c 7320 7265  : write cells re
-00010cd0: 6375 7273 6976 656c 792e 0a20 2020 2020  cursively..     
-00010ce0: 2020 2020 2020 2077 6974 685f 706f 7274         with_port
-00010cf0: 733a 2077 7269 7465 2070 6f72 7420 696e  s: write port in
-00010d00: 666f 726d 6174 696f 6e20 6469 6374 2e0a  formation dict..
-00010d10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010d20: 2020 2020 6420 3d20 7b7d 0a20 2020 2020      d = {}.     
-00010d30: 2020 2069 6620 7769 7468 5f70 6f72 7473     if with_ports
-00010d40: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
-00010d50: 7274 7320 3d20 7b70 6f72 742e 6e61 6d65  rts = {port.name
-00010d60: 3a20 706f 7274 2e74 6f5f 6469 6374 2829  : port.to_dict()
-00010d70: 2066 6f72 2070 6f72 7420 696e 2073 656c   for port in sel
-00010d80: 662e 6765 745f 706f 7274 735f 6c69 7374  f.get_ports_list
-00010d90: 2829 7d0a 2020 2020 2020 2020 2020 2020  ()}.            
-00010da0: 645b 2270 6f72 7473 225d 203d 2070 6f72  d["ports"] = por
-00010db0: 7473 0a0a 2020 2020 2020 2020 6966 2077  ts..        if w
-00010dc0: 6974 685f 6365 6c6c 733a 0a20 2020 2020  ith_cells:.     
-00010dd0: 2020 2020 2020 2063 656c 6c73 203d 2072         cells = r
-00010de0: 6563 7572 7365 5f73 7472 7563 7475 7265  ecurse_structure
-00010df0: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00010e00: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00010e10: 2020 2020 2020 2020 2069 676e 6f72 655f           ignore_
-00010e20: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
-00010e30: 3d69 676e 6f72 655f 6675 6e63 7469 6f6e  =ignore_function
-00010e40: 735f 7072 6566 6978 2c0a 2020 2020 2020  s_prefix,.      
-00010e50: 2020 2020 2020 2020 2020 6967 6e6f 7265            ignore
-00010e60: 5f63 6f6d 706f 6e65 6e74 735f 7072 6566  _components_pref
-00010e70: 6978 3d69 676e 6f72 655f 636f 6d70 6f6e  ix=ignore_compon
-00010e80: 656e 7473 5f70 7265 6669 782c 0a20 2020  ents_prefix,.   
-00010e90: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00010ea0: 2020 2020 2020 2064 5b22 6365 6c6c 7322         d["cells"
-00010eb0: 5d20 3d20 636c 6561 6e5f 6469 6374 2863  ] = clean_dict(c
-00010ec0: 656c 6c73 290a 0a20 2020 2020 2020 2064  ells)..        d
-00010ed0: 5b22 6e61 6d65 225d 203d 2073 656c 662e  ["name"] = self.
-00010ee0: 6e61 6d65 0a20 2020 2020 2020 2064 5b22  name.        d["
-00010ef0: 7365 7474 696e 6773 225d 203d 2063 6c65  settings"] = cle
-00010f00: 616e 5f64 6963 7428 6469 6374 2873 656c  an_dict(dict(sel
-00010f10: 662e 7365 7474 696e 6773 2929 0a20 2020  f.settings)).   
-00010f20: 2020 2020 2072 6574 7572 6e20 640a 0a20       return d.. 
-00010f30: 2020 2064 6566 2074 6f5f 7961 6d6c 2873     def to_yaml(s
-00010f40: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-00010f50: 3e20 7374 723a 0a20 2020 2020 2020 2022  > str:.        "
-00010f60: 2222 5772 6974 6520 4469 6374 2072 6570  ""Write Dict rep
-00010f70: 7265 7365 6e74 6174 696f 6e20 6f66 2061  resentation of a
-00010f80: 2063 6f6d 706f 6e65 6e74 2069 6e20 5941   component in YA
-00010f90: 4d4c 2066 6f72 6d61 742e 0a0a 2020 2020  ML format...    
-00010fa0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00010fb0: 2020 2020 2020 6967 6e6f 7265 5f63 6f6d        ignore_com
-00010fc0: 706f 6e65 6e74 735f 7072 6566 6978 3a20  ponents_prefix: 
-00010fd0: 666f 7220 636f 6d70 6f6e 656e 7473 2074  for components t
-00010fe0: 6f20 6967 6e6f 7265 2077 6865 6e20 6578  o ignore when ex
-00010ff0: 706f 7274 696e 672e 0a20 2020 2020 2020  porting..       
-00011000: 2020 2020 2069 676e 6f72 655f 6675 6e63       ignore_func
-00011010: 7469 6f6e 735f 7072 6566 6978 3a20 666f  tions_prefix: fo
-00011020: 7220 6675 6e63 7469 6f6e 7320 746f 2069  r functions to i
-00011030: 676e 6f72 6520 7768 656e 2065 7870 6f72  gnore when expor
-00011040: 7469 6e67 2e0a 2020 2020 2020 2020 2020  ting..          
-00011050: 2020 7769 7468 5f63 656c 6c73 3a20 7772    with_cells: wr
-00011060: 6974 6520 6365 6c6c 7320 7265 6375 7273  ite cells recurs
-00011070: 6976 656c 792e 0a20 2020 2020 2020 2020  ively..         
-00011080: 2020 2077 6974 685f 706f 7274 733a 2077     with_ports: w
-00011090: 7269 7465 2070 6f72 7420 696e 666f 726d  rite port inform
-000110a0: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
-000110b0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-000110c0: 6e20 4f6d 6567 6143 6f6e 662e 746f 5f79  n OmegaConf.to_y
-000110d0: 616d 6c28 636c 6561 6e5f 6469 6374 2873  aml(clean_dict(s
-000110e0: 656c 662e 746f 5f64 6963 7428 2a2a 6b77  elf.to_dict(**kw
-000110f0: 6172 6773 2929 290a 0a20 2020 2064 6566  args)))..    def
-00011100: 2074 6f5f 6469 6374 5f70 6f6c 7967 6f6e   to_dict_polygon
-00011110: 7328 7365 6c66 2920 2d3e 2044 6963 745b  s(self) -> Dict[
-00011120: 7374 722c 2041 6e79 5d3a 0a20 2020 2020  str, Any]:.     
-00011130: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-00011140: 6469 6374 2072 6570 7265 7365 6e74 6174  dict representat
-00011150: 696f 6e20 6f66 2074 6865 2066 6c61 7474  ion of the flatt
-00011160: 656e 6564 2063 6f6d 706f 6e65 6e74 2e22  ened component."
-00011170: 2222 0a20 2020 2020 2020 2064 203d 207b  "".        d = {
-00011180: 7d0a 2020 2020 2020 2020 706f 6c79 676f  }.        polygo
-00011190: 6e73 203d 207b 7d0a 2020 2020 2020 2020  ns = {}.        
-000111a0: 6c61 7965 725f 746f 5f70 6f6c 7967 6f6e  layer_to_polygon
-000111b0: 7320 3d20 7365 6c66 2e67 6574 5f70 6f6c  s = self.get_pol
-000111c0: 7967 6f6e 7328 6279 5f73 7065 633d 5472  ygons(by_spec=Tr
-000111d0: 7565 290a 0a20 2020 2020 2020 2066 6f72  ue)..        for
-000111e0: 206c 6179 6572 2c20 706f 6c79 676f 6e73   layer, polygons
-000111f0: 5f6c 6179 6572 2069 6e20 6c61 7965 725f  _layer in layer_
-00011200: 746f 5f70 6f6c 7967 6f6e 732e 6974 656d  to_polygons.item
-00011210: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00011220: 206c 6179 6572 5f6e 616d 6520 3d20 6622   layer_name = f"
-00011230: 7b6c 6179 6572 5b30 5d7d 5f7b 6c61 7965  {layer[0]}_{laye
-00011240: 725b 315d 7d22 0a20 2020 2020 2020 2020  r[1]}".         
-00011250: 2020 2066 6f72 2070 6f6c 7967 6f6e 2069     for polygon i
-00011260: 6e20 706f 6c79 676f 6e73 5f6c 6179 6572  n polygons_layer
-00011270: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011280: 2020 706f 6c79 676f 6e73 5b6c 6179 6572    polygons[layer
-00011290: 5f6e 616d 655d 203d 205b 7475 706c 6528  _name] = [tuple(
-000112a0: 736e 6170 5f74 6f5f 6772 6964 2876 2929  snap_to_grid(v))
-000112b0: 2066 6f72 2076 2069 6e20 706f 6c79 676f   for v in polygo
-000112c0: 6e5d 0a0a 2020 2020 2020 2020 706f 7274  n]..        port
-000112d0: 7320 3d20 7b70 6f72 742e 6e61 6d65 3a20  s = {port.name: 
-000112e0: 706f 7274 2e73 6574 7469 6e67 7320 666f  port.settings fo
-000112f0: 7220 706f 7274 2069 6e20 7365 6c66 2e67  r port in self.g
-00011300: 6574 5f70 6f72 7473 5f6c 6973 7428 297d  et_ports_list()}
-00011310: 0a20 2020 2020 2020 2063 6c65 616e 5f64  .        clean_d
-00011320: 6963 7428 706f 7274 7329 0a20 2020 2020  ict(ports).     
-00011330: 2020 2063 6c65 616e 5f64 6963 7428 706f     clean_dict(po
-00011340: 6c79 676f 6e73 290a 2020 2020 2020 2020  lygons).        
-00011350: 642e 696e 666f 203d 2073 656c 662e 696e  d.info = self.in
-00011360: 666f 0a20 2020 2020 2020 2064 2e70 6f6c  fo.        d.pol
-00011370: 7967 6f6e 7320 3d20 706f 6c79 676f 6e73  ygons = polygons
-00011380: 0a20 2020 2020 2020 2064 2e70 6f72 7473  .        d.ports
-00011390: 203d 2070 6f72 7473 0a20 2020 2020 2020   = ports.       
-000113a0: 2072 6574 7572 6e20 640a 0a20 2020 2064   return d..    d
-000113b0: 6566 2061 7574 6f5f 7265 6e61 6d65 5f70  ef auto_rename_p
-000113c0: 6f72 7473 2873 656c 662c 202a 2a6b 7761  orts(self, **kwa
-000113d0: 7267 7329 202d 3e20 4e6f 6e65 3a0a 2020  rgs) -> None:.  
-000113e0: 2020 2020 2020 2222 2252 656e 616d 6520        """Rename 
-000113f0: 706f 7274 7320 6279 206f 7269 656e 7461  ports by orienta
-00011400: 7469 6f6e 204e 5345 5720 286e 6f72 7468  tion NSEW (north
-00011410: 2c20 736f 7574 682c 2065 6173 742c 2077  , south, east, w
-00011420: 6573 7429 2e0a 0a20 2020 2020 2020 204b  est)...        K
-00011430: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
-00011440: 2020 2020 2020 2020 2066 756e 6374 696f           functio
-00011450: 6e3a 2074 6f20 7265 6e61 6d65 2070 6f72  n: to rename por
-00011460: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
-00011470: 7365 6c65 6374 5f70 6f72 7473 5f6f 7074  select_ports_opt
-00011480: 6963 616c 3a20 746f 2073 656c 6563 7420  ical: to select 
-00011490: 6f70 7469 6361 6c20 706f 7274 732e 0a20  optical ports.. 
-000114a0: 2020 2020 2020 2020 2020 2073 656c 6563             selec
-000114b0: 745f 706f 7274 735f 656c 6563 7472 6963  t_ports_electric
-000114c0: 616c 3a20 746f 2073 656c 6563 7420 656c  al: to select el
-000114d0: 6563 7472 6963 616c 2070 6f72 7473 2e0a  ectrical ports..
-000114e0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-000114f0: 6978 5f6f 7074 6963 616c 3a20 7072 6566  ix_optical: pref
-00011500: 6978 2e0a 2020 2020 2020 2020 2020 2020  ix..            
-00011510: 7072 6566 6978 5f65 6c65 6374 7269 6361  prefix_electrica
-00011520: 6c3a 2070 7265 6669 782e 0a0a 2020 2020  l: prefix...    
-00011530: 2020 2020 2e2e 2063 6f64 653a 3a0a 0a20      .. code::.. 
-00011540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011550: 2033 2020 340a 2020 2020 2020 2020 2020   3  4.          
-00011560: 2020 2020 2020 205f 7c5f 5f7c 5f0a 2020         _|__|_.  
-00011570: 2020 2020 2020 2020 2020 2032 202d 7c20             2 -| 
-00011580: 2020 2020 207c 2d20 350a 2020 2020 2020       |- 5.      
-00011590: 2020 2020 2020 2020 2020 7c20 2020 2020            |     
-000115a0: 207c 0a20 2020 2020 2020 2020 2020 2020   |.             
-000115b0: 3120 2d7c 5f5f 5f5f 5f5f 7c2d 2036 0a20  1 -|______|- 6. 
-000115c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115d0: 207c 2020 7c0a 2020 2020 2020 2020 2020   |  |.          
-000115e0: 2020 2020 2020 2020 3820 2037 0a20 2020          8  7.   
-000115f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00011600: 2073 656c 662e 6973 5f75 6e6c 6f63 6b65   self.is_unlocke
-00011610: 6428 290a 2020 2020 2020 2020 6175 746f  d().        auto
-00011620: 5f72 656e 616d 655f 706f 7274 7328 7365  _rename_ports(se
-00011630: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
-00011640: 2020 2064 6566 2061 7574 6f5f 7265 6e61     def auto_rena
-00011650: 6d65 5f70 6f72 7473 5f63 6f75 6e74 6572  me_ports_counter
-00011660: 5f63 6c6f 636b 7769 7365 2873 656c 662c  _clockwise(self,
-00011670: 202a 2a6b 7761 7267 7329 202d 3e20 4e6f   **kwargs) -> No
-00011680: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
-00011690: 2e69 735f 756e 6c6f 636b 6564 2829 0a20  .is_unlocked(). 
-000116a0: 2020 2020 2020 2061 7574 6f5f 7265 6e61         auto_rena
-000116b0: 6d65 5f70 6f72 7473 5f63 6f75 6e74 6572  me_ports_counter
-000116c0: 5f63 6c6f 636b 7769 7365 2873 656c 662c  _clockwise(self,
-000116d0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-000116e0: 6465 6620 6175 746f 5f72 656e 616d 655f  def auto_rename_
-000116f0: 706f 7274 735f 6c61 7965 725f 6f72 6965  ports_layer_orie
-00011700: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
-00011710: 6b77 6172 6773 2920 2d3e 204e 6f6e 653a  kwargs) -> None:
-00011720: 0a20 2020 2020 2020 2073 656c 662e 6973  .        self.is
-00011730: 5f75 6e6c 6f63 6b65 6428 290a 2020 2020  _unlocked().    
-00011740: 2020 2020 6175 746f 5f72 656e 616d 655f      auto_rename_
-00011750: 706f 7274 735f 6c61 7965 725f 6f72 6965  ports_layer_orie
-00011760: 6e74 6174 696f 6e28 7365 6c66 2c20 2a2a  ntation(self, **
-00011770: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
-00011780: 2061 7574 6f5f 7265 6e61 6d65 5f70 6f72   auto_rename_por
-00011790: 7473 5f6f 7269 656e 7461 7469 6f6e 2873  ts_orientation(s
-000117a0: 656c 662c 202a 2a6b 7761 7267 7329 202d  elf, **kwargs) -
-000117b0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000117c0: 2222 2252 656e 616d 6520 706f 7274 7320  """Rename ports 
-000117d0: 6279 206f 7269 656e 7461 7469 6f6e 204e  by orientation N
-000117e0: 5345 5720 286e 6f72 7468 2c20 736f 7574  SEW (north, sout
-000117f0: 682c 2065 6173 742c 2077 6573 7429 2e0a  h, east, west)..
-00011800: 0a20 2020 2020 2020 204b 6579 776f 7264  .        Keyword
-00011810: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-00011820: 2020 2066 756e 6374 696f 6e3a 2074 6f20     function: to 
-00011830: 7265 6e61 6d65 2070 6f72 7473 2e0a 2020  rename ports..  
-00011840: 2020 2020 2020 2020 2020 7365 6c65 6374            select
-00011850: 5f70 6f72 7473 5f6f 7074 6963 616c 3a20  _ports_optical: 
-00011860: 746f 2073 656c 6563 7420 706f 7274 732e  to select ports.
-00011870: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00011880: 6563 745f 706f 7274 735f 656c 6563 7472  ect_ports_electr
-00011890: 6963 616c 3a0a 2020 2020 2020 2020 2020  ical:.          
-000118a0: 2020 7072 6566 6978 5f6f 7074 6963 616c    prefix_optical
-000118b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-000118c0: 6566 6978 5f65 6c65 6374 7269 6361 6c3a  efix_electrical:
-000118d0: 0a0a 2020 2020 2020 2020 2e2e 2063 6f64  ..        .. cod
-000118e0: 653a 3a0a 0a20 2020 2020 2020 2020 2020  e::..           
-000118f0: 2020 2020 2020 4e30 2020 4e31 0a20 2020        N0  N1.   
-00011900: 2020 2020 2020 2020 2020 2020 2020 7c5f                |_
-00011910: 5f5f 7c5f 0a20 2020 2020 2020 2020 2020  __|_.           
-00011920: 2057 3120 2d7c 2020 2020 2020 7c2d 2045   W1 -|      |- E
-00011930: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00011940: 2020 7c20 2020 2020 207c 0a20 2020 2020    |      |.     
-00011950: 2020 2020 2020 2057 3020 2d7c 5f5f 5f5f         W0 -|____
-00011960: 5f5f 7c2d 2045 300a 2020 2020 2020 2020  __|- E0.        
-00011970: 2020 2020 2020 2020 207c 2020 207c 0a20           |   |. 
-00011980: 2020 2020 2020 2020 2020 2020 2020 2053                 S
-00011990: 3020 2020 5331 0a20 2020 2020 2020 2022  0   S1.        "
-000119a0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-000119b0: 6973 5f75 6e6c 6f63 6b65 6428 290a 2020  is_unlocked().  
-000119c0: 2020 2020 2020 6175 746f 5f72 656e 616d        auto_renam
-000119d0: 655f 706f 7274 735f 6f72 6965 6e74 6174  e_ports_orientat
-000119e0: 696f 6e28 7365 6c66 2c20 2a2a 6b77 6172  ion(self, **kwar
-000119f0: 6773 290a 0a20 2020 2064 6566 206d 6f76  gs)..    def mov
-00011a00: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-00011a10: 0a20 2020 2020 2020 206f 7269 6769 6e3a  .        origin:
-00011a20: 2046 6c6f 6174 3220 3d20 2830 2c20 3029   Float2 = (0, 0)
-00011a30: 2c0a 2020 2020 2020 2020 6465 7374 696e  ,.        destin
-00011a40: 6174 696f 6e3a 204f 7074 696f 6e61 6c5b  ation: Optional[
-00011a50: 466c 6f61 7432 5d20 3d20 4e6f 6e65 2c0a  Float2] = None,.
-00011a60: 2020 2020 2020 2020 6178 6973 3a20 4f70          axis: Op
-00011a70: 7469 6f6e 616c 5b41 7869 735d 203d 204e  tional[Axis] = N
-00011a80: 6f6e 652c 0a20 2020 2029 202d 3e20 436f  one,.    ) -> Co
-00011a90: 6d70 6f6e 656e 743a 0a20 2020 2020 2020  mponent:.       
-00011aa0: 2022 2222 5265 7475 726e 7320 6e65 7720   """Returns new 
-00011ab0: 436f 6d70 6f6e 656e 7420 7769 7468 2061  Component with a
-00011ac0: 206d 6f76 6564 2072 6566 6572 656e 6365   moved reference
-00011ad0: 2074 6f20 7468 6520 6f72 6967 696e 616c   to the original
-00011ae0: 2e0a 0a20 2020 2020 2020 2063 6f6d 706f  ...        compo
-00011af0: 6e65 6e74 2e0a 0a20 2020 2020 2020 2041  nent...        A
-00011b00: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
-00011b10: 206f 7269 6769 6e3a 206f 6620 636f 6d70   origin: of comp
-00011b20: 6f6e 656e 742e 0a20 2020 2020 2020 2020  onent..         
-00011b30: 2020 2064 6573 7469 6e61 7469 6f6e 3a20     destination: 
-00011b40: 782c 2079 2e0a 2020 2020 2020 2020 2020  x, y..          
-00011b50: 2020 6178 6973 3a20 7820 6f72 2079 2e0a    axis: x or y..
-00011b60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00011b70: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00011b80: 7272 6f72 286d 6f76 655f 6572 726f 725f  rror(move_error_
-00011b90: 6d65 7373 6167 6529 0a0a 2020 2020 6465  message)..    de
-00011ba0: 6620 6d69 7272 6f72 2873 656c 662c 2070  f mirror(self, p
-00011bb0: 313a 2046 6c6f 6174 3220 3d20 2830 2c20  1: Float2 = (0, 
-00011bc0: 3129 2c20 7032 3a20 466c 6f61 7432 203d  1), p2: Float2 =
-00011bd0: 2028 302c 2030 292c 202a 2a6b 7761 7267   (0, 0), **kwarg
-00011be0: 7329 202d 3e20 436f 6d70 6f6e 656e 743a  s) -> Component:
-00011bf0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00011c00: 726e 7320 6e65 7720 436f 6d70 6f6e 656e  rns new Componen
-00011c10: 7420 7769 7468 2061 206d 6972 726f 7265  t with a mirrore
-00011c20: 6420 7265 6665 7265 6e63 652e 0a0a 2020  d reference...  
-00011c30: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-00011c40: 2020 2020 2020 2020 7031 3a20 6669 7273          p1: firs
-00011c50: 7420 706f 696e 7420 746f 2064 6566 696e  t point to defin
-00011c60: 6520 6d69 7272 6f72 2061 7869 732e 0a20  e mirror axis.. 
-00011c70: 2020 2020 2020 2020 2020 2070 323a 2073             p2: s
-00011c80: 6563 6f6e 6420 706f 696e 7420 746f 2064  econd point to d
-00011c90: 6566 696e 6520 6d69 7272 6f72 2061 7869  efine mirror axi
-00011ca0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
-00011cb0: 2020 2020 2020 2066 726f 6d20 6764 7366         from gdsf
-00011cc0: 6163 746f 7279 2e66 756e 6374 696f 6e73  actory.functions
-00011cd0: 2069 6d70 6f72 7420 6d69 7272 6f72 0a0a   import mirror..
-00011ce0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00011cf0: 6972 726f 7228 636f 6d70 6f6e 656e 743d  irror(component=
-00011d00: 7365 6c66 2c20 7031 3d70 312c 2070 323d  self, p1=p1, p2=
-00011d10: 7032 2c20 2a2a 6b77 6172 6773 290a 0a20  p2, **kwargs).. 
-00011d20: 2020 2064 6566 2072 6f74 6174 6528 7365     def rotate(se
-00011d30: 6c66 2c20 616e 676c 653a 2066 6c6f 6174  lf, angle: float
-00011d40: 203d 2039 302c 202a 2a6b 7761 7267 7329   = 90, **kwargs)
-00011d50: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
-00011d60: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00011d70: 7320 6e65 7720 636f 6d70 6f6e 656e 7420  s new component 
-00011d80: 7769 7468 2061 2072 6f74 6174 6564 2072  with a rotated r
-00011d90: 6566 6572 656e 6365 2074 6f20 7468 6520  eference to the 
-00011da0: 6f72 6967 696e 616c 2e0a 0a20 2020 2020  original...     
-00011db0: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00011dc0: 2020 2020 2061 6e67 6c65 3a20 696e 2064       angle: in d
-00011dd0: 6567 7265 6573 2e0a 2020 2020 2020 2020  egrees..        
-00011de0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
-00011df0: 2067 6473 6661 6374 6f72 792e 6675 6e63   gdsfactory.func
-00011e00: 7469 6f6e 7320 696d 706f 7274 2072 6f74  tions import rot
-00011e10: 6174 650a 0a20 2020 2020 2020 2072 6574  ate..        ret
-00011e20: 7572 6e20 726f 7461 7465 2863 6f6d 706f  urn rotate(compo
-00011e30: 6e65 6e74 3d73 656c 662c 2061 6e67 6c65  nent=self, angle
-00011e40: 3d61 6e67 6c65 2c20 2a2a 6b77 6172 6773  =angle, **kwargs
-00011e50: 290a 0a20 2020 2064 6566 2061 6464 5f70  )..    def add_p
-00011e60: 6164 6469 6e67 2873 656c 662c 202a 2a6b  adding(self, **k
-00011e70: 7761 7267 7329 202d 3e20 436f 6d70 6f6e  wargs) -> Compon
-00011e80: 656e 743a 0a20 2020 2020 2020 2022 2222  ent:.        """
-00011e90: 5265 7475 726e 7320 7361 6d65 2063 6f6d  Returns same com
-00011ea0: 706f 6e65 6e74 2077 6974 6820 7061 6464  ponent with padd
-00011eb0: 696e 672e 0a0a 2020 2020 2020 2020 4b65  ing...        Ke
-00011ec0: 7977 6f72 6420 4172 6773 3a0a 2020 2020  yword Args:.    
-00011ed0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-00011ee0: 743a 2066 6f72 2070 6164 6469 6e67 2e0a  t: for padding..
-00011ef0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00011f00: 7273 3a20 6c69 7374 206f 6620 6c61 7965  rs: list of laye
-00011f10: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
-00011f20: 7375 6666 6978 2066 6f72 206e 616d 652e  suffix for name.
-00011f30: 0a20 2020 2020 2020 2020 2020 2064 6566  .            def
-00011f40: 6175 6c74 3a20 6465 6661 756c 7420 7061  ault: default pa
-00011f50: 6464 696e 6720 2835 3075 6d29 2e0a 2020  dding (50um)..  
-00011f60: 2020 2020 2020 2020 2020 746f 703a 206e            top: n
-00011f70: 6f72 7468 2070 6164 6469 6e67 2e0a 2020  orth padding..  
-00011f80: 2020 2020 2020 2020 2020 626f 7474 6f6d            bottom
-00011f90: 3a20 736f 7574 6820 7061 6464 696e 672e  : south padding.
-00011fa0: 0a20 2020 2020 2020 2020 2020 2072 6967  .            rig
-00011fb0: 6874 3a20 6561 7374 2070 6164 6469 6e67  ht: east padding
-00011fc0: 2e0a 2020 2020 2020 2020 2020 2020 6c65  ..            le
-00011fd0: 6674 3a20 7765 7374 2070 6164 6469 6e67  ft: west padding
-00011fe0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00011ff0: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
-00012000: 6374 6f72 792e 6164 645f 7061 6464 696e  ctory.add_paddin
-00012010: 6720 696d 706f 7274 2061 6464 5f70 6164  g import add_pad
-00012020: 6469 6e67 0a0a 2020 2020 2020 2020 7265  ding..        re
-00012030: 7475 726e 2061 6464 5f70 6164 6469 6e67  turn add_padding
-00012040: 2863 6f6d 706f 6e65 6e74 3d73 656c 662c  (component=self,
-00012050: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00012060: 6465 6620 6162 736f 7262 2873 656c 662c  def absorb(self,
-00012070: 2072 6566 6572 656e 6365 2920 2d3e 2043   reference) -> C
-00012080: 6f6d 706f 6e65 6e74 3a0a 2020 2020 2020  omponent:.      
-00012090: 2020 2222 2241 6273 6f72 6273 2070 6f6c    """Absorbs pol
-000120a0: 7967 6f6e 7320 6672 6f6d 2043 6f6d 706f  ygons from Compo
-000120b0: 6e65 6e74 5265 6665 7265 6e63 6520 696e  nentReference in
-000120c0: 746f 2043 6f6d 706f 6e65 6e74 2e0a 0a20  to Component... 
-000120d0: 2020 2020 2020 2044 6573 7472 6f79 7320         Destroys 
-000120e0: 7468 6520 7265 6665 7265 6e63 6520 696e  the reference in
-000120f0: 2074 6865 2070 726f 6365 7373 2062 7574   the process but
-00012100: 206b 6565 7069 6e67 2074 6865 2070 6f6c   keeping the pol
-00012110: 7967 6f6e 2067 656f 6d65 7472 792e 0a0a  ygon geometry...
-00012120: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00012130: 2020 2020 2020 2020 2020 7265 6665 7265            refere
-00012140: 6e63 653a 2043 6f6d 706f 6e65 6e74 5265  nce: ComponentRe
-00012150: 6665 7265 6e63 6520 746f 2062 6520 6162  ference to be ab
-00012160: 736f 7262 6564 2069 6e74 6f20 7468 6520  sorbed into the 
-00012170: 436f 6d70 6f6e 656e 742e 0a20 2020 2020  Component..     
-00012180: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00012190: 6620 7265 6665 7265 6e63 6520 6e6f 7420  f reference not 
-000121a0: 696e 2073 656c 662e 7265 6665 7265 6e63  in self.referenc
-000121b0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000121c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000121d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000121e0: 2020 2254 6865 2072 6566 6572 656e 6365    "The reference
-000121f0: 2079 6f75 2061 736b 6564 2074 6f20 6162   you asked to ab
-00012200: 736f 7262 2064 6f65 7320 6e6f 7420 6578  sorb does not ex
-00012210: 6973 7420 696e 2074 6869 7320 436f 6d70  ist in this Comp
-00012220: 6f6e 656e 742e 220a 2020 2020 2020 2020  onent.".        
-00012230: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00012240: 665f 706f 6c79 676f 6e73 203d 2072 6566  f_polygons = ref
-00012250: 6572 656e 6365 2e67 6574 5f70 6f6c 7967  erence.get_polyg
-00012260: 6f6e 7328 0a20 2020 2020 2020 2020 2020  ons(.           
-00012270: 2062 795f 7370 6563 3d46 616c 7365 2c20   by_spec=False, 
-00012280: 696e 636c 7564 655f 7061 7468 733d 4661  include_paths=Fa
-00012290: 6c73 652c 2061 735f 6172 7261 793d 4661  lse, as_array=Fa
-000122a0: 6c73 650a 2020 2020 2020 2020 290a 2020  lse.        ).  
-000122b0: 2020 2020 2020 7365 6c66 2e5f 6164 645f        self._add_
-000122c0: 706f 6c79 676f 6e73 282a 7265 665f 706f  polygons(*ref_po
-000122d0: 6c79 676f 6e73 290a 0a20 2020 2020 2020  lygons)..       
-000122e0: 2073 656c 662e 6164 6428 7265 6665 7265   self.add(refere
-000122f0: 6e63 652e 6765 745f 6c61 6265 6c73 2829  nce.get_labels()
-00012300: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-00012310: 6464 2872 6566 6572 656e 6365 2e67 6574  dd(reference.get
-00012320: 5f70 6174 6873 2829 290a 2020 2020 2020  _paths()).      
-00012330: 2020 7365 6c66 2e72 656d 6f76 6528 7265    self.remove(re
-00012340: 6665 7265 6e63 6529 0a20 2020 2020 2020  ference).       
-00012350: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
-00012360: 2020 6465 6620 7265 6d6f 7665 2873 656c    def remove(sel
-00012370: 662c 2069 7465 6d73 293a 0a20 2020 2020  f, items):.     
-00012380: 2020 2022 2222 5265 6d6f 7665 7320 6974     """Removes it
-00012390: 656d 7320 6672 6f6d 2061 2043 6f6d 706f  ems from a Compo
-000123a0: 6e65 6e74 2c20 7768 6963 6820 6361 6e20  nent, which can 
-000123b0: 696e 636c 7564 6520 506f 7274 732c 2050  include Ports, P
-000123c0: 6f6c 7967 6f6e 5365 7473 205c 0a20 2020  olygonSets \.   
-000123d0: 2020 2020 2043 656c 6c52 6566 6572 656e       CellReferen
-000123e0: 6365 732c 2043 6f6d 706f 6e65 6e74 5265  ces, ComponentRe
-000123f0: 6665 7265 6e63 6573 2061 6e64 204c 6162  ferences and Lab
-00012400: 656c 732e 0a0a 2020 2020 2020 2020 4172  els...        Ar
-00012410: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-00012420: 6974 656d 733a 206c 6973 7420 6f66 2049  items: list of I
-00012430: 7465 6d73 2074 6f20 6265 2072 656d 6f76  tems to be remov
-00012440: 6564 2066 726f 6d20 7468 6520 436f 6d70  ed from the Comp
-00012450: 6f6e 656e 742e 0a20 2020 2020 2020 2022  onent..        "
-00012460: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00012470: 7420 6861 7361 7474 7228 6974 656d 732c  t hasattr(items,
-00012480: 2022 5f5f 6974 6572 5f5f 2229 3a0a 2020   "__iter__"):.  
-00012490: 2020 2020 2020 2020 2020 6974 656d 7320            items 
-000124a0: 3d20 5b69 7465 6d73 5d0a 2020 2020 2020  = [items].      
-000124b0: 2020 666f 7220 6974 656d 2069 6e20 6974    for item in it
-000124c0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-000124d0: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
-000124e0: 7465 6d2c 2050 6f72 7429 3a0a 2020 2020  tem, Port):.    
-000124f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00012500: 2e70 6f72 7473 203d 207b 6b3a 2076 2066  .ports = {k: v f
-00012510: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
-00012520: 706f 7274 732e 6974 656d 7328 2920 6966  ports.items() if
-00012530: 2076 2021 3d20 6974 656d 7d0a 2020 2020   v != item}.    
-00012540: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
-00012550: 6e73 7461 6e63 6528 6974 656d 2c20 6764  nstance(item, gd
-00012560: 7374 6b2e 5265 6665 7265 6e63 6529 3a0a  stk.Reference):.
-00012570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012580: 7365 6c66 2e5f 6365 6c6c 2e72 656d 6f76  self._cell.remov
-00012590: 6528 6974 656d 290a 2020 2020 2020 2020  e(item).        
-000125a0: 2020 2020 2020 2020 6974 656d 2e6f 776e          item.own
-000125b0: 6572 203d 204e 6f6e 650a 2020 2020 2020  er = None.      
-000125c0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-000125d0: 7461 6e63 6528 6974 656d 2c20 436f 6d70  tance(item, Comp
-000125e0: 6f6e 656e 7452 6566 6572 656e 6365 293a  onentReference):
-000125f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012600: 2073 656c 662e 7265 6665 7265 6e63 6573   self.references
-00012610: 2e72 656d 6f76 6528 6974 656d 290a 2020  .remove(item).  
-00012620: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00012630: 6c66 2e5f 6365 6c6c 2e72 656d 6f76 6528  lf._cell.remove(
-00012640: 6974 656d 2e5f 7265 6665 7265 6e63 6529  item._reference)
-00012650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012660: 2069 7465 6d2e 6f77 6e65 7220 3d20 4e6f   item.owner = No
-00012670: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
-00012680: 2020 2073 656c 662e 5f6e 616d 6564 5f72     self._named_r
-00012690: 6566 6572 656e 6365 732e 706f 7028 6974  eferences.pop(it
-000126a0: 656d 2e6e 616d 6529 0a20 2020 2020 2020  em.name).       
-000126b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000126c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000126d0: 5f63 656c 6c2e 7265 6d6f 7665 2869 7465  _cell.remove(ite
-000126e0: 6d29 0a0a 2020 2020 2020 2020 7365 6c66  m)..        self
-000126f0: 2e5f 6262 5f76 616c 6964 203d 2046 616c  ._bb_valid = Fal
-00012700: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
-00012710: 6e20 7365 6c66 0a0a 2020 2020 6465 6620  n self..    def 
-00012720: 6861 7368 5f67 656f 6d65 7472 7928 7365  hash_geometry(se
-00012730: 6c66 2c20 7072 6563 6973 696f 6e3a 2066  lf, precision: f
-00012740: 6c6f 6174 203d 2031 652d 3429 202d 3e20  loat = 1e-4) -> 
-00012750: 7374 723a 0a20 2020 2020 2020 2022 2222  str:.        """
-00012760: 5265 7475 726e 7320 616e 2053 4841 3120  Returns an SHA1 
-00012770: 6861 7368 206f 6620 7468 6520 6765 6f6d  hash of the geom
-00012780: 6574 7279 2069 6e20 7468 6520 436f 6d70  etry in the Comp
-00012790: 6f6e 656e 742e 0a0a 2020 2020 2020 2020  onent...        
-000127a0: 466f 7220 6561 6368 206c 6179 6572 2c20  For each layer, 
-000127b0: 6561 6368 2070 6f6c 7967 6f6e 2069 7320  each polygon is 
-000127c0: 696e 6469 7669 6475 616c 6c79 2068 6173  individually has
-000127d0: 6865 6420 616e 6420 7468 656e 2074 6865  hed and then the
-000127e0: 2070 6f6c 7967 6f6e 2068 6173 6865 730a   polygon hashes.
-000127f0: 2020 2020 2020 2020 6172 6520 736f 7274          are sort
-00012800: 6564 2c20 746f 2065 6e73 7572 6520 7468  ed, to ensure th
-00012810: 6520 6861 7368 2073 7461 7973 2063 6f6e  e hash stays con
-00012820: 7374 616e 7420 7265 6761 7264 6c65 7373  stant regardless
-00012830: 206f 6620 7468 6520 6f72 6465 7269 6e67   of the ordering
-00012840: 0a20 2020 2020 2020 2074 6865 2070 6f6c  .        the pol
-00012850: 7967 6f6e 732e 2020 5369 6d69 6c61 726c  ygons.  Similarl
-00012860: 792c 2074 6865 206c 6179 6572 7320 6172  y, the layers ar
-00012870: 6520 736f 7274 6564 2062 7920 286c 6179  e sorted by (lay
-00012880: 6572 2c20 6461 7461 7479 7065 292e 0a0a  er, datatype)...
-00012890: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-000128a0: 2020 2020 2020 2020 2020 7072 6563 6973            precis
-000128b0: 696f 6e3a 2052 6f75 6e64 696e 6720 7072  ion: Rounding pr
-000128c0: 6563 6973 696f 6e20 666f 7220 7468 6520  ecision for the 
-000128d0: 7468 6520 6f62 6a65 6374 7320 696e 2074  the objects in t
-000128e0: 6865 2043 6f6d 706f 6e65 6e74 2e0a 2020  he Component..  
-000128f0: 2020 2020 2020 2020 2020 2020 2020 466f                Fo
-00012900: 7220 696e 7374 616e 6365 2c20 6120 7072  r instance, a pr
-00012910: 6563 6973 696f 6e20 6f66 2031 652d 3220  ecision of 1e-2 
-00012920: 7769 6c6c 2072 6f75 6e64 2061 2070 6f69  will round a poi
-00012930: 6e74 2061 740a 2020 2020 2020 2020 2020  nt at.          
-00012940: 2020 2020 2020 2830 2e31 3234 2c20 312e        (0.124, 1.
-00012950: 3734 3829 2074 6f20 2830 2e31 322c 2031  748) to (0.12, 1
-00012960: 2e37 3529 2e0a 0a20 2020 2020 2020 2022  .75)...        "
-00012970: 2222 0a20 2020 2020 2020 2070 6f6c 7967  "".        polyg
-00012980: 6f6e 735f 6279 5f73 7065 6320 3d20 7365  ons_by_spec = se
-00012990: 6c66 2e67 6574 5f70 6f6c 7967 6f6e 7328  lf.get_polygons(
-000129a0: 6279 5f73 7065 633d 5472 7565 2c20 6173  by_spec=True, as
-000129b0: 5f61 7272 6179 3d46 616c 7365 290a 2020  _array=False).  
-000129c0: 2020 2020 2020 6c61 7965 7273 203d 206e        layers = n
-000129d0: 702e 6172 7261 7928 6c69 7374 2870 6f6c  p.array(list(pol
-000129e0: 7967 6f6e 735f 6279 5f73 7065 632e 6b65  ygons_by_spec.ke
-000129f0: 7973 2829 2929 0a20 2020 2020 2020 2073  ys())).        s
-00012a00: 6f72 7465 645f 6c61 7965 7273 203d 206c  orted_layers = l
-00012a10: 6179 6572 735b 6e70 2e6c 6578 736f 7274  ayers[np.lexsort
-00012a20: 2828 6c61 7965 7273 5b3a 2c20 305d 2c20  ((layers[:, 0], 
-00012a30: 6c61 7965 7273 5b3a 2c20 315d 2929 5d0a  layers[:, 1]))].
-00012a40: 0a20 2020 2020 2020 2066 696e 616c 5f68  .        final_h
-00012a50: 6173 6820 3d20 6861 7368 6c69 622e 7368  ash = hashlib.sh
-00012a60: 6131 2829 0a20 2020 2020 2020 2066 6f72  a1().        for
-00012a70: 206c 6179 6572 2069 6e20 736f 7274 6564   layer in sorted
-00012a80: 5f6c 6179 6572 733a 0a20 2020 2020 2020  _layers:.       
-00012a90: 2020 2020 206c 6179 6572 5f68 6173 6820       layer_hash 
-00012aa0: 3d20 6861 7368 6c69 622e 7368 6131 286c  = hashlib.sha1(l
-00012ab0: 6179 6572 2e61 7374 7970 6528 6e70 2e69  ayer.astype(np.i
-00012ac0: 6e74 3634 2929 2e64 6967 6573 7428 290a  nt64)).digest().
-00012ad0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-00012ae0: 676f 6e73 203d 2070 6f6c 7967 6f6e 735f  gons = polygons_
-00012af0: 6279 5f73 7065 635b 7475 706c 6528 6c61  by_spec[tuple(la
-00012b00: 7965 7229 5d0a 2020 2020 2020 2020 2020  yer)].          
-00012b10: 2020 706f 6c79 676f 6e73 203d 205b 5f72    polygons = [_r
-00012b20: 6e64 2870 2e70 6f69 6e74 732c 2070 7265  nd(p.points, pre
-00012b30: 6369 7369 6f6e 2920 666f 7220 7020 696e  cision) for p in
-00012b40: 2070 6f6c 7967 6f6e 735d 0a20 2020 2020   polygons].     
-00012b50: 2020 2020 2020 2070 6f6c 7967 6f6e 5f68         polygon_h
-00012b60: 6173 6865 7320 3d20 6e70 2e73 6f72 7428  ashes = np.sort(
-00012b70: 5b68 6173 686c 6962 2e73 6861 3128 7029  [hashlib.sha1(p)
-00012b80: 2e64 6967 6573 7428 2920 666f 7220 7020  .digest() for p 
-00012b90: 696e 2070 6f6c 7967 6f6e 735d 290a 2020  in polygons]).  
-00012ba0: 2020 2020 2020 2020 2020 6669 6e61 6c5f            final_
-00012bb0: 6861 7368 2e75 7064 6174 6528 6c61 7965  hash.update(laye
-00012bc0: 725f 6861 7368 290a 2020 2020 2020 2020  r_hash).        
-00012bd0: 2020 2020 666f 7220 7068 2069 6e20 706f      for ph in po
-00012be0: 6c79 676f 6e5f 6861 7368 6573 3a0a 2020  lygon_hashes:.  
-00012bf0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00012c00: 6e61 6c5f 6861 7368 2e75 7064 6174 6528  nal_hash.update(
-00012c10: 7068 290a 0a20 2020 2020 2020 2072 6574  ph)..        ret
-00012c20: 7572 6e20 6669 6e61 6c5f 6861 7368 2e68  urn final_hash.h
-00012c30: 6578 6469 6765 7374 2829 0a0a 2020 2020  exdigest()..    
-00012c40: 6465 6620 6765 745f 6c61 6265 6c73 280a  def get_labels(.
-00012c50: 2020 2020 2020 2020 7365 6c66 2c20 6170          self, ap
-00012c60: 706c 795f 7265 7065 7469 7469 6f6e 733d  ply_repetitions=
-00012c70: 5472 7565 2c20 6465 7074 683a 204f 7074  True, depth: Opt
-00012c80: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-00012c90: 652c 206c 6179 6572 3d4e 6f6e 650a 2020  e, layer=None.  
-00012ca0: 2020 2920 2d3e 204c 6973 745b 4c61 6265    ) -> List[Labe
-00012cb0: 6c5d 3a0a 2020 2020 2020 2020 2222 2252  l]:.        """R
-00012cc0: 6574 7572 6e20 6c61 6265 6c73 2e0a 0a20  eturn labels... 
-00012cd0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00012ce0: 2020 2020 2020 2020 2061 7070 6c79 5f72           apply_r
-00012cf0: 6570 6574 6974 696f 6e73 3a2e 0a20 2020  epetitions:..   
-00012d00: 2020 2020 2020 2020 2064 6570 7468 3a20           depth: 
-00012d10: 4e6f 6e65 2072 6574 7572 6e73 2061 6c6c  None returns all
-00012d20: 206c 6162 656c 7320 616e 6420 3020 746f   labels and 0 to
-00012d30: 7020 6c65 7665 6c2e 0a20 2020 2020 2020  p level..       
-00012d40: 2020 2020 206c 6179 6572 3a20 6c61 7965       layer: laye
-00012d50: 7273 7065 632e 0a20 2020 2020 2020 2022  rspec..        "
-00012d60: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00012d70: 6764 7366 6163 746f 7279 2e70 646b 2069  gdsfactory.pdk i
-00012d80: 6d70 6f72 7420 6765 745f 6c61 7965 720a  mport get_layer.
-00012d90: 0a20 2020 2020 2020 2069 6620 6c61 7965  .        if laye
-00012da0: 723a 0a20 2020 2020 2020 2020 2020 206c  r:.            l
-00012db0: 6179 6572 2c20 7465 7874 7479 7065 203d  ayer, texttype =
-00012dc0: 2067 6574 5f6c 6179 6572 286c 6179 6572   get_layer(layer
-00012dd0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00012de0: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00012df0: 7479 7065 203d 204e 6f6e 650a 2020 2020  type = None.    
-00012e00: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00012e10: 5f63 656c 6c2e 6765 745f 6c61 6265 6c73  _cell.get_labels
-00012e20: 280a 2020 2020 2020 2020 2020 2020 6170  (.            ap
-00012e30: 706c 795f 7265 7065 7469 7469 6f6e 733d  ply_repetitions=
-00012e40: 6170 706c 795f 7265 7065 7469 7469 6f6e  apply_repetition
-00012e50: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
-00012e60: 6570 7468 3d64 6570 7468 2c0a 2020 2020  epth=depth,.    
-00012e70: 2020 2020 2020 2020 6c61 7965 723d 6c61          layer=la
-00012e80: 7965 722c 0a20 2020 2020 2020 2020 2020  yer,.           
-00012e90: 2074 6578 7474 7970 653d 7465 7874 7479   texttype=textty
-00012ea0: 7065 2c0a 2020 2020 2020 2020 290a 0a20  pe,.        ).. 
-00012eb0: 2020 2064 6566 2072 656d 6f76 655f 6c61     def remove_la
-00012ec0: 6265 6c73 2873 656c 6629 202d 3e20 4e6f  bels(self) -> No
-00012ed0: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
-00012ee0: 656d 6f76 6520 6c61 6265 6c73 2e22 2222  emove labels."""
-00012ef0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00012f00: 656c 6c2e 7265 6d6f 7665 282a 7365 6c66  ell.remove(*self
-00012f10: 2e6c 6162 656c 7329 0a0a 2020 2020 2320  .labels)..    # 
-00012f20: 4465 7072 6563 6174 6564 0a20 2020 2064  Deprecated.    d
-00012f30: 6566 2067 6574 5f69 6e66 6f28 7365 6c66  ef get_info(self
-00012f40: 293a 0a20 2020 2020 2020 2022 2222 4761  ):.        """Ga
-00012f50: 7468 6572 7320 7468 6520 2e69 6e66 6f20  thers the .info 
-00012f60: 6469 6374 696f 6e61 7269 6573 2066 726f  dictionaries fro
-00012f70: 6d20 6576 6572 7920 7375 622d 436f 6d70  m every sub-Comp
-00012f80: 6f6e 656e 7420 616e 6420 7265 7475 726e  onent and return
-00012f90: 7320 7468 656d 2069 6e20 6120 6c69 7374  s them in a list
-00012fa0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
-00012fb0: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-00012fc0: 7468 3a20 696e 7420 6f72 204e 6f6e 650a  th: int or None.
-00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fe0: 4966 206e 6f74 204e 6f6e 652c 2064 6566  If not None, def
-00012ff0: 696e 6573 2066 726f 6d20 686f 7720 6d61  ines from how ma
-00013000: 6e79 2072 6566 6572 656e 6365 206c 6576  ny reference lev
-00013010: 656c 7320 746f 0a20 2020 2020 2020 2020  els to.         
-00013020: 2020 2020 2020 2072 6574 7269 6576 6520         retrieve 
-00013030: 506f 7274 7320 6672 6f6d 2e0a 0a20 2020  Ports from...   
-00013040: 2020 2020 2052 6574 7572 6e73 3a0a 2020       Returns:.  
-00013050: 2020 2020 2020 2020 2020 6c69 7374 206f            list o
-00013060: 6620 6469 6374 696f 6e61 7269 6573 0a20  f dictionaries. 
-00013070: 2020 2020 2020 2020 2020 2020 2020 204c                 L
-00013080: 6973 7420 6f66 2074 6865 2022 2e69 6e66  ist of the ".inf
-00013090: 6f22 2070 726f 7065 7274 7920 6469 6374  o" property dict
-000130a0: 696f 6e61 7269 6573 2066 726f 6d20 616c  ionaries from al
-000130b0: 6c20 7375 622d 436f 6d70 6f6e 656e 7473  l sub-Components
-000130c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000130d0: 2020 2020 2044 5f6c 6973 7420 3d20 7365       D_list = se
-000130e0: 6c66 2e67 6574 5f64 6570 656e 6465 6e63  lf.get_dependenc
-000130f0: 6965 7328 7265 6375 7273 6976 653d 5472  ies(recursive=Tr
-00013100: 7565 290a 2020 2020 2020 2020 7265 7475  ue).        retu
-00013110: 726e 205b 442e 696e 666f 2e63 6f70 7928  rn [D.info.copy(
-00013120: 2920 666f 7220 4420 696e 2044 5f6c 6973  ) for D in D_lis
-00013130: 745d 0a0a 2020 2020 6465 6620 7265 6d61  t]..    def rema
-00013140: 705f 6c61 7965 7273 280a 2020 2020 2020  p_layers(.      
-00013150: 2020 7365 6c66 2c20 6c61 7965 726d 6170    self, layermap
-00013160: 2c20 696e 636c 7564 655f 6c61 6265 6c73  , include_labels
-00013170: 3a20 626f 6f6c 203d 2054 7275 652c 2069  : bool = True, i
-00013180: 6e63 6c75 6465 5f70 6174 6873 3a20 626f  nclude_paths: bo
-00013190: 6f6c 203d 2054 7275 650a 2020 2020 2920  ol = True.    ) 
-000131a0: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-000131b0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
-000131c0: 2061 2063 6f70 7920 6f66 2074 6865 2063   a copy of the c
-000131d0: 6f6d 706f 6e65 6e74 2077 6974 6820 7265  omponent with re
-000131e0: 6d61 7070 6564 206c 6179 6572 732e 0a0a  mapped layers...
-000131f0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
-00013200: 2020 2020 2020 2020 2020 6c61 7965 726d            layerm
-00013210: 6170 3a20 4469 6374 696f 6e61 7279 206f  ap: Dictionary o
-00013220: 6620 7661 6c75 6573 2069 6e20 666f 726d  f values in form
-00013230: 6174 207b 6c61 7965 725f 6672 6f6d 203a  at {layer_from :
-00013240: 206c 6179 6572 5f74 6f7d 2e0a 2020 2020   layer_to}..    
-00013250: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-00013260: 6c61 6265 6c73 3a20 5365 6c65 6374 7320  labels: Selects 
-00013270: 7768 6574 6865 7220 746f 206d 6f76 6520  whether to move 
-00013280: 4c61 6265 6c73 2061 6c6f 6e67 2077 6974  Labels along wit
-00013290: 6820 706f 6c79 676f 6e73 2e0a 2020 2020  h polygons..    
-000132a0: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-000132b0: 7061 7468 733a 2053 656c 6563 7473 2077  paths: Selects w
-000132c0: 6865 7468 6572 2074 6f20 6d6f 7665 2050  hether to move P
-000132d0: 6174 6873 2061 6c6f 6e67 2077 6974 6820  aths along with 
-000132e0: 706f 6c79 676f 6e73 2e0a 2020 2020 2020  polygons..      
-000132f0: 2020 2222 220a 2020 2020 2020 2020 636f    """.        co
-00013300: 6d70 6f6e 656e 7420 3d20 7365 6c66 2e63  mponent = self.c
-00013310: 6f70 7928 290a 2020 2020 2020 2020 6c61  opy().        la
-00013320: 7965 726d 6170 203d 207b 5f70 6172 7365  yermap = {_parse
-00013330: 5f6c 6179 6572 286b 293a 205f 7061 7273  _layer(k): _pars
-00013340: 655f 6c61 7965 7228 7629 2066 6f72 206b  e_layer(v) for k
-00013350: 2c20 7620 696e 206c 6179 6572 6d61 702e  , v in layermap.
-00013360: 6974 656d 7328 297d 0a0a 2020 2020 2020  items()}..      
-00013370: 2020 616c 6c5f 4420 3d20 6c69 7374 2863    all_D = list(c
-00013380: 6f6d 706f 6e65 6e74 2e67 6574 5f64 6570  omponent.get_dep
-00013390: 656e 6465 6e63 6965 7328 5472 7565 2929  endencies(True))
-000133a0: 0a20 2020 2020 2020 2061 6c6c 5f44 2e61  .        all_D.a
-000133b0: 7070 656e 6428 636f 6d70 6f6e 656e 7429  ppend(component)
-000133c0: 0a20 2020 2020 2020 2066 6f72 2044 2069  .        for D i
-000133d0: 6e20 616c 6c5f 443a 0a20 2020 2020 2020  n all_D:.       
-000133e0: 2020 2020 2066 6f72 2070 2069 6e20 442e       for p in D.
-000133f0: 706f 6c79 676f 6e73 3a0a 2020 2020 2020  polygons:.      
-00013400: 2020 2020 2020 2020 2020 6c61 7965 7220            layer 
-00013410: 3d20 2870 2e6c 6179 6572 2c20 702e 6461  = (p.layer, p.da
-00013420: 7461 7479 7065 290a 2020 2020 2020 2020  tatype).        
-00013430: 2020 2020 2020 2020 6966 206c 6179 6572          if layer
-00013440: 2069 6e20 6c61 7965 726d 6170 3a0a 2020   in layermap:.  
-00013450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013460: 2020 6e65 775f 6c61 7965 7220 3d20 6c61    new_layer = la
-00013470: 7965 726d 6170 5b6c 6179 6572 5d0a 2020  yermap[layer].  
-00013480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013490: 2020 702e 6c61 7965 7220 3d20 6e65 775f    p.layer = new_
-000134a0: 6c61 7965 725b 305d 0a20 2020 2020 2020  layer[0].       
-000134b0: 2020 2020 2020 2020 2020 2020 2070 2e64               p.d
-000134c0: 6174 6174 7970 6520 3d20 6e65 775f 6c61  atatype = new_la
-000134d0: 7965 725b 315d 0a20 2020 2020 2020 2020  yer[1].         
-000134e0: 2020 2069 6620 696e 636c 7564 655f 6c61     if include_la
-000134f0: 6265 6c73 3a0a 2020 2020 2020 2020 2020  bels:.          
-00013500: 2020 2020 2020 666f 7220 6c61 6265 6c20        for label 
-00013510: 696e 2044 2e6c 6162 656c 733a 0a20 2020  in D.labels:.   
+0000d780: 2020 2020 6669 6c6c 5f61 6c70 6861 3d6c      fill_alpha=l
+0000d790: 6179 6572 5f76 6965 772e 6765 745f 616c  ayer_view.get_al
+0000d7a0: 7068 6128 2920 6f72 2022 222c 0a20 2020  pha() or "",.   
+0000d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7c0: 206c 696e 655f 616c 7068 613d 6c61 7965   line_alpha=laye
+0000d7d0: 725f 7669 6577 2e67 6574 5f61 6c70 6861  r_view.get_alpha
+0000d7e0: 2829 206f 7220 2222 2c0a 2020 2020 2020  () or "",.      
+0000d7f0: 2020 2020 2020 2020 2020 2020 2020 746f                to
+0000d800: 6f6c 733d 5b22 686f 7665 7222 5d2c 0a20  ols=["hover"],. 
+0000d810: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000d820: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000d830: 2020 2020 2020 2066 6f72 206e 616d 652c         for name,
+0000d840: 2070 6f72 7420 696e 2073 656c 662e 706f   port in self.po
+0000d850: 7274 732e 6974 656d 7328 293a 0a20 2020  rts.items():.   
+0000d860: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+0000d870: 7374 7228 6e61 6d65 290a 2020 2020 2020  str(name).      
+0000d880: 2020 2020 2020 706f 6c79 676f 6e2c 2070        polygon, p
+0000d890: 7469 7020 3d20 6765 745f 7069 6e5f 7472  tip = get_pin_tr
+0000d8a0: 6961 6e67 6c65 5f70 6f6c 7967 6f6e 5f74  iangle_polygon_t
+0000d8b0: 6970 2870 6f72 743d 706f 7274 290a 0a20  ip(port=port).. 
+0000d8c0: 2020 2020 2020 2020 2020 2070 6c6f 7473             plots
+0000d8d0: 5f74 6f5f 6f76 6572 6c61 792e 6170 7065  _to_overlay.appe
+0000d8e0: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+0000d8f0: 2020 2020 6876 2e50 6f6c 7967 6f6e 7328      hv.Polygons(
+0000d900: 706f 6c79 676f 6e2c 206c 6162 656c 3d6e  polygon, label=n
+0000d910: 616d 6529 2e6f 7074 7328 0a20 2020 2020  ame).opts(.     
+0000d920: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000d930: 6174 615f 6173 7065 6374 3d31 2c0a 2020  ata_aspect=1,.  
+0000d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d950: 2020 6672 616d 655f 7769 6474 683d 3530    frame_width=50
+0000d960: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
+0000d970: 2020 2020 2020 2066 696c 6c5f 616c 7068         fill_alph
+0000d980: 613d 302c 0a20 2020 2020 2020 2020 2020  a=0,.           
+0000d990: 2020 2020 2020 2020 2079 6c69 6d3d 2862           ylim=(b
+0000d9a0: 5b31 5d2c 2062 5b33 5d29 2c0a 2020 2020  [1], b[3]),.    
+0000d9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d9c0: 786c 696d 3d28 625b 305d 2c20 625b 325d  xlim=(b[0], b[2]
+0000d9d0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0000d9e0: 2020 2020 2020 2063 6f6c 6f72 3d22 7265         color="re
+0000d9f0: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
+0000da00: 2020 2020 2020 2020 6c69 6e65 5f61 6c70          line_alp
+0000da10: 6861 3d6c 6179 6572 5f76 6965 772e 6765  ha=layer_view.ge
+0000da20: 745f 616c 7068 6128 2920 6f72 2022 222c  t_alpha() or "",
+0000da30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da40: 2020 2020 2074 6f6f 6c73 3d5b 2268 6f76       tools=["hov
+0000da50: 6572 225d 2c0a 2020 2020 2020 2020 2020  er"],.          
+0000da60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000da70: 2020 2020 2020 2020 2a20 6876 2e54 6578          * hv.Tex
+0000da80: 7428 7074 6970 5b30 5d2c 2070 7469 705b  t(ptip[0], ptip[
+0000da90: 315d 2c20 6e61 6d65 290a 2020 2020 2020  1], name).      
+0000daa0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000dab0: 2072 6574 7572 6e20 6876 2e4f 7665 726c   return hv.Overl
+0000dac0: 6179 2870 6c6f 7473 5f74 6f5f 6f76 6572  ay(plots_to_over
+0000dad0: 6c61 7929 2e6f 7074 7328 0a20 2020 2020  lay).opts(.     
+0000dae0: 2020 2020 2020 2073 686f 775f 6c65 6765         show_lege
+0000daf0: 6e64 3d54 7275 652c 2073 6861 7265 645f  nd=True, shared_
+0000db00: 6178 6573 3d46 616c 7365 2c20 796c 696d  axes=False, ylim
+0000db10: 3d28 625b 315d 2c20 625b 335d 292c 2078  =(b[1], b[3]), x
+0000db20: 6c69 6d3d 2862 5b30 5d2c 2062 5b32 5d29  lim=(b[0], b[2])
+0000db30: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000db40: 6465 6620 7368 6f77 280a 2020 2020 2020  def show(.      
+0000db50: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000db60: 7368 6f77 5f70 6f72 7473 3a20 626f 6f6c  show_ports: bool
+0000db70: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0000db80: 2020 7368 6f77 5f73 7562 706f 7274 733a    show_subports:
+0000db90: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+0000dba0: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
+0000dbb0: 6572 5f6c 6179 6572 3a20 4c61 7965 7220  er_layer: Layer 
+0000dbc0: 3d20 2831 2c20 3130 292c 0a20 2020 2020  = (1, 10),.     
+0000dbd0: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+0000dbe0: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
+0000dbf0: 2020 2020 2222 2253 686f 7720 636f 6d70      """Show comp
+0000dc00: 6f6e 656e 7420 696e 204b 4c61 796f 7574  onent in KLayout
+0000dc10: 2e0a 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+0000dc20: 6e73 2061 2063 6f70 7920 6f66 2074 6865  ns a copy of the
+0000dc30: 2043 6f6d 706f 6e65 6e74 2c20 736f 2074   Component, so t
+0000dc40: 6865 206f 7269 6769 6e61 6c20 636f 6d70  he original comp
+0000dc50: 6f6e 656e 7420 7265 6d61 696e 7320 696e  onent remains in
+0000dc60: 7461 6374 2e0a 2020 2020 2020 2020 7769  tact..        wi
+0000dc70: 7468 2070 696e 7320 6d61 726b 6572 7320  th pins markers 
+0000dc80: 6f6e 2065 6163 6820 706f 7274 2073 686f  on each port sho
+0000dc90: 775f 706f 7274 7320 3d20 5472 7565 2c20  w_ports = True, 
+0000dca0: 616e 6420 6f70 7469 6f6e 616c 6c79 2061  and optionally a
+0000dcb0: 6c73 6f0a 2020 2020 2020 2020 7468 6520  lso.        the 
+0000dcc0: 706f 7274 7320 6672 6f6d 2074 6865 2072  ports from the r
+0000dcd0: 6566 6572 656e 6365 7320 2873 686f 775f  eferences (show_
+0000dce0: 7375 6270 6f72 7473 3d54 7275 6529 0a0a  subports=True)..
+0000dcf0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+0000dd00: 2020 2020 2020 2020 2020 7368 6f77 5f70            show_p
+0000dd10: 6f72 7473 3a20 7368 6f77 7320 636f 6d70  orts: shows comp
+0000dd20: 6f6e 656e 7420 7769 7468 2070 6f72 7420  onent with port 
+0000dd30: 6d61 726b 6572 7320 616e 6420 6c61 6265  markers and labe
+0000dd40: 6c73 2e0a 2020 2020 2020 2020 2020 2020  ls..            
+0000dd50: 7368 6f77 5f73 7562 706f 7274 733a 2061  show_subports: a
+0000dd60: 6464 2070 6f72 7473 206d 6172 6b65 7273  dd ports markers
+0000dd70: 2061 6e64 206c 6162 656c 7320 746f 2072   and labels to r
+0000dd80: 6566 6572 656e 6365 732e 0a20 2020 2020  eferences..     
+0000dd90: 2020 2020 2020 2070 6f72 745f 6d61 726b         port_mark
+0000dda0: 6572 5f6c 6179 6572 3a20 666f 7220 7468  er_layer: for th
+0000ddb0: 6520 706f 7274 732e 0a0a 2020 2020 2020  e ports...      
+0000ddc0: 2020 4b65 7977 6f72 6420 4172 6773 3a0a    Keyword Args:.
+0000ddd0: 2020 2020 2020 2020 2020 2020 6764 7370              gdsp
+0000dde0: 6174 683a 2047 4453 2066 696c 6520 7061  ath: GDS file pa
+0000ddf0: 7468 2074 6f20 7772 6974 6520 746f 2e0a  th to write to..
+0000de00: 2020 2020 2020 2020 2020 2020 6764 7364              gdsd
+0000de10: 6972 3a20 6469 7265 6374 6f72 7920 666f  ir: directory fo
+0000de20: 7220 7468 6520 4744 5320 6669 6c65 2e20  r the GDS file. 
+0000de30: 4465 6661 756c 7473 2074 6f20 2f74 6d70  Defaults to /tmp
+0000de40: 2f2e 0a20 2020 2020 2020 2020 2020 2075  /..            u
+0000de50: 6e69 743a 2075 6e69 7420 7369 7a65 2066  nit: unit size f
+0000de60: 6f72 206f 626a 6563 7473 2069 6e20 6c69  or objects in li
+0000de70: 6272 6172 792e 2031 756d 2062 7920 6465  brary. 1um by de
+0000de80: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
+0000de90: 2020 2070 7265 6369 7369 6f6e 3a20 666f     precision: fo
+0000dea0: 7220 6f62 6a65 6374 2064 696d 656e 7369  r object dimensi
+0000deb0: 6f6e 7320 696e 2074 6865 206c 6962 7261  ons in the libra
+0000dec0: 7279 2028 6d29 2e20 316e 6d20 6279 2064  ry (m). 1nm by d
+0000ded0: 6566 6175 6c74 2e0a 2020 2020 2020 2020  efault..        
+0000dee0: 2020 2020 7469 6d65 7374 616d 703a 2044      timestamp: D
+0000def0: 6566 6175 6c74 7320 746f 2032 3031 392d  efaults to 2019-
+0000df00: 3130 2d32 352e 2049 6620 4e6f 6e65 2075  10-25. If None u
+0000df10: 7365 7320 6375 7272 656e 7420 7469 6d65  ses current time
+0000df20: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000df30: 2020 2020 2020 6672 6f6d 2067 6473 6661        from gdsfa
+0000df40: 6374 6f72 792e 6164 645f 7069 6e73 2069  ctory.add_pins i
+0000df50: 6d70 6f72 7420 6164 645f 7069 6e73 5f74  mport add_pins_t
+0000df60: 7269 616e 676c 650a 2020 2020 2020 2020  riangle.        
+0000df70: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000df80: 7368 6f77 2069 6d70 6f72 7420 7368 6f77  show import show
+0000df90: 0a0a 2020 2020 2020 2020 636f 6d70 6f6e  ..        compon
+0000dfa0: 656e 7420 3d20 280a 2020 2020 2020 2020  ent = (.        
+0000dfb0: 2020 2020 7365 6c66 2e61 6464 5f70 696e      self.add_pin
+0000dfc0: 735f 7472 6961 6e67 6c65 2870 6f72 745f  s_triangle(port_
+0000dfd0: 6d61 726b 6572 5f6c 6179 6572 3d70 6f72  marker_layer=por
+0000dfe0: 745f 6d61 726b 6572 5f6c 6179 6572 290a  t_marker_layer).
+0000dff0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000e000: 686f 775f 706f 7274 730a 2020 2020 2020  how_ports.      
+0000e010: 2020 2020 2020 656c 7365 2073 656c 660a        else self.
+0000e020: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000e030: 2020 2069 6620 7368 6f77 5f73 7562 706f     if show_subpo
+0000e040: 7274 733a 0a20 2020 2020 2020 2020 2020  rts:.           
+0000e050: 2063 6f6d 706f 6e65 6e74 203d 2073 656c   component = sel
+0000e060: 662e 636f 7079 2829 0a20 2020 2020 2020  f.copy().       
+0000e070: 2020 2020 2063 6f6d 706f 6e65 6e74 2e6e       component.n
+0000e080: 616d 6520 3d20 7365 6c66 2e6e 616d 650a  ame = self.name.
+0000e090: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000e0a0: 7265 6665 7265 6e63 6520 696e 2063 6f6d  reference in com
+0000e0b0: 706f 6e65 6e74 2e72 6566 6572 656e 6365  ponent.reference
+0000e0c0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000e0d0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000e0e0: 2863 6f6d 706f 6e65 6e74 2c20 436f 6d70  (component, Comp
+0000e0f0: 6f6e 656e 7452 6566 6572 656e 6365 293a  onentReference):
+0000e100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e110: 2020 2020 2061 6464 5f70 696e 735f 7472       add_pins_tr
+0000e120: 6961 6e67 6c65 280a 2020 2020 2020 2020  iangle(.        
+0000e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e140: 636f 6d70 6f6e 656e 743d 636f 6d70 6f6e  component=compon
+0000e150: 656e 742c 0a20 2020 2020 2020 2020 2020  ent,.           
+0000e160: 2020 2020 2020 2020 2020 2020 2072 6566               ref
+0000e170: 6572 656e 6365 3d72 6566 6572 656e 6365  erence=reference
+0000e180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e190: 2020 2020 2020 2020 2020 6c61 7965 723d            layer=
+0000e1a0: 706f 7274 5f6d 6172 6b65 725f 6c61 7965  port_marker_laye
+0000e1b0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0000e1c0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000e1d0: 2020 7368 6f77 2863 6f6d 706f 6e65 6e74    show(component
+0000e1e0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+0000e1f0: 2064 6566 205f 7772 6974 655f 6c69 6272   def _write_libr
+0000e200: 6172 7928 0a20 2020 2020 2020 2073 656c  ary(.        sel
+0000e210: 662c 0a20 2020 2020 2020 2067 6473 7061  f,.        gdspa
+0000e220: 7468 3a20 4f70 7469 6f6e 616c 5b50 6174  th: Optional[Pat
+0000e230: 6854 7970 655d 203d 204e 6f6e 652c 0a20  hType] = None,. 
+0000e240: 2020 2020 2020 2067 6473 6469 723a 204f         gdsdir: O
+0000e250: 7074 696f 6e61 6c5b 5061 7468 5479 7065  ptional[PathType
+0000e260: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0000e270: 2020 7469 6d65 7374 616d 703a 204f 7074    timestamp: Opt
+0000e280: 696f 6e61 6c5b 6461 7465 7469 6d65 2e64  ional[datetime.d
+0000e290: 6174 6574 696d 655d 203d 205f 7469 6d65  atetime] = _time
+0000e2a0: 7374 616d 7032 3031 392c 0a20 2020 2020  stamp2019,.     
+0000e2b0: 2020 206c 6f67 6769 6e67 3a20 626f 6f6c     logging: bool
+0000e2c0: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+0000e2d0: 2077 6974 685f 6f61 7369 733a 2062 6f6f   with_oasis: boo
+0000e2e0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+0000e2f0: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+0000e300: 2029 202d 3e20 5061 7468 3a0a 2020 2020   ) -> Path:.    
+0000e310: 2020 2020 2222 2257 7269 7465 2063 6f6d      """Write com
+0000e320: 706f 6e65 6e74 2074 6f20 4744 5320 6f72  ponent to GDS or
+0000e330: 204f 4153 4953 2061 6e64 2072 6574 7572   OASIS and retur
+0000e340: 6e73 2067 6473 7061 7468 2e0a 0a20 2020  ns gdspath...   
+0000e350: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+0000e360: 2020 2020 2020 2067 6473 7061 7468 3a20         gdspath: 
+0000e370: 4744 5320 6669 6c65 2070 6174 6820 746f  GDS file path to
+0000e380: 2077 7269 7465 2074 6f2e 0a20 2020 2020   write to..     
+0000e390: 2020 2020 2020 2067 6473 6469 723a 2064         gdsdir: d
+0000e3a0: 6972 6563 746f 7279 2066 6f72 2074 6865  irectory for the
+0000e3b0: 2047 4453 2066 696c 652e 2044 6566 6175   GDS file. Defau
+0000e3c0: 6c74 7320 746f 202f 746d 702f 7261 6e64  lts to /tmp/rand
+0000e3d0: 6f6d 4669 6c65 2f67 6473 6661 6374 6f72  omFile/gdsfactor
+0000e3e0: 792e 0a20 2020 2020 2020 2020 2020 2074  y..            t
+0000e3f0: 696d 6573 7461 6d70 3a20 4465 6661 756c  imestamp: Defaul
+0000e400: 7473 2074 6f20 3230 3139 2d31 302d 3235  ts to 2019-10-25
+0000e410: 2066 6f72 2063 6f6e 7369 7374 656e 7420   for consistent 
+0000e420: 6861 7368 2e0a 2020 2020 2020 2020 2020  hash..          
+0000e430: 2020 2020 2020 4966 204e 6f6e 6520 7573        If None us
+0000e440: 6573 2063 7572 7265 6e74 2074 696d 652e  es current time.
+0000e450: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+0000e460: 6769 6e67 3a20 6469 7361 626c 6520 4744  ging: disable GD
+0000e470: 5320 7061 7468 206c 6f67 6769 6e67 2c20  S path logging, 
+0000e480: 666f 7220 6578 616d 706c 6520 666f 7220  for example for 
+0000e490: 7368 6f77 696e 6720 6974 2069 6e20 4b4c  showing it in KL
+0000e4a0: 6179 6f75 742e 0a20 2020 2020 2020 2020  ayout..         
+0000e4b0: 2020 2077 6974 685f 6f61 7369 733a 2049     with_oasis: I
+0000e4c0: 6620 5472 7565 2c20 6669 6c65 2077 696c  f True, file wil
+0000e4d0: 6c20 6265 2077 7269 7474 656e 2074 6f20  l be written to 
+0000e4e0: 4f41 5349 532e 204f 7468 6572 7769 7365  OASIS. Otherwise
+0000e4f0: 2c20 6669 6c65 2077 696c 6c20 6265 2077  , file will be w
+0000e500: 7269 7474 656e 2074 6f20 4744 532e 0a0a  ritten to GDS...
+0000e510: 2020 2020 2020 2020 4b65 7977 6f72 6420          Keyword 
+0000e520: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000e530: 2020 4b65 7977 6f72 6420 6172 6775 6d65    Keyword argume
+0000e540: 6e74 7320 7769 6c6c 206f 7665 7272 6964  nts will overrid
+0000e550: 6520 7468 6520 6163 7469 7665 2050 444b  e the active PDK
+0000e560: 2773 2064 6566 6175 6c74 2047 6473 5772  's default GdsWr
+0000e570: 6974 6553 6574 7469 6e67 7320 616e 6420  iteSettings and 
+0000e580: 4f61 7369 7357 7269 7465 5365 7474 696e  OasisWriteSettin
+0000e590: 6773 2e0a 0a20 2020 2020 2020 2020 2020  gs...           
+0000e5a0: 2047 6473 2073 6574 7469 6e67 733a 0a20   Gds settings:. 
+0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0000e5c0: 6e69 743a 2075 6e69 7420 7369 7a65 2066  nit: unit size f
+0000e5d0: 6f72 206f 626a 6563 7473 2069 6e20 6c69  or objects in li
+0000e5e0: 6272 6172 792e 2031 756d 2062 7920 6465  brary. 1um by de
+0000e5f0: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
+0000e600: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+0000e610: 3a20 666f 7220 6469 6d65 6e73 696f 6e73  : for dimensions
+0000e620: 2069 6e20 7468 6520 6c69 6272 6172 7920   in the library 
+0000e630: 286d 292e 2031 6e6d 2062 7920 6465 6661  (m). 1nm by defa
+0000e640: 756c 742e 0a20 2020 2020 2020 2020 2020  ult..           
+0000e650: 2020 2020 206f 6e5f 6475 706c 6963 6174       on_duplicat
+0000e660: 655f 6365 6c6c 3a20 7370 6563 6966 7920  e_cell: specify 
+0000e670: 686f 7720 746f 2072 6573 6f6c 7665 2064  how to resolve d
+0000e680: 7570 6c69 6361 7465 2d6e 616d 6564 2063  uplicate-named c
+0000e690: 656c 6c73 2e20 4368 6f6f 7365 206f 6e65  ells. Choose one
+0000e6a0: 206f 6620 7468 6520 666f 6c6c 6f77 696e   of the followin
+0000e6b0: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+0000e6c0: 2020 2020 2020 2022 7761 726e 2220 2864         "warn" (d
+0000e6d0: 6566 6175 6c74 293a 206f 7665 7277 7269  efault): overwri
+0000e6e0: 7465 2061 6c6c 2064 7570 6c69 6361 7465  te all duplicate
+0000e6f0: 2063 656c 6c73 2077 6974 6820 6f6e 6520   cells with one 
+0000e700: 6f66 2074 6865 2064 7570 6c69 6361 7465  of the duplicate
+0000e710: 7320 2861 7262 6974 7261 7269 6c79 292e  s (arbitrarily).
+0000e720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e730: 2020 2020 2022 6572 726f 7222 3a20 7468       "error": th
+0000e740: 726f 7720 6120 5661 6c75 6545 7272 6f72  row a ValueError
+0000e750: 2077 6865 6e20 6174 7465 6d70 7469 6e67   when attempting
+0000e760: 2074 6f20 7772 6974 6520 6120 6764 7320   to write a gds 
+0000e770: 7769 7468 2064 7570 6c69 6361 7465 2063  with duplicate c
+0000e780: 656c 6c73 2e0a 2020 2020 2020 2020 2020  ells..          
+0000e790: 2020 2020 2020 2020 2020 226f 7665 7277            "overw
+0000e7a0: 7269 7465 223a 206f 7665 7277 7269 7465  rite": overwrite
+0000e7b0: 2061 6c6c 2064 7570 6c69 6361 7465 2063   all duplicate c
+0000e7c0: 656c 6c73 2077 6974 6820 6f6e 6520 6f66  ells with one of
+0000e7d0: 2074 6865 2064 7570 6c69 6361 7465 732c   the duplicates,
+0000e7e0: 2077 6974 686f 7574 2077 6172 6e69 6e67   without warning
+0000e7f0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e800: 2020 2020 2020 4e6f 6e65 3a20 646f 206e        None: do n
+0000e810: 6f74 2074 7279 2074 6f20 7265 736f 6c76  ot try to resolv
+0000e820: 6520 2861 7420 796f 7572 206f 776e 2072  e (at your own r
+0000e830: 6973 6b21 290a 2020 2020 2020 2020 2020  isk!).          
+0000e840: 2020 2020 2020 666c 6174 7465 6e5f 696e        flatten_in
+0000e850: 7661 6c69 645f 7265 6673 3a20 666c 6174  valid_refs: flat
+0000e860: 7465 6e73 2063 6f6d 706f 6e65 6e74 2072  tens component r
+0000e870: 6566 6572 656e 6365 7320 7768 6963 6820  eferences which 
+0000e880: 6861 7665 2069 6e76 616c 6964 2074 7261  have invalid tra
+0000e890: 6e73 666f 726d 6174 696f 6e73 2e0a 2020  nsformations..  
+0000e8a0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0000e8b0: 785f 706f 696e 7473 3a20 4d61 7869 6d61  x_points: Maxima
+0000e8c0: 6c20 6e75 6d62 6572 206f 6620 7665 7274  l number of vert
+0000e8d0: 6963 6573 2070 6572 2070 6f6c 7967 6f6e  ices per polygon
+0000e8e0: 2e20 506f 6c79 676f 6e73 2077 6974 6820  . Polygons with 
+0000e8f0: 6d6f 7265 2076 6572 7469 6365 7320 7468  more vertices th
+0000e900: 6174 2074 6869 7320 6172 6520 6175 746f  at this are auto
+0000e910: 6d61 7469 6361 6c6c 7920 6672 6163 7475  matically fractu
+0000e920: 7265 642e 0a0a 2020 2020 2020 2020 2020  red...          
+0000e930: 2020 4f61 7369 7320 7365 7474 696e 6773    Oasis settings
+0000e940: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e950: 2020 636f 6d70 7265 7373 696f 6e5f 6c65    compression_le
+0000e960: 7665 6c3a 204c 6576 656c 206f 6620 636f  vel: Level of co
+0000e970: 6d70 7265 7373 696f 6e20 666f 7220 6365  mpression for ce
+0000e980: 6c6c 7320 2862 6574 7765 656e 2030 2061  lls (between 0 a
+0000e990: 6e64 2039 292e 0a20 2020 2020 2020 2020  nd 9)..         
+0000e9a0: 2020 2020 2020 2020 2020 2053 6574 7469             Setti
+0000e9b0: 6e67 2074 6f20 3020 7769 6c6c 2064 6973  ng to 0 will dis
+0000e9c0: 6162 6c65 2063 656c 6c20 636f 6d70 7265  able cell compre
+0000e9d0: 7373 696f 6e2c 2031 2067 6976 6573 2074  ssion, 1 gives t
+0000e9e0: 6865 2062 6573 7420 7370 6565 6420 616e  he best speed an
+0000e9f0: 6420 392c 2074 6865 2062 6573 7420 636f  d 9, the best co
+0000ea00: 6d70 7265 7373 696f 6e2e 0a20 2020 2020  mpression..     
+0000ea10: 2020 2020 2020 2020 2020 2064 6574 6563             detec
+0000ea20: 745f 7265 6374 616e 676c 6573 3a20 5374  t_rectangles: St
+0000ea30: 6f72 6520 7265 6374 616e 676c 6573 2069  ore rectangles i
+0000ea40: 6e20 636f 6d70 7265 7373 6564 2066 6f72  n compressed for
+0000ea50: 6d61 742e 0a20 2020 2020 2020 2020 2020  mat..           
+0000ea60: 2020 2020 2064 6574 6563 745f 7472 6170       detect_trap
+0000ea70: 657a 6f69 6473 3a20 5374 6f72 6520 7472  ezoids: Store tr
+0000ea80: 6170 657a 6f69 6473 2069 6e20 636f 6d70  apezoids in comp
+0000ea90: 7265 7373 6564 2066 6f72 6d61 742e 0a20  ressed format.. 
+0000eaa0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000eab0: 6972 636c 655f 746f 6c65 7261 6e63 653a  ircle_tolerance:
+0000eac0: 2054 6f6c 6572 616e 6365 2066 6f72 2064   Tolerance for d
+0000ead0: 6574 6563 7469 6e67 2063 6972 636c 6573  etecting circles
+0000eae0: 2e20 4966 206c 6573 7320 6f72 2065 7175  . If less or equ
+0000eaf0: 616c 2074 6f20 302c 206e 6f20 6465 7465  al to 0, no dete
+0000eb00: 6374 696f 6e20 6973 2070 6572 666f 726d  ction is perform
+0000eb10: 6564 2e20 4369 7263 6c65 7320 6172 6520  ed. Circles are 
+0000eb20: 7374 6f72 6564 2069 6e20 636f 6d70 7265  stored in compre
+0000eb30: 7373 6564 2066 6f72 6d61 742e 0a20 2020  ssed format..   
+0000eb40: 2020 2020 2020 2020 2020 2020 2076 616c               val
+0000eb50: 6964 6174 696f 6e20 2822 6372 6333 3222  idation ("crc32"
+0000eb60: 2c20 2263 6865 636b 7375 6d33 3222 2c20  , "checksum32", 
+0000eb70: 4e6f 6e65 293a 2074 7970 6520 6f66 2076  None): type of v
+0000eb80: 616c 6964 6174 696f 6e20 746f 2069 6e63  alidation to inc
+0000eb90: 6c75 6465 2069 6e20 7468 6520 7361 7665  lude in the save
+0000eba0: 6420 6669 6c65 2e0a 2020 2020 2020 2020  d file..        
+0000ebb0: 2020 2020 2020 2020 7374 616e 6461 7264          standard
+0000ebc0: 5f70 726f 7065 7274 6965 733a 2053 746f  _properties: Sto
+0000ebd0: 7265 2073 7461 6e64 6172 6420 4f41 5349  re standard OASI
+0000ebe0: 5320 7072 6f70 6572 7469 6573 2069 6e20  S properties in 
+0000ebf0: 7468 6520 6669 6c65 2e0a 0a20 2020 2020  the file...     
+0000ec00: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+0000ec10: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+0000ec20: 7064 6b20 696d 706f 7274 2067 6574 5f61  pdk import get_a
+0000ec30: 6374 6976 655f 7064 6b0a 0a20 2020 2020  ctive_pdk..     
+0000ec40: 2020 2069 6620 6764 7370 6174 6820 616e     if gdspath an
+0000ec50: 6420 6764 7364 6972 3a0a 2020 2020 2020  d gdsdir:.      
+0000ec60: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
+0000ec70: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
+0000ec80: 2020 2020 2022 6764 7370 6174 6820 616e       "gdspath an
+0000ec90: 6420 6764 7364 6972 2068 6176 6520 626f  d gdsdir have bo
+0000eca0: 7468 2062 6565 6e20 7370 6563 6966 6965  th been specifie
+0000ecb0: 642e 2067 6473 7061 7468 2077 696c 6c20  d. gdspath will 
+0000ecc0: 7461 6b65 2070 7265 6365 6465 6e63 6520  take precedence 
+0000ecd0: 616e 6420 6764 7364 6972 2077 696c 6c20  and gdsdir will 
+0000ece0: 6265 2069 676e 6f72 6564 2e22 0a20 2020  be ignored.".   
+0000ecf0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0000ed00: 2020 2020 6465 6661 756c 745f 7365 7474      default_sett
+0000ed10: 696e 6773 203d 2067 6574 5f61 6374 6976  ings = get_activ
+0000ed20: 655f 7064 6b28 292e 6764 735f 7772 6974  e_pdk().gds_writ
+0000ed30: 655f 7365 7474 696e 6773 0a20 2020 2020  e_settings.     
+0000ed40: 2020 2064 6566 6175 6c74 5f6f 6173 6973     default_oasis
+0000ed50: 5f73 6574 7469 6e67 7320 3d20 6765 745f  _settings = get_
+0000ed60: 6163 7469 7665 5f70 646b 2829 2e6f 6173  active_pdk().oas
+0000ed70: 6973 5f73 6574 7469 6e67 730a 0a20 2020  is_settings..   
+0000ed80: 2020 2020 2065 7870 6c69 6369 745f 6764       explicit_gd
+0000ed90: 735f 7365 7474 696e 6773 203d 207b 0a20  s_settings = {. 
+0000eda0: 2020 2020 2020 2020 2020 206b 3a20 760a             k: v.
+0000edb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000edc0: 6b2c 2076 2069 6e20 6b77 6172 6773 2e69  k, v in kwargs.i
+0000edd0: 7465 6d73 2829 0a20 2020 2020 2020 2020  tems().         
+0000ede0: 2020 2069 6620 7620 6973 206e 6f74 204e     if v is not N
+0000edf0: 6f6e 6520 616e 6420 6b20 696e 2064 6566  one and k in def
+0000ee00: 6175 6c74 5f73 6574 7469 6e67 732e 6469  ault_settings.di
+0000ee10: 6374 2829 0a20 2020 2020 2020 207d 0a20  ct().        }. 
+0000ee20: 2020 2020 2020 2065 7870 6c69 6369 745f         explicit_
+0000ee30: 6f61 735f 7365 7474 696e 6773 203d 207b  oas_settings = {
+0000ee40: 0a20 2020 2020 2020 2020 2020 206b 3a20  .            k: 
+0000ee50: 760a 2020 2020 2020 2020 2020 2020 666f  v.            fo
+0000ee60: 7220 6b2c 2076 2069 6e20 6b77 6172 6773  r k, v in kwargs
+0000ee70: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
+0000ee80: 2020 2020 2069 6620 7620 6973 206e 6f74       if v is not
+0000ee90: 204e 6f6e 6520 616e 6420 6b20 696e 2064   None and k in d
+0000eea0: 6566 6175 6c74 5f6f 6173 6973 5f73 6574  efault_oasis_set
+0000eeb0: 7469 6e67 732e 6469 6374 2829 0a20 2020  tings.dict().   
+0000eec0: 2020 2020 207d 0a20 2020 2020 2020 2023       }.        #
+0000eed0: 2075 7064 6174 6520 7468 6520 7772 6974   update the writ
+0000eee0: 6520 7365 7474 696e 6773 2077 6974 6820  e settings with 
+0000eef0: 616e 7920 7365 7474 696e 6773 2065 7870  any settings exp
+0000ef00: 6c69 6369 746c 7920 7061 7373 6564 0a20  licitly passed. 
+0000ef10: 2020 2020 2020 2077 7269 7465 5f73 6574         write_set
+0000ef20: 7469 6e67 7320 3d20 6465 6661 756c 745f  tings = default_
+0000ef30: 7365 7474 696e 6773 2e63 6f70 7928 7570  settings.copy(up
+0000ef40: 6461 7465 3d65 7870 6c69 6369 745f 6764  date=explicit_gd
+0000ef50: 735f 7365 7474 696e 6773 290a 2020 2020  s_settings).    
+0000ef60: 2020 2020 6f61 7369 735f 7365 7474 696e      oasis_settin
+0000ef70: 6773 203d 2064 6566 6175 6c74 5f6f 6173  gs = default_oas
+0000ef80: 6973 5f73 6574 7469 6e67 732e 636f 7079  is_settings.copy
+0000ef90: 2875 7064 6174 653d 6578 706c 6963 6974  (update=explicit
+0000efa0: 5f6f 6173 5f73 6574 7469 6e67 7329 0a0a  _oas_settings)..
+0000efb0: 2020 2020 2020 2020 5f63 6865 636b 5f75          _check_u
+0000efc0: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
+0000efd0: 7473 280a 2020 2020 2020 2020 2020 2020  ts(.            
+0000efe0: 636f 6d70 6f6e 656e 743d 7365 6c66 2c20  component=self, 
+0000eff0: 6d6f 6465 3d77 7269 7465 5f73 6574 7469  mode=write_setti
+0000f000: 6e67 732e 6f6e 5f75 6e63 6163 6865 645f  ngs.on_uncached_
+0000f010: 636f 6d70 6f6e 656e 740a 2020 2020 2020  component.      
+0000f020: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+0000f030: 7772 6974 655f 7365 7474 696e 6773 2e66  write_settings.f
+0000f040: 6c61 7474 656e 5f69 6e76 616c 6964 5f72  latten_invalid_r
+0000f050: 6566 733a 0a20 2020 2020 2020 2020 2020  efs:.           
+0000f060: 2074 6f70 5f63 656c 6c20 3d20 666c 6174   top_cell = flat
+0000f070: 7465 6e5f 696e 7661 6c69 645f 7265 6673  ten_invalid_refs
+0000f080: 5f72 6563 7572 7369 7665 2873 656c 6629  _recursive(self)
+0000f090: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000f0a0: 2020 2020 2020 2020 2020 2074 6f70 5f63             top_c
+0000f0b0: 656c 6c20 3d20 7365 6c66 0a0a 2020 2020  ell = self..    
+0000f0c0: 2020 2020 6764 7364 6972 203d 2067 6473      gdsdir = gds
+0000f0d0: 6469 7220 6f72 2047 4453 4449 525f 5445  dir or GDSDIR_TE
+0000f0e0: 4d50 0a20 2020 2020 2020 2067 6473 6469  MP.        gdsdi
+0000f0f0: 7220 3d20 7061 7468 6c69 622e 5061 7468  r = pathlib.Path
+0000f100: 2867 6473 6469 7229 0a20 2020 2020 2020  (gdsdir).       
+0000f110: 2069 6620 7769 7468 5f6f 6173 6973 3a0a   if with_oasis:.
+0000f120: 2020 2020 2020 2020 2020 2020 6764 7370              gdsp
+0000f130: 6174 6820 3d20 6764 7370 6174 6820 6f72  ath = gdspath or
+0000f140: 2067 6473 6469 7220 2f20 6622 7b74 6f70   gdsdir / f"{top
+0000f150: 5f63 656c 6c2e 6e61 6d65 7d2e 6f61 7322  _cell.name}.oas"
+0000f160: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000f170: 2020 2020 2020 2020 2020 2067 6473 7061             gdspa
+0000f180: 7468 203d 2067 6473 7061 7468 206f 7220  th = gdspath or 
+0000f190: 6764 7364 6972 202f 2066 227b 746f 705f  gdsdir / f"{top_
+0000f1a0: 6365 6c6c 2e6e 616d 657d 2e67 6473 220a  cell.name}.gds".
+0000f1b0: 2020 2020 2020 2020 6764 7370 6174 6820          gdspath 
+0000f1c0: 3d20 7061 7468 6c69 622e 5061 7468 2867  = pathlib.Path(g
+0000f1d0: 6473 7061 7468 290a 2020 2020 2020 2020  dspath).        
+0000f1e0: 6764 7364 6972 203d 2067 6473 7061 7468  gdsdir = gdspath
+0000f1f0: 2e70 6172 656e 740a 2020 2020 2020 2020  .parent.        
+0000f200: 6764 7364 6972 2e6d 6b64 6972 2865 7869  gdsdir.mkdir(exi
+0000f210: 7374 5f6f 6b3d 5472 7565 2c20 7061 7265  st_ok=True, pare
+0000f220: 6e74 733d 5472 7565 290a 0a20 2020 2020  nts=True)..     
+0000f230: 2020 2063 656c 6c73 203d 2074 6f70 5f63     cells = top_c
+0000f240: 656c 6c2e 6765 745f 6465 7065 6e64 656e  ell.get_dependen
+0000f250: 6369 6573 2872 6563 7572 7369 7665 3d54  cies(recursive=T
+0000f260: 7275 6529 0a20 2020 2020 2020 2063 656c  rue).        cel
+0000f270: 6c5f 6e61 6d65 7320 3d20 5b63 656c 6c2e  l_names = [cell.
+0000f280: 6e61 6d65 2066 6f72 2063 656c 6c20 696e  name for cell in
+0000f290: 206c 6973 7428 6365 6c6c 7329 5d0a 2020   list(cells)].  
+0000f2a0: 2020 2020 2020 6365 6c6c 5f6e 616d 6573        cell_names
+0000f2b0: 5f75 6e69 7175 6520 3d20 7365 7428 6365  _unique = set(ce
+0000f2c0: 6c6c 5f6e 616d 6573 290a 0a20 2020 2020  ll_names)..     
+0000f2d0: 2020 2069 6620 6c65 6e28 6365 6c6c 5f6e     if len(cell_n
+0000f2e0: 616d 6573 2920 213d 206c 656e 2873 6574  ames) != len(set
+0000f2f0: 2863 656c 6c5f 6e61 6d65 7329 293a 0a20  (cell_names)):. 
+0000f300: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+0000f310: 656c 6c5f 6e61 6d65 2069 6e20 6365 6c6c  ell_name in cell
+0000f320: 5f6e 616d 6573 5f75 6e69 7175 653a 0a20  _names_unique:. 
+0000f330: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000f340: 656c 6c5f 6e61 6d65 732e 7265 6d6f 7665  ell_names.remove
+0000f350: 2863 656c 6c5f 6e61 6d65 290a 0a20 2020  (cell_name)..   
+0000f360: 2020 2020 2020 2020 2069 6620 7772 6974           if writ
+0000f370: 655f 7365 7474 696e 6773 2e6f 6e5f 6475  e_settings.on_du
+0000f380: 706c 6963 6174 655f 6365 6c6c 203d 3d20  plicate_cell == 
+0000f390: 2265 7272 6f72 223a 0a20 2020 2020 2020  "error":.       
+0000f3a0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0000f3b0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+0000f3c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000f3d0: 2244 7570 6c69 6361 7465 6420 6365 6c6c  "Duplicated cell
+0000f3e0: 206e 616d 6573 2069 6e20 7b74 6f70 5f63   names in {top_c
+0000f3f0: 656c 6c2e 6e61 6d65 2172 7d3a 207b 6365  ell.name!r}: {ce
+0000f400: 6c6c 5f6e 616d 6573 2172 7d22 0a20 2020  ll_names!r}".   
+0000f410: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0000f420: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+0000f430: 7772 6974 655f 7365 7474 696e 6773 2e6f  write_settings.o
+0000f440: 6e5f 6475 706c 6963 6174 655f 6365 6c6c  n_duplicate_cell
+0000f450: 2069 6e20 7b22 7761 726e 222c 2022 6f76   in {"warn", "ov
+0000f460: 6572 7772 6974 6522 7d3a 0a20 2020 2020  erwrite"}:.     
+0000f470: 2020 2020 2020 2020 2020 2069 6620 7772             if wr
+0000f480: 6974 655f 7365 7474 696e 6773 2e6f 6e5f  ite_settings.on_
+0000f490: 6475 706c 6963 6174 655f 6365 6c6c 203d  duplicate_cell =
+0000f4a0: 3d20 2277 6172 6e22 3a0a 2020 2020 2020  = "warn":.      
+0000f4b0: 2020 2020 2020 2020 2020 2020 2020 7761                wa
+0000f4c0: 726e 696e 6773 2e77 6172 6e28 0a20 2020  rnings.warn(.   
+0000f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4e0: 2020 2020 2066 2244 7570 6c69 6361 7465       f"Duplicate
+0000f4f0: 6420 6365 6c6c 206e 616d 6573 2069 6e20  d cell names in 
+0000f500: 7b74 6f70 5f63 656c 6c2e 6e61 6d65 2172  {top_cell.name!r
+0000f510: 7d3a 2020 7b63 656c 6c5f 6e61 6d65 737d  }:  {cell_names}
+0000f520: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000f530: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000f540: 2020 2020 2020 2020 2063 656c 6c73 5f64           cells_d
+0000f550: 6963 7420 3d20 7b63 656c 6c2e 6e61 6d65  ict = {cell.name
+0000f560: 3a20 6365 6c6c 2e5f 6365 6c6c 2066 6f72  : cell._cell for
+0000f570: 2063 656c 6c20 696e 2063 656c 6c73 7d0a   cell in cells}.
+0000f580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f590: 6365 6c6c 7320 3d20 6365 6c6c 735f 6469  cells = cells_di
+0000f5a0: 6374 2e76 616c 7565 7328 290a 2020 2020  ct.values().    
+0000f5b0: 2020 2020 2020 2020 656c 6966 2077 7269          elif wri
+0000f5c0: 7465 5f73 6574 7469 6e67 732e 6f6e 5f64  te_settings.on_d
+0000f5d0: 7570 6c69 6361 7465 5f63 656c 6c20 6973  uplicate_cell is
+0000f5e0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000f5f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000f600: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0000f610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f620: 2066 226f 6e5f 6475 706c 6963 6174 655f   f"on_duplicate_
+0000f630: 6365 6c6c 3a20 7b77 7269 7465 5f73 6574  cell: {write_set
+0000f640: 7469 6e67 732e 6f6e 5f64 7570 6c69 6361  tings.on_duplica
+0000f650: 7465 5f63 656c 6c21 727d 206e 6f74 2069  te_cell!r} not i
+0000f660: 6e20 284e 6f6e 652c 2077 6172 6e2c 2065  n (None, warn, e
+0000f670: 7272 6f72 2c20 6f76 6572 7772 6974 6529  rror, overwrite)
+0000f680: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000f690: 2020 290a 0a20 2020 2020 2020 2061 6c6c    )..        all
+0000f6a0: 5f63 656c 6c73 203d 205b 746f 705f 6365  _cells = [top_ce
+0000f6b0: 6c6c 2e5f 6365 6c6c 5d20 2b20 736f 7274  ll._cell] + sort
+0000f6c0: 6564 2863 656c 6c73 2c20 6b65 793d 6c61  ed(cells, key=la
+0000f6d0: 6d62 6461 2063 633a 2063 632e 6e61 6d65  mbda cc: cc.name
+0000f6e0: 290a 0a20 2020 2020 2020 206e 6f5f 6e61  )..        no_na
+0000f6f0: 6d65 5f63 656c 6c73 203d 205b 0a20 2020  me_cells = [.   
+0000f700: 2020 2020 2020 2020 2063 656c 6c2e 6e61           cell.na
+0000f710: 6d65 2066 6f72 2063 656c 6c20 696e 2061  me for cell in a
+0000f720: 6c6c 5f63 656c 6c73 2069 6620 6365 6c6c  ll_cells if cell
+0000f730: 2e6e 616d 652e 7374 6172 7473 7769 7468  .name.startswith
+0000f740: 2822 556e 6e61 6d65 6422 290a 2020 2020  ("Unnamed").    
+0000f750: 2020 2020 5d0a 0a20 2020 2020 2020 2069      ]..        i
+0000f760: 6620 6e6f 5f6e 616d 655f 6365 6c6c 733a  f no_name_cells:
+0000f770: 0a20 2020 2020 2020 2020 2020 2077 6172  .            war
+0000f780: 6e69 6e67 732e 7761 726e 280a 2020 2020  nings.warn(.    
+0000f790: 2020 2020 2020 2020 2020 2020 6622 436f              f"Co
+0000f7a0: 6d70 6f6e 656e 7420 7b74 6f70 5f63 656c  mponent {top_cel
+0000f7b0: 6c2e 6e61 6d65 2172 7d20 636f 6e74 6169  l.name!r} contai
+0000f7c0: 6e73 207b 6c65 6e28 6e6f 5f6e 616d 655f  ns {len(no_name_
+0000f7d0: 6365 6c6c 7329 7d20 556e 6e61 6d65 6420  cells)} Unnamed 
+0000f7e0: 6365 6c6c 7322 0a20 2020 2020 2020 2020  cells".         
+0000f7f0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+0000f800: 666f 7220 6365 6c6c 2069 6e20 616c 6c5f  for cell in all_
+0000f810: 6365 6c6c 733a 0a20 2020 2020 2020 2023  cells:.        #
+0000f820: 2020 2020 2070 7269 6e74 2863 656c 6c2e       print(cell.
+0000f830: 6e61 6d65 2c20 7479 7065 2863 656c 6c29  name, type(cell)
+0000f840: 290a 0a20 2020 2020 2020 206c 6962 203d  )..        lib =
+0000f850: 2067 6473 746b 2e4c 6962 7261 7279 280a   gdstk.Library(.
+0000f860: 2020 2020 2020 2020 2020 2020 756e 6974              unit
+0000f870: 3d77 7269 7465 5f73 6574 7469 6e67 732e  =write_settings.
+0000f880: 756e 6974 2c20 7072 6563 6973 696f 6e3d  unit, precision=
+0000f890: 7772 6974 655f 7365 7474 696e 6773 2e70  write_settings.p
+0000f8a0: 7265 6369 7369 6f6e 0a20 2020 2020 2020  recision.       
+0000f8b0: 2029 0a20 2020 2020 2020 206c 6962 2e61   ).        lib.a
+0000f8c0: 6464 2874 6f70 5f63 656c 6c2e 5f63 656c  dd(top_cell._cel
+0000f8d0: 6c29 0a20 2020 2020 2020 206c 6962 2e61  l).        lib.a
+0000f8e0: 6464 282a 746f 705f 6365 6c6c 2e5f 6365  dd(*top_cell._ce
+0000f8f0: 6c6c 2e64 6570 656e 6465 6e63 6965 7328  ll.dependencies(
+0000f900: 5472 7565 2929 0a0a 2020 2020 2020 2020  True))..        
+0000f910: 6966 2077 6974 685f 6f61 7369 733a 0a20  if with_oasis:. 
+0000f920: 2020 2020 2020 2020 2020 206c 6962 2e77             lib.w
+0000f930: 7269 7465 5f6f 6173 2867 6473 7061 7468  rite_oas(gdspath
+0000f940: 2c20 2a2a 6f61 7369 735f 7365 7474 696e  , **oasis_settin
+0000f950: 6773 2e64 6963 7428 2929 0a20 2020 2020  gs.dict()).     
+0000f960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000f970: 2020 2020 206c 6962 2e77 7269 7465 5f67       lib.write_g
+0000f980: 6473 280a 2020 2020 2020 2020 2020 2020  ds(.            
+0000f990: 2020 2020 6764 7370 6174 682c 2074 696d      gdspath, tim
+0000f9a0: 6573 7461 6d70 3d74 696d 6573 7461 6d70  estamp=timestamp
+0000f9b0: 2c20 6d61 785f 706f 696e 7473 3d77 7269  , max_points=wri
+0000f9c0: 7465 5f73 6574 7469 6e67 732e 6d61 785f  te_settings.max_
+0000f9d0: 706f 696e 7473 0a20 2020 2020 2020 2020  points.         
+0000f9e0: 2020 2029 0a20 2020 2020 2020 2069 6620     ).        if 
+0000f9f0: 6c6f 6767 696e 673a 0a20 2020 2020 2020  logging:.       
+0000fa00: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+0000fa10: 2866 2257 726f 7465 2074 6f20 7b73 7472  (f"Wrote to {str
+0000fa20: 2867 6473 7061 7468 2921 727d 2229 0a20  (gdspath)!r}"). 
+0000fa30: 2020 2020 2020 2072 6574 7572 6e20 6764         return gd
+0000fa40: 7370 6174 680a 0a20 2020 2064 6566 2077  spath..    def w
+0000fa50: 7269 7465 5f67 6473 280a 2020 2020 2020  rite_gds(.      
+0000fa60: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000fa70: 6764 7370 6174 683a 204f 7074 696f 6e61  gdspath: Optiona
+0000fa80: 6c5b 5061 7468 5479 7065 5d20 3d20 4e6f  l[PathType] = No
+0000fa90: 6e65 2c0a 2020 2020 2020 2020 6764 7364  ne,.        gdsd
+0000faa0: 6972 3a20 4f70 7469 6f6e 616c 5b50 6174  ir: Optional[Pat
+0000fab0: 6854 7970 655d 203d 204e 6f6e 652c 0a20  hType] = None,. 
+0000fac0: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
+0000fad0: 0a20 2020 2029 202d 3e20 5061 7468 3a0a  .    ) -> Path:.
+0000fae0: 2020 2020 2020 2020 2222 2257 7269 7465          """Write
+0000faf0: 2063 6f6d 706f 6e65 6e74 2074 6f20 4744   component to GD
+0000fb00: 5320 616e 6420 7265 7475 726e 7320 6764  S and returns gd
+0000fb10: 7370 6174 682e 0a0a 2020 2020 2020 2020  spath...        
+0000fb20: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
+0000fb30: 2020 6764 7370 6174 683a 2047 4453 2066    gdspath: GDS f
+0000fb40: 696c 6520 7061 7468 2074 6f20 7772 6974  ile path to writ
+0000fb50: 6520 746f 2e0a 2020 2020 2020 2020 2020  e to..          
+0000fb60: 2020 6764 7364 6972 3a20 6469 7265 6374    gdsdir: direct
+0000fb70: 6f72 7920 666f 7220 7468 6520 4744 5320  ory for the GDS 
+0000fb80: 6669 6c65 2e20 4465 6661 756c 7473 2074  file. Defaults t
+0000fb90: 6f20 2f74 6d70 2f72 616e 646f 6d46 696c  o /tmp/randomFil
+0000fba0: 652f 6764 7366 6163 746f 7279 2e0a 0a20  e/gdsfactory... 
+0000fbb0: 2020 2020 2020 204b 6579 776f 7264 2041         Keyword A
+0000fbc0: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0000fbd0: 2075 6e69 743a 2075 6e69 7420 7369 7a65   unit: unit size
+0000fbe0: 2066 6f72 206f 626a 6563 7473 2069 6e20   for objects in 
+0000fbf0: 6c69 6272 6172 792e 2031 756d 2062 7920  library. 1um by 
+0000fc00: 6465 6661 756c 742e 0a20 2020 2020 2020  default..       
+0000fc10: 2020 2020 2070 7265 6369 7369 6f6e 3a20       precision: 
+0000fc20: 666f 7220 6469 6d65 6e73 696f 6e73 2069  for dimensions i
+0000fc30: 6e20 7468 6520 6c69 6272 6172 7920 286d  n the library (m
+0000fc40: 292e 2031 6e6d 2062 7920 6465 6661 756c  ). 1nm by defaul
+0000fc50: 742e 0a20 2020 2020 2020 2020 2020 206c  t..            l
+0000fc60: 6f67 6769 6e67 3a20 6469 7361 626c 6520  ogging: disable 
+0000fc70: 4744 5320 7061 7468 206c 6f67 6769 6e67  GDS path logging
+0000fc80: 2c20 666f 7220 6578 616d 706c 6520 666f  , for example fo
+0000fc90: 7220 7368 6f77 696e 6720 6974 2069 6e20  r showing it in 
+0000fca0: 4b4c 6179 6f75 742e 0a20 2020 2020 2020  KLayout..       
+0000fcb0: 2020 2020 206f 6e5f 6475 706c 6963 6174       on_duplicat
+0000fcc0: 655f 6365 6c6c 3a20 7370 6563 6966 7920  e_cell: specify 
+0000fcd0: 686f 7720 746f 2072 6573 6f6c 7665 2064  how to resolve d
+0000fce0: 7570 6c69 6361 7465 2d6e 616d 6564 2063  uplicate-named c
+0000fcf0: 656c 6c73 2e20 4368 6f6f 7365 206f 6e65  ells. Choose one
+0000fd00: 206f 6620 7468 6520 666f 6c6c 6f77 696e   of the followin
+0000fd10: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
+0000fd20: 2020 2022 7761 726e 2220 2864 6566 6175     "warn" (defau
+0000fd30: 6c74 293a 206f 7665 7277 7269 7465 2061  lt): overwrite a
+0000fd40: 6c6c 2064 7570 6c69 6361 7465 2063 656c  ll duplicate cel
+0000fd50: 6c73 2077 6974 6820 6f6e 6520 6f66 2074  ls with one of t
+0000fd60: 6865 2064 7570 6c69 6361 7465 7320 2861  he duplicates (a
+0000fd70: 7262 6974 7261 7269 6c79 292e 0a20 2020  rbitrarily)..   
+0000fd80: 2020 2020 2020 2020 2020 2020 2022 6572               "er
+0000fd90: 726f 7222 3a20 7468 726f 7720 6120 5661  ror": throw a Va
+0000fda0: 6c75 6545 7272 6f72 2077 6865 6e20 6174  lueError when at
+0000fdb0: 7465 6d70 7469 6e67 2074 6f20 7772 6974  tempting to writ
+0000fdc0: 6520 6120 6764 7320 7769 7468 2064 7570  e a gds with dup
+0000fdd0: 6c69 6361 7465 2063 656c 6c73 2e0a 2020  licate cells..  
+0000fde0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
+0000fdf0: 7665 7277 7269 7465 223a 206f 7665 7277  verwrite": overw
+0000fe00: 7269 7465 2061 6c6c 2064 7570 6c69 6361  rite all duplica
+0000fe10: 7465 2063 656c 6c73 2077 6974 6820 6f6e  te cells with on
+0000fe20: 6520 6f66 2074 6865 2064 7570 6c69 6361  e of the duplica
+0000fe30: 7465 732c 2077 6974 686f 7574 2077 6172  tes, without war
+0000fe40: 6e69 6e67 2e0a 2020 2020 2020 2020 2020  ning..          
+0000fe50: 2020 6f6e 5f75 6e63 6163 6865 645f 636f    on_uncached_co
+0000fe60: 6d70 6f6e 656e 743a 204c 6974 6572 616c  mponent: Literal
+0000fe70: 5b22 7761 726e 222c 2022 6572 726f 7222  ["warn", "error"
+0000fe80: 5d20 3d20 2277 6172 6e22 0a20 2020 2020  ] = "warn".     
+0000fe90: 2020 2020 2020 2066 6c61 7474 656e 5f69         flatten_i
+0000fea0: 6e76 616c 6964 5f72 6566 733a 2066 6c61  nvalid_refs: fla
+0000feb0: 7474 656e 7320 636f 6d70 6f6e 656e 7420  ttens component 
+0000fec0: 7265 6665 7265 6e63 6573 2077 6869 6368  references which
+0000fed0: 2068 6176 6520 696e 7661 6c69 6420 7472   have invalid tr
+0000fee0: 616e 7366 6f72 6d61 7469 6f6e 732e 0a20  ansformations.. 
+0000fef0: 2020 2020 2020 2020 2020 206d 6178 5f70             max_p
+0000ff00: 6f69 6e74 733a 204d 6178 696d 616c 206e  oints: Maximal n
+0000ff10: 756d 6265 7220 6f66 2076 6572 7469 6365  umber of vertice
+0000ff20: 7320 7065 7220 706f 6c79 676f 6e2e 0a20  s per polygon.. 
+0000ff30: 2020 2020 2020 2020 2020 2020 2020 2050                 P
+0000ff40: 6f6c 7967 6f6e 7320 7769 7468 206d 6f72  olygons with mor
+0000ff50: 6520 7665 7274 6963 6573 2074 6861 7420  e vertices that 
+0000ff60: 7468 6973 2061 7265 2061 7574 6f6d 6174  this are automat
+0000ff70: 6963 616c 6c79 2066 7261 6374 7572 6564  ically fractured
+0000ff80: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0000ff90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000ffa0: 6c66 2e5f 7772 6974 655f 6c69 6272 6172  lf._write_librar
+0000ffb0: 7928 0a20 2020 2020 2020 2020 2020 2067  y(.            g
+0000ffc0: 6473 7061 7468 3d67 6473 7061 7468 2c20  dspath=gdspath, 
+0000ffd0: 6764 7364 6972 3d67 6473 6469 722c 2077  gdsdir=gdsdir, w
+0000ffe0: 6974 685f 6f61 7369 733d 4661 6c73 652c  ith_oasis=False,
+0000fff0: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
+00010000: 2020 290a 0a20 2020 2064 6566 2077 7269    )..    def wri
+00010010: 7465 5f6f 6173 280a 2020 2020 2020 2020  te_oas(.        
+00010020: 7365 6c66 2c0a 2020 2020 2020 2020 6764  self,.        gd
+00010030: 7370 6174 683a 204f 7074 696f 6e61 6c5b  spath: Optional[
+00010040: 5061 7468 5479 7065 5d20 3d20 4e6f 6e65  PathType] = None
+00010050: 2c0a 2020 2020 2020 2020 6764 7364 6972  ,.        gdsdir
+00010060: 3a20 4f70 7469 6f6e 616c 5b50 6174 6854  : Optional[PathT
+00010070: 7970 655d 203d 204e 6f6e 652c 0a20 2020  ype] = None,.   
+00010080: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
+00010090: 2020 2029 202d 3e20 5061 7468 3a0a 2020     ) -> Path:.  
+000100a0: 2020 2020 2020 2222 2257 7269 7465 2063        """Write c
+000100b0: 6f6d 706f 6e65 6e74 2074 6f20 4744 5320  omponent to GDS 
+000100c0: 616e 6420 7265 7475 726e 7320 6764 7370  and returns gdsp
+000100d0: 6174 682e 0a0a 2020 2020 2020 2020 4172  ath...        Ar
+000100e0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000100f0: 6764 7370 6174 683a 2047 4453 2066 696c  gdspath: GDS fil
+00010100: 6520 7061 7468 2074 6f20 7772 6974 6520  e path to write 
+00010110: 746f 2e0a 2020 2020 2020 2020 2020 2020  to..            
+00010120: 6764 7364 6972 3a20 6469 7265 6374 6f72  gdsdir: director
+00010130: 7920 666f 7220 7468 6520 4744 5320 6669  y for the GDS fi
+00010140: 6c65 2e20 4465 6661 756c 7473 2074 6f20  le. Defaults to 
+00010150: 2f74 6d70 2f72 616e 646f 6d46 696c 652f  /tmp/randomFile/
+00010160: 6764 7366 6163 746f 7279 2e0a 0a20 2020  gdsfactory...   
+00010170: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
+00010180: 733a 0a20 2020 2020 2020 2020 2020 2075  s:.            u
+00010190: 6e69 743a 2075 6e69 7420 7369 7a65 2066  nit: unit size f
+000101a0: 6f72 206f 626a 6563 7473 2069 6e20 6c69  or objects in li
+000101b0: 6272 6172 792e 2031 756d 2062 7920 6465  brary. 1um by de
+000101c0: 6661 756c 742e 0a20 2020 2020 2020 2020  fault..         
+000101d0: 2020 2070 7265 6369 7369 6f6e 3a20 666f     precision: fo
+000101e0: 7220 6469 6d65 6e73 696f 6e73 2069 6e20  r dimensions in 
+000101f0: 7468 6520 6c69 6272 6172 7920 286d 292e  the library (m).
+00010200: 2031 6e6d 2062 7920 6465 6661 756c 742e   1nm by default.
+00010210: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00010220: 6769 6e67 3a20 6469 7361 626c 6520 4744  ging: disable GD
+00010230: 5320 7061 7468 206c 6f67 6769 6e67 2c20  S path logging, 
+00010240: 666f 7220 6578 616d 706c 6520 666f 7220  for example for 
+00010250: 7368 6f77 696e 6720 6974 2069 6e20 4b4c  showing it in KL
+00010260: 6179 6f75 742e 0a20 2020 2020 2020 2020  ayout..         
+00010270: 2020 206f 6e5f 6475 706c 6963 6174 655f     on_duplicate_
+00010280: 6365 6c6c 3a20 7370 6563 6966 7920 686f  cell: specify ho
+00010290: 7720 746f 2072 6573 6f6c 7665 2064 7570  w to resolve dup
+000102a0: 6c69 6361 7465 2d6e 616d 6564 2063 656c  licate-named cel
+000102b0: 6c73 2e20 4368 6f6f 7365 206f 6e65 206f  ls. Choose one o
+000102c0: 6620 7468 6520 666f 6c6c 6f77 696e 673a  f the following:
+000102d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000102e0: 2022 7761 726e 2220 2864 6566 6175 6c74   "warn" (default
+000102f0: 293a 206f 7665 7277 7269 7465 2061 6c6c  ): overwrite all
+00010300: 2064 7570 6c69 6361 7465 2063 656c 6c73   duplicate cells
+00010310: 2077 6974 6820 6f6e 6520 6f66 2074 6865   with one of the
+00010320: 2064 7570 6c69 6361 7465 7320 2861 7262   duplicates (arb
+00010330: 6974 7261 7269 6c79 292e 0a20 2020 2020  itrarily)..     
+00010340: 2020 2020 2020 2020 2020 2022 6572 726f             "erro
+00010350: 7222 3a20 7468 726f 7720 6120 5661 6c75  r": throw a Valu
+00010360: 6545 7272 6f72 2077 6865 6e20 6174 7465  eError when atte
+00010370: 6d70 7469 6e67 2074 6f20 7772 6974 6520  mpting to write 
+00010380: 6120 6764 7320 7769 7468 2064 7570 6c69  a gds with dupli
+00010390: 6361 7465 2063 656c 6c73 2e0a 2020 2020  cate cells..    
+000103a0: 2020 2020 2020 2020 2020 2020 226f 7665              "ove
+000103b0: 7277 7269 7465 223a 206f 7665 7277 7269  rwrite": overwri
+000103c0: 7465 2061 6c6c 2064 7570 6c69 6361 7465  te all duplicate
+000103d0: 2063 656c 6c73 2077 6974 6820 6f6e 6520   cells with one 
+000103e0: 6f66 2074 6865 2064 7570 6c69 6361 7465  of the duplicate
+000103f0: 732c 2077 6974 686f 7574 2077 6172 6e69  s, without warni
+00010400: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
+00010410: 2020 2020 4e6f 6e65 3a20 646f 206e 6f74      None: do not
+00010420: 2074 7279 2074 6f20 7265 736f 6c76 6520   try to resolve 
+00010430: 2861 7420 796f 7572 206f 776e 2072 6973  (at your own ris
+00010440: 6b21 290a 2020 2020 2020 2020 2020 2020  k!).            
+00010450: 6f6e 5f75 6e63 6163 6865 645f 636f 6d70  on_uncached_comp
+00010460: 6f6e 656e 743a 204c 6974 6572 616c 5b22  onent: Literal["
+00010470: 7761 726e 222c 2022 6572 726f 7222 5d20  warn", "error"] 
+00010480: 3d20 2277 6172 6e22 0a20 2020 2020 2020  = "warn".       
+00010490: 2020 2020 2066 6c61 7474 656e 5f69 6e76       flatten_inv
+000104a0: 616c 6964 5f72 6566 733a 2066 6c61 7474  alid_refs: flatt
+000104b0: 656e 7320 636f 6d70 6f6e 656e 7420 7265  ens component re
+000104c0: 6665 7265 6e63 6573 2077 6869 6368 2068  ferences which h
+000104d0: 6176 6520 696e 7661 6c69 6420 7472 616e  ave invalid tran
+000104e0: 7366 6f72 6d61 7469 6f6e 732e 0a20 2020  sformations..   
+000104f0: 2020 2020 2020 2020 2063 6f6d 7072 6573           compres
+00010500: 7369 6f6e 5f6c 6576 656c 3a20 4c65 7665  sion_level: Leve
+00010510: 6c20 6f66 2063 6f6d 7072 6573 7369 6f6e  l of compression
+00010520: 2066 6f72 2063 656c 6c73 2028 6265 7477   for cells (betw
+00010530: 6565 6e20 3020 616e 6420 3929 2e0a 2020  een 0 and 9)..  
+00010540: 2020 2020 2020 2020 2020 2020 2020 5365                Se
+00010550: 7474 696e 6720 746f 2030 2077 696c 6c20  tting to 0 will 
+00010560: 6469 7361 626c 6520 6365 6c6c 2063 6f6d  disable cell com
+00010570: 7072 6573 7369 6f6e 2c20 3120 6769 7665  pression, 1 give
+00010580: 7320 7468 6520 6265 7374 2073 7065 6564  s the best speed
+00010590: 2061 6e64 2039 2c20 7468 6520 6265 7374   and 9, the best
+000105a0: 2063 6f6d 7072 6573 7369 6f6e 2e0a 2020   compression..  
+000105b0: 2020 2020 2020 2020 2020 6465 7465 6374            detect
+000105c0: 5f72 6563 7461 6e67 6c65 733a 2053 746f  _rectangles: Sto
+000105d0: 7265 2072 6563 7461 6e67 6c65 7320 696e  re rectangles in
+000105e0: 2063 6f6d 7072 6573 7365 6420 666f 726d   compressed form
+000105f0: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
+00010600: 6465 7465 6374 5f74 7261 7065 7a6f 6964  detect_trapezoid
+00010610: 733a 2053 746f 7265 2074 7261 7065 7a6f  s: Store trapezo
+00010620: 6964 7320 696e 2063 6f6d 7072 6573 7365  ids in compresse
+00010630: 6420 666f 726d 6174 2e0a 2020 2020 2020  d format..      
+00010640: 2020 2020 2020 6369 7263 6c65 5f74 6f6c        circle_tol
+00010650: 6572 616e 6365 3a20 546f 6c65 7261 6e63  erance: Toleranc
+00010660: 6520 666f 7220 6465 7465 6374 696e 6720  e for detecting 
+00010670: 6369 7263 6c65 732e 2049 6620 6c65 7373  circles. If less
+00010680: 206f 7220 6571 7561 6c20 746f 2030 2c20   or equal to 0, 
+00010690: 6e6f 2064 6574 6563 7469 6f6e 2069 7320  no detection is 
+000106a0: 7065 7266 6f72 6d65 642e 0a20 2020 2020  performed..     
+000106b0: 2020 2020 2020 2020 2020 2043 6972 636c             Circl
+000106c0: 6573 2061 7265 2073 746f 7265 6420 696e  es are stored in
+000106d0: 2063 6f6d 7072 6573 7365 6420 666f 726d   compressed form
+000106e0: 6174 2e0a 2020 2020 2020 2020 2020 2020  at..            
+000106f0: 7661 6c69 6461 7469 6f6e 2028 2263 7263  validation ("crc
+00010700: 3332 222c 2022 6368 6563 6b73 756d 3332  32", "checksum32
+00010710: 222c 204e 6f6e 6529 20e2 8093 2074 7970  ", None) ... typ
+00010720: 6520 6f66 2076 616c 6964 6174 696f 6e20  e of validation 
+00010730: 746f 2069 6e63 6c75 6465 2069 6e20 7468  to include in th
+00010740: 6520 7361 7665 6420 6669 6c65 2e0a 2020  e saved file..  
+00010750: 2020 2020 2020 2020 2020 7374 616e 6461            standa
+00010760: 7264 5f70 726f 7065 7274 6965 733a 2053  rd_properties: S
+00010770: 746f 7265 2073 7461 6e64 6172 6420 4f41  tore standard OA
+00010780: 5349 5320 7072 6f70 6572 7469 6573 2069  SIS properties i
+00010790: 6e20 7468 6520 6669 6c65 2e0a 2020 2020  n the file..    
+000107a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000107b0: 7265 7475 726e 2073 656c 662e 5f77 7269  return self._wri
+000107c0: 7465 5f6c 6962 7261 7279 280a 2020 2020  te_library(.    
+000107d0: 2020 2020 2020 2020 6764 7370 6174 683d          gdspath=
+000107e0: 6764 7370 6174 682c 0a20 2020 2020 2020  gdspath,.       
+000107f0: 2020 2020 2067 6473 6469 723d 6764 7364       gdsdir=gdsd
+00010800: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+00010810: 7769 7468 5f6f 6173 6973 3d54 7275 652c  with_oasis=True,
+00010820: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+00010830: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
+00010840: 0a0a 2020 2020 6465 6620 7772 6974 655f  ..    def write_
+00010850: 6764 735f 7769 7468 5f6d 6574 6164 6174  gds_with_metadat
+00010860: 6128 7365 6c66 2c20 2a61 7267 732c 202a  a(self, *args, *
+00010870: 2a6b 7761 7267 7329 202d 3e20 5061 7468  *kwargs) -> Path
+00010880: 3a0a 2020 2020 2020 2020 2222 2257 7269  :.        """Wri
+00010890: 7465 2063 6f6d 706f 6e65 6e74 2069 6e20  te component in 
+000108a0: 4744 5320 616e 6420 6d65 7461 6461 7461  GDS and metadata
+000108b0: 2028 636f 6d70 6f6e 656e 7420 7365 7474   (component sett
+000108c0: 696e 6773 2920 696e 2059 414d 4c2e 2222  ings) in YAML.""
+000108d0: 220a 2020 2020 2020 2020 6764 7370 6174  ".        gdspat
+000108e0: 6820 3d20 7365 6c66 2e77 7269 7465 5f67  h = self.write_g
+000108f0: 6473 282a 6172 6773 2c20 2a2a 6b77 6172  ds(*args, **kwar
+00010900: 6773 290a 2020 2020 2020 2020 6d65 7461  gs).        meta
+00010910: 6461 7461 203d 2067 6473 7061 7468 2e77  data = gdspath.w
+00010920: 6974 685f 7375 6666 6978 2822 2e79 6d6c  ith_suffix(".yml
+00010930: 2229 0a20 2020 2020 2020 206d 6574 6164  ").        metad
+00010940: 6174 612e 7772 6974 655f 7465 7874 2873  ata.write_text(s
+00010950: 656c 662e 746f 5f79 616d 6c28 7769 7468  elf.to_yaml(with
+00010960: 5f63 656c 6c73 3d54 7275 652c 2077 6974  _cells=True, wit
+00010970: 685f 706f 7274 733d 5472 7565 2929 0a20  h_ports=True)). 
+00010980: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+00010990: 666f 2866 2257 7269 7465 2059 414d 4c20  fo(f"Write YAML 
+000109a0: 6d65 7461 6461 7461 2074 6f20 7b73 7472  metadata to {str
+000109b0: 286d 6574 6164 6174 6129 2172 7d22 290a  (metadata)!r}").
+000109c0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+000109d0: 6473 7061 7468 0a0a 2020 2020 6465 6620  dspath..    def 
+000109e0: 746f 5f64 6963 7428 0a20 2020 2020 2020  to_dict(.       
+000109f0: 2073 656c 662c 0a20 2020 2020 2020 2069   self,.        i
+00010a00: 676e 6f72 655f 636f 6d70 6f6e 656e 7473  gnore_components
+00010a10: 5f70 7265 6669 783a 204f 7074 696f 6e61  _prefix: Optiona
+00010a20: 6c5b 4c69 7374 5b73 7472 5d5d 203d 204e  l[List[str]] = N
+00010a30: 6f6e 652c 0a20 2020 2020 2020 2069 676e  one,.        ign
+00010a40: 6f72 655f 6675 6e63 7469 6f6e 735f 7072  ore_functions_pr
+00010a50: 6566 6978 3a20 4f70 7469 6f6e 616c 5b4c  efix: Optional[L
+00010a60: 6973 745b 7374 725d 5d20 3d20 4e6f 6e65  ist[str]] = None
+00010a70: 2c0a 2020 2020 2020 2020 7769 7468 5f63  ,.        with_c
+00010a80: 656c 6c73 3a20 626f 6f6c 203d 2046 616c  ells: bool = Fal
+00010a90: 7365 2c0a 2020 2020 2020 2020 7769 7468  se,.        with
+00010aa0: 5f70 6f72 7473 3a20 626f 6f6c 203d 2054  _ports: bool = T
+00010ab0: 7275 652c 0a20 2020 2029 202d 3e20 4469  rue,.    ) -> Di
+00010ac0: 6374 5b73 7472 2c20 416e 795d 3a0a 2020  ct[str, Any]:.  
+00010ad0: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00010ae0: 2044 6963 7420 7265 7072 6573 656e 7461   Dict representa
+00010af0: 7469 6f6e 206f 6620 6120 636f 6d70 6f6e  tion of a compon
+00010b00: 656e 742e 0a0a 2020 2020 2020 2020 4172  ent...        Ar
+00010b10: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00010b20: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
+00010b30: 735f 7072 6566 6978 3a20 666f 7220 636f  s_prefix: for co
+00010b40: 6d70 6f6e 656e 7473 2074 6f20 6967 6e6f  mponents to igno
+00010b50: 7265 2077 6865 6e20 6578 706f 7274 696e  re when exportin
+00010b60: 672e 0a20 2020 2020 2020 2020 2020 2069  g..            i
+00010b70: 676e 6f72 655f 6675 6e63 7469 6f6e 735f  gnore_functions_
+00010b80: 7072 6566 6978 3a20 666f 7220 6675 6e63  prefix: for func
+00010b90: 7469 6f6e 7320 746f 2069 676e 6f72 6520  tions to ignore 
+00010ba0: 7768 656e 2065 7870 6f72 7469 6e67 2e0a  when exporting..
+00010bb0: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00010bc0: 5f63 656c 6c73 3a20 7772 6974 6520 6365  _cells: write ce
+00010bd0: 6c6c 7320 7265 6375 7273 6976 656c 792e  lls recursively.
+00010be0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00010bf0: 685f 706f 7274 733a 2077 7269 7465 2070  h_ports: write p
+00010c00: 6f72 7420 696e 666f 726d 6174 696f 6e20  ort information 
+00010c10: 6469 6374 2e0a 2020 2020 2020 2020 2222  dict..        ""
+00010c20: 220a 2020 2020 2020 2020 6420 3d20 7b7d  ".        d = {}
+00010c30: 0a20 2020 2020 2020 2069 6620 7769 7468  .        if with
+00010c40: 5f70 6f72 7473 3a0a 2020 2020 2020 2020  _ports:.        
+00010c50: 2020 2020 706f 7274 7320 3d20 7b70 6f72      ports = {por
+00010c60: 742e 6e61 6d65 3a20 706f 7274 2e74 6f5f  t.name: port.to_
+00010c70: 6469 6374 2829 2066 6f72 2070 6f72 7420  dict() for port 
+00010c80: 696e 2073 656c 662e 6765 745f 706f 7274  in self.get_port
+00010c90: 735f 6c69 7374 2829 7d0a 2020 2020 2020  s_list()}.      
+00010ca0: 2020 2020 2020 645b 2270 6f72 7473 225d        d["ports"]
+00010cb0: 203d 2070 6f72 7473 0a0a 2020 2020 2020   = ports..      
+00010cc0: 2020 6966 2077 6974 685f 6365 6c6c 733a    if with_cells:
+00010cd0: 0a20 2020 2020 2020 2020 2020 2063 656c  .            cel
+00010ce0: 6c73 203d 2072 6563 7572 7365 5f73 7472  ls = recurse_str
+00010cf0: 7563 7475 7265 7328 0a20 2020 2020 2020  uctures(.       
+00010d00: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+00010d10: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010d20: 676e 6f72 655f 6675 6e63 7469 6f6e 735f  gnore_functions_
+00010d30: 7072 6566 6978 3d69 676e 6f72 655f 6675  prefix=ignore_fu
+00010d40: 6e63 7469 6f6e 735f 7072 6566 6978 2c0a  nctions_prefix,.
+00010d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d60: 6967 6e6f 7265 5f63 6f6d 706f 6e65 6e74  ignore_component
+00010d70: 735f 7072 6566 6978 3d69 676e 6f72 655f  s_prefix=ignore_
+00010d80: 636f 6d70 6f6e 656e 7473 5f70 7265 6669  components_prefi
+00010d90: 782c 0a20 2020 2020 2020 2020 2020 2029  x,.            )
+00010da0: 0a20 2020 2020 2020 2020 2020 2064 5b22  .            d["
+00010db0: 6365 6c6c 7322 5d20 3d20 636c 6561 6e5f  cells"] = clean_
+00010dc0: 6469 6374 2863 656c 6c73 290a 0a20 2020  dict(cells)..   
+00010dd0: 2020 2020 2064 5b22 6e61 6d65 225d 203d       d["name"] =
+00010de0: 2073 656c 662e 6e61 6d65 0a20 2020 2020   self.name.     
+00010df0: 2020 2064 5b22 7365 7474 696e 6773 225d     d["settings"]
+00010e00: 203d 2063 6c65 616e 5f64 6963 7428 6469   = clean_dict(di
+00010e10: 6374 2873 656c 662e 7365 7474 696e 6773  ct(self.settings
+00010e20: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
+00010e30: 6e20 640a 0a20 2020 2064 6566 2074 6f5f  n d..    def to_
+00010e40: 7961 6d6c 2873 656c 662c 202a 2a6b 7761  yaml(self, **kwa
+00010e50: 7267 7329 202d 3e20 7374 723a 0a20 2020  rgs) -> str:.   
+00010e60: 2020 2020 2022 2222 5772 6974 6520 4469       """Write Di
+00010e70: 6374 2072 6570 7265 7365 6e74 6174 696f  ct representatio
+00010e80: 6e20 6f66 2061 2063 6f6d 706f 6e65 6e74  n of a component
+00010e90: 2069 6e20 5941 4d4c 2066 6f72 6d61 742e   in YAML format.
+00010ea0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00010eb0: 2020 2020 2020 2020 2020 2020 6967 6e6f              igno
+00010ec0: 7265 5f63 6f6d 706f 6e65 6e74 735f 7072  re_components_pr
+00010ed0: 6566 6978 3a20 666f 7220 636f 6d70 6f6e  efix: for compon
+00010ee0: 656e 7473 2074 6f20 6967 6e6f 7265 2077  ents to ignore w
+00010ef0: 6865 6e20 6578 706f 7274 696e 672e 0a20  hen exporting.. 
+00010f00: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
+00010f10: 655f 6675 6e63 7469 6f6e 735f 7072 6566  e_functions_pref
+00010f20: 6978 3a20 666f 7220 6675 6e63 7469 6f6e  ix: for function
+00010f30: 7320 746f 2069 676e 6f72 6520 7768 656e  s to ignore when
+00010f40: 2065 7870 6f72 7469 6e67 2e0a 2020 2020   exporting..    
+00010f50: 2020 2020 2020 2020 7769 7468 5f63 656c          with_cel
+00010f60: 6c73 3a20 7772 6974 6520 6365 6c6c 7320  ls: write cells 
+00010f70: 7265 6375 7273 6976 656c 792e 0a20 2020  recursively..   
+00010f80: 2020 2020 2020 2020 2077 6974 685f 706f           with_po
+00010f90: 7274 733a 2077 7269 7465 2070 6f72 7420  rts: write port 
+00010fa0: 696e 666f 726d 6174 696f 6e2e 0a20 2020  information..   
+00010fb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00010fc0: 2072 6574 7572 6e20 4f6d 6567 6143 6f6e   return OmegaCon
+00010fd0: 662e 746f 5f79 616d 6c28 636c 6561 6e5f  f.to_yaml(clean_
+00010fe0: 6469 6374 2873 656c 662e 746f 5f64 6963  dict(self.to_dic
+00010ff0: 7428 2a2a 6b77 6172 6773 2929 290a 0a20  t(**kwargs))).. 
+00011000: 2020 2064 6566 2074 6f5f 6469 6374 5f70     def to_dict_p
+00011010: 6f6c 7967 6f6e 7328 7365 6c66 2920 2d3e  olygons(self) ->
+00011020: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
+00011030: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00011040: 726e 7320 6120 6469 6374 2072 6570 7265  rns a dict repre
+00011050: 7365 6e74 6174 696f 6e20 6f66 2074 6865  sentation of the
+00011060: 2066 6c61 7474 656e 6564 2063 6f6d 706f   flattened compo
+00011070: 6e65 6e74 2e22 2222 0a20 2020 2020 2020  nent.""".       
+00011080: 2064 203d 207b 7d0a 2020 2020 2020 2020   d = {}.        
+00011090: 706f 6c79 676f 6e73 203d 207b 7d0a 2020  polygons = {}.  
+000110a0: 2020 2020 2020 6c61 7965 725f 746f 5f70        layer_to_p
+000110b0: 6f6c 7967 6f6e 7320 3d20 7365 6c66 2e67  olygons = self.g
+000110c0: 6574 5f70 6f6c 7967 6f6e 7328 6279 5f73  et_polygons(by_s
+000110d0: 7065 633d 5472 7565 290a 0a20 2020 2020  pec=True)..     
+000110e0: 2020 2066 6f72 206c 6179 6572 2c20 706f     for layer, po
+000110f0: 6c79 676f 6e73 5f6c 6179 6572 2069 6e20  lygons_layer in 
+00011100: 6c61 7965 725f 746f 5f70 6f6c 7967 6f6e  layer_to_polygon
+00011110: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+00011120: 2020 2020 2020 206c 6179 6572 5f6e 616d         layer_nam
+00011130: 6520 3d20 6622 7b6c 6179 6572 5b30 5d7d  e = f"{layer[0]}
+00011140: 5f7b 6c61 7965 725b 315d 7d22 0a20 2020  _{layer[1]}".   
+00011150: 2020 2020 2020 2020 2066 6f72 2070 6f6c           for pol
+00011160: 7967 6f6e 2069 6e20 706f 6c79 676f 6e73  ygon in polygons
+00011170: 5f6c 6179 6572 3a0a 2020 2020 2020 2020  _layer:.        
+00011180: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00011190: 5b6c 6179 6572 5f6e 616d 655d 203d 205b  [layer_name] = [
+000111a0: 7475 706c 6528 736e 6170 5f74 6f5f 6772  tuple(snap_to_gr
+000111b0: 6964 2876 2929 2066 6f72 2076 2069 6e20  id(v)) for v in 
+000111c0: 706f 6c79 676f 6e5d 0a0a 2020 2020 2020  polygon]..      
+000111d0: 2020 706f 7274 7320 3d20 7b70 6f72 742e    ports = {port.
+000111e0: 6e61 6d65 3a20 706f 7274 2e73 6574 7469  name: port.setti
+000111f0: 6e67 7320 666f 7220 706f 7274 2069 6e20  ngs for port in 
+00011200: 7365 6c66 2e67 6574 5f70 6f72 7473 5f6c  self.get_ports_l
+00011210: 6973 7428 297d 0a20 2020 2020 2020 2063  ist()}.        c
+00011220: 6c65 616e 5f64 6963 7428 706f 7274 7329  lean_dict(ports)
+00011230: 0a20 2020 2020 2020 2063 6c65 616e 5f64  .        clean_d
+00011240: 6963 7428 706f 6c79 676f 6e73 290a 2020  ict(polygons).  
+00011250: 2020 2020 2020 642e 696e 666f 203d 2073        d.info = s
+00011260: 656c 662e 696e 666f 0a20 2020 2020 2020  elf.info.       
+00011270: 2064 2e70 6f6c 7967 6f6e 7320 3d20 706f   d.polygons = po
+00011280: 6c79 676f 6e73 0a20 2020 2020 2020 2064  lygons.        d
+00011290: 2e70 6f72 7473 203d 2070 6f72 7473 0a20  .ports = ports. 
+000112a0: 2020 2020 2020 2072 6574 7572 6e20 640a         return d.
+000112b0: 0a20 2020 2064 6566 2061 7574 6f5f 7265  .    def auto_re
+000112c0: 6e61 6d65 5f70 6f72 7473 2873 656c 662c  name_ports(self,
+000112d0: 202a 2a6b 7761 7267 7329 202d 3e20 4e6f   **kwargs) -> No
+000112e0: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
+000112f0: 656e 616d 6520 706f 7274 7320 6279 206f  ename ports by o
+00011300: 7269 656e 7461 7469 6f6e 204e 5345 5720  rientation NSEW 
+00011310: 286e 6f72 7468 2c20 736f 7574 682c 2065  (north, south, e
+00011320: 6173 742c 2077 6573 7429 2e0a 0a20 2020  ast, west)...   
+00011330: 2020 2020 204b 6579 776f 7264 2041 7267       Keyword Arg
+00011340: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
+00011350: 756e 6374 696f 6e3a 2074 6f20 7265 6e61  unction: to rena
+00011360: 6d65 2070 6f72 7473 2e0a 2020 2020 2020  me ports..      
+00011370: 2020 2020 2020 7365 6c65 6374 5f70 6f72        select_por
+00011380: 7473 5f6f 7074 6963 616c 3a20 746f 2073  ts_optical: to s
+00011390: 656c 6563 7420 6f70 7469 6361 6c20 706f  elect optical po
+000113a0: 7274 732e 0a20 2020 2020 2020 2020 2020  rts..           
+000113b0: 2073 656c 6563 745f 706f 7274 735f 656c   select_ports_el
+000113c0: 6563 7472 6963 616c 3a20 746f 2073 656c  ectrical: to sel
+000113d0: 6563 7420 656c 6563 7472 6963 616c 2070  ect electrical p
+000113e0: 6f72 7473 2e0a 2020 2020 2020 2020 2020  orts..          
+000113f0: 2020 7072 6566 6978 5f6f 7074 6963 616c    prefix_optical
+00011400: 3a20 7072 6566 6978 2e0a 2020 2020 2020  : prefix..      
+00011410: 2020 2020 2020 7072 6566 6978 5f65 6c65        prefix_ele
+00011420: 6374 7269 6361 6c3a 2070 7265 6669 782e  ctrical: prefix.
+00011430: 0a0a 2020 2020 2020 2020 2e2e 2063 6f64  ..        .. cod
+00011440: 653a 3a0a 0a20 2020 2020 2020 2020 2020  e::..           
+00011450: 2020 2020 2020 2033 2020 340a 2020 2020         3  4.    
+00011460: 2020 2020 2020 2020 2020 2020 205f 7c5f               _|_
+00011470: 5f7c 5f0a 2020 2020 2020 2020 2020 2020  _|_.            
+00011480: 2032 202d 7c20 2020 2020 207c 2d20 350a   2 -|      |- 5.
+00011490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114a0: 7c20 2020 2020 207c 0a20 2020 2020 2020  |      |.       
+000114b0: 2020 2020 2020 3120 2d7c 5f5f 5f5f 5f5f        1 -|______
+000114c0: 7c2d 2036 0a20 2020 2020 2020 2020 2020  |- 6.           
+000114d0: 2020 2020 2020 207c 2020 7c0a 2020 2020         |  |.    
+000114e0: 2020 2020 2020 2020 2020 2020 2020 3820                8 
+000114f0: 2037 0a20 2020 2020 2020 2022 2222 0a20   7.        """. 
+00011500: 2020 2020 2020 2073 656c 662e 6973 5f75         self.is_u
+00011510: 6e6c 6f63 6b65 6428 290a 2020 2020 2020  nlocked().      
+00011520: 2020 6175 746f 5f72 656e 616d 655f 706f    auto_rename_po
+00011530: 7274 7328 7365 6c66 2c20 2a2a 6b77 6172  rts(self, **kwar
+00011540: 6773 290a 0a20 2020 2064 6566 2061 7574  gs)..    def aut
+00011550: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f63  o_rename_ports_c
+00011560: 6f75 6e74 6572 5f63 6c6f 636b 7769 7365  ounter_clockwise
+00011570: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+00011580: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00011590: 2020 7365 6c66 2e69 735f 756e 6c6f 636b    self.is_unlock
+000115a0: 6564 2829 0a20 2020 2020 2020 2061 7574  ed().        aut
+000115b0: 6f5f 7265 6e61 6d65 5f70 6f72 7473 5f63  o_rename_ports_c
+000115c0: 6f75 6e74 6572 5f63 6c6f 636b 7769 7365  ounter_clockwise
+000115d0: 2873 656c 662c 202a 2a6b 7761 7267 7329  (self, **kwargs)
+000115e0: 0a0a 2020 2020 6465 6620 6175 746f 5f72  ..    def auto_r
+000115f0: 656e 616d 655f 706f 7274 735f 6c61 7965  ename_ports_laye
+00011600: 725f 6f72 6965 6e74 6174 696f 6e28 7365  r_orientation(se
+00011610: 6c66 2c20 2a2a 6b77 6172 6773 2920 2d3e  lf, **kwargs) ->
+00011620: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+00011630: 656c 662e 6973 5f75 6e6c 6f63 6b65 6428  elf.is_unlocked(
+00011640: 290a 2020 2020 2020 2020 6175 746f 5f72  ).        auto_r
+00011650: 656e 616d 655f 706f 7274 735f 6c61 7965  ename_ports_laye
+00011660: 725f 6f72 6965 6e74 6174 696f 6e28 7365  r_orientation(se
+00011670: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
+00011680: 2020 2064 6566 2061 7574 6f5f 7265 6e61     def auto_rena
+00011690: 6d65 5f70 6f72 7473 5f6f 7269 656e 7461  me_ports_orienta
+000116a0: 7469 6f6e 2873 656c 662c 202a 2a6b 7761  tion(self, **kwa
+000116b0: 7267 7329 202d 3e20 4e6f 6e65 3a0a 2020  rgs) -> None:.  
+000116c0: 2020 2020 2020 2222 2252 656e 616d 6520        """Rename 
+000116d0: 706f 7274 7320 6279 206f 7269 656e 7461  ports by orienta
+000116e0: 7469 6f6e 204e 5345 5720 286e 6f72 7468  tion NSEW (north
+000116f0: 2c20 736f 7574 682c 2065 6173 742c 2077  , south, east, w
+00011700: 6573 7429 2e0a 0a20 2020 2020 2020 204b  est)...        K
+00011710: 6579 776f 7264 2041 7267 733a 0a20 2020  eyword Args:.   
+00011720: 2020 2020 2020 2020 2066 756e 6374 696f           functio
+00011730: 6e3a 2074 6f20 7265 6e61 6d65 2070 6f72  n: to rename por
+00011740: 7473 2e0a 2020 2020 2020 2020 2020 2020  ts..            
+00011750: 7365 6c65 6374 5f70 6f72 7473 5f6f 7074  select_ports_opt
+00011760: 6963 616c 3a20 746f 2073 656c 6563 7420  ical: to select 
+00011770: 706f 7274 732e 0a20 2020 2020 2020 2020  ports..         
+00011780: 2020 2073 656c 6563 745f 706f 7274 735f     select_ports_
+00011790: 656c 6563 7472 6963 616c 3a0a 2020 2020  electrical:.    
+000117a0: 2020 2020 2020 2020 7072 6566 6978 5f6f          prefix_o
+000117b0: 7074 6963 616c 3a0a 2020 2020 2020 2020  ptical:.        
+000117c0: 2020 2020 7072 6566 6978 5f65 6c65 6374      prefix_elect
+000117d0: 7269 6361 6c3a 0a0a 2020 2020 2020 2020  rical:..        
+000117e0: 2e2e 2063 6f64 653a 3a0a 0a20 2020 2020  .. code::..     
+000117f0: 2020 2020 2020 2020 2020 2020 4e30 2020              N0  
+00011800: 4e31 0a20 2020 2020 2020 2020 2020 2020  N1.             
+00011810: 2020 2020 7c5f 5f5f 7c5f 0a20 2020 2020      |___|_.     
+00011820: 2020 2020 2020 2057 3120 2d7c 2020 2020         W1 -|    
+00011830: 2020 7c2d 2045 310a 2020 2020 2020 2020    |- E1.        
+00011840: 2020 2020 2020 2020 7c20 2020 2020 207c          |      |
+00011850: 0a20 2020 2020 2020 2020 2020 2057 3020  .            W0 
+00011860: 2d7c 5f5f 5f5f 5f5f 7c2d 2045 300a 2020  -|______|- E0.  
+00011870: 2020 2020 2020 2020 2020 2020 2020 207c                 |
+00011880: 2020 207c 0a20 2020 2020 2020 2020 2020     |.           
+00011890: 2020 2020 2053 3020 2020 5331 0a20 2020       S0   S1.   
+000118a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000118b0: 2073 656c 662e 6973 5f75 6e6c 6f63 6b65   self.is_unlocke
+000118c0: 6428 290a 2020 2020 2020 2020 6175 746f  d().        auto
+000118d0: 5f72 656e 616d 655f 706f 7274 735f 6f72  _rename_ports_or
+000118e0: 6965 6e74 6174 696f 6e28 7365 6c66 2c20  ientation(self, 
+000118f0: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
+00011900: 6566 206d 6f76 6528 0a20 2020 2020 2020  ef move(.       
+00011910: 2073 656c 662c 0a20 2020 2020 2020 206f   self,.        o
+00011920: 7269 6769 6e3a 2046 6c6f 6174 3220 3d20  rigin: Float2 = 
+00011930: 2830 2c20 3029 2c0a 2020 2020 2020 2020  (0, 0),.        
+00011940: 6465 7374 696e 6174 696f 6e3a 204f 7074  destination: Opt
+00011950: 696f 6e61 6c5b 466c 6f61 7432 5d20 3d20  ional[Float2] = 
+00011960: 4e6f 6e65 2c0a 2020 2020 2020 2020 6178  None,.        ax
+00011970: 6973 3a20 4f70 7469 6f6e 616c 5b41 7869  is: Optional[Axi
+00011980: 735d 203d 204e 6f6e 652c 0a20 2020 2029  s] = None,.    )
+00011990: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
+000119a0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+000119b0: 7320 6e65 7720 436f 6d70 6f6e 656e 7420  s new Component 
+000119c0: 7769 7468 2061 206d 6f76 6564 2072 6566  with a moved ref
+000119d0: 6572 656e 6365 2074 6f20 7468 6520 6f72  erence to the or
+000119e0: 6967 696e 616c 2e0a 0a20 2020 2020 2020  iginal...       
+000119f0: 2063 6f6d 706f 6e65 6e74 2e0a 0a20 2020   component...   
+00011a00: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
+00011a10: 2020 2020 2020 206f 7269 6769 6e3a 206f         origin: o
+00011a20: 6620 636f 6d70 6f6e 656e 742e 0a20 2020  f component..   
+00011a30: 2020 2020 2020 2020 2064 6573 7469 6e61           destina
+00011a40: 7469 6f6e 3a20 782c 2079 2e0a 2020 2020  tion: x, y..    
+00011a50: 2020 2020 2020 2020 6178 6973 3a20 7820          axis: x 
+00011a60: 6f72 2079 2e0a 2020 2020 2020 2020 2222  or y..        ""
+00011a70: 220a 2020 2020 2020 2020 7261 6973 6520  ".        raise 
+00011a80: 5661 6c75 6545 7272 6f72 286d 6f76 655f  ValueError(move_
+00011a90: 6572 726f 725f 6d65 7373 6167 6529 0a0a  error_message)..
+00011aa0: 2020 2020 6465 6620 6d69 7272 6f72 2873      def mirror(s
+00011ab0: 656c 662c 2070 313a 2046 6c6f 6174 3220  elf, p1: Float2 
+00011ac0: 3d20 2830 2c20 3129 2c20 7032 3a20 466c  = (0, 1), p2: Fl
+00011ad0: 6f61 7432 203d 2028 302c 2030 292c 202a  oat2 = (0, 0), *
+00011ae0: 2a6b 7761 7267 7329 202d 3e20 436f 6d70  *kwargs) -> Comp
+00011af0: 6f6e 656e 743a 0a20 2020 2020 2020 2022  onent:.        "
+00011b00: 2222 5265 7475 726e 7320 6e65 7720 436f  ""Returns new Co
+00011b10: 6d70 6f6e 656e 7420 7769 7468 2061 206d  mponent with a m
+00011b20: 6972 726f 7265 6420 7265 6665 7265 6e63  irrored referenc
+00011b30: 652e 0a0a 2020 2020 2020 2020 4172 6773  e...        Args
+00011b40: 3a0a 2020 2020 2020 2020 2020 2020 7031  :.            p1
+00011b50: 3a20 6669 7273 7420 706f 696e 7420 746f  : first point to
+00011b60: 2064 6566 696e 6520 6d69 7272 6f72 2061   define mirror a
+00011b70: 7869 732e 0a20 2020 2020 2020 2020 2020  xis..           
+00011b80: 2070 323a 2073 6563 6f6e 6420 706f 696e   p2: second poin
+00011b90: 7420 746f 2064 6566 696e 6520 6d69 7272  t to define mirr
+00011ba0: 6f72 2061 7869 732e 0a20 2020 2020 2020  or axis..       
+00011bb0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
+00011bc0: 6d20 6764 7366 6163 746f 7279 2e66 756e  m gdsfactory.fun
+00011bd0: 6374 696f 6e73 2069 6d70 6f72 7420 6d69  ctions import mi
+00011be0: 7272 6f72 0a0a 2020 2020 2020 2020 7265  rror..        re
+00011bf0: 7475 726e 206d 6972 726f 7228 636f 6d70  turn mirror(comp
+00011c00: 6f6e 656e 743d 7365 6c66 2c20 7031 3d70  onent=self, p1=p
+00011c10: 312c 2070 323d 7032 2c20 2a2a 6b77 6172  1, p2=p2, **kwar
+00011c20: 6773 290a 0a20 2020 2064 6566 2072 6f74  gs)..    def rot
+00011c30: 6174 6528 7365 6c66 2c20 616e 676c 653a  ate(self, angle:
+00011c40: 2066 6c6f 6174 203d 2039 302c 202a 2a6b   float = 90, **k
+00011c50: 7761 7267 7329 202d 3e20 436f 6d70 6f6e  wargs) -> Compon
+00011c60: 656e 743a 0a20 2020 2020 2020 2022 2222  ent:.        """
+00011c70: 5265 7475 726e 7320 6e65 7720 636f 6d70  Returns new comp
+00011c80: 6f6e 656e 7420 7769 7468 2061 2072 6f74  onent with a rot
+00011c90: 6174 6564 2072 6566 6572 656e 6365 2074  ated reference t
+00011ca0: 6f20 7468 6520 6f72 6967 696e 616c 2e0a  o the original..
+00011cb0: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00011cc0: 2020 2020 2020 2020 2020 2061 6e67 6c65             angle
+00011cd0: 3a20 696e 2064 6567 7265 6573 2e0a 2020  : in degrees..  
+00011ce0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011cf0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+00011d00: 792e 6675 6e63 7469 6f6e 7320 696d 706f  y.functions impo
+00011d10: 7274 2072 6f74 6174 650a 0a20 2020 2020  rt rotate..     
+00011d20: 2020 2072 6574 7572 6e20 726f 7461 7465     return rotate
+00011d30: 2863 6f6d 706f 6e65 6e74 3d73 656c 662c  (component=self,
+00011d40: 2061 6e67 6c65 3d61 6e67 6c65 2c20 2a2a   angle=angle, **
+00011d50: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
+00011d60: 2061 6464 5f70 6164 6469 6e67 2873 656c   add_padding(sel
+00011d70: 662c 202a 2a6b 7761 7267 7329 202d 3e20  f, **kwargs) -> 
+00011d80: 436f 6d70 6f6e 656e 743a 0a20 2020 2020  Component:.     
+00011d90: 2020 2022 2222 5265 7475 726e 7320 7361     """Returns sa
+00011da0: 6d65 2063 6f6d 706f 6e65 6e74 2077 6974  me component wit
+00011db0: 6820 7061 6464 696e 672e 0a0a 2020 2020  h padding...    
+00011dc0: 2020 2020 4b65 7977 6f72 6420 4172 6773      Keyword Args
+00011dd0: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+00011de0: 6d70 6f6e 656e 743a 2066 6f72 2070 6164  mponent: for pad
+00011df0: 6469 6e67 2e0a 2020 2020 2020 2020 2020  ding..          
+00011e00: 2020 6c61 7965 7273 3a20 6c69 7374 206f    layers: list o
+00011e10: 6620 6c61 7965 7273 2e0a 2020 2020 2020  f layers..      
+00011e20: 2020 2020 2020 7375 6666 6978 2066 6f72        suffix for
+00011e30: 206e 616d 652e 0a20 2020 2020 2020 2020   name..         
+00011e40: 2020 2064 6566 6175 6c74 3a20 6465 6661     default: defa
+00011e50: 756c 7420 7061 6464 696e 6720 2835 3075  ult padding (50u
+00011e60: 6d29 2e0a 2020 2020 2020 2020 2020 2020  m)..            
+00011e70: 746f 703a 206e 6f72 7468 2070 6164 6469  top: north paddi
+00011e80: 6e67 2e0a 2020 2020 2020 2020 2020 2020  ng..            
+00011e90: 626f 7474 6f6d 3a20 736f 7574 6820 7061  bottom: south pa
+00011ea0: 6464 696e 672e 0a20 2020 2020 2020 2020  dding..         
+00011eb0: 2020 2072 6967 6874 3a20 6561 7374 2070     right: east p
+00011ec0: 6164 6469 6e67 2e0a 2020 2020 2020 2020  adding..        
+00011ed0: 2020 2020 6c65 6674 3a20 7765 7374 2070      left: west p
+00011ee0: 6164 6469 6e67 2e0a 2020 2020 2020 2020  adding..        
+00011ef0: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00011f00: 2067 6473 6661 6374 6f72 792e 6164 645f   gdsfactory.add_
+00011f10: 7061 6464 696e 6720 696d 706f 7274 2061  padding import a
+00011f20: 6464 5f70 6164 6469 6e67 0a0a 2020 2020  dd_padding..    
+00011f30: 2020 2020 7265 7475 726e 2061 6464 5f70      return add_p
+00011f40: 6164 6469 6e67 2863 6f6d 706f 6e65 6e74  adding(component
+00011f50: 3d73 656c 662c 202a 2a6b 7761 7267 7329  =self, **kwargs)
+00011f60: 0a0a 2020 2020 6465 6620 6162 736f 7262  ..    def absorb
+00011f70: 2873 656c 662c 2072 6566 6572 656e 6365  (self, reference
+00011f80: 2920 2d3e 2043 6f6d 706f 6e65 6e74 3a0a  ) -> Component:.
+00011f90: 2020 2020 2020 2020 2222 2241 6273 6f72          """Absor
+00011fa0: 6273 2070 6f6c 7967 6f6e 7320 6672 6f6d  bs polygons from
+00011fb0: 2043 6f6d 706f 6e65 6e74 5265 6665 7265   ComponentRefere
+00011fc0: 6e63 6520 696e 746f 2043 6f6d 706f 6e65  nce into Compone
+00011fd0: 6e74 2e0a 0a20 2020 2020 2020 2044 6573  nt...        Des
+00011fe0: 7472 6f79 7320 7468 6520 7265 6665 7265  troys the refere
+00011ff0: 6e63 6520 696e 2074 6865 2070 726f 6365  nce in the proce
+00012000: 7373 2062 7574 206b 6565 7069 6e67 2074  ss but keeping t
+00012010: 6865 2070 6f6c 7967 6f6e 2067 656f 6d65  he polygon geome
+00012020: 7472 792e 0a0a 2020 2020 2020 2020 4172  try...        Ar
+00012030: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00012040: 7265 6665 7265 6e63 653a 2043 6f6d 706f  reference: Compo
+00012050: 6e65 6e74 5265 6665 7265 6e63 6520 746f  nentReference to
+00012060: 2062 6520 6162 736f 7262 6564 2069 6e74   be absorbed int
+00012070: 6f20 7468 6520 436f 6d70 6f6e 656e 742e  o the Component.
+00012080: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012090: 2020 2020 2069 6620 7265 6665 7265 6e63       if referenc
+000120a0: 6520 6e6f 7420 696e 2073 656c 662e 7265  e not in self.re
+000120b0: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
+000120c0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000120d0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+000120e0: 2020 2020 2020 2020 2254 6865 2072 6566          "The ref
+000120f0: 6572 656e 6365 2079 6f75 2061 736b 6564  erence you asked
+00012100: 2074 6f20 6162 736f 7262 2064 6f65 7320   to absorb does 
+00012110: 6e6f 7420 6578 6973 7420 696e 2074 6869  not exist in thi
+00012120: 7320 436f 6d70 6f6e 656e 742e 220a 2020  s Component.".  
+00012130: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00012140: 2020 2020 7265 665f 706f 6c79 676f 6e73      ref_polygons
+00012150: 203d 2072 6566 6572 656e 6365 2e67 6574   = reference.get
+00012160: 5f70 6f6c 7967 6f6e 7328 0a20 2020 2020  _polygons(.     
+00012170: 2020 2020 2020 2062 795f 7370 6563 3d46         by_spec=F
+00012180: 616c 7365 2c20 696e 636c 7564 655f 7061  alse, include_pa
+00012190: 7468 733d 4661 6c73 652c 2061 735f 6172  ths=False, as_ar
+000121a0: 7261 793d 4661 6c73 650a 2020 2020 2020  ray=False.      
+000121b0: 2020 290a 2020 2020 2020 2020 7365 6c66    ).        self
+000121c0: 2e5f 6164 645f 706f 6c79 676f 6e73 282a  ._add_polygons(*
+000121d0: 7265 665f 706f 6c79 676f 6e73 290a 0a20  ref_polygons).. 
+000121e0: 2020 2020 2020 2073 656c 662e 6164 6428         self.add(
+000121f0: 7265 6665 7265 6e63 652e 6765 745f 6c61  reference.get_la
+00012200: 6265 6c73 2829 290a 2020 2020 2020 2020  bels()).        
+00012210: 7365 6c66 2e61 6464 2872 6566 6572 656e  self.add(referen
+00012220: 6365 2e67 6574 5f70 6174 6873 2829 290a  ce.get_paths()).
+00012230: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
+00012240: 6f76 6528 7265 6665 7265 6e63 6529 0a20  ove(reference). 
+00012250: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00012260: 6c66 0a0a 2020 2020 6465 6620 7265 6d6f  lf..    def remo
+00012270: 7665 2873 656c 662c 2069 7465 6d73 293a  ve(self, items):
+00012280: 0a20 2020 2020 2020 2022 2222 5265 6d6f  .        """Remo
+00012290: 7665 7320 6974 656d 7320 6672 6f6d 2061  ves items from a
+000122a0: 2043 6f6d 706f 6e65 6e74 2c20 7768 6963   Component, whic
+000122b0: 6820 6361 6e20 696e 636c 7564 6520 506f  h can include Po
+000122c0: 7274 732c 2050 6f6c 7967 6f6e 5365 7473  rts, PolygonSets
+000122d0: 205c 0a20 2020 2020 2020 2043 656c 6c52   \.        CellR
+000122e0: 6566 6572 656e 6365 732c 2043 6f6d 706f  eferences, Compo
+000122f0: 6e65 6e74 5265 6665 7265 6e63 6573 2061  nentReferences a
+00012300: 6e64 204c 6162 656c 732e 0a0a 2020 2020  nd Labels...    
+00012310: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00012320: 2020 2020 2020 6974 656d 733a 206c 6973        items: lis
+00012330: 7420 6f66 2049 7465 6d73 2074 6f20 6265  t of Items to be
+00012340: 2072 656d 6f76 6564 2066 726f 6d20 7468   removed from th
+00012350: 6520 436f 6d70 6f6e 656e 742e 0a20 2020  e Component..   
+00012360: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012370: 2069 6620 6e6f 7420 6861 7361 7474 7228   if not hasattr(
+00012380: 6974 656d 732c 2022 5f5f 6974 6572 5f5f  items, "__iter__
+00012390: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+000123a0: 6974 656d 7320 3d20 5b69 7465 6d73 5d0a  items = [items].
+000123b0: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+000123c0: 2069 6e20 6974 656d 733a 0a20 2020 2020   in items:.     
+000123d0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+000123e0: 616e 6365 2869 7465 6d2c 2050 6f72 7429  ance(item, Port)
+000123f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012400: 2020 7365 6c66 2e70 6f72 7473 203d 207b    self.ports = {
+00012410: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00012420: 2073 656c 662e 706f 7274 732e 6974 656d   self.ports.item
+00012430: 7328 2920 6966 2076 2021 3d20 6974 656d  s() if v != item
+00012440: 7d0a 2020 2020 2020 2020 2020 2020 656c  }.            el
+00012450: 6966 2069 7369 6e73 7461 6e63 6528 6974  if isinstance(it
+00012460: 656d 2c20 6764 7374 6b2e 5265 6665 7265  em, gdstk.Refere
+00012470: 6e63 6529 3a0a 2020 2020 2020 2020 2020  nce):.          
+00012480: 2020 2020 2020 7365 6c66 2e5f 6365 6c6c        self._cell
+00012490: 2e72 656d 6f76 6528 6974 656d 290a 2020  .remove(item).  
+000124a0: 2020 2020 2020 2020 2020 2020 2020 6974                it
+000124b0: 656d 2e6f 776e 6572 203d 204e 6f6e 650a  em.owner = None.
+000124c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000124d0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+000124e0: 2c20 436f 6d70 6f6e 656e 7452 6566 6572  , ComponentRefer
+000124f0: 656e 6365 293a 0a20 2020 2020 2020 2020  ence):.         
+00012500: 2020 2020 2020 2073 656c 662e 7265 6665         self.refe
+00012510: 7265 6e63 6573 2e72 656d 6f76 6528 6974  rences.remove(it
+00012520: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+00012530: 2020 2020 7365 6c66 2e5f 6365 6c6c 2e72      self._cell.r
+00012540: 656d 6f76 6528 6974 656d 2e5f 7265 6665  emove(item._refe
+00012550: 7265 6e63 6529 0a20 2020 2020 2020 2020  rence).         
+00012560: 2020 2020 2020 2069 7465 6d2e 6f77 6e65         item.owne
+00012570: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
+00012580: 2020 2020 2020 2020 2073 656c 662e 5f6e           self._n
+00012590: 616d 6564 5f72 6566 6572 656e 6365 732e  amed_references.
+000125a0: 706f 7028 6974 656d 2e6e 616d 6529 0a20  pop(item.name). 
+000125b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000125c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000125d0: 2073 656c 662e 5f63 656c 6c2e 7265 6d6f   self._cell.remo
+000125e0: 7665 2869 7465 6d29 0a0a 2020 2020 2020  ve(item)..      
+000125f0: 2020 7365 6c66 2e5f 6262 5f76 616c 6964    self._bb_valid
+00012600: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00012610: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+00012620: 2020 6465 6620 6861 7368 5f67 656f 6d65    def hash_geome
+00012630: 7472 7928 7365 6c66 2c20 7072 6563 6973  try(self, precis
+00012640: 696f 6e3a 2066 6c6f 6174 203d 2031 652d  ion: float = 1e-
+00012650: 3429 202d 3e20 7374 723a 0a20 2020 2020  4) -> str:.     
+00012660: 2020 2022 2222 5265 7475 726e 7320 616e     """Returns an
+00012670: 2053 4841 3120 6861 7368 206f 6620 7468   SHA1 hash of th
+00012680: 6520 6765 6f6d 6574 7279 2069 6e20 7468  e geometry in th
+00012690: 6520 436f 6d70 6f6e 656e 742e 0a0a 2020  e Component...  
+000126a0: 2020 2020 2020 466f 7220 6561 6368 206c        For each l
+000126b0: 6179 6572 2c20 6561 6368 2070 6f6c 7967  ayer, each polyg
+000126c0: 6f6e 2069 7320 696e 6469 7669 6475 616c  on is individual
+000126d0: 6c79 2068 6173 6865 6420 616e 6420 7468  ly hashed and th
+000126e0: 656e 2074 6865 2070 6f6c 7967 6f6e 2068  en the polygon h
+000126f0: 6173 6865 730a 2020 2020 2020 2020 6172  ashes.        ar
+00012700: 6520 736f 7274 6564 2c20 746f 2065 6e73  e sorted, to ens
+00012710: 7572 6520 7468 6520 6861 7368 2073 7461  ure the hash sta
+00012720: 7973 2063 6f6e 7374 616e 7420 7265 6761  ys constant rega
+00012730: 7264 6c65 7373 206f 6620 7468 6520 6f72  rdless of the or
+00012740: 6465 7269 6e67 0a20 2020 2020 2020 2074  dering.        t
+00012750: 6865 2070 6f6c 7967 6f6e 732e 2020 5369  he polygons.  Si
+00012760: 6d69 6c61 726c 792c 2074 6865 206c 6179  milarly, the lay
+00012770: 6572 7320 6172 6520 736f 7274 6564 2062  ers are sorted b
+00012780: 7920 286c 6179 6572 2c20 6461 7461 7479  y (layer, dataty
+00012790: 7065 292e 0a0a 2020 2020 2020 2020 4172  pe)...        Ar
+000127a0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+000127b0: 7072 6563 6973 696f 6e3a 2052 6f75 6e64  precision: Round
+000127c0: 696e 6720 7072 6563 6973 696f 6e20 666f  ing precision fo
+000127d0: 7220 7468 6520 7468 6520 6f62 6a65 6374  r the the object
+000127e0: 7320 696e 2074 6865 2043 6f6d 706f 6e65  s in the Compone
+000127f0: 6e74 2e0a 2020 2020 2020 2020 2020 2020  nt..            
+00012800: 2020 2020 466f 7220 696e 7374 616e 6365      For instance
+00012810: 2c20 6120 7072 6563 6973 696f 6e20 6f66  , a precision of
+00012820: 2031 652d 3220 7769 6c6c 2072 6f75 6e64   1e-2 will round
+00012830: 2061 2070 6f69 6e74 2061 740a 2020 2020   a point at.    
+00012840: 2020 2020 2020 2020 2020 2020 2830 2e31              (0.1
+00012850: 3234 2c20 312e 3734 3829 2074 6f20 2830  24, 1.748) to (0
+00012860: 2e31 322c 2031 2e37 3529 2e0a 0a20 2020  .12, 1.75)...   
+00012870: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012880: 2070 6f6c 7967 6f6e 735f 6279 5f73 7065   polygons_by_spe
+00012890: 6320 3d20 7365 6c66 2e67 6574 5f70 6f6c  c = self.get_pol
+000128a0: 7967 6f6e 7328 6279 5f73 7065 633d 5472  ygons(by_spec=Tr
+000128b0: 7565 2c20 6173 5f61 7272 6179 3d46 616c  ue, as_array=Fal
+000128c0: 7365 290a 2020 2020 2020 2020 6c61 7965  se).        laye
+000128d0: 7273 203d 206e 702e 6172 7261 7928 6c69  rs = np.array(li
+000128e0: 7374 2870 6f6c 7967 6f6e 735f 6279 5f73  st(polygons_by_s
+000128f0: 7065 632e 6b65 7973 2829 2929 0a20 2020  pec.keys())).   
+00012900: 2020 2020 2073 6f72 7465 645f 6c61 7965       sorted_laye
+00012910: 7273 203d 206c 6179 6572 735b 6e70 2e6c  rs = layers[np.l
+00012920: 6578 736f 7274 2828 6c61 7965 7273 5b3a  exsort((layers[:
+00012930: 2c20 305d 2c20 6c61 7965 7273 5b3a 2c20  , 0], layers[:, 
+00012940: 315d 2929 5d0a 0a20 2020 2020 2020 2066  1]))]..        f
+00012950: 696e 616c 5f68 6173 6820 3d20 6861 7368  inal_hash = hash
+00012960: 6c69 622e 7368 6131 2829 0a20 2020 2020  lib.sha1().     
+00012970: 2020 2066 6f72 206c 6179 6572 2069 6e20     for layer in 
+00012980: 736f 7274 6564 5f6c 6179 6572 733a 0a20  sorted_layers:. 
+00012990: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+000129a0: 5f68 6173 6820 3d20 6861 7368 6c69 622e  _hash = hashlib.
+000129b0: 7368 6131 286c 6179 6572 2e61 7374 7970  sha1(layer.astyp
+000129c0: 6528 6e70 2e69 6e74 3634 2929 2e64 6967  e(np.int64)).dig
+000129d0: 6573 7428 290a 2020 2020 2020 2020 2020  est().          
+000129e0: 2020 706f 6c79 676f 6e73 203d 2070 6f6c    polygons = pol
+000129f0: 7967 6f6e 735f 6279 5f73 7065 635b 7475  ygons_by_spec[tu
+00012a00: 706c 6528 6c61 7965 7229 5d0a 2020 2020  ple(layer)].    
+00012a10: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+00012a20: 203d 205b 5f72 6e64 2870 2e70 6f69 6e74   = [_rnd(p.point
+00012a30: 732c 2070 7265 6369 7369 6f6e 2920 666f  s, precision) fo
+00012a40: 7220 7020 696e 2070 6f6c 7967 6f6e 735d  r p in polygons]
+00012a50: 0a20 2020 2020 2020 2020 2020 2070 6f6c  .            pol
+00012a60: 7967 6f6e 5f68 6173 6865 7320 3d20 6e70  ygon_hashes = np
+00012a70: 2e73 6f72 7428 5b68 6173 686c 6962 2e73  .sort([hashlib.s
+00012a80: 6861 3128 7029 2e64 6967 6573 7428 2920  ha1(p).digest() 
+00012a90: 666f 7220 7020 696e 2070 6f6c 7967 6f6e  for p in polygon
+00012aa0: 735d 290a 2020 2020 2020 2020 2020 2020  s]).            
+00012ab0: 6669 6e61 6c5f 6861 7368 2e75 7064 6174  final_hash.updat
+00012ac0: 6528 6c61 7965 725f 6861 7368 290a 2020  e(layer_hash).  
+00012ad0: 2020 2020 2020 2020 2020 666f 7220 7068            for ph
+00012ae0: 2069 6e20 706f 6c79 676f 6e5f 6861 7368   in polygon_hash
+00012af0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00012b00: 2020 2020 6669 6e61 6c5f 6861 7368 2e75      final_hash.u
+00012b10: 7064 6174 6528 7068 290a 0a20 2020 2020  pdate(ph)..     
+00012b20: 2020 2072 6574 7572 6e20 6669 6e61 6c5f     return final_
+00012b30: 6861 7368 2e68 6578 6469 6765 7374 2829  hash.hexdigest()
+00012b40: 0a0a 2020 2020 6465 6620 6765 745f 6c61  ..    def get_la
+00012b50: 6265 6c73 280a 2020 2020 2020 2020 7365  bels(.        se
+00012b60: 6c66 2c20 6170 706c 795f 7265 7065 7469  lf, apply_repeti
+00012b70: 7469 6f6e 733d 5472 7565 2c20 6465 7074  tions=True, dept
+00012b80: 683a 204f 7074 696f 6e61 6c5b 696e 745d  h: Optional[int]
+00012b90: 203d 204e 6f6e 652c 206c 6179 6572 3d4e   = None, layer=N
+00012ba0: 6f6e 650a 2020 2020 2920 2d3e 204c 6973  one.    ) -> Lis
+00012bb0: 745b 4c61 6265 6c5d 3a0a 2020 2020 2020  t[Label]:.      
+00012bc0: 2020 2222 2252 6574 7572 6e20 6c61 6265    """Return labe
+00012bd0: 6c73 2e0a 0a20 2020 2020 2020 2041 7267  ls...        Arg
+00012be0: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
+00012bf0: 7070 6c79 5f72 6570 6574 6974 696f 6e73  pply_repetitions
+00012c00: 3a2e 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00012c10: 6570 7468 3a20 4e6f 6e65 2072 6574 7572  epth: None retur
+00012c20: 6e73 2061 6c6c 206c 6162 656c 7320 616e  ns all labels an
+00012c30: 6420 3020 746f 7020 6c65 7665 6c2e 0a20  d 0 top level.. 
+00012c40: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00012c50: 3a20 6c61 7965 7273 7065 632e 0a20 2020  : layerspec..   
+00012c60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012c70: 2066 726f 6d20 6764 7366 6163 746f 7279   from gdsfactory
+00012c80: 2e70 646b 2069 6d70 6f72 7420 6765 745f  .pdk import get_
+00012c90: 6c61 7965 720a 0a20 2020 2020 2020 2069  layer..        i
+00012ca0: 6620 6c61 7965 723a 0a20 2020 2020 2020  f layer:.       
+00012cb0: 2020 2020 206c 6179 6572 2c20 7465 7874       layer, text
+00012cc0: 7479 7065 203d 2067 6574 5f6c 6179 6572  type = get_layer
+00012cd0: 286c 6179 6572 290a 2020 2020 2020 2020  (layer).        
+00012ce0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00012cf0: 2020 7465 7874 7479 7065 203d 204e 6f6e    texttype = Non
+00012d00: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00012d10: 2073 656c 662e 5f63 656c 6c2e 6765 745f   self._cell.get_
+00012d20: 6c61 6265 6c73 280a 2020 2020 2020 2020  labels(.        
+00012d30: 2020 2020 6170 706c 795f 7265 7065 7469      apply_repeti
+00012d40: 7469 6f6e 733d 6170 706c 795f 7265 7065  tions=apply_repe
+00012d50: 7469 7469 6f6e 732c 0a20 2020 2020 2020  titions,.       
+00012d60: 2020 2020 2064 6570 7468 3d64 6570 7468       depth=depth
+00012d70: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
+00012d80: 7965 723d 6c61 7965 722c 0a20 2020 2020  yer=layer,.     
+00012d90: 2020 2020 2020 2074 6578 7474 7970 653d         texttype=
+00012da0: 7465 7874 7479 7065 2c0a 2020 2020 2020  texttype,.      
+00012db0: 2020 290a 0a20 2020 2064 6566 2072 656d    )..    def rem
+00012dc0: 6f76 655f 6c61 6265 6c73 2873 656c 6629  ove_labels(self)
+00012dd0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00012de0: 2020 2222 2252 656d 6f76 6520 6c61 6265    """Remove labe
+00012df0: 6c73 2e22 2222 0a20 2020 2020 2020 2073  ls.""".        s
+00012e00: 656c 662e 5f63 656c 6c2e 7265 6d6f 7665  elf._cell.remove
+00012e10: 282a 7365 6c66 2e6c 6162 656c 7329 0a0a  (*self.labels)..
+00012e20: 2020 2020 2320 4465 7072 6563 6174 6564      # Deprecated
+00012e30: 0a20 2020 2064 6566 2067 6574 5f69 6e66  .    def get_inf
+00012e40: 6f28 7365 6c66 293a 0a20 2020 2020 2020  o(self):.       
+00012e50: 2022 2222 4761 7468 6572 7320 7468 6520   """Gathers the 
+00012e60: 2e69 6e66 6f20 6469 6374 696f 6e61 7269  .info dictionari
+00012e70: 6573 2066 726f 6d20 6576 6572 7920 7375  es from every su
+00012e80: 622d 436f 6d70 6f6e 656e 7420 616e 6420  b-Component and 
+00012e90: 7265 7475 726e 7320 7468 656d 2069 6e20  returns them in 
+00012ea0: 6120 6c69 7374 2e0a 0a20 2020 2020 2020  a list...       
+00012eb0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+00012ec0: 2020 2064 6570 7468 3a20 696e 7420 6f72     depth: int or
+00012ed0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+00012ee0: 2020 2020 2020 4966 206e 6f74 204e 6f6e        If not Non
+00012ef0: 652c 2064 6566 696e 6573 2066 726f 6d20  e, defines from 
+00012f00: 686f 7720 6d61 6e79 2072 6566 6572 656e  how many referen
+00012f10: 6365 206c 6576 656c 7320 746f 0a20 2020  ce levels to.   
+00012f20: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00012f30: 7269 6576 6520 506f 7274 7320 6672 6f6d  rieve Ports from
+00012f40: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00012f50: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00012f60: 6c69 7374 206f 6620 6469 6374 696f 6e61  list of dictiona
+00012f70: 7269 6573 0a20 2020 2020 2020 2020 2020  ries.           
+00012f80: 2020 2020 204c 6973 7420 6f66 2074 6865       List of the
+00012f90: 2022 2e69 6e66 6f22 2070 726f 7065 7274   ".info" propert
+00012fa0: 7920 6469 6374 696f 6e61 7269 6573 2066  y dictionaries f
+00012fb0: 726f 6d20 616c 6c20 7375 622d 436f 6d70  rom all sub-Comp
+00012fc0: 6f6e 656e 7473 0a20 2020 2020 2020 2022  onents.        "
+00012fd0: 2222 0a20 2020 2020 2020 2044 5f6c 6973  "".        D_lis
+00012fe0: 7420 3d20 7365 6c66 2e67 6574 5f64 6570  t = self.get_dep
+00012ff0: 656e 6465 6e63 6965 7328 7265 6375 7273  endencies(recurs
+00013000: 6976 653d 5472 7565 290a 2020 2020 2020  ive=True).      
+00013010: 2020 7265 7475 726e 205b 442e 696e 666f    return [D.info
+00013020: 2e63 6f70 7928 2920 666f 7220 4420 696e  .copy() for D in
+00013030: 2044 5f6c 6973 745d 0a0a 2020 2020 6465   D_list]..    de
+00013040: 6620 7265 6d61 705f 6c61 7965 7273 280a  f remap_layers(.
+00013050: 2020 2020 2020 2020 7365 6c66 2c20 6c61          self, la
+00013060: 7965 726d 6170 2c20 696e 636c 7564 655f  yermap, include_
+00013070: 6c61 6265 6c73 3a20 626f 6f6c 203d 2054  labels: bool = T
+00013080: 7275 652c 2069 6e63 6c75 6465 5f70 6174  rue, include_pat
+00013090: 6873 3a20 626f 6f6c 203d 2054 7275 650a  hs: bool = True.
+000130a0: 2020 2020 2920 2d3e 2043 6f6d 706f 6e65      ) -> Compone
+000130b0: 6e74 3a0a 2020 2020 2020 2020 2222 2252  nt:.        """R
+000130c0: 6574 7572 6e73 2061 2063 6f70 7920 6f66  eturns a copy of
+000130d0: 2074 6865 2063 6f6d 706f 6e65 6e74 2077   the component w
+000130e0: 6974 6820 7265 6d61 7070 6564 206c 6179  ith remapped lay
+000130f0: 6572 732e 0a0a 2020 2020 2020 2020 4172  ers...        Ar
+00013100: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00013110: 6c61 7965 726d 6170 3a20 4469 6374 696f  layermap: Dictio
+00013120: 6e61 7279 206f 6620 7661 6c75 6573 2069  nary of values i
+00013130: 6e20 666f 726d 6174 207b 6c61 7965 725f  n format {layer_
+00013140: 6672 6f6d 203a 206c 6179 6572 5f74 6f7d  from : layer_to}
+00013150: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+00013160: 636c 7564 655f 6c61 6265 6c73 3a20 5365  clude_labels: Se
+00013170: 6c65 6374 7320 7768 6574 6865 7220 746f  lects whether to
+00013180: 206d 6f76 6520 4c61 6265 6c73 2061 6c6f   move Labels alo
+00013190: 6e67 2077 6974 6820 706f 6c79 676f 6e73  ng with polygons
+000131a0: 2e0a 2020 2020 2020 2020 2020 2020 696e  ..            in
+000131b0: 636c 7564 655f 7061 7468 733a 2053 656c  clude_paths: Sel
+000131c0: 6563 7473 2077 6865 7468 6572 2074 6f20  ects whether to 
+000131d0: 6d6f 7665 2050 6174 6873 2061 6c6f 6e67  move Paths along
+000131e0: 2077 6974 6820 706f 6c79 676f 6e73 2e0a   with polygons..
+000131f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013200: 2020 2020 636f 6d70 6f6e 656e 7420 3d20      component = 
+00013210: 7365 6c66 2e63 6f70 7928 290a 2020 2020  self.copy().    
+00013220: 2020 2020 6c61 7965 726d 6170 203d 207b      layermap = {
+00013230: 5f70 6172 7365 5f6c 6179 6572 286b 293a  _parse_layer(k):
+00013240: 205f 7061 7273 655f 6c61 7965 7228 7629   _parse_layer(v)
+00013250: 2066 6f72 206b 2c20 7620 696e 206c 6179   for k, v in lay
+00013260: 6572 6d61 702e 6974 656d 7328 297d 0a0a  ermap.items()}..
+00013270: 2020 2020 2020 2020 616c 6c5f 4420 3d20          all_D = 
+00013280: 6c69 7374 2863 6f6d 706f 6e65 6e74 2e67  list(component.g
+00013290: 6574 5f64 6570 656e 6465 6e63 6965 7328  et_dependencies(
+000132a0: 5472 7565 2929 0a20 2020 2020 2020 2061  True)).        a
+000132b0: 6c6c 5f44 2e61 7070 656e 6428 636f 6d70  ll_D.append(comp
+000132c0: 6f6e 656e 7429 0a20 2020 2020 2020 2066  onent).        f
+000132d0: 6f72 2044 2069 6e20 616c 6c5f 443a 0a20  or D in all_D:. 
+000132e0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+000132f0: 2069 6e20 442e 706f 6c79 676f 6e73 3a0a   in D.polygons:.
+00013300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013310: 6c61 7965 7220 3d20 2870 2e6c 6179 6572  layer = (p.layer
+00013320: 2c20 702e 6461 7461 7479 7065 290a 2020  , p.datatype).  
+00013330: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013340: 206c 6179 6572 2069 6e20 6c61 7965 726d   layer in layerm
+00013350: 6170 3a0a 2020 2020 2020 2020 2020 2020  ap:.            
+00013360: 2020 2020 2020 2020 6e65 775f 6c61 7965          new_laye
+00013370: 7220 3d20 6c61 7965 726d 6170 5b6c 6179  r = layermap[lay
+00013380: 6572 5d0a 2020 2020 2020 2020 2020 2020  er].            
+00013390: 2020 2020 2020 2020 702e 6c61 7965 7220          p.layer 
+000133a0: 3d20 6e65 775f 6c61 7965 725b 305d 0a20  = new_layer[0]. 
+000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133c0: 2020 2070 2e64 6174 6174 7970 6520 3d20     p.datatype = 
+000133d0: 6e65 775f 6c61 7965 725b 315d 0a20 2020  new_layer[1].   
+000133e0: 2020 2020 2020 2020 2069 6620 696e 636c           if incl
+000133f0: 7564 655f 6c61 6265 6c73 3a0a 2020 2020  ude_labels:.    
+00013400: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00013410: 6c61 6265 6c20 696e 2044 2e6c 6162 656c  label in D.label
+00013420: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00013430: 2020 2020 2020 206f 7269 6769 6e61 6c5f         original_
+00013440: 6c61 7965 7220 3d20 286c 6162 656c 2e6c  layer = (label.l
+00013450: 6179 6572 2c20 6c61 6265 6c2e 7465 7874  ayer, label.text
+00013460: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
+00013470: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+00013480: 616c 5f6c 6179 6572 203d 205f 7061 7273  al_layer = _pars
+00013490: 655f 6c61 7965 7228 6f72 6967 696e 616c  e_layer(original
+000134a0: 5f6c 6179 6572 290a 2020 2020 2020 2020  _layer).        
+000134b0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+000134c0: 7269 6769 6e61 6c5f 6c61 7965 7220 696e  riginal_layer in
+000134d0: 206c 6179 6572 6d61 703a 0a20 2020 2020   layermap:.     
+000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134f0: 2020 206e 6577 5f6c 6179 6572 203d 206c     new_layer = l
+00013500: 6179 6572 6d61 705b 6f72 6967 696e 616c  ayermap[original
+00013510: 5f6c 6179 6572 5d0a 2020 2020 2020 2020  _layer].        
 00013520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013530: 206f 7269 6769 6e61 6c5f 6c61 7965 7220   original_layer 
-00013540: 3d20 286c 6162 656c 2e6c 6179 6572 2c20  = (label.layer, 
-00013550: 6c61 6265 6c2e 7465 7874 7479 7065 290a  label.texttype).
-00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013570: 2020 2020 6f72 6967 696e 616c 5f6c 6179      original_lay
-00013580: 6572 203d 205f 7061 7273 655f 6c61 7965  er = _parse_laye
-00013590: 7228 6f72 6967 696e 616c 5f6c 6179 6572  r(original_layer
-000135a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000135b0: 2020 2020 2020 6966 206f 7269 6769 6e61        if origina
-000135c0: 6c5f 6c61 7965 7220 696e 206c 6179 6572  l_layer in layer
-000135d0: 6d61 703a 0a20 2020 2020 2020 2020 2020  map:.           
-000135e0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-000135f0: 5f6c 6179 6572 203d 206c 6179 6572 6d61  _layer = layerma
-00013600: 705b 6f72 6967 696e 616c 5f6c 6179 6572  p[original_layer
-00013610: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00013620: 2020 2020 2020 2020 2020 6c61 6265 6c2e            label.
-00013630: 6c61 7965 7220 3d20 6e65 775f 6c61 7965  layer = new_laye
-00013640: 725b 305d 0a20 2020 2020 2020 2020 2020  r[0].           
-00013650: 2020 2020 2020 2020 2020 2020 206c 6162               lab
-00013660: 656c 2e74 6578 7474 7970 6520 3d20 6e65  el.texttype = ne
-00013670: 775f 6c61 7965 725b 315d 0a0a 2020 2020  w_layer[1]..    
-00013680: 2020 2020 2020 2020 6966 2069 6e63 6c75          if inclu
-00013690: 6465 5f70 6174 6873 3a0a 2020 2020 2020  de_paths:.      
-000136a0: 2020 2020 2020 2020 2020 666f 7220 7061            for pa
-000136b0: 7468 2069 6e20 442e 7061 7468 733a 0a20  th in D.paths:. 
-000136c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136d0: 2020 206e 6577 5f6c 6179 6572 7320 3d20     new_layers = 
-000136e0: 6c69 7374 2870 6174 682e 6c61 7965 7273  list(path.layers
-000136f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00013700: 2020 2020 2020 6e65 775f 6461 7461 7479        new_dataty
-00013710: 7065 7320 3d20 6c69 7374 2870 6174 682e  pes = list(path.
-00013720: 6461 7461 7479 7065 7329 0a20 2020 2020  datatypes).     
-00013730: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00013740: 6f72 206c 6179 6572 5f6e 756d 6265 7220  or layer_number 
-00013750: 696e 2072 616e 6765 286c 656e 286e 6577  in range(len(new
-00013760: 5f6c 6179 6572 7329 293a 0a20 2020 2020  _layers)):.     
-00013770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013780: 2020 206f 7269 6769 6e61 6c5f 6c61 7965     original_laye
-00013790: 7220 3d20 5f70 6172 7365 5f6c 6179 6572  r = _parse_layer
-000137a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000137b0: 2020 2020 2020 2020 2020 2020 2020 286e                (n
-000137c0: 6577 5f6c 6179 6572 735b 6c61 7965 725f  ew_layers[layer_
-000137d0: 6e75 6d62 6572 5d2c 206e 6577 5f64 6174  number], new_dat
-000137e0: 6174 7970 6573 5b6c 6179 6572 5f6e 756d  atypes[layer_num
-000137f0: 6265 725d 290a 2020 2020 2020 2020 2020  ber]).          
-00013800: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00013810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013820: 2020 2020 2020 2020 6966 206f 7269 6769          if origi
-00013830: 6e61 6c5f 6c61 7965 7220 696e 206c 6179  nal_layer in lay
-00013840: 6572 6d61 703a 0a20 2020 2020 2020 2020  ermap:.         
-00013850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013860: 2020 206e 6577 5f6c 6179 6572 203d 206c     new_layer = l
-00013870: 6179 6572 6d61 705b 6f72 6967 696e 616c  ayermap[original
-00013880: 5f6c 6179 6572 5d0a 2020 2020 2020 2020  _layer].        
-00013890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138a0: 2020 2020 6e65 775f 6c61 7965 7273 5b6c      new_layers[l
-000138b0: 6179 6572 5f6e 756d 6265 725d 203d 206e  ayer_number] = n
-000138c0: 6577 5f6c 6179 6572 5b30 5d0a 2020 2020  ew_layer[0].    
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2020 2020 2020 2020 6e65 775f 6461 7461          new_data
-000138f0: 7479 7065 735b 6c61 7965 725f 6e75 6d62  types[layer_numb
-00013900: 6572 5d20 3d20 6e65 775f 6c61 7965 725b  er] = new_layer[
-00013910: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-00013920: 2020 2020 2020 2070 6174 682e 7365 745f         path.set_
-00013930: 6c61 7965 7273 282a 6e65 775f 6c61 7965  layers(*new_laye
-00013940: 7273 290a 2020 2020 2020 2020 2020 2020  rs).            
-00013950: 2020 2020 2020 2020 7061 7468 2e73 6574          path.set
-00013960: 5f64 6174 6174 7970 6573 282a 6e65 775f  _datatypes(*new_
-00013970: 6461 7461 7479 7065 7329 0a20 2020 2020  datatypes).     
-00013980: 2020 2072 6574 7572 6e20 636f 6d70 6f6e     return compon
-00013990: 656e 740a 0a20 2020 2064 6566 2074 6f5f  ent..    def to_
-000139a0: 3364 280a 2020 2020 2020 2020 7365 6c66  3d(.        self
-000139b0: 2c0a 2020 2020 2020 2020 6c61 7965 725f  ,.        layer_
-000139c0: 7669 6577 733a 204f 7074 696f 6e61 6c5b  views: Optional[
-000139d0: 4c61 7965 7256 6965 7773 5d20 3d20 4e6f  LayerViews] = No
-000139e0: 6e65 2c0a 2020 2020 2020 2020 6c61 7965  ne,.        laye
-000139f0: 725f 7374 6163 6b3a 204f 7074 696f 6e61  r_stack: Optiona
-00013a00: 6c5b 4c61 7965 7253 7461 636b 5d20 3d20  l[LayerStack] = 
-00013a10: 4e6f 6e65 2c0a 2020 2020 2020 2020 6578  None,.        ex
-00013a20: 636c 7564 655f 6c61 7965 7273 3a20 4f70  clude_layers: Op
-00013a30: 7469 6f6e 616c 5b54 7570 6c65 5b4c 6179  tional[Tuple[Lay
-00013a40: 6572 2c20 2e2e 2e5d 5d20 3d20 4e6f 6e65  er, ...]] = None
-00013a50: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
-00013a60: 2022 2222 5265 7475 726e 2043 6f6d 706f   """Return Compo
-00013a70: 6e65 6e74 2033 4420 7472 696d 6573 6820  nent 3D trimesh 
-00013a80: 5363 656e 652e 0a0a 2020 2020 2020 2020  Scene...        
-00013a90: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00013aa0: 2020 636f 6d70 6f6e 656e 743a 2074 6f20    component: to 
-00013ab0: 6578 7472 7564 6520 696e 2033 442e 0a20  extrude in 3D.. 
-00013ac0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
-00013ad0: 5f76 6965 7773 3a20 6c61 7965 7220 636f  _views: layer co
-00013ae0: 6c6f 7273 2066 726f 6d20 4b6c 6179 6f75  lors from Klayou
-00013af0: 7420 4c61 7965 7220 5072 6f70 6572 7469  t Layer Properti
-00013b00: 6573 2066 696c 652e 0a20 2020 2020 2020  es file..       
-00013b10: 2020 2020 2020 2020 2044 6566 6175 6c74           Default
-00013b20: 7320 746f 2061 6374 6976 6520 5044 4b2e  s to active PDK.
-00013b30: 6c61 7965 725f 7669 6577 732e 0a20 2020  layer_views..   
-00013b40: 2020 2020 2020 2020 206c 6179 6572 5f73           layer_s
-00013b50: 7461 636b 3a20 636f 6e74 6169 6e73 2074  tack: contains t
-00013b60: 6869 636b 6e65 7373 2061 6e64 207a 6d69  hickness and zmi
-00013b70: 6e20 666f 7220 6561 6368 206c 6179 6572  n for each layer
-00013b80: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00013b90: 2020 4465 6661 756c 7473 2074 6f20 6163    Defaults to ac
-00013ba0: 7469 7665 2050 444b 2e6c 6179 6572 5f73  tive PDK.layer_s
-00013bb0: 7461 636b 2e0a 2020 2020 2020 2020 2020  tack..          
-00013bc0: 2020 6578 636c 7564 655f 6c61 7965 7273    exclude_layers
-00013bd0: 3a20 6c61 7965 7273 2074 6f20 6578 636c  : layers to excl
-00013be0: 7564 652e 0a0a 2020 2020 2020 2020 2222  ude...        ""
-00013bf0: 220a 2020 2020 2020 2020 6672 6f6d 2067  ".        from g
-00013c00: 6473 6661 6374 6f72 792e 6578 706f 7274  dsfactory.export
-00013c10: 2e74 6f5f 3364 2069 6d70 6f72 7420 746f  .to_3d import to
-00013c20: 5f33 640a 0a20 2020 2020 2020 2072 6574  _3d..        ret
-00013c30: 7572 6e20 746f 5f33 6428 0a20 2020 2020  urn to_3d(.     
-00013c40: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00013c50: 2020 2020 2020 2020 206c 6179 6572 5f76           layer_v
-00013c60: 6965 7773 3d6c 6179 6572 5f76 6965 7773  iews=layer_views
-00013c70: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
-00013c80: 7965 725f 7374 6163 6b3d 6c61 7965 725f  yer_stack=layer_
-00013c90: 7374 6163 6b2c 0a20 2020 2020 2020 2020  stack,.         
-00013ca0: 2020 2065 7863 6c75 6465 5f6c 6179 6572     exclude_layer
-00013cb0: 733d 6578 636c 7564 655f 6c61 7965 7273  s=exclude_layers
-00013cc0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00013cd0: 2064 6566 2074 6f5f 6e70 280a 2020 2020   def to_np(.    
-00013ce0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00013cf0: 2020 6e6d 5f70 6572 5f70 6978 656c 3a20    nm_per_pixel: 
-00013d00: 696e 7420 3d20 3230 2c0a 2020 2020 2020  int = 20,.      
-00013d10: 2020 6c61 7965 7273 3a20 4c61 7965 7273    layers: Layers
-00013d20: 203d 2028 2831 2c20 3029 2c29 2c0a 2020   = ((1, 0),),.  
-00013d30: 2020 2020 2020 7661 6c75 6573 3a20 4f70        values: Op
-00013d40: 7469 6f6e 616c 5b54 7570 6c65 5b66 6c6f  tional[Tuple[flo
-00013d50: 6174 2c20 2e2e 2e5d 5d20 3d20 4e6f 6e65  at, ...]] = None
-00013d60: 2c0a 2020 2020 2020 2020 7061 645f 7769  ,.        pad_wi
-00013d70: 6474 683a 2069 6e74 203d 2031 2c0a 2020  dth: int = 1,.  
-00013d80: 2020 2920 2d3e 206e 702e 6e64 6172 7261    ) -> np.ndarra
-00013d90: 793a 0a20 2020 2020 2020 2022 2222 5265  y:.        """Re
-00013da0: 7475 726e 7320 6120 7069 7865 6c61 7465  turns a pixelate
-00013db0: 6420 6e75 6d70 7920 6172 7261 7920 6672  d numpy array fr
-00013dc0: 6f6d 2043 6f6d 706f 6e65 6e74 2070 6f6c  om Component pol
-00013dd0: 7967 6f6e 732e 0a0a 2020 2020 2020 2020  ygons...        
-00013de0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00013df0: 2020 636f 6d70 6f6e 656e 743a 2043 6f6d    component: Com
-00013e00: 706f 6e65 6e74 2e0a 2020 2020 2020 2020  ponent..        
-00013e10: 2020 2020 6e6d 5f70 6572 5f70 6978 656c      nm_per_pixel
-00013e20: 3a20 796f 7520 6361 6e20 676f 2066 726f  : you can go fro
-00013e30: 6d20 3230 2028 636f 6172 7365 2920 746f  m 20 (coarse) to
-00013e40: 2034 2028 6669 6e65 292e 0a20 2020 2020   4 (fine)..     
-00013e50: 2020 2020 2020 206c 6179 6572 733a 2074         layers: t
-00013e60: 6f20 636f 6e76 6572 742e 204f 7264 6572  o convert. Order
-00013e70: 206d 6174 7465 7273 2028 6c61 7474 6572   matters (latter
-00013e80: 206f 7665 7277 7269 7465 2066 6f72 6d65   overwrite forme
-00013e90: 7229 2e0a 2020 2020 2020 2020 2020 2020  r)..            
-00013ea0: 7661 6c75 6573 3a20 6173 736f 6369 6174  values: associat
-00013eb0: 6564 2074 6f20 6561 6368 206c 6179 6572  ed to each layer
-00013ec0: 2028 6465 6661 756c 7473 2074 6f20 3129   (defaults to 1)
-00013ed0: 2e0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
-00013ee0: 645f 7769 6474 683a 2070 6164 6469 6e67  d_width: padding
-00013ef0: 2070 6978 656c 7320 6172 6f75 6e64 2074   pixels around t
-00013f00: 6865 2069 6d61 6765 2e0a 0a20 2020 2020  he image...     
-00013f10: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00013f20: 726f 6d20 6764 7366 6163 746f 7279 2e65  rom gdsfactory.e
-00013f30: 7870 6f72 742e 746f 5f6e 7020 696d 706f  xport.to_np impo
-00013f40: 7274 2074 6f5f 6e70 0a0a 2020 2020 2020  rt to_np..      
-00013f50: 2020 7265 7475 726e 2074 6f5f 6e70 280a    return to_np(.
-00013f60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013f70: 2c0a 2020 2020 2020 2020 2020 2020 6e6d  ,.            nm
-00013f80: 5f70 6572 5f70 6978 656c 3d6e 6d5f 7065  _per_pixel=nm_pe
-00013f90: 725f 7069 7865 6c2c 0a20 2020 2020 2020  r_pixel,.       
-00013fa0: 2020 2020 206c 6179 6572 733d 6c61 7965       layers=laye
-00013fb0: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
-00013fc0: 7661 6c75 6573 3d76 616c 7565 732c 0a20  values=values,. 
-00013fd0: 2020 2020 2020 2020 2020 2070 6164 5f77             pad_w
-00013fe0: 6964 7468 3d70 6164 5f77 6964 7468 2c0a  idth=pad_width,.
-00013ff0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00014000: 6566 2077 7269 7465 5f73 746c 280a 2020  ef write_stl(.  
-00014010: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00014020: 2020 2020 6669 6c65 7061 7468 3a20 7374      filepath: st
-00014030: 722c 0a20 2020 2020 2020 206c 6179 6572  r,.        layer
-00014040: 5f73 7461 636b 3a20 4f70 7469 6f6e 616c  _stack: Optional
-00014050: 5b4c 6179 6572 5374 6163 6b5d 203d 204e  [LayerStack] = N
-00014060: 6f6e 652c 0a20 2020 2020 2020 2065 7863  one,.        exc
-00014070: 6c75 6465 5f6c 6179 6572 733a 204f 7074  lude_layers: Opt
-00014080: 696f 6e61 6c5b 5475 706c 655b 4c61 7965  ional[Tuple[Laye
-00014090: 722c 202e 2e2e 5d5d 203d 204e 6f6e 652c  r, ...]] = None,
-000140a0: 0a20 2020 2029 202d 3e20 6e70 2e6e 6461  .    ) -> np.nda
-000140b0: 7272 6179 3a0a 2020 2020 2020 2020 2222  rray:.        ""
-000140c0: 2257 7269 7465 2061 2043 6f6d 706f 6e65  "Write a Compone
-000140d0: 6e74 2074 6f20 5354 4c20 666f 7220 3344  nt to STL for 3D
-000140e0: 2070 7269 6e74 696e 672e 0a0a 2020 2020   printing...    
-000140f0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00014100: 2020 2020 2020 6669 6c65 7061 7468 3a20        filepath: 
-00014110: 746f 2077 7269 7465 2053 544c 2074 6f2e  to write STL to.
-00014120: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00014130: 6572 5f73 7461 636b 3a20 636f 6e74 6169  er_stack: contai
-00014140: 6e73 2074 6869 636b 6e65 7373 2061 6e64  ns thickness and
-00014150: 207a 6d69 6e20 666f 7220 6561 6368 206c   zmin for each l
-00014160: 6179 6572 2e0a 2020 2020 2020 2020 2020  ayer..          
-00014170: 2020 6578 636c 7564 655f 6c61 7965 7273    exclude_layers
-00014180: 3a20 6c61 7965 7273 2074 6f20 6578 636c  : layers to excl
-00014190: 7564 652e 0a20 2020 2020 2020 2020 2020  ude..           
-000141a0: 2075 7365 5f6c 6179 6572 5f6e 616d 653a   use_layer_name:
-000141b0: 2049 6620 5472 7565 2c20 7573 6573 204c   If True, uses L
-000141c0: 6179 6572 4c65 7665 6c20 6e61 6d65 7320  ayerLevel names 
-000141d0: 696e 206f 7574 7075 7420 6669 6c65 6e61  in output filena
-000141e0: 6d65 7320 7261 7468 6572 2074 6861 6e20  mes rather than 
-000141f0: 6764 735f 6c61 7965 7220 616e 6420 6764  gds_layer and gd
-00014200: 735f 6461 7461 7479 7065 2e0a 2020 2020  s_datatype..    
-00014210: 2020 2020 2020 2020 6875 6c6c 5f69 6e76          hull_inv
-00014220: 616c 6964 5f70 6f6c 7967 6f6e 733a 2049  alid_polygons: I
-00014230: 6620 5472 7565 2c20 7265 706c 6163 6573  f True, replaces
-00014240: 2069 6e76 616c 6964 2070 6f6c 7967 6f6e   invalid polygon
-00014250: 7320 2864 6574 6572 6d69 6e65 6420 6279  s (determined by
-00014260: 2073 6861 7065 6c79 2e50 6f6c 7967 6f6e   shapely.Polygon
-00014270: 2e69 735f 7661 6c69 6429 2077 6974 6820  .is_valid) with 
-00014280: 6974 7320 636f 6e76 6578 2068 756c 6c2e  its convex hull.
-00014290: 0a20 2020 2020 2020 2020 2020 2073 6361  .            sca
-000142a0: 6c65 3a20 4f70 7469 6f6e 616c 2066 6163  le: Optional fac
-000142b0: 746f 7220 6279 2077 6869 6368 2074 6f20  tor by which to 
-000142c0: 7363 616c 6520 6d65 7368 6573 2062 6566  scale meshes bef
-000142d0: 6f72 6520 7772 6974 696e 672e 0a0a 2020  ore writing...  
-000142e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000142f0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-00014300: 792e 6578 706f 7274 2e74 6f5f 7374 6c20  y.export.to_stl 
-00014310: 696d 706f 7274 2074 6f5f 7374 6c0a 0a20  import to_stl.. 
-00014320: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
-00014330: 5f73 746c 280a 2020 2020 2020 2020 2020  _stl(.          
-00014340: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00014350: 2020 2020 6669 6c65 7061 7468 3d66 696c      filepath=fil
-00014360: 6570 6174 682c 0a20 2020 2020 2020 2020  epath,.         
-00014370: 2020 206c 6179 6572 5f73 7461 636b 3d6c     layer_stack=l
-00014380: 6179 6572 5f73 7461 636b 2c0a 2020 2020  ayer_stack,.    
-00014390: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
-000143a0: 6c61 7965 7273 3d65 7863 6c75 6465 5f6c  layers=exclude_l
-000143b0: 6179 6572 732c 0a20 2020 2020 2020 2029  ayers,.        )
-000143c0: 0a0a 2020 2020 6465 6620 746f 5f67 6d73  ..    def to_gms
-000143d0: 6828 0a20 2020 2020 2020 2073 656c 662c  h(.        self,
-000143e0: 0a20 2020 2020 2020 2074 7970 652c 0a20  .        type,. 
-000143f0: 2020 2020 2020 207a 3d4e 6f6e 652c 0a20         z=None,. 
-00014400: 2020 2020 2020 2078 7365 6374 696f 6e5f         xsection_
-00014410: 626f 756e 6473 3d4e 6f6e 652c 0a20 2020  bounds=None,.   
-00014420: 2020 2020 206c 6179 6572 5f73 7461 636b       layer_stack
-00014430: 3d4e 6f6e 652c 0a20 2020 2020 2020 2077  =None,.        w
-00014440: 6166 6572 5f70 6164 6469 6e67 3d30 2e30  afer_padding=0.0
-00014450: 2c0a 2020 2020 2020 2020 7761 6665 725f  ,.        wafer_
-00014460: 6c61 7965 723d 4c41 5945 522e 5741 4645  layer=LAYER.WAFE
-00014470: 522c 0a20 2020 2020 2020 202a 6172 6773  R,.        *args
-00014480: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
-00014490: 6773 2c0a 2020 2020 293a 0a20 2020 2020  gs,.    ):.     
-000144a0: 2020 2022 2222 5265 7475 726e 7320 6120     """Returns a 
-000144b0: 676d 7368 206d 7368 206f 6620 7468 6520  gmsh msh of the 
-000144c0: 636f 6d70 6f6e 656e 7420 666f 7220 6669  component for fi
-000144d0: 6e69 7465 2065 6c65 6d65 6e74 2073 696d  nite element sim
-000144e0: 756c 6174 696f 6e2e 0a0a 2020 2020 2020  ulation...      
-000144f0: 2020 4172 6775 6d65 6e74 733a 0a20 2020    Arguments:.   
-00014500: 2020 2020 2020 2020 2074 7970 653a 206f           type: o
-00014510: 6e65 206f 6620 2278 7922 2c20 2275 7a22  ne of "xy", "uz"
-00014520: 2c20 6f72 2022 3344 222e 2044 6574 6572  , or "3D". Deter
-00014530: 6d69 6e65 7320 7468 6520 7479 7065 206f  mines the type o
-00014540: 6620 6d65 7368 2074 6f20 7265 7475 726e  f mesh to return
-00014550: 2e0a 2020 2020 2020 2020 2020 2020 7a3a  ..            z:
-00014560: 2075 7365 6420 746f 2064 6566 696e 6520   used to define 
-00014570: 7a2d 736c 6963 6520 666f 7220 7879 206d  z-slice for xy m
-00014580: 6573 6869 6e67 0a20 2020 2020 2020 2020  eshing.         
-00014590: 2020 2078 7365 6374 696f 6e5f 626f 756e     xsection_boun
-000145a0: 6473 3a20 7573 6564 2074 6f20 6465 6669  ds: used to defi
-000145b0: 6e65 2069 6e2d 706c 616e 6520 6c69 6e65  ne in-plane line
-000145c0: 2066 6f72 2075 7a20 6d65 7368 696e 670a   for uz meshing.
-000145d0: 2020 2020 2020 2020 2020 2020 7761 6665              wafe
-000145e0: 725f 7061 6464 696e 673a 2070 6164 6469  r_padding: paddi
-000145f0: 6e67 2062 6579 6f6e 6420 6262 6f78 2074  ng beyond bbox t
-00014600: 6f20 6164 6420 746f 2057 4146 4552 206c  o add to WAFER l
-00014610: 6179 6572 732e 0a0a 2020 2020 2020 2020  ayers...        
-00014620: 4b65 7977 6f72 6420 4172 6773 3a0a 2020  Keyword Args:.  
-00014630: 2020 2020 2020 2020 2020 4172 6775 6d65            Argume
-00014640: 6e74 7320 666f 7220 7468 6520 7461 7267  nts for the targ
-00014650: 6574 206d 6573 6869 6e67 2066 756e 6374  et meshing funct
-00014660: 696f 6e20 696e 2067 6473 6661 6374 6f72  ion in gdsfactor
-00014670: 792e 7369 6d75 6c61 7469 6f6e 2e67 6d73  y.simulation.gms
-00014680: 680a 2020 2020 2020 2020 2222 220a 2020  h.        """.  
-00014690: 2020 2020 2020 2320 4164 6420 5741 4645        # Add WAFE
-000146a0: 5220 6c61 7965 723a 0a20 2020 2020 2020  R layer:.       
-000146b0: 2070 6164 6465 645f 636f 6d70 6f6e 656e   padded_componen
-000146c0: 7420 3d20 436f 6d70 6f6e 656e 7428 290a  t = Component().
-000146d0: 2020 2020 2020 2020 7061 6464 6564 5f63          padded_c
-000146e0: 6f6d 706f 6e65 6e74 203c 3c20 7365 6c66  omponent << self
-000146f0: 0a20 2020 2020 2020 2028 786d 696e 2c20  .        (xmin, 
-00014700: 796d 696e 292c 2028 786d 6178 2c20 796d  ymin), (xmax, ym
-00014710: 6178 2920 3d20 7365 6c66 2e62 626f 780a  ax) = self.bbox.
-00014720: 2020 2020 2020 2020 706f 696e 7473 203d          points =
-00014730: 205b 0a20 2020 2020 2020 2020 2020 205b   [.            [
-00014740: 786d 696e 202d 2077 6166 6572 5f70 6164  xmin - wafer_pad
-00014750: 6469 6e67 2c20 796d 696e 202d 2077 6166  ding, ymin - waf
-00014760: 6572 5f70 6164 6469 6e67 5d2c 0a20 2020  er_padding],.   
-00014770: 2020 2020 2020 2020 205b 786d 6178 202b           [xmax +
-00014780: 2077 6166 6572 5f70 6164 6469 6e67 2c20   wafer_padding, 
-00014790: 796d 696e 202d 2077 6166 6572 5f70 6164  ymin - wafer_pad
-000147a0: 6469 6e67 5d2c 0a20 2020 2020 2020 2020  ding],.         
-000147b0: 2020 205b 786d 6178 202b 2077 6166 6572     [xmax + wafer
-000147c0: 5f70 6164 6469 6e67 2c20 796d 6178 202b  _padding, ymax +
-000147d0: 2077 6166 6572 5f70 6164 6469 6e67 5d2c   wafer_padding],
-000147e0: 0a20 2020 2020 2020 2020 2020 205b 786d  .            [xm
-000147f0: 696e 202d 2077 6166 6572 5f70 6164 6469  in - wafer_paddi
-00014800: 6e67 2c20 796d 6178 202b 2077 6166 6572  ng, ymax + wafer
-00014810: 5f70 6164 6469 6e67 5d2c 0a20 2020 2020  _padding],.     
-00014820: 2020 205d 0a20 2020 2020 2020 2070 6164     ].        pad
-00014830: 6465 645f 636f 6d70 6f6e 656e 742e 6164  ded_component.ad
-00014840: 645f 706f 6c79 676f 6e28 706f 696e 7473  d_polygon(points
-00014850: 2c20 6c61 7965 723d 7761 6665 725f 6c61  , layer=wafer_la
-00014860: 7965 7229 0a0a 2020 2020 2020 2020 6966  yer)..        if
-00014870: 206c 6179 6572 5f73 7461 636b 2069 7320   layer_stack is 
-00014880: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00014890: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000148a0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-000148b0: 2020 2020 2741 204c 6179 6572 5374 6163      'A LayerStac
-000148c0: 6b20 6d75 7374 2062 6520 7072 6f76 6964  k must be provid
-000148d0: 6564 2074 6872 6f75 6768 2061 7267 756d  ed through argum
-000148e0: 656e 7420 226c 6179 6572 5f73 7461 636b  ent "layer_stack
-000148f0: 222e 270a 2020 2020 2020 2020 2020 2020  ".'.            
-00014900: 290a 2020 2020 2020 2020 6966 2074 7970  ).        if typ
-00014910: 6520 3d3d 2022 7879 223a 0a20 2020 2020  e == "xy":.     
-00014920: 2020 2020 2020 2069 6620 7a20 6973 204e         if z is N
-00014930: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00014940: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00014950: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00014960: 2020 2020 2020 2020 2020 2027 466f 7220             'For 
-00014970: 7879 2d6d 6573 6869 6e67 2c20 6120 7a2d  xy-meshing, a z-
-00014980: 7661 6c75 6520 6d75 7374 2062 6520 7072  value must be pr
-00014990: 6f76 6964 6564 2076 6961 2074 6865 2066  ovided via the f
-000149a0: 6c6f 6174 2061 7267 756d 656e 7420 227a  loat argument "z
-000149b0: 222e 270a 2020 2020 2020 2020 2020 2020  ".'.            
-000149c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000149d0: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
-000149e0: 792e 7369 6d75 6c61 7469 6f6e 2e67 6d73  y.simulation.gms
-000149f0: 682e 7879 5f78 7365 6374 696f 6e5f 6d65  h.xy_xsection_me
-00014a00: 7368 2069 6d70 6f72 7420 7879 5f78 7365  sh import xy_xse
-00014a10: 6374 696f 6e5f 6d65 7368 0a0a 2020 2020  ction_mesh..    
-00014a20: 2020 2020 2020 2020 7265 7475 726e 2078          return x
-00014a30: 795f 7873 6563 7469 6f6e 5f6d 6573 6828  y_xsection_mesh(
-00014a40: 7061 6464 6564 5f63 6f6d 706f 6e65 6e74  padded_component
-00014a50: 2c20 7a2c 206c 6179 6572 5f73 7461 636b  , z, layer_stack
-00014a60: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-00014a70: 2020 2020 656c 6966 2074 7970 6520 3d3d      elif type ==
-00014a80: 2022 757a 223a 0a20 2020 2020 2020 2020   "uz":.         
-00014a90: 2020 2069 6620 7873 6563 7469 6f6e 5f62     if xsection_b
-00014aa0: 6f75 6e64 7320 6973 204e 6f6e 653a 0a20  ounds is None:. 
-00014ab0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014ac0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00014ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ae0: 2020 2020 2022 466f 7220 757a 2d6d 6573       "For uz-mes
-00014af0: 6869 6e67 2c20 796f 7520 6d75 7374 2070  hing, you must p
-00014b00: 726f 7669 6465 2061 206c 696e 6520 696e  rovide a line in
-00014b10: 2074 6865 2078 792d 706c 616e 6520 220a   the xy-plane ".
-00014b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b30: 2020 2020 2276 6961 2074 6865 2054 7570      "via the Tup
-00014b40: 6c65 2061 7267 756d 656e 7420 5b5b 7831  le argument [[x1
-00014b50: 2c79 315d 2c20 5b78 322c 7932 5d5d 2078  ,y1], [x2,y2]] x
-00014b60: 7365 6374 696f 6e5f 626f 756e 6473 2e22  section_bounds."
-00014b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014b80: 2029 0a20 2020 2020 2020 2020 2020 2066   ).            f
-00014b90: 726f 6d20 6764 7366 6163 746f 7279 2e73  rom gdsfactory.s
-00014ba0: 696d 756c 6174 696f 6e2e 676d 7368 2e75  imulation.gmsh.u
-00014bb0: 7a5f 7873 6563 7469 6f6e 5f6d 6573 6820  z_xsection_mesh 
-00014bc0: 696d 706f 7274 2075 7a5f 7873 6563 7469  import uz_xsecti
-00014bd0: 6f6e 5f6d 6573 680a 0a20 2020 2020 2020  on_mesh..       
-00014be0: 2020 2020 2072 6574 7572 6e20 757a 5f78       return uz_x
-00014bf0: 7365 6374 696f 6e5f 6d65 7368 280a 2020  section_mesh(.  
-00014c00: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00014c10: 6464 6564 5f63 6f6d 706f 6e65 6e74 2c20  dded_component, 
-00014c20: 7873 6563 7469 6f6e 5f62 6f75 6e64 732c  xsection_bounds,
-00014c30: 206c 6179 6572 5f73 7461 636b 2c20 2a2a   layer_stack, **
-00014c40: 6b77 6172 6773 0a20 2020 2020 2020 2020  kwargs.         
-00014c50: 2020 2029 0a20 2020 2020 2020 2065 6c69     ).        eli
-00014c60: 6620 7479 7065 203d 3d20 2233 4422 3a0a  f type == "3D":.
-00014c70: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-00014c80: 2067 6473 6661 6374 6f72 792e 7369 6d75   gdsfactory.simu
-00014c90: 6c61 7469 6f6e 2e67 6d73 682e 7879 7a5f  lation.gmsh.xyz_
-00014ca0: 6d65 7368 2069 6d70 6f72 7420 7879 7a5f  mesh import xyz_
-00014cb0: 6d65 7368 0a0a 2020 2020 2020 2020 2020  mesh..          
-00014cc0: 2020 7265 7475 726e 2078 797a 5f6d 6573    return xyz_mes
-00014cd0: 6828 7061 6464 6564 5f63 6f6d 706f 6e65  h(padded_compone
-00014ce0: 6e74 2c20 6c61 7965 725f 7374 6163 6b2c  nt, layer_stack,
-00014cf0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-00014d00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00014d10: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00014d20: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00014d30: 2020 2020 2020 2027 5265 7175 6972 6564         'Required
-00014d40: 2061 7267 756d 656e 7420 2274 7970 6522   argument "type"
-00014d50: 206d 7573 7420 6265 206f 6e65 206f 6620   must be one of 
-00014d60: 2278 7922 2c20 2275 7a22 2c20 6f72 2022  "xy", "uz", or "
-00014d70: 3344 222e 270a 2020 2020 2020 2020 2020  3D".'.          
-00014d80: 2020 290a 0a20 2020 2064 6566 206f 6666    )..    def off
-00014d90: 7365 7428 0a20 2020 2020 2020 2073 656c  set(.        sel
-00014da0: 662c 0a20 2020 2020 2020 2064 6973 7461  f,.        dista
-00014db0: 6e63 653a 2066 6c6f 6174 203d 2030 2e31  nce: float = 0.1
-00014dc0: 2c0a 2020 2020 2020 2020 706f 6c79 676f  ,.        polygo
-00014dd0: 6e73 3d4e 6f6e 652c 0a20 2020 2020 2020  ns=None,.       
-00014de0: 2075 7365 5f75 6e69 6f6e 3a20 626f 6f6c   use_union: bool
-00014df0: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-00014e00: 2070 7265 6369 7369 6f6e 3a20 666c 6f61   precision: floa
-00014e10: 7420 3d20 3165 2d34 2c0a 2020 2020 2020  t = 1e-4,.      
-00014e20: 2020 6a6f 696e 3a20 7374 7220 3d20 226d    join: str = "m
-00014e30: 6974 6572 222c 0a20 2020 2020 2020 2074  iter",.        t
-00014e40: 6f6c 6572 616e 6365 3a20 696e 7420 3d20  olerance: int = 
-00014e50: 322c 0a20 2020 2020 2020 206c 6179 6572  2,.        layer
-00014e60: 3a20 4c61 7965 7253 7065 6320 3d20 2257  : LayerSpec = "W
-00014e70: 4722 2c0a 2020 2020 2920 2d3e 2043 6f6d  G",.    ) -> Com
-00014e80: 706f 6e65 6e74 3a0a 2020 2020 2020 2020  ponent:.        
-00014e90: 2222 2252 6574 7572 6e73 206e 6577 2043  """Returns new C
-00014ea0: 6f6d 706f 6e65 6e74 2077 6974 6820 706f  omponent with po
-00014eb0: 6c79 676f 6e73 2065 726f 6465 6420 6f72  lygons eroded or
-00014ec0: 2064 696c 6174 6564 2062 7920 616e 206f   dilated by an o
-00014ed0: 6666 7365 742e 0a0a 2020 2020 2020 2020  ffset...        
-00014ee0: 4172 6773 3a0a 2020 2020 2020 2020 2020  Args:.          
-00014ef0: 2020 6469 7374 616e 6365 3a20 4469 7374    distance: Dist
-00014f00: 616e 6365 2074 6f20 6f66 6673 6574 2070  ance to offset p
-00014f10: 6f6c 7967 6f6e 732e 2050 6f73 6974 6976  olygons. Positiv
-00014f20: 6520 7661 6c75 6573 2065 7870 616e 642c  e values expand,
-00014f30: 206e 6567 6174 6976 6520 7368 7269 6e6b   negative shrink
-00014f40: 2e0a 2020 2020 2020 2020 2020 2020 7072  ..            pr
-00014f50: 6563 6973 696f 6e3a 2044 6573 6972 6564  ecision: Desired
-00014f60: 2070 7265 6369 7369 6f6e 2066 6f72 2072   precision for r
-00014f70: 6f75 6e64 696e 6720 7665 7274 6578 2063  ounding vertex c
-00014f80: 6f6f 7264 696e 6174 6573 2e0a 2020 2020  oordinates..    
-00014f90: 2020 2020 2020 2020 6a6f 696e 3a20 7b27          join: {'
-00014fa0: 6d69 7465 7227 2c20 2762 6576 656c 272c  miter', 'bevel',
-00014fb0: 2027 726f 756e 6427 7d20 5479 7065 206f   'round'} Type o
-00014fc0: 6620 6a6f 696e 2075 7365 6420 746f 2063  f join used to c
-00014fd0: 7265 6174 6520 706f 6c79 676f 6e20 6f66  reate polygon of
-00014fe0: 6673 6574 0a20 2020 2020 2020 2020 2020  fset.           
-00014ff0: 2074 6f6c 6572 616e 6365 3a20 466f 7220   tolerance: For 
-00015000: 6d69 7465 7220 6a6f 696e 7473 2c20 7468  miter joints, th
-00015010: 6973 206e 756d 6265 7220 6d75 7374 2062  is number must b
-00015020: 6520 6174 206c 6561 7374 2032 2072 6570  e at least 2 rep
-00015030: 7265 7365 6e74 7320 7468 650a 2020 2020  resents the.    
-00015040: 2020 2020 2020 2020 2020 6d61 7869 6d61            maxima
-00015050: 6c20 6469 7374 616e 6365 2069 6e20 6d75  l distance in mu
-00015060: 6c74 6970 6c65 7320 6f66 206f 6666 7365  ltiples of offse
-00015070: 7420 6265 7477 6565 6e20 6e65 7720 7665  t between new ve
-00015080: 7274 6963 6573 2061 6e64 2074 6865 6972  rtices and their
-00015090: 0a20 2020 2020 2020 2020 2020 2020 206f  .              o
-000150a0: 7269 6769 6e61 6c20 706f 7369 7469 6f6e  riginal position
-000150b0: 2062 6566 6f72 6520 6265 7665 6c69 6e67   before beveling
-000150c0: 2074 6f20 6176 6f69 6420 7370 696b 6573   to avoid spikes
-000150d0: 2061 7420 6163 7574 6520 6a6f 696e 7473   at acute joints
-000150e0: 2e20 466f 720a 2020 2020 2020 2020 2020  . For.          
-000150f0: 2020 2020 726f 756e 6420 6a6f 696e 7473      round joints
-00015100: 2c20 6974 2069 6e64 6963 6174 6573 2074  , it indicates t
-00015110: 6865 2063 7572 7661 7475 7265 2072 6573  he curvature res
-00015120: 6f6c 7574 696f 6e20 696e 206e 756d 6265  olution in numbe
-00015130: 7220 6f66 0a20 2020 2020 2020 2020 2020  r of.           
-00015140: 2020 2070 6f69 6e74 7320 7065 7220 6675     points per fu
-00015150: 6c6c 2063 6972 636c 652e 0a20 2020 2020  ll circle..     
-00015160: 2020 2020 2020 206c 6179 6572 3a20 5370         layer: Sp
-00015170: 6563 6966 6963 206c 6179 6572 2066 6f72  ecific layer for
-00015180: 206e 6577 2070 6f6c 7967 6f6e 732e 0a0a   new polygons...
-00015190: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000151a0: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
-000151b0: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
-000151c0: 2020 2020 2067 6473 5f6c 6179 6572 2c20       gds_layer, 
-000151d0: 6764 735f 6461 7461 7479 7065 203d 2067  gds_datatype = g
-000151e0: 662e 6765 745f 6c61 7965 7228 6c61 7965  f.get_layer(laye
-000151f0: 7229 0a20 2020 2020 2020 2070 203d 2067  r).        p = g
-00015200: 6473 746b 2e6f 6666 7365 7428 0a20 2020  dstk.offset(.   
-00015210: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00015220: 7320 6f72 2073 656c 662e 6765 745f 706f  s or self.get_po
-00015230: 6c79 676f 6e73 2829 2c0a 2020 2020 2020  lygons(),.      
-00015240: 2020 2020 2020 6469 7374 616e 6365 3d64        distance=d
-00015250: 6973 7461 6e63 652c 0a20 2020 2020 2020  istance,.       
-00015260: 2020 2020 206a 6f69 6e3d 6a6f 696e 2c0a       join=join,.
-00015270: 2020 2020 2020 2020 2020 2020 746f 6c65              tole
-00015280: 7261 6e63 653d 746f 6c65 7261 6e63 652c  rance=tolerance,
-00015290: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-000152a0: 6369 7369 6f6e 3d70 7265 6369 7369 6f6e  cision=precision
-000152b0: 2c0a 2020 2020 2020 2020 2020 2020 7573  ,.            us
-000152c0: 655f 756e 696f 6e3d 7573 655f 756e 696f  e_union=use_unio
-000152d0: 6e2c 0a20 2020 2020 2020 2020 2020 206c  n,.            l
-000152e0: 6179 6572 3d67 6473 5f6c 6179 6572 2c0a  ayer=gds_layer,.
-000152f0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00015300: 7479 7065 3d67 6473 5f64 6174 6174 7970  type=gds_datatyp
-00015310: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-00015320: 2020 2020 2020 636f 6d70 6f6e 656e 7420        component 
-00015330: 3d20 6766 2e43 6f6d 706f 6e65 6e74 2829  = gf.Component()
-00015340: 0a20 2020 2020 2020 2063 6f6d 706f 6e65  .        compone
-00015350: 6e74 2e61 6464 5f70 6f6c 7967 6f6e 2870  nt.add_polygon(p
-00015360: 2c20 6c61 7965 723d 6c61 7965 7229 0a20  , layer=layer). 
-00015370: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-00015380: 6d70 6f6e 656e 740a 0a0a 6465 6620 636f  mponent...def co
-00015390: 7079 280a 2020 2020 443a 2043 6f6d 706f  py(.    D: Compo
-000153a0: 6e65 6e74 2c0a 2020 2020 7265 6665 7265  nent,.    refere
-000153b0: 6e63 6573 3d4e 6f6e 652c 0a20 2020 2070  nces=None,.    p
-000153c0: 6f72 7473 3d4e 6f6e 652c 0a20 2020 2070  orts=None,.    p
-000153d0: 6f6c 7967 6f6e 733d 4e6f 6e65 2c0a 2020  olygons=None,.  
-000153e0: 2020 7061 7468 733d 4e6f 6e65 2c0a 2020    paths=None,.  
-000153f0: 2020 6e61 6d65 3d4e 6f6e 652c 0a20 2020    name=None,.   
-00015400: 206c 6162 656c 733d 4e6f 6e65 2c0a 2920   labels=None,.) 
-00015410: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
-00015420: 2020 2222 2252 6574 7572 6e73 2061 2043    """Returns a C
-00015430: 6f6d 706f 6e65 6e74 2063 6f70 792e 0a0a  omponent copy...
-00015440: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-00015450: 2020 443a 2063 6f6d 706f 6e65 6e74 2074    D: component t
-00015460: 6f20 636f 7079 2e0a 2020 2020 2222 220a  o copy..    """.
-00015470: 2020 2020 445f 636f 7079 203d 2043 6f6d      D_copy = Com
-00015480: 706f 6e65 6e74 2829 0a20 2020 2044 5f63  ponent().    D_c
-00015490: 6f70 792e 696e 666f 203d 2044 2e69 6e66  opy.info = D.inf
-000154a0: 6f0a 2020 2020 2320 445f 636f 7079 2e5f  o.    # D_copy._
-000154b0: 6365 6c6c 203d 2044 2e5f 6365 6c6c 2e63  cell = D._cell.c
-000154c0: 6f70 7928 6e61 6d65 3d44 5f63 6f70 792e  opy(name=D_copy.
-000154d0: 6e61 6d65 290a 0a20 2020 2066 6f72 2072  name)..    for r
-000154e0: 6566 2069 6e20 7265 6665 7265 6e63 6573  ef in references
-000154f0: 2069 6620 7265 6665 7265 6e63 6573 2069   if references i
-00015500: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00015510: 442e 7265 6665 7265 6e63 6573 3a0a 2020  D.references:.  
-00015520: 2020 2020 2020 445f 636f 7079 2e61 6464        D_copy.add
-00015530: 2863 6f70 795f 7265 6665 7265 6e63 6528  (copy_reference(
-00015540: 7265 6629 290a 2020 2020 666f 7220 706f  ref)).    for po
-00015550: 7274 2069 6e20 2870 6f72 7473 2069 6620  rt in (ports if 
-00015560: 706f 7274 7320 6973 206e 6f74 204e 6f6e  ports is not Non
-00015570: 6520 656c 7365 2044 2e70 6f72 7473 292e  e else D.ports).
-00015580: 7661 6c75 6573 2829 3a0a 2020 2020 2020  values():.      
-00015590: 2020 445f 636f 7079 2e61 6464 5f70 6f72    D_copy.add_por
-000155a0: 7428 706f 7274 3d70 6f72 7429 0a20 2020  t(port=port).   
-000155b0: 2066 6f72 2070 6f6c 7920 696e 2070 6f6c   for poly in pol
-000155c0: 7967 6f6e 7320 6966 2070 6f6c 7967 6f6e  ygons if polygon
-000155d0: 7320 6973 206e 6f74 204e 6f6e 6520 656c  s is not None el
-000155e0: 7365 2044 2e70 6f6c 7967 6f6e 733a 0a20  se D.polygons:. 
-000155f0: 2020 2020 2020 2044 5f63 6f70 792e 6164         D_copy.ad
-00015600: 645f 706f 6c79 676f 6e28 706f 6c79 290a  d_polygon(poly).
-00015610: 2020 2020 666f 7220 7061 7468 2069 6e20      for path in 
-00015620: 7061 7468 7320 6966 2070 6174 6873 2069  paths if paths i
-00015630: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-00015640: 442e 7061 7468 733a 0a20 2020 2020 2020  D.paths:.       
-00015650: 2044 5f63 6f70 792e 6164 6428 7061 7468   D_copy.add(path
-00015660: 290a 2020 2020 666f 7220 6c61 6265 6c20  ).    for label 
-00015670: 696e 206c 6162 656c 7320 6966 206c 6162  in labels if lab
-00015680: 656c 7320 6973 206e 6f74 204e 6f6e 6520  els is not None 
-00015690: 656c 7365 2044 2e6c 6162 656c 733a 0a20  else D.labels:. 
-000156a0: 2020 2020 2020 2044 5f63 6f70 792e 6164         D_copy.ad
-000156b0: 645f 6c61 6265 6c28 0a20 2020 2020 2020  d_label(.       
-000156c0: 2020 2020 2074 6578 743d 6c61 6265 6c2e       text=label.
-000156d0: 7465 7874 2c0a 2020 2020 2020 2020 2020  text,.          
-000156e0: 2020 706f 7369 7469 6f6e 3d6c 6162 656c    position=label
-000156f0: 2e6f 7269 6769 6e2c 0a20 2020 2020 2020  .origin,.       
-00015700: 2020 2020 206c 6179 6572 3d28 6c61 6265       layer=(labe
-00015710: 6c2e 6c61 7965 722c 206c 6162 656c 2e74  l.layer, label.t
-00015720: 6578 7474 7970 6529 2c0a 2020 2020 2020  exttype),.      
-00015730: 2020 290a 0a20 2020 2069 6620 6e61 6d65    )..    if name
-00015740: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00015750: 2020 2020 2020 445f 636f 7079 2e6e 616d        D_copy.nam
-00015760: 6520 3d20 6e61 6d65 0a0a 2020 2020 7265  e = name..    re
-00015770: 7475 726e 2044 5f63 6f70 790a 0a0a 6465  turn D_copy...de
-00015780: 6620 636f 7079 5f72 6566 6572 656e 6365  f copy_reference
-00015790: 280a 2020 2020 7265 662c 0a20 2020 2070  (.    ref,.    p
-000157a0: 6172 656e 743d 4e6f 6e65 2c0a 2020 2020  arent=None,.    
-000157b0: 636f 6c75 6d6e 733d 4e6f 6e65 2c0a 2020  columns=None,.  
-000157c0: 2020 726f 7773 3d4e 6f6e 652c 0a20 2020    rows=None,.   
-000157d0: 2073 7061 6369 6e67 3d4e 6f6e 652c 0a20   spacing=None,. 
-000157e0: 2020 206f 7269 6769 6e3d 4e6f 6e65 2c0a     origin=None,.
-000157f0: 2020 2020 726f 7461 7469 6f6e 3d4e 6f6e      rotation=Non
-00015800: 652c 0a20 2020 206d 6167 6e69 6669 6361  e,.    magnifica
-00015810: 7469 6f6e 3d4e 6f6e 652c 0a20 2020 2078  tion=None,.    x
-00015820: 5f72 6566 6c65 6374 696f 6e3d 4e6f 6e65  _reflection=None
-00015830: 2c0a 2020 2020 6e61 6d65 3d4e 6f6e 652c  ,.    name=None,
-00015840: 0a20 2020 2076 313d 4e6f 6e65 2c0a 2020  .    v1=None,.  
-00015850: 2020 7632 3d4e 6f6e 652c 0a29 202d 3e20    v2=None,.) -> 
-00015860: 436f 6d70 6f6e 656e 7452 6566 6572 656e  ComponentReferen
-00015870: 6365 3a0a 2020 2020 7265 7475 726e 2043  ce:.    return C
-00015880: 6f6d 706f 6e65 6e74 5265 6665 7265 6e63  omponentReferenc
-00015890: 6528 0a20 2020 2020 2020 2063 6f6d 706f  e(.        compo
-000158a0: 6e65 6e74 3d70 6172 656e 7420 6f72 2072  nent=parent or r
-000158b0: 6566 2e70 6172 656e 742c 0a20 2020 2020  ef.parent,.     
-000158c0: 2020 2063 6f6c 756d 6e73 3d63 6f6c 756d     columns=colum
-000158d0: 6e73 206f 7220 7265 662e 636f 6c75 6d6e  ns or ref.column
-000158e0: 732c 0a20 2020 2020 2020 2072 6f77 733d  s,.        rows=
-000158f0: 726f 7773 206f 7220 7265 662e 726f 7773  rows or ref.rows
-00015900: 2c0a 2020 2020 2020 2020 7370 6163 696e  ,.        spacin
-00015910: 673d 7370 6163 696e 6720 6f72 2072 6566  g=spacing or ref
-00015920: 2e73 7061 6369 6e67 2c0a 2020 2020 2020  .spacing,.      
-00015930: 2020 6f72 6967 696e 3d6f 7269 6769 6e20    origin=origin 
-00015940: 6f72 2072 6566 2e6f 7269 6769 6e2c 0a20  or ref.origin,. 
-00015950: 2020 2020 2020 2072 6f74 6174 696f 6e3d         rotation=
-00015960: 726f 7461 7469 6f6e 206f 7220 7265 662e  rotation or ref.
-00015970: 726f 7461 7469 6f6e 2c0a 2020 2020 2020  rotation,.      
-00015980: 2020 6d61 676e 6966 6963 6174 696f 6e3d    magnification=
-00015990: 6d61 676e 6966 6963 6174 696f 6e20 6f72  magnification or
-000159a0: 2072 6566 2e6d 6167 6e69 6669 6361 7469   ref.magnificati
-000159b0: 6f6e 2c0a 2020 2020 2020 2020 785f 7265  on,.        x_re
-000159c0: 666c 6563 7469 6f6e 3d78 5f72 6566 6c65  flection=x_refle
-000159d0: 6374 696f 6e20 6f72 2072 6566 2e78 5f72  ction or ref.x_r
-000159e0: 6566 6c65 6374 696f 6e2c 0a20 2020 2020  eflection,.     
-000159f0: 2020 206e 616d 653d 6e61 6d65 206f 7220     name=name or 
-00015a00: 7265 662e 6e61 6d65 2c0a 2020 2020 2020  ref.name,.      
-00015a10: 2020 7631 3d76 3120 6f72 2072 6566 2e76    v1=v1 or ref.v
-00015a20: 312c 0a20 2020 2020 2020 2076 323d 7632  1,.        v2=v2
-00015a30: 206f 7220 7265 662e 7632 2c0a 2020 2020   or ref.v2,.    
-00015a40: 290a 0a0a 6465 6620 7465 7374 5f67 6574  )...def test_get
-00015a50: 5f6c 6179 6572 7328 2920 2d3e 2043 6f6d  _layers() -> Com
-00015a60: 706f 6e65 6e74 3a0a 2020 2020 696d 706f  ponent:.    impo
-00015a70: 7274 2067 6473 6661 6374 6f72 7920 6173  rt gdsfactory as
-00015a80: 2067 660a 0a20 2020 2063 3120 3d20 6766   gf..    c1 = gf
-00015a90: 2e63 6f6d 706f 6e65 6e74 732e 7374 7261  .components.stra
-00015aa0: 6967 6874 280a 2020 2020 2020 2020 6c65  ight(.        le
-00015ab0: 6e67 7468 3d31 302c 0a20 2020 2020 2020  ngth=10,.       
-00015ac0: 2077 6964 7468 3d30 2e35 2c0a 2020 2020   width=0.5,.    
-00015ad0: 2020 2020 6c61 7965 723d 2832 2c20 3029      layer=(2, 0)
-00015ae0: 2c0a 2020 2020 2020 2020 6262 6f78 5f6c  ,.        bbox_l
-00015af0: 6179 6572 733d 5b28 3131 312c 2030 295d  ayers=[(111, 0)]
-00015b00: 2c0a 2020 2020 2020 2020 6262 6f78 5f6f  ,.        bbox_o
-00015b10: 6666 7365 7473 3d5b 335d 2c0a 2020 2020  ffsets=[3],.    
-00015b20: 2020 2020 7769 7468 5f62 626f 783d 5472      with_bbox=Tr
-00015b30: 7565 2c0a 2020 2020 2020 2020 636c 6164  ue,.        clad
-00015b40: 6469 6e67 5f6c 6179 6572 733d 4e6f 6e65  ding_layers=None
-00015b50: 2c0a 2020 2020 2020 2020 6164 645f 7069  ,.        add_pi
-00015b60: 6e73 3d4e 6f6e 652c 0a20 2020 2020 2020  ns=None,.       
-00015b70: 2061 6464 5f62 626f 783d 4e6f 6e65 2c0a   add_bbox=None,.
-00015b80: 2020 2020 290a 2020 2020 6173 7365 7274      ).    assert
-00015b90: 2063 312e 6765 745f 6c61 7965 7273 2829   c1.get_layers()
-00015ba0: 203d 3d20 7b28 322c 2030 292c 2028 3131   == {(2, 0), (11
-00015bb0: 312c 2030 297d 2c20 6331 2e67 6574 5f6c  1, 0)}, c1.get_l
-00015bc0: 6179 6572 7328 290a 2020 2020 2320 7265  ayers().    # re
-00015bd0: 7475 726e 2063 310a 2020 2020 6332 203d  turn c1.    c2 =
-00015be0: 2063 312e 7265 6d6f 7665 5f6c 6179 6572   c1.remove_layer
-00015bf0: 7328 5b28 3131 312c 2030 295d 290a 2020  s([(111, 0)]).  
-00015c00: 2020 6173 7365 7274 2063 322e 6765 745f    assert c2.get_
-00015c10: 6c61 7965 7273 2829 203d 3d20 7b28 322c  layers() == {(2,
-00015c20: 2030 297d 2c20 6332 2e67 6574 5f6c 6179   0)}, c2.get_lay
-00015c30: 6572 7328 290a 2020 2020 7265 7475 726e  ers().    return
-00015c40: 2063 320a 0a0a 6465 6620 5f66 696c 7465   c2...def _filte
-00015c50: 725f 706f 6c79 7328 706f 6c79 676f 6e73  r_polys(polygons
-00015c60: 2c20 6c61 7965 7273 5f65 7863 6c29 3a0a  , layers_excl):.
-00015c70: 2020 2020 7265 7475 726e 205b 0a20 2020      return [.   
-00015c80: 2020 2020 2070 6f6c 7967 6f6e 0a20 2020       polygon.   
-00015c90: 2020 2020 2066 6f72 2070 6f6c 7967 6f6e       for polygon
-00015ca0: 2c20 6c61 7965 722c 2064 6174 6174 7970  , layer, datatyp
-00015cb0: 6520 696e 207a 6970 280a 2020 2020 2020  e in zip(.      
-00015cc0: 2020 2020 2020 706f 6c79 676f 6e73 2e70        polygons.p
-00015cd0: 6f6c 7967 6f6e 732c 2070 6f6c 7967 6f6e  olygons, polygon
-00015ce0: 732e 6c61 7965 7273 2c20 706f 6c79 676f  s.layers, polygo
-00015cf0: 6e73 2e64 6174 6174 7970 6573 0a20 2020  ns.datatypes.   
-00015d00: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-00015d10: 6620 286c 6179 6572 2c20 6461 7461 7479  f (layer, dataty
-00015d20: 7065 2920 6e6f 7420 696e 206c 6179 6572  pe) not in layer
-00015d30: 735f 6578 636c 0a20 2020 205d 0a0a 0a64  s_excl.    ]...d
-00015d40: 6566 2072 6563 7572 7365 5f73 7472 7563  ef recurse_struc
-00015d50: 7475 7265 7328 0a20 2020 2063 6f6d 706f  tures(.    compo
-00015d60: 6e65 6e74 3a20 436f 6d70 6f6e 656e 742c  nent: Component,
-00015d70: 0a20 2020 2069 676e 6f72 655f 636f 6d70  .    ignore_comp
-00015d80: 6f6e 656e 7473 5f70 7265 6669 783a 204f  onents_prefix: O
-00015d90: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
-00015da0: 5d5d 203d 204e 6f6e 652c 0a20 2020 2069  ]] = None,.    i
-00015db0: 676e 6f72 655f 6675 6e63 7469 6f6e 735f  gnore_functions_
-00015dc0: 7072 6566 6978 3a20 4f70 7469 6f6e 616c  prefix: Optional
-00015dd0: 5b4c 6973 745b 7374 725d 5d20 3d20 4e6f  [List[str]] = No
-00015de0: 6e65 2c0a 2920 2d3e 2044 6963 745b 7374  ne,.) -> Dict[st
-00015df0: 722c 2041 6e79 5d3a 0a20 2020 2022 2222  r, Any]:.    """
-00015e00: 5265 6375 7273 6520 636f 6d70 6f6e 656e  Recurse componen
-00015e10: 7420 616e 6420 636f 6d70 6f6e 656e 7473  t and components
-00015e20: 2072 6566 6572 656e 6365 7320 7265 6375   references recu
-00015e30: 7273 6976 656c 792e 0a0a 2020 2020 4172  rsively...    Ar
-00015e40: 6773 3a0a 2020 2020 2020 2020 636f 6d70  gs:.        comp
-00015e50: 6f6e 656e 743a 2063 6f6d 706f 6e65 6e74  onent: component
-00015e60: 2074 6f20 7265 6375 7273 652e 0a20 2020   to recurse..   
-00015e70: 2020 2020 2069 676e 6f72 655f 636f 6d70       ignore_comp
-00015e80: 6f6e 656e 7473 5f70 7265 6669 783a 206c  onents_prefix: l
-00015e90: 6973 7420 6f66 2070 7265 6669 7820 746f  ist of prefix to
-00015ea0: 2069 676e 6f72 652e 0a20 2020 2020 2020   ignore..       
-00015eb0: 2069 676e 6f72 655f 6675 6e63 7469 6f6e   ignore_function
-00015ec0: 735f 7072 6566 6978 3a20 6c69 7374 206f  s_prefix: list o
-00015ed0: 6620 7072 6566 6978 2074 6f20 6967 6e6f  f prefix to igno
-00015ee0: 7265 2e0a 2020 2020 2222 220a 2020 2020  re..    """.    
-00015ef0: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
-00015f00: 5f70 7265 6669 7820 3d20 6967 6e6f 7265  _prefix = ignore
-00015f10: 5f66 756e 6374 696f 6e73 5f70 7265 6669  _functions_prefi
-00015f20: 7820 6f72 205b 5d0a 2020 2020 6967 6e6f  x or [].    igno
-00015f30: 7265 5f63 6f6d 706f 6e65 6e74 735f 7072  re_components_pr
-00015f40: 6566 6978 203d 2069 676e 6f72 655f 636f  efix = ignore_co
-00015f50: 6d70 6f6e 656e 7473 5f70 7265 6669 7820  mponents_prefix 
-00015f60: 6f72 205b 5d0a 0a20 2020 2069 6620 280a  or []..    if (.
-00015f70: 2020 2020 2020 2020 6861 7361 7474 7228          hasattr(
-00015f80: 636f 6d70 6f6e 656e 742c 2022 6675 6e63  component, "func
-00015f90: 7469 6f6e 5f6e 616d 6522 290a 2020 2020  tion_name").    
-00015fa0: 2020 2020 616e 6420 636f 6d70 6f6e 656e      and componen
-00015fb0: 742e 6675 6e63 7469 6f6e 5f6e 616d 6520  t.function_name 
-00015fc0: 696e 2069 676e 6f72 655f 6675 6e63 7469  in ignore_functi
-00015fd0: 6f6e 735f 7072 6566 6978 0a20 2020 2029  ons_prefix.    )
-00015fe0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00015ff0: 207b 7d0a 0a20 2020 2069 6620 6861 7361   {}..    if hasa
-00016000: 7474 7228 636f 6d70 6f6e 656e 742c 2022  ttr(component, "
-00016010: 6e61 6d65 2229 2061 6e64 2061 6e79 280a  name") and any(.
-00016020: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
-00016030: 742e 6e61 6d65 2e73 7461 7274 7377 6974  t.name.startswit
-00016040: 6828 6929 2066 6f72 2069 2069 6e20 6967  h(i) for i in ig
-00016050: 6e6f 7265 5f63 6f6d 706f 6e65 6e74 735f  nore_components_
-00016060: 7072 6566 6978 0a20 2020 2029 3a0a 2020  prefix.    ):.  
-00016070: 2020 2020 2020 7265 7475 726e 207b 7d0a        return {}.
-00016080: 0a20 2020 206f 7574 7075 7420 3d20 7b63  .    output = {c
-00016090: 6f6d 706f 6e65 6e74 2e6e 616d 653a 2064  omponent.name: d
-000160a0: 6963 7428 636f 6d70 6f6e 656e 742e 7365  ict(component.se
-000160b0: 7474 696e 6773 297d 0a20 2020 2066 6f72  ttings)}.    for
-000160c0: 2072 6566 6572 656e 6365 2069 6e20 636f   reference in co
-000160d0: 6d70 6f6e 656e 742e 7265 6665 7265 6e63  mponent.referenc
-000160e0: 6573 3a0a 2020 2020 2020 2020 6966 2028  es:.        if (
-000160f0: 0a20 2020 2020 2020 2020 2020 2069 7369  .            isi
-00016100: 6e73 7461 6e63 6528 7265 6665 7265 6e63  nstance(referenc
-00016110: 652c 2043 6f6d 706f 6e65 6e74 5265 6665  e, ComponentRefe
-00016120: 7265 6e63 6529 0a20 2020 2020 2020 2020  rence).         
-00016130: 2020 2061 6e64 2072 6566 6572 656e 6365     and reference
-00016140: 2e72 6566 5f63 656c 6c2e 6e61 6d65 206e  .ref_cell.name n
-00016150: 6f74 2069 6e20 6f75 7470 7574 0a20 2020  ot in output.   
-00016160: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00016170: 2020 2020 6f75 7470 7574 2e75 7064 6174      output.updat
-00016180: 6528 7265 6375 7273 655f 7374 7275 6374  e(recurse_struct
-00016190: 7572 6573 2872 6566 6572 656e 6365 2e72  ures(reference.r
-000161a0: 6566 5f63 656c 6c29 290a 0a20 2020 2072  ef_cell))..    r
-000161b0: 6574 7572 6e20 6f75 7470 7574 0a0a 0a64  eturn output...d
-000161c0: 6566 2066 6c61 7474 656e 5f69 6e76 616c  ef flatten_inval
-000161d0: 6964 5f72 6566 735f 7265 6375 7273 6976  id_refs_recursiv
-000161e0: 6528 0a20 2020 2063 6f6d 706f 6e65 6e74  e(.    component
-000161f0: 3a20 436f 6d70 6f6e 656e 742c 0a20 2020  : Component,.   
-00016200: 2067 7269 645f 7369 7a65 3a20 4f70 7469   grid_size: Opti
-00016210: 6f6e 616c 5b66 6c6f 6174 5d20 3d20 4e6f  onal[float] = No
-00016220: 6e65 2c0a 2020 2020 7570 6461 7465 645f  ne,.    updated_
-00016230: 636f 6d70 6f6e 656e 7473 3d4e 6f6e 652c  components=None,
-00016240: 0a20 2020 2074 7261 7665 7273 6564 5f63  .    traversed_c
-00016250: 6f6d 706f 6e65 6e74 733d 4e6f 6e65 2c0a  omponents=None,.
-00016260: 293a 0a20 2020 2022 2222 5265 6375 7273  ):.    """Recurs
-00016270: 6976 656c 7920 666c 6174 7465 6e73 2063  ively flattens c
-00016280: 6f6d 706f 6e65 6e74 2072 6566 6572 656e  omponent referen
-00016290: 6365 7320 7768 6963 6820 6861 7665 2069  ces which have i
-000162a0: 6e76 616c 6964 2074 7261 6e73 666f 726d  nvalid transform
-000162b0: 6174 696f 6e73 2028 692e 652e 206e 6f6e  ations (i.e. non
-000162c0: 2d39 3020 6465 6720 726f 7461 7469 6f6e  -90 deg rotation
-000162d0: 7320 6f72 2073 7562 2d67 7269 6420 7472  s or sub-grid tr
-000162e0: 616e 736c 6174 696f 6e73 2920 616e 6420  anslations) and 
-000162f0: 7265 7475 726e 7320 6120 636f 7079 2069  returns a copy i
-00016300: 6620 616e 7920 7375 6263 656c 6c73 2068  f any subcells h
-00016310: 6176 6520 6265 656e 206d 6f64 6966 6965  ave been modifie
-00016320: 642e 0a0a 2020 2020 5741 524e 494e 473a  d...    WARNING:
-00016330: 2074 6869 7320 6675 6e63 7469 6f6e 2077   this function w
-00016340: 696c 6c20 7072 6f64 7563 6520 7361 6d65  ill produce same
-00016350: 2d6e 616d 6520 636f 7069 6573 206f 6620  -name copies of 
-00016360: 6365 6c6c 732e 2049 7420 6973 2073 7472  cells. It is str
-00016370: 6963 746c 7920 6d65 616e 7420 746f 2062  ictly meant to b
-00016380: 6520 7573 6564 206f 6e20 7772 6974 6520  e used on write 
-00016390: 6f66 2074 6865 2047 4453 2066 696c 6520  of the GDS file 
-000163a0: 616e 640a 2020 2020 7368 6f75 6c64 206e  and.    should n
-000163b0: 6f74 2062 6520 6d69 7865 6420 7769 7468  ot be mixed with
-000163c0: 206f 7468 6572 2063 656c 6c73 2c20 6f72   other cells, or
-000163d0: 2079 6f75 2077 696c 6c20 6c69 6b65 6c79   you will likely
-000163e0: 2065 7870 6572 6965 6e63 6520 6973 7375   experience issu
-000163f0: 6573 2077 6974 6820 6475 706c 6963 6174  es with duplicat
-00016400: 6520 6365 6c6c 730a 0a20 2020 2041 7267  e cells..    Arg
-00016410: 733a 0a20 2020 2020 2020 2063 6f6d 706f  s:.        compo
-00016420: 6e65 6e74 3a20 7468 6520 636f 6d70 6f6e  nent: the compon
-00016430: 656e 7420 746f 2066 6978 2028 696e 2070  ent to fix (in p
-00016440: 6c61 6365 292e 0a20 2020 2020 2020 2067  lace)..        g
-00016450: 7269 645f 7369 7a65 3a20 7468 6520 4744  rid_size: the GD
-00016460: 5320 6772 6964 2073 697a 652c 2069 6e20  S grid size, in 
-00016470: 756d 2c20 6465 6661 756c 7473 2074 6f20  um, defaults to 
-00016480: 6163 7469 7665 2050 444b 2e67 6574 5f67  active PDK.get_g
-00016490: 7269 645f 7369 7a65 2829 0a20 2020 2020  rid_size().     
-000164a0: 2020 2020 2020 2061 6e79 2074 7261 6e73         any trans
-000164b0: 6c61 7469 6f6e 7320 7769 7468 2068 6967  lations with hig
-000164c0: 6865 7220 7265 736f 6c75 7469 6f6e 2074  her resolution t
-000164d0: 6861 6e20 7468 6973 2061 7265 2063 6f6e  han this are con
-000164e0: 7369 6465 7265 6420 696e 7661 6c69 642e  sidered invalid.
-000164f0: 0a20 2020 2020 2020 2075 7064 6174 6564  .        updated
-00016500: 5f63 6f6d 706f 6e65 6e74 733a 2074 6865  _components: the
-00016510: 2072 756e 6e69 6e67 2064 6963 7469 6f6e   running diction
-00016520: 6172 7920 6f66 2063 6f6d 706f 6e65 6e74  ary of component
-00016530: 7320 7768 6963 6820 6861 7665 2062 6565  s which have bee
-00016540: 6e20 6d6f 6469 6669 6564 2062 7920 7468  n modified by th
-00016550: 6973 2074 7261 6e73 666f 726d 6174 696f  is transformatio
-00016560: 6e2e 2053 686f 756c 6420 616c 7761 7973  n. Should always
-00016570: 2062 6520 4e6f 6e65 2c20 6578 6365 7074   be None, except
-00016580: 2066 6f72 2072 6563 7572 7369 7665 2069   for recursive i
-00016590: 6e76 6f63 6174 696f 6e73 2e0a 2020 2020  nvocations..    
-000165a0: 2020 2020 7472 6176 6572 7365 645f 636f      traversed_co
-000165b0: 6d70 6f6e 656e 7473 3a20 7468 6520 7365  mponents: the se
-000165c0: 7420 6f66 2063 6f6d 706f 6e65 6e74 206e  t of component n
-000165d0: 616d 6573 2077 6869 6368 2068 6176 6520  ames which have 
-000165e0: 6265 656e 2074 7261 7665 7273 6564 2e20  been traversed. 
-000165f0: 5368 6f75 6c64 2061 6c77 6179 7320 6265  Should always be
-00016600: 204e 6f6e 652c 2065 7863 6570 7420 666f   None, except fo
-00016610: 7220 7265 6375 7273 6976 6520 696e 766f  r recursive invo
-00016620: 6361 7469 6f6e 732e 0a20 2020 2022 2222  cations..    """
-00016630: 0a20 2020 2066 726f 6d20 6764 7366 6163  .    from gdsfac
-00016640: 746f 7279 2e64 6563 6f72 6174 6f72 7320  tory.decorators 
-00016650: 696d 706f 7274 2069 735f 696e 7661 6c69  import is_invali
-00016660: 645f 7265 660a 0a20 2020 2069 6e76 616c  d_ref..    inval
-00016670: 6964 5f72 6566 7320 3d20 5b5d 0a20 2020  id_refs = [].   
-00016680: 2072 6566 7320 3d20 636f 6d70 6f6e 656e   refs = componen
-00016690: 742e 7265 6665 7265 6e63 6573 0a20 2020  t.references.   
-000166a0: 2073 7562 6365 6c6c 5f6d 6f64 6966 6965   subcell_modifie
-000166b0: 6420 3d20 4661 6c73 650a 2020 2020 6966  d = False.    if
-000166c0: 2075 7064 6174 6564 5f63 6f6d 706f 6e65   updated_compone
-000166d0: 6e74 7320 6973 204e 6f6e 653a 0a20 2020  nts is None:.   
-000166e0: 2020 2020 2075 7064 6174 6564 5f63 6f6d       updated_com
-000166f0: 706f 6e65 6e74 7320 3d20 7b7d 0a20 2020  ponents = {}.   
-00016700: 2069 6620 7472 6176 6572 7365 645f 636f   if traversed_co
-00016710: 6d70 6f6e 656e 7473 2069 7320 4e6f 6e65  mponents is None
-00016720: 3a0a 2020 2020 2020 2020 7472 6176 6572  :.        traver
-00016730: 7365 645f 636f 6d70 6f6e 656e 7473 203d  sed_components =
-00016740: 2073 6574 2829 0a20 2020 2066 6f72 2072   set().    for r
-00016750: 6566 2069 6e20 7265 6673 3a0a 2020 2020  ef in refs:.    
-00016760: 2020 2020 2320 6d61 726b 2061 6e79 2069      # mark any i
-00016770: 6e76 616c 6964 2072 6566 7320 666f 7220  nvalid refs for 
-00016780: 666c 6174 7465 6e69 6e67 0a20 2020 2020  flattening.     
-00016790: 2020 2023 206f 7468 6572 7769 7365 2c20     # otherwise, 
-000167a0: 6368 6563 6b20 6966 2074 6865 7265 2061  check if there a
-000167b0: 7265 2061 6e79 206d 6f64 6966 6965 6420  re any modified 
-000167c0: 6365 6c6c 7320 6265 6e65 6174 6820 2877  cells beneath (w
-000167d0: 6520 6e65 6564 206e 6f74 2064 6f20 7468  e need not do th
-000167e0: 6973 2069 6620 7468 6520 7265 6620 7769  is if the ref wi
-000167f0: 6c6c 2062 6520 666c 6174 7465 6e65 6420  ll be flattened 
-00016800: 616e 7977 6179 7329 0a20 2020 2020 2020  anyways).       
-00016810: 2069 6620 6973 5f69 6e76 616c 6964 5f72   if is_invalid_r
-00016820: 6566 2872 6566 2c20 6772 6964 5f73 697a  ef(ref, grid_siz
-00016830: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00016840: 696e 7661 6c69 645f 7265 6673 2e61 7070  invalid_refs.app
-00016850: 656e 6428 7265 662e 6e61 6d65 290a 2020  end(ref.name).  
-00016860: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00016870: 2020 2020 2020 2020 2320 6f74 6865 7277          # otherw
-00016880: 6973 652c 2072 6563 7572 7369 7665 6c79  ise, recursively
-00016890: 2066 6c61 7474 656e 2072 6566 7320 6966   flatten refs if
-000168a0: 2074 6865 2073 7562 6365 6c6c 2068 6173   the subcell has
-000168b0: 206e 6f74 2061 6c72 6561 6479 2062 6565   not already bee
-000168c0: 6e20 7472 6176 6572 7365 640a 2020 2020  n traversed.    
-000168d0: 2020 2020 2020 2020 6966 2072 6566 2e70          if ref.p
-000168e0: 6172 656e 742e 6e61 6d65 206e 6f74 2069  arent.name not i
-000168f0: 6e20 7472 6176 6572 7365 645f 636f 6d70  n traversed_comp
-00016900: 6f6e 656e 7473 3a0a 2020 2020 2020 2020  onents:.        
-00016910: 2020 2020 2020 2020 666c 6174 7465 6e5f          flatten_
-00016920: 696e 7661 6c69 645f 7265 6673 5f72 6563  invalid_refs_rec
-00016930: 7572 7369 7665 280a 2020 2020 2020 2020  ursive(.        
-00016940: 2020 2020 2020 2020 2020 2020 7265 662e              ref.
-00016950: 7061 7265 6e74 2c0a 2020 2020 2020 2020  parent,.        
-00016960: 2020 2020 2020 2020 2020 2020 6772 6964              grid
-00016970: 5f73 697a 653d 6772 6964 5f73 697a 652c  _size=grid_size,
-00016980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016990: 2020 2020 2075 7064 6174 6564 5f63 6f6d       updated_com
-000169a0: 706f 6e65 6e74 733d 7570 6461 7465 645f  ponents=updated_
-000169b0: 636f 6d70 6f6e 656e 7473 2c0a 2020 2020  components,.    
-000169c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169d0: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
-000169e0: 656e 7473 3d74 7261 7665 7273 6564 5f63  ents=traversed_c
-000169f0: 6f6d 706f 6e65 6e74 732c 0a20 2020 2020  omponents,.     
-00016a00: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00016a10: 2020 2020 2020 2020 2023 206e 6f77 2c20           # now, 
-00016a20: 6966 2074 6865 2072 6566 2773 2063 656c  if the ref's cel
-00016a30: 6c20 6265 656e 206d 6f64 6966 6965 642c  l been modified,
-00016a40: 206d 6172 6b20 6974 2061 7320 7375 6368   mark it as such
-00016a50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016a60: 7265 662e 7061 7265 6e74 2e6e 616d 6520  ref.parent.name 
-00016a70: 696e 2075 7064 6174 6564 5f63 6f6d 706f  in updated_compo
-00016a80: 6e65 6e74 733a 0a20 2020 2020 2020 2020  nents:.         
-00016a90: 2020 2020 2020 2073 7562 6365 6c6c 5f6d         subcell_m
-00016aa0: 6f64 6966 6965 6420 3d20 5472 7565 0a20  odified = True. 
-00016ab0: 2020 2069 6620 696e 7661 6c69 645f 7265     if invalid_re
-00016ac0: 6673 206f 7220 7375 6263 656c 6c5f 6d6f  fs or subcell_mo
-00016ad0: 6469 6669 6564 3a0a 2020 2020 2020 2020  dified:.        
-00016ae0: 6e65 775f 636f 6d70 6f6e 656e 7420 3d20  new_component = 
-00016af0: 636f 6d70 6f6e 656e 742e 636f 7079 2829  component.copy()
-00016b00: 0a20 2020 2020 2020 206e 6577 5f63 6f6d  .        new_com
-00016b10: 706f 6e65 6e74 2e6e 616d 6520 3d20 636f  ponent.name = co
-00016b20: 6d70 6f6e 656e 742e 6e61 6d65 0a20 2020  mponent.name.   
-00016b30: 2020 2020 2023 206d 616b 6520 7375 7265       # make sure
-00016b40: 2061 6c6c 206d 6f64 6966 6965 6420 6365   all modified ce
-00016b50: 6c6c 7320 6861 7665 2074 6865 6972 2072  lls have their r
-00016b60: 6566 6572 656e 6365 7320 7570 6461 7465  eferences update
-00016b70: 640a 2020 2020 2020 2020 6e65 775f 7265  d.        new_re
-00016b80: 6673 203d 206e 6577 5f63 6f6d 706f 6e65  fs = new_compone
-00016b90: 6e74 2e72 6566 6572 656e 6365 732e 636f  nt.references.co
-00016ba0: 7079 2829 0a20 2020 2020 2020 2066 6f72  py().        for
-00016bb0: 2072 6566 2069 6e20 6e65 775f 7265 6673   ref in new_refs
-00016bc0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00016bd0: 2072 6566 2e6e 616d 6520 696e 2069 6e76   ref.name in inv
-00016be0: 616c 6964 5f72 6566 733a 0a20 2020 2020  alid_refs:.     
-00016bf0: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
-00016c00: 6f6d 706f 6e65 6e74 2e66 6c61 7474 656e  omponent.flatten
-00016c10: 5f72 6566 6572 656e 6365 2872 6566 290a  _reference(ref).
-00016c20: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00016c30: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00016c40: 2020 2072 6566 2e70 6172 656e 742e 6e61     ref.parent.na
-00016c50: 6d65 2069 6e20 7570 6461 7465 645f 636f  me in updated_co
-00016c60: 6d70 6f6e 656e 7473 0a20 2020 2020 2020  mponents.       
-00016c70: 2020 2020 2020 2020 2061 6e64 2072 6566           and ref
-00016c80: 2e70 6172 656e 7420 6973 206e 6f74 2075  .parent is not u
-00016c90: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
-00016ca0: 735b 7265 662e 7061 7265 6e74 2e6e 616d  s[ref.parent.nam
-00016cb0: 655d 0a20 2020 2020 2020 2020 2020 2029  e].            )
-00016cc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016cd0: 2020 7265 662e 7061 7265 6e74 203d 2075    ref.parent = u
-00016ce0: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
-00016cf0: 735b 7265 662e 7061 7265 6e74 2e6e 616d  s[ref.parent.nam
-00016d00: 655d 0a20 2020 2020 2020 2063 6f6d 706f  e].        compo
-00016d10: 6e65 6e74 203d 206e 6577 5f63 6f6d 706f  nent = new_compo
-00016d20: 6e65 6e74 0a20 2020 2020 2020 2075 7064  nent.        upd
-00016d30: 6174 6564 5f63 6f6d 706f 6e65 6e74 735b  ated_components[
-00016d40: 636f 6d70 6f6e 656e 742e 6e61 6d65 5d20  component.name] 
-00016d50: 3d20 6e65 775f 636f 6d70 6f6e 656e 740a  = new_component.
-00016d60: 2020 2020 7472 6176 6572 7365 645f 636f      traversed_co
-00016d70: 6d70 6f6e 656e 7473 2e61 6464 2863 6f6d  mponents.add(com
-00016d80: 706f 6e65 6e74 2e6e 616d 6529 0a20 2020  ponent.name).   
-00016d90: 2072 6574 7572 6e20 636f 6d70 6f6e 656e   return componen
-00016da0: 740a 0a0a 6465 6620 5f63 6865 636b 5f75  t...def _check_u
-00016db0: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
-00016dc0: 7473 2863 6f6d 706f 6e65 6e74 2c20 6d6f  ts(component, mo
-00016dd0: 6465 293a 0a20 2020 2076 616c 6964 5f6d  de):.    valid_m
-00016de0: 6f64 6573 203d 205b 2277 6172 6e22 2c20  odes = ["warn", 
-00016df0: 2265 7272 6f72 222c 2022 6967 6e6f 7265  "error", "ignore
-00016e00: 225d 0a0a 2020 2020 6966 206d 6f64 6520  "]..    if mode 
-00016e10: 3d3d 2022 6967 6e6f 7265 223a 0a20 2020  == "ignore":.   
-00016e20: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00016e30: 656c 6966 206d 6f64 6520 6e6f 7420 696e  elif mode not in
-00016e40: 2076 616c 6964 5f6d 6f64 6573 3a0a 2020   valid_modes:.  
-00016e50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00016e60: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00016e70: 2020 2020 6622 7b6d 6f64 657d 2069 7320      f"{mode} is 
-00016e80: 6e6f 7420 6120 7661 6c69 6420 7661 6c75  not a valid valu
-00016e90: 6520 666f 7220 6f6e 5f75 6e63 6163 6865  e for on_uncache
-00016ea0: 645f 636f 6d70 6f6e 656e 742e 2054 7279  d_component. Try
-00016eb0: 206f 6e65 206f 6620 7468 6573 653a 207b   one of these: {
-00016ec0: 7661 6c69 645f 6d6f 6465 737d 2e22 0a20  valid_modes}.". 
-00016ed0: 2020 2020 2020 2029 0a0a 2020 2020 666f         )..    fo
-00016ee0: 7220 7375 625f 636f 6d70 6f6e 656e 7420  r sub_component 
-00016ef0: 696e 2063 6f6d 706f 6e65 6e74 2e67 6574  in component.get
-00016f00: 5f64 6570 656e 6465 6e63 6965 7328 7265  _dependencies(re
-00016f10: 6375 7273 6976 653d 5472 7565 293a 0a20  cursive=True):. 
-00016f20: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
-00016f30: 625f 636f 6d70 6f6e 656e 742e 5f6c 6f63  b_component._loc
-00016f40: 6b65 643a 0a20 2020 2020 2020 2020 2020  ked:.           
-00016f50: 206d 6573 7361 6765 203d 2028 0a20 2020   message = (.   
-00016f60: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
-00016f70: 6f6d 706f 6e65 6e74 207b 7375 625f 636f  omponent {sub_co
-00016f80: 6d70 6f6e 656e 742e 6e61 6d65 2172 7d20  mponent.name!r} 
-00016f90: 7761 7320 4e4f 5420 7072 6f70 6572 6c79  was NOT properly
-00016fa0: 206c 6f63 6b65 642e 2022 0a20 2020 2020   locked. ".     
-00016fb0: 2020 2020 2020 2020 2020 2022 596f 7520             "You 
-00016fc0: 6e65 6564 2074 6f20 7772 6974 6520 6974  need to write it
-00016fd0: 2069 6e74 6f20 6120 6675 6e63 7469 6f6e   into a function
-00016fe0: 2074 6861 7420 6861 7320 7468 6520 4063   that has the @c
-00016ff0: 656c 6c20 6465 636f 7261 746f 722e 220a  ell decorator.".
-00017000: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00017010: 2020 2020 2020 2020 2020 6966 206d 6f64            if mod
-00017020: 6520 3d3d 2022 7761 726e 223a 0a20 2020  e == "warn":.   
-00017030: 2020 2020 2020 2020 2020 2020 2077 6172               war
-00017040: 6e69 6e67 732e 7761 726e 286d 6573 7361  nings.warn(messa
-00017050: 6765 2c20 556e 6361 6368 6564 436f 6d70  ge, UncachedComp
-00017060: 6f6e 656e 7457 6172 6e69 6e67 290a 0a20  onentWarning).. 
-00017070: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00017080: 6d6f 6465 203d 3d20 2265 7272 6f72 223a  mode == "error":
-00017090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000170a0: 2072 6169 7365 2055 6e63 6163 6865 6443   raise UncachedC
-000170b0: 6f6d 706f 6e65 6e74 4572 726f 7228 6d65  omponentError(me
-000170c0: 7373 6167 6529 0a0a 0a64 6566 2074 6573  ssage)...def tes
-000170d0: 745f 7361 6d65 5f75 6964 2829 202d 3e20  t_same_uid() -> 
-000170e0: 4e6f 6e65 3a0a 2020 2020 696d 706f 7274  None:.    import
-000170f0: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
-00017100: 660a 0a20 2020 2063 203d 2043 6f6d 706f  f..    c = Compo
-00017110: 6e65 6e74 2829 0a20 2020 2063 203c 3c20  nent().    c << 
-00017120: 6766 2e63 6f6d 706f 6e65 6e74 732e 7265  gf.components.re
-00017130: 6374 616e 676c 6528 290a 2020 2020 6320  ctangle().    c 
-00017140: 3c3c 2067 662e 636f 6d70 6f6e 656e 7473  << gf.components
-00017150: 2e72 6563 7461 6e67 6c65 2829 0a0a 2020  .rectangle()..  
-00017160: 2020 7231 203d 2063 2e72 6566 6572 656e    r1 = c.referen
-00017170: 6365 735b 305d 2e70 6172 656e 740a 2020  ces[0].parent.  
-00017180: 2020 7232 203d 2063 2e72 6566 6572 656e    r2 = c.referen
-00017190: 6365 735b 315d 2e70 6172 656e 740a 0a20  ces[1].parent.. 
-000171a0: 2020 2061 7373 6572 7420 7231 2e75 6964     assert r1.uid
-000171b0: 203d 3d20 7232 2e75 6964 2c20 6622 7b72   == r2.uid, f"{r
-000171c0: 312e 7569 647d 206d 7573 7420 6571 7561  1.uid} must equa
-000171d0: 6c20 7b72 322e 7569 647d 220a 0a0a 6465  l {r2.uid}"...de
-000171e0: 6620 7465 7374 5f6e 6574 6c69 7374 5f73  f test_netlist_s
-000171f0: 696d 706c 6528 2920 2d3e 204e 6f6e 653a  imple() -> None:
-00017200: 0a20 2020 2069 6d70 6f72 7420 6764 7366  .    import gdsf
-00017210: 6163 746f 7279 2061 7320 6766 0a0a 2020  actory as gf..  
-00017220: 2020 6320 3d20 6766 2e43 6f6d 706f 6e65    c = gf.Compone
-00017230: 6e74 2829 0a20 2020 2063 3120 3d20 6320  nt().    c1 = c 
-00017240: 3c3c 2067 662e 636f 6d70 6f6e 656e 7473  << gf.components
-00017250: 2e73 7472 6169 6768 7428 6c65 6e67 7468  .straight(length
-00017260: 3d31 2c20 7769 6474 683d 3229 0a20 2020  =1, width=2).   
-00017270: 2063 3220 3d20 6320 3c3c 2067 662e 636f   c2 = c << gf.co
-00017280: 6d70 6f6e 656e 7473 2e73 7472 6169 6768  mponents.straigh
-00017290: 7428 6c65 6e67 7468 3d32 2c20 7769 6474  t(length=2, widt
-000172a0: 683d 3229 0a20 2020 2063 322e 636f 6e6e  h=2).    c2.conn
-000172b0: 6563 7428 706f 7274 3d22 6f31 222c 2064  ect(port="o1", d
-000172c0: 6573 7469 6e61 7469 6f6e 3d63 312e 706f  estination=c1.po
-000172d0: 7274 735b 226f 3222 5d29 0a20 2020 2063  rts["o2"]).    c
-000172e0: 2e61 6464 5f70 6f72 7428 226f 3122 2c20  .add_port("o1", 
-000172f0: 706f 7274 3d63 312e 706f 7274 735b 226f  port=c1.ports["o
-00017300: 3122 5d29 0a20 2020 2063 2e61 6464 5f70  1"]).    c.add_p
-00017310: 6f72 7428 226f 3222 2c20 706f 7274 3d63  ort("o2", port=c
-00017320: 322e 706f 7274 735b 226f 3222 5d29 0a20  2.ports["o2"]). 
-00017330: 2020 206e 6574 6c69 7374 203d 2063 2e67     netlist = c.g
-00017340: 6574 5f6e 6574 6c69 7374 2829 0a20 2020  et_netlist().   
-00017350: 2023 2070 7269 6e74 286e 6574 6c69 7374   # print(netlist
-00017360: 2e70 7265 7474 7928 2929 0a20 2020 2061  .pretty()).    a
-00017370: 7373 6572 7420 6c65 6e28 6e65 746c 6973  ssert len(netlis
-00017380: 745b 2269 6e73 7461 6e63 6573 225d 2920  t["instances"]) 
-00017390: 3d3d 2032 0a0a 0a64 6566 2074 6573 745f  == 2...def test_
-000173a0: 6e65 746c 6973 745f 7369 6d70 6c65 5f77  netlist_simple_w
-000173b0: 6964 7468 5f6d 6973 6d61 7463 685f 7468  idth_mismatch_th
-000173c0: 726f 7773 5f65 7272 6f72 2829 202d 3e20  rows_error() -> 
-000173d0: 4e6f 6e65 3a0a 2020 2020 696d 706f 7274  None:.    import
-000173e0: 2070 7974 6573 740a 0a20 2020 2069 6d70   pytest..    imp
-000173f0: 6f72 7420 6764 7366 6163 746f 7279 2061  ort gdsfactory a
-00017400: 7320 6766 0a0a 2020 2020 6320 3d20 6766  s gf..    c = gf
-00017410: 2e43 6f6d 706f 6e65 6e74 2829 0a20 2020  .Component().   
-00017420: 2063 3120 3d20 6320 3c3c 2067 662e 636f   c1 = c << gf.co
-00017430: 6d70 6f6e 656e 7473 2e73 7472 6169 6768  mponents.straigh
-00017440: 7428 6c65 6e67 7468 3d31 2c20 7769 6474  t(length=1, widt
-00017450: 683d 3129 0a20 2020 2063 3220 3d20 6320  h=1).    c2 = c 
-00017460: 3c3c 2067 662e 636f 6d70 6f6e 656e 7473  << gf.components
-00017470: 2e73 7472 6169 6768 7428 6c65 6e67 7468  .straight(length
-00017480: 3d32 2c20 7769 6474 683d 3229 0a20 2020  =2, width=2).   
-00017490: 2063 322e 636f 6e6e 6563 7428 706f 7274   c2.connect(port
-000174a0: 3d22 6f31 222c 2064 6573 7469 6e61 7469  ="o1", destinati
-000174b0: 6f6e 3d63 312e 706f 7274 735b 226f 3222  on=c1.ports["o2"
-000174c0: 5d29 0a20 2020 2063 2e61 6464 5f70 6f72  ]).    c.add_por
-000174d0: 7428 226f 3122 2c20 706f 7274 3d63 312e  t("o1", port=c1.
-000174e0: 706f 7274 735b 226f 3122 5d29 0a20 2020  ports["o1"]).   
-000174f0: 2063 2e61 6464 5f70 6f72 7428 226f 3222   c.add_port("o2"
-00017500: 2c20 706f 7274 3d63 322e 706f 7274 735b  , port=c2.ports[
-00017510: 226f 3222 5d29 0a20 2020 2077 6974 6820  "o2"]).    with 
-00017520: 7079 7465 7374 2e72 6169 7365 7328 5661  pytest.raises(Va
-00017530: 6c75 6545 7272 6f72 293a 0a20 2020 2020  lueError):.     
-00017540: 2020 2063 2e67 6574 5f6e 6574 6c69 7374     c.get_netlist
-00017550: 2829 0a0a 0a64 6566 2074 6573 745f 6e65  ()...def test_ne
-00017560: 746c 6973 745f 636f 6d70 6c65 7828 2920  tlist_complex() 
-00017570: 2d3e 204e 6f6e 653a 0a20 2020 2069 6d70  -> None:.    imp
-00017580: 6f72 7420 6764 7366 6163 746f 7279 2061  ort gdsfactory a
-00017590: 7320 6766 0a0a 2020 2020 6320 3d20 6766  s gf..    c = gf
-000175a0: 2e63 6f6d 706f 6e65 6e74 732e 6d7a 695f  .components.mzi_
-000175b0: 6172 6d73 2829 0a20 2020 206e 6574 6c69  arms().    netli
-000175c0: 7374 203d 2063 2e67 6574 5f6e 6574 6c69  st = c.get_netli
-000175d0: 7374 2829 0a20 2020 2023 2070 7269 6e74  st().    # print
-000175e0: 286e 6574 6c69 7374 2e70 7265 7474 7928  (netlist.pretty(
-000175f0: 2929 0a20 2020 2061 7373 6572 7420 6c65  )).    assert le
-00017600: 6e28 6e65 746c 6973 745b 2269 6e73 7461  n(netlist["insta
-00017610: 6e63 6573 225d 2920 3d3d 2034 2c20 6c65  nces"]) == 4, le
-00017620: 6e28 6e65 746c 6973 745b 2269 6e73 7461  n(netlist["insta
-00017630: 6e63 6573 225d 290a 0a0a 6465 6620 7465  nces"])...def te
-00017640: 7374 5f65 7874 7261 6374 2829 202d 3e20  st_extract() -> 
-00017650: 436f 6d70 6f6e 656e 743a 0a20 2020 2069  Component:.    i
-00017660: 6d70 6f72 7420 6764 7366 6163 746f 7279  mport gdsfactory
-00017670: 2061 7320 6766 0a0a 2020 2020 6320 3d20   as gf..    c = 
-00017680: 6766 2e63 6f6d 706f 6e65 6e74 732e 7374  gf.components.st
-00017690: 7261 6967 6874 280a 2020 2020 2020 2020  raight(.        
-000176a0: 6c65 6e67 7468 3d31 302c 0a20 2020 2020  length=10,.     
-000176b0: 2020 2077 6964 7468 3d30 2e35 2c0a 2020     width=0.5,.  
-000176c0: 2020 2020 2020 6262 6f78 5f6c 6179 6572        bbox_layer
-000176d0: 733d 5b67 662e 4c41 5945 522e 5747 434c  s=[gf.LAYER.WGCL
-000176e0: 4144 5d2c 0a20 2020 2020 2020 2062 626f  AD],.        bbo
-000176f0: 785f 6f66 6673 6574 733d 5b33 5d2c 0a20  x_offsets=[3],. 
-00017700: 2020 2020 2020 2077 6974 685f 6262 6f78         with_bbox
-00017710: 3d54 7275 652c 0a20 2020 2020 2020 2063  =True,.        c
-00017720: 6c61 6464 696e 675f 6c61 7965 7273 3d4e  ladding_layers=N
-00017730: 6f6e 652c 0a20 2020 2020 2020 2061 6464  one,.        add
-00017740: 5f70 696e 733d 4e6f 6e65 2c0a 2020 2020  _pins=None,.    
-00017750: 2020 2020 6164 645f 6262 6f78 3d4e 6f6e      add_bbox=Non
-00017760: 652c 0a20 2020 2029 0a20 2020 2063 3220  e,.    ).    c2 
-00017770: 3d20 632e 6578 7472 6163 7428 6c61 7965  = c.extract(laye
-00017780: 7273 3d5b 6766 2e4c 4159 4552 2e57 4743  rs=[gf.LAYER.WGC
-00017790: 4c41 445d 290a 0a20 2020 2061 7373 6572  LAD])..    asser
-000177a0: 7420 6c65 6e28 632e 706f 6c79 676f 6e73  t len(c.polygons
-000177b0: 2920 3d3d 2032 2c20 6c65 6e28 632e 706f  ) == 2, len(c.po
-000177c0: 6c79 676f 6e73 290a 2020 2020 6173 7365  lygons).    asse
-000177d0: 7274 206c 656e 2863 322e 706f 6c79 676f  rt len(c2.polygo
-000177e0: 6e73 2920 3d3d 2031 2c20 6c65 6e28 6332  ns) == 1, len(c2
-000177f0: 2e70 6f6c 7967 6f6e 7329 0a20 2020 2061  .polygons).    a
-00017800: 7373 6572 7420 6766 2e4c 4159 4552 2e57  ssert gf.LAYER.W
-00017810: 4743 4c41 4420 696e 2063 322e 6c61 7965  GCLAD in c2.laye
-00017820: 7273 0a20 2020 2072 6574 7572 6e20 6332  rs.    return c2
-00017830: 0a0a 0a64 6566 2068 6173 685f 6669 6c65  ...def hash_file
-00017840: 2866 696c 6570 6174 6829 3a0a 2020 2020  (filepath):.    
-00017850: 6d64 3520 3d20 6861 7368 6c69 622e 6d64  md5 = hashlib.md
-00017860: 3528 290a 2020 2020 6d64 352e 7570 6461  5().    md5.upda
-00017870: 7465 2866 696c 6570 6174 682e 7265 6164  te(filepath.read
-00017880: 5f62 7974 6573 2829 290a 2020 2020 7265  _bytes()).    re
-00017890: 7475 726e 206d 6435 2e68 6578 6469 6765  turn md5.hexdige
-000178a0: 7374 2829 0a0a 0a64 6566 2074 6573 745f  st()...def test_
-000178b0: 6262 6f78 5f72 6566 6572 656e 6365 2829  bbox_reference()
-000178c0: 202d 3e20 436f 6d70 6f6e 656e 743a 0a20   -> Component:. 
-000178d0: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
-000178e0: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
-000178f0: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
-00017900: 2822 636f 6d70 6f6e 656e 745f 7769 7468  ("component_with
-00017910: 5f6f 6666 6772 6964 5f70 6f6c 7967 6f6e  _offgrid_polygon
-00017920: 7322 290a 2020 2020 6331 203d 2063 203c  s").    c1 = c <
-00017930: 3c20 6766 2e63 6f6d 706f 6e65 6e74 732e  < gf.components.
-00017940: 7265 6374 616e 676c 6528 7369 7a65 3d28  rectangle(size=(
-00017950: 312e 3565 2d33 2c20 312e 3565 2d33 292c  1.5e-3, 1.5e-3),
-00017960: 2070 6f72 745f 7479 7065 3d4e 6f6e 6529   port_type=None)
-00017970: 0a20 2020 2063 3220 3d20 6320 3c3c 2067  .    c2 = c << g
-00017980: 662e 636f 6d70 6f6e 656e 7473 2e72 6563  f.components.rec
-00017990: 7461 6e67 6c65 2873 697a 653d 2831 2e35  tangle(size=(1.5
-000179a0: 652d 332c 2031 2e35 652d 3329 2c20 706f  e-3, 1.5e-3), po
-000179b0: 7274 5f74 7970 653d 4e6f 6e65 290a 2020  rt_type=None).  
-000179c0: 2020 6332 2e78 6d69 6e20 3d20 6331 2e78    c2.xmin = c1.x
-000179d0: 6d61 780a 0a20 2020 2061 7373 6572 7420  max..    assert 
-000179e0: 6332 2e78 7369 7a65 203d 3d20 3265 2d33  c2.xsize == 2e-3
-000179f0: 0a20 2020 2072 6574 7572 6e20 6332 0a0a  .    return c2..
-00017a00: 0a64 6566 2074 6573 745f 6262 6f78 5f63  .def test_bbox_c
-00017a10: 6f6d 706f 6e65 6e74 2829 202d 3e20 4e6f  omponent() -> No
-00017a20: 6e65 3a0a 2020 2020 696d 706f 7274 2067  ne:.    import g
-00017a30: 6473 6661 6374 6f72 7920 6173 2067 660a  dsfactory as gf.
-00017a40: 0a20 2020 2063 203d 2067 662e 636f 6d70  .    c = gf.comp
-00017a50: 6f6e 656e 7473 2e72 6563 7461 6e67 6c65  onents.rectangle
-00017a60: 2873 697a 653d 2831 2e35 652d 332c 2031  (size=(1.5e-3, 1
-00017a70: 2e35 652d 3329 2c20 706f 7274 5f74 7970  .5e-3), port_typ
-00017a80: 653d 4e6f 6e65 290a 2020 2020 6173 7365  e=None).    asse
-00017a90: 7274 2063 2e78 7369 7a65 203d 3d20 3265  rt c.xsize == 2e
-00017aa0: 2d33 0a0a 0a64 6566 2074 6573 745f 7265  -3...def test_re
-00017ab0: 6d61 705f 6c61 7965 7273 2829 202d 3e20  map_layers() -> 
-00017ac0: 4e6f 6e65 3a0a 2020 2020 696d 706f 7274  None:.    import
-00017ad0: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
-00017ae0: 660a 0a20 2020 2063 203d 2067 662e 636f  f..    c = gf.co
-00017af0: 6d70 6f6e 656e 7473 2e73 7472 6169 6768  mponents.straigh
-00017b00: 7428 6c61 7965 723d 2832 2c20 3029 290a  t(layer=(2, 0)).
-00017b10: 2020 2020 7265 6d61 7020 3d20 632e 7265      remap = c.re
-00017b20: 6d61 705f 6c61 7965 7273 286c 6179 6572  map_layers(layer
-00017b30: 6d61 703d 7b28 322c 2030 293a 2067 662e  map={(2, 0): gf.
-00017b40: 4c41 5945 522e 5747 4e7d 290a 2020 2020  LAYER.WGN}).    
-00017b50: 6861 7368 5f67 656f 6d65 7472 7920 3d20  hash_geometry = 
-00017b60: 2238 3366 6263 3661 3832 3839 3530 3565  "83fbc6a8289505e
-00017b70: 6165 6433 6132 6533 6162 3237 3963 6330  aed3a2e3ab279cc0
-00017b80: 3366 3565 3464 3030 6322 0a0a 2020 2020  3f5e4d00c"..    
-00017b90: 6173 7365 7274 2028 0a20 2020 2020 2020  assert (.       
-00017ba0: 2072 656d 6170 2e68 6173 685f 6765 6f6d   remap.hash_geom
-00017bb0: 6574 7279 2829 203d 3d20 6861 7368 5f67  etry() == hash_g
-00017bc0: 656f 6d65 7472 790a 2020 2020 292c 2066  eometry.    ), f
-00017bd0: 2268 6173 685f 6765 6f6d 6574 7279 203d  "hash_geometry =
-00017be0: 207b 7265 6d61 702e 6861 7368 5f67 656f   {remap.hash_geo
-00017bf0: 6d65 7472 7928 2921 727d 220a 0a0a 6465  metry()!r}"...de
-00017c00: 6620 7465 7374 5f72 656d 6f76 655f 6c61  f test_remove_la
-00017c10: 6265 6c73 2829 202d 3e20 4e6f 6e65 3a0a  bels() -> None:.
-00017c20: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
-00017c30: 6374 6f72 7920 6173 2067 660a 0a20 2020  ctory as gf..   
-00017c40: 2063 203d 2067 662e 632e 7374 7261 6967   c = gf.c.straig
-00017c50: 6874 2829 0a20 2020 2063 2e72 656d 6f76  ht().    c.remov
-00017c60: 655f 6c61 6265 6c73 2829 0a0a 2020 2020  e_labels()..    
-00017c70: 6173 7365 7274 206c 656e 2863 2e6c 6162  assert len(c.lab
-00017c80: 656c 7329 203d 3d20 300a 0a0a 6465 6620  els) == 0...def 
-00017c90: 7465 7374 5f69 6d70 6f72 745f 6764 735f  test_import_gds_
-00017ca0: 7365 7474 696e 6773 2829 3a0a 2020 2020  settings():.    
-00017cb0: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
-00017cc0: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
-00017cd0: 2067 662e 636f 6d70 6f6e 656e 7473 2e6d   gf.components.m
-00017ce0: 7a69 2829 0a20 2020 2067 6473 7061 7468  zi().    gdspath
-00017cf0: 203d 2063 2e77 7269 7465 5f67 6473 5f77   = c.write_gds_w
-00017d00: 6974 685f 6d65 7461 6461 7461 2829 0a20  ith_metadata(). 
-00017d10: 2020 2063 3220 3d20 6766 2e69 6d70 6f72     c2 = gf.impor
-00017d20: 745f 6764 7328 6764 7370 6174 682c 206e  t_gds(gdspath, n
-00017d30: 616d 653d 226d 7a69 5f73 616d 706c 6522  ame="mzi_sample"
-00017d40: 2c20 7265 6164 5f6d 6574 6164 6174 613d  , read_metadata=
-00017d50: 5472 7565 290a 2020 2020 6333 203d 2067  True).    c3 = g
-00017d60: 662e 726f 7574 696e 672e 6164 645f 6669  f.routing.add_fi
-00017d70: 6265 725f 7369 6e67 6c65 2863 3229 0a20  ber_single(c2). 
-00017d80: 2020 2061 7373 6572 7420 6333 0a0a 0a64     assert c3...d
-00017d90: 6566 2074 6573 745f 666c 6174 7465 6e5f  ef test_flatten_
-00017da0: 696e 7661 6c69 645f 7265 6673 5f72 6563  invalid_refs_rec
-00017db0: 7572 7369 7665 2829 3a0a 2020 2020 696d  ursive():.    im
-00017dc0: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
-00017dd0: 6173 2067 660a 2020 2020 6672 6f6d 2067  as gf.    from g
-00017de0: 6473 6661 6374 6f72 792e 6469 6666 7465  dsfactory.diffte
-00017df0: 7374 2069 6d70 6f72 7420 7275 6e5f 786f  st import run_xo
-00017e00: 720a 2020 2020 6672 6f6d 2067 6473 6661  r.    from gdsfa
-00017e10: 6374 6f72 792e 726f 7574 696e 672e 616c  ctory.routing.al
-00017e20: 6c5f 616e 676c 6520 696d 706f 7274 2067  l_angle import g
-00017e30: 6574 5f62 756e 646c 655f 616c 6c5f 616e  et_bundle_all_an
-00017e40: 676c 650a 0a20 2020 2040 6766 2e63 656c  gle..    @gf.cel
-00017e50: 6c0a 2020 2020 6465 6620 666c 6174 2829  l.    def flat()
-00017e60: 3a0a 2020 2020 2020 2020 6320 3d20 6766  :.        c = gf
-00017e70: 2e43 6f6d 706f 6e65 6e74 2829 0a20 2020  .Component().   
-00017e80: 2020 2020 206d 6d69 3120 3d20 2863 203c       mmi1 = (c <
-00017e90: 3c20 6766 2e63 6f6d 706f 6e65 6e74 732e  < gf.components.
-00017ea0: 6d6d 6931 7832 2829 292e 6d6f 7665 2828  mmi1x2()).move((
-00017eb0: 302c 202d 312e 3030 3035 2929 0a20 2020  0, -1.0005)).   
-00017ec0: 2020 2020 206d 6d69 3220 3d20 2863 203c       mmi2 = (c <
-00017ed0: 3c20 6766 2e63 6f6d 706f 6e65 6e74 732e  < gf.components.
-00017ee0: 6d6d 6931 7832 2829 292e 726f 7461 7465  mmi1x2()).rotate
-00017ef0: 2838 3029 0a20 2020 2020 2020 206d 6d69  (80).        mmi
-00017f00: 322e 6d6f 7665 2828 3430 2c20 3230 2929  2.move((40, 20))
-00017f10: 0a20 2020 2020 2020 2062 756e 646c 6520  .        bundle 
-00017f20: 3d20 6765 745f 6275 6e64 6c65 5f61 6c6c  = get_bundle_all
-00017f30: 5f61 6e67 6c65 285b 6d6d 6931 2e70 6f72  _angle([mmi1.por
-00017f40: 7473 5b22 6f32 225d 5d2c 205b 6d6d 6932  ts["o2"]], [mmi2
-00017f50: 2e70 6f72 7473 5b22 6f31 225d 5d29 0a20  .ports["o1"]]). 
-00017f60: 2020 2020 2020 2066 6f72 2072 6f75 7465         for route
-00017f70: 2069 6e20 6275 6e64 6c65 3a0a 2020 2020   in bundle:.    
-00017f80: 2020 2020 2020 2020 632e 6164 6428 726f          c.add(ro
-00017f90: 7574 652e 7265 6665 7265 6e63 6573 290a  ute.references).
-00017fa0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00017fb0: 0a0a 2020 2020 4067 662e 6365 6c6c 0a20  ..    @gf.cell. 
-00017fc0: 2020 2064 6566 2068 6965 7261 7263 6879     def hierarchy
-00017fd0: 2829 3a0a 2020 2020 2020 2020 6320 3d20  ():.        c = 
-00017fe0: 6766 2e43 6f6d 706f 6e65 6e74 2829 0a20  gf.Component(). 
-00017ff0: 2020 2020 2020 2028 6320 3c3c 2066 6c61         (c << fla
-00018000: 7428 2929 2e72 6f74 6174 6528 3333 290a  t()).rotate(33).
-00018010: 2020 2020 2020 2020 2863 203c 3c20 666c          (c << fl
-00018020: 6174 2829 292e 726f 7461 7465 2833 3329  at()).rotate(33)
-00018030: 2e6d 6f76 6528 2830 2c20 3130 3029 290a  .move((0, 100)).
-00018040: 2020 2020 2020 2020 2863 203c 3c20 666c          (c << fl
-00018050: 6174 2829 292e 6d6f 7665 2828 3130 302c  at()).move((100,
-00018060: 2030 2929 0a20 2020 2020 2020 2072 6574   0)).        ret
-00018070: 7572 6e20 630a 0a20 2020 2063 5f6f 7269  urn c..    c_ori
-00018080: 6720 3d20 6869 6572 6172 6368 7928 290a  g = hierarchy().
-00018090: 2020 2020 635f 6e65 7720 3d20 666c 6174      c_new = flat
-000180a0: 7465 6e5f 696e 7661 6c69 645f 7265 6673  ten_invalid_refs
-000180b0: 5f72 6563 7572 7369 7665 2863 5f6f 7269  _recursive(c_ori
-000180c0: 6729 0a20 2020 2061 7373 6572 7420 635f  g).    assert c_
-000180d0: 6e65 7720 6973 206e 6f74 2063 5f6f 7269  new is not c_ori
-000180e0: 670a 2020 2020 696e 7661 6c69 645f 7265  g.    invalid_re
-000180f0: 6673 5f66 696c 656e 616d 6520 3d20 2269  fs_filename = "i
-00018100: 6e76 616c 6964 5f72 6566 732e 6764 7322  nvalid_refs.gds"
-00018110: 0a20 2020 2069 6e76 616c 6964 5f72 6566  .    invalid_ref
-00018120: 735f 6669 7865 645f 6669 6c65 6e61 6d65  s_fixed_filename
-00018130: 203d 2022 696e 7661 6c69 645f 7265 6673   = "invalid_refs
-00018140: 5f66 6978 6564 2e67 6473 220a 2020 2020  _fixed.gds".    
-00018150: 2320 6764 7320 6669 6c65 7320 7368 6f75  # gds files shou
-00018160: 6c64 2073 7469 6c6c 2062 6520 7361 6d65  ld still be same
-00018170: 2074 6f20 316e 6d20 746f 6c65 7261 6e63   to 1nm toleranc
-00018180: 650a 2020 2020 635f 6f72 6967 2e77 7269  e.    c_orig.wri
-00018190: 7465 5f67 6473 2869 6e76 616c 6964 5f72  te_gds(invalid_r
-000181a0: 6566 735f 6669 6c65 6e61 6d65 290a 2020  efs_filename).  
-000181b0: 2020 635f 6e65 772e 7772 6974 655f 6764    c_new.write_gd
-000181c0: 7328 696e 7661 6c69 645f 7265 6673 5f66  s(invalid_refs_f
-000181d0: 6978 6564 5f66 696c 656e 616d 6529 0a20  ixed_filename). 
-000181e0: 2020 2072 756e 5f78 6f72 2869 6e76 616c     run_xor(inval
-000181f0: 6964 5f72 6566 735f 6669 6c65 6e61 6d65  id_refs_filename
-00018200: 2c20 696e 7661 6c69 645f 7265 6673 5f66  , invalid_refs_f
-00018210: 6978 6564 5f66 696c 656e 616d 6529 0a0a  ixed_filename)..
-00018220: 0a69 6620 5f5f 6e61 6d65 5f5f 203d 3d20  .if __name__ == 
-00018230: 225f 5f6d 6169 6e5f 5f22 3a0a 2020 2020  "__main__":.    
-00018240: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
-00018250: 7920 6173 2067 660a 0a20 2020 2023 2063  y as gf..    # c
-00018260: 3220 3d20 6766 2e43 6f6d 706f 6e65 6e74  2 = gf.Component
-00018270: 2829 0a20 2020 2063 203d 2067 662e 636f  ().    c = gf.co
-00018280: 6d70 6f6e 656e 7473 2e6d 7a69 2829 0a20  mponents.mzi(). 
-00018290: 2020 2070 7269 6e74 2863 2e67 6574 5f6c     print(c.get_l
-000182a0: 6179 6572 5f6e 616d 6573 2829 290a 2020  ayer_names()).  
-000182b0: 2020 2320 7220 3d20 632e 7265 6628 290a    # r = c.ref().
-000182c0: 2020 2020 2320 6332 2e63 6f70 795f 6368      # c2.copy_ch
-000182d0: 696c 645f 696e 666f 2863 2e6e 616d 6564  ild_info(c.named
-000182e0: 5f72 6566 6572 656e 6365 735b 2273 7874  _references["sxt
-000182f0: 225d 290a 2020 2020 2320 7465 7374 5f72  "]).    # test_r
-00018300: 656d 6170 5f6c 6179 6572 7328 290a 2020  emap_layers().  
-00018310: 2020 2320 6320 3d20 7465 7374 5f67 6574    # c = test_get
-00018320: 5f6c 6179 6572 7328 290a 2020 2020 2320  _layers().    # 
-00018330: 632e 706c 6f74 5f71 7428 290a 2020 2020  c.plot_qt().    
-00018340: 2320 632e 706c 6f74 6828 290a 2020 2020  # c.ploth().    
-00018350: 2320 6320 3d20 7465 7374 5f65 7874 7261  # c = test_extra
-00018360: 6374 2829 0a20 2020 2023 2067 6473 7061  ct().    # gdspa
-00018370: 7468 203d 2063 2e77 7269 7465 5f67 6473  th = c.write_gds
-00018380: 2829 0a20 2020 2023 2067 662e 7368 6f77  ().    # gf.show
-00018390: 2867 6473 7061 7468 290a 2020 2020 2320  (gdspath).    # 
-000183a0: 632e 7368 6f77 2873 686f 775f 706f 7274  c.show(show_port
-000183b0: 733d 5472 7565 290a 2020 2020 632e 7368  s=True).    c.sh
-000183c0: 6f77 2829 0a                             ow().
+00013530: 6c61 6265 6c2e 6c61 7965 7220 3d20 6e65  label.layer = ne
+00013540: 775f 6c61 7965 725b 305d 0a20 2020 2020  w_layer[0].     
+00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013560: 2020 206c 6162 656c 2e74 6578 7474 7970     label.texttyp
+00013570: 6520 3d20 6e65 775f 6c61 7965 725b 315d  e = new_layer[1]
+00013580: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00013590: 2069 6e63 6c75 6465 5f70 6174 6873 3a0a   include_paths:.
+000135a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135b0: 666f 7220 7061 7468 2069 6e20 442e 7061  for path in D.pa
+000135c0: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+000135d0: 2020 2020 2020 2020 206e 6577 5f6c 6179           new_lay
+000135e0: 6572 7320 3d20 6c69 7374 2870 6174 682e  ers = list(path.
+000135f0: 6c61 7965 7273 290a 2020 2020 2020 2020  layers).        
+00013600: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00013610: 6461 7461 7479 7065 7320 3d20 6c69 7374  datatypes = list
+00013620: 2870 6174 682e 6461 7461 7479 7065 7329  (path.datatypes)
+00013630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013640: 2020 2020 2066 6f72 206c 6179 6572 5f6e       for layer_n
+00013650: 756d 6265 7220 696e 2072 616e 6765 286c  umber in range(l
+00013660: 656e 286e 6577 5f6c 6179 6572 7329 293a  en(new_layers)):
+00013670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013680: 2020 2020 2020 2020 206f 7269 6769 6e61           origina
+00013690: 6c5f 6c61 7965 7220 3d20 5f70 6172 7365  l_layer = _parse
+000136a0: 5f6c 6179 6572 280a 2020 2020 2020 2020  _layer(.        
+000136b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136c0: 2020 2020 286e 6577 5f6c 6179 6572 735b      (new_layers[
+000136d0: 6c61 7965 725f 6e75 6d62 6572 5d2c 206e  layer_number], n
+000136e0: 6577 5f64 6174 6174 7970 6573 5b6c 6179  ew_datatypes[lay
+000136f0: 6572 5f6e 756d 6265 725d 290a 2020 2020  er_number]).    
+00013700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013710: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00013720: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00013730: 206f 7269 6769 6e61 6c5f 6c61 7965 7220   original_layer 
+00013740: 696e 206c 6179 6572 6d61 703a 0a20 2020  in layermap:.   
+00013750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013760: 2020 2020 2020 2020 206e 6577 5f6c 6179           new_lay
+00013770: 6572 203d 206c 6179 6572 6d61 705b 6f72  er = layermap[or
+00013780: 6967 696e 616c 5f6c 6179 6572 5d0a 2020  iginal_layer].  
+00013790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137a0: 2020 2020 2020 2020 2020 6e65 775f 6c61            new_la
+000137b0: 7965 7273 5b6c 6179 6572 5f6e 756d 6265  yers[layer_numbe
+000137c0: 725d 203d 206e 6577 5f6c 6179 6572 5b30  r] = new_layer[0
+000137d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000137e0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+000137f0: 775f 6461 7461 7479 7065 735b 6c61 7965  w_datatypes[laye
+00013800: 725f 6e75 6d62 6572 5d20 3d20 6e65 775f  r_number] = new_
+00013810: 6c61 7965 725b 315d 0a20 2020 2020 2020  layer[1].       
+00013820: 2020 2020 2020 2020 2020 2020 2070 6174               pat
+00013830: 682e 7365 745f 6c61 7965 7273 282a 6e65  h.set_layers(*ne
+00013840: 775f 6c61 7965 7273 290a 2020 2020 2020  w_layers).      
+00013850: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00013860: 7468 2e73 6574 5f64 6174 6174 7970 6573  th.set_datatypes
+00013870: 282a 6e65 775f 6461 7461 7479 7065 7329  (*new_datatypes)
+00013880: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013890: 636f 6d70 6f6e 656e 740a 0a20 2020 2064  component..    d
+000138a0: 6566 2074 6f5f 3364 280a 2020 2020 2020  ef to_3d(.      
+000138b0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+000138c0: 6c61 7965 725f 7669 6577 733a 204f 7074  layer_views: Opt
+000138d0: 696f 6e61 6c5b 4c61 7965 7256 6965 7773  ional[LayerViews
+000138e0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+000138f0: 2020 6c61 7965 725f 7374 6163 6b3a 204f    layer_stack: O
+00013900: 7074 696f 6e61 6c5b 4c61 7965 7253 7461  ptional[LayerSta
+00013910: 636b 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ck] = None,.    
+00013920: 2020 2020 6578 636c 7564 655f 6c61 7965      exclude_laye
+00013930: 7273 3a20 4f70 7469 6f6e 616c 5b54 7570  rs: Optional[Tup
+00013940: 6c65 5b4c 6179 6572 2c20 2e2e 2e5d 5d20  le[Layer, ...]] 
+00013950: 3d20 4e6f 6e65 2c0a 2020 2020 293a 0a20  = None,.    ):. 
+00013960: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00013970: 2043 6f6d 706f 6e65 6e74 2033 4420 7472   Component 3D tr
+00013980: 696d 6573 6820 5363 656e 652e 0a0a 2020  imesh Scene...  
+00013990: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+000139a0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+000139b0: 743a 2074 6f20 6578 7472 7564 6520 696e  t: to extrude in
+000139c0: 2033 442e 0a20 2020 2020 2020 2020 2020   3D..           
+000139d0: 206c 6179 6572 5f76 6965 7773 3a20 6c61   layer_views: la
+000139e0: 7965 7220 636f 6c6f 7273 2066 726f 6d20  yer colors from 
+000139f0: 4b6c 6179 6f75 7420 4c61 7965 7220 5072  Klayout Layer Pr
+00013a00: 6f70 6572 7469 6573 2066 696c 652e 0a20  operties file.. 
+00013a10: 2020 2020 2020 2020 2020 2020 2020 2044                 D
+00013a20: 6566 6175 6c74 7320 746f 2061 6374 6976  efaults to activ
+00013a30: 6520 5044 4b2e 6c61 7965 725f 7669 6577  e PDK.layer_view
+00013a40: 732e 0a20 2020 2020 2020 2020 2020 206c  s..            l
+00013a50: 6179 6572 5f73 7461 636b 3a20 636f 6e74  ayer_stack: cont
+00013a60: 6169 6e73 2074 6869 636b 6e65 7373 2061  ains thickness a
+00013a70: 6e64 207a 6d69 6e20 666f 7220 6561 6368  nd zmin for each
+00013a80: 206c 6179 6572 2e0a 2020 2020 2020 2020   layer..        
+00013a90: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
+00013aa0: 2074 6f20 6163 7469 7665 2050 444b 2e6c   to active PDK.l
+00013ab0: 6179 6572 5f73 7461 636b 2e0a 2020 2020  ayer_stack..    
+00013ac0: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
+00013ad0: 6c61 7965 7273 3a20 6c61 7965 7273 2074  layers: layers t
+00013ae0: 6f20 6578 636c 7564 652e 0a0a 2020 2020  o exclude...    
+00013af0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00013b00: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00013b10: 6578 706f 7274 2e74 6f5f 3364 2069 6d70  export.to_3d imp
+00013b20: 6f72 7420 746f 5f33 640a 0a20 2020 2020  ort to_3d..     
+00013b30: 2020 2072 6574 7572 6e20 746f 5f33 6428     return to_3d(
+00013b40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00013b50: 662c 0a20 2020 2020 2020 2020 2020 206c  f,.            l
+00013b60: 6179 6572 5f76 6965 7773 3d6c 6179 6572  ayer_views=layer
+00013b70: 5f76 6965 7773 2c0a 2020 2020 2020 2020  _views,.        
+00013b80: 2020 2020 6c61 7965 725f 7374 6163 6b3d      layer_stack=
+00013b90: 6c61 7965 725f 7374 6163 6b2c 0a20 2020  layer_stack,.   
+00013ba0: 2020 2020 2020 2020 2065 7863 6c75 6465           exclude
+00013bb0: 5f6c 6179 6572 733d 6578 636c 7564 655f  _layers=exclude_
+00013bc0: 6c61 7965 7273 2c0a 2020 2020 2020 2020  layers,.        
+00013bd0: 290a 0a20 2020 2064 6566 2074 6f5f 6e70  )..    def to_np
+00013be0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00013bf0: 2020 2020 2020 2020 6e6d 5f70 6572 5f70          nm_per_p
+00013c00: 6978 656c 3a20 696e 7420 3d20 3230 2c0a  ixel: int = 20,.
+00013c10: 2020 2020 2020 2020 6c61 7965 7273 3a20          layers: 
+00013c20: 4c61 7965 7273 203d 2028 2831 2c20 3029  Layers = ((1, 0)
+00013c30: 2c29 2c0a 2020 2020 2020 2020 7661 6c75  ,),.        valu
+00013c40: 6573 3a20 4f70 7469 6f6e 616c 5b54 7570  es: Optional[Tup
+00013c50: 6c65 5b66 6c6f 6174 2c20 2e2e 2e5d 5d20  le[float, ...]] 
+00013c60: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00013c70: 7061 645f 7769 6474 683a 2069 6e74 203d  pad_width: int =
+00013c80: 2031 2c0a 2020 2020 2920 2d3e 206e 702e   1,.    ) -> np.
+00013c90: 6e64 6172 7261 793a 0a20 2020 2020 2020  ndarray:.       
+00013ca0: 2022 2222 5265 7475 726e 7320 6120 7069   """Returns a pi
+00013cb0: 7865 6c61 7465 6420 6e75 6d70 7920 6172  xelated numpy ar
+00013cc0: 7261 7920 6672 6f6d 2043 6f6d 706f 6e65  ray from Compone
+00013cd0: 6e74 2070 6f6c 7967 6f6e 732e 0a0a 2020  nt polygons...  
+00013ce0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00013cf0: 2020 2020 2020 2020 636f 6d70 6f6e 656e          componen
+00013d00: 743a 2043 6f6d 706f 6e65 6e74 2e0a 2020  t: Component..  
+00013d10: 2020 2020 2020 2020 2020 6e6d 5f70 6572            nm_per
+00013d20: 5f70 6978 656c 3a20 796f 7520 6361 6e20  _pixel: you can 
+00013d30: 676f 2066 726f 6d20 3230 2028 636f 6172  go from 20 (coar
+00013d40: 7365 2920 746f 2034 2028 6669 6e65 292e  se) to 4 (fine).
+00013d50: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00013d60: 6572 733a 2074 6f20 636f 6e76 6572 742e  ers: to convert.
+00013d70: 204f 7264 6572 206d 6174 7465 7273 2028   Order matters (
+00013d80: 6c61 7474 6572 206f 7665 7277 7269 7465  latter overwrite
+00013d90: 2066 6f72 6d65 7229 2e0a 2020 2020 2020   former)..      
+00013da0: 2020 2020 2020 7661 6c75 6573 3a20 6173        values: as
+00013db0: 736f 6369 6174 6564 2074 6f20 6561 6368  sociated to each
+00013dc0: 206c 6179 6572 2028 6465 6661 756c 7473   layer (defaults
+00013dd0: 2074 6f20 3129 2e0a 2020 2020 2020 2020   to 1)..        
+00013de0: 2020 2020 7061 645f 7769 6474 683a 2070      pad_width: p
+00013df0: 6164 6469 6e67 2070 6978 656c 7320 6172  adding pixels ar
+00013e00: 6f75 6e64 2074 6865 2069 6d61 6765 2e0a  ound the image..
+00013e10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013e20: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+00013e30: 746f 7279 2e65 7870 6f72 742e 746f 5f6e  tory.export.to_n
+00013e40: 7020 696d 706f 7274 2074 6f5f 6e70 0a0a  p import to_np..
+00013e50: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00013e60: 6f5f 6e70 280a 2020 2020 2020 2020 2020  o_np(.          
+00013e70: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00013e80: 2020 2020 6e6d 5f70 6572 5f70 6978 656c      nm_per_pixel
+00013e90: 3d6e 6d5f 7065 725f 7069 7865 6c2c 0a20  =nm_per_pixel,. 
+00013ea0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00013eb0: 733d 6c61 7965 7273 2c0a 2020 2020 2020  s=layers,.      
+00013ec0: 2020 2020 2020 7661 6c75 6573 3d76 616c        values=val
+00013ed0: 7565 732c 0a20 2020 2020 2020 2020 2020  ues,.           
+00013ee0: 2070 6164 5f77 6964 7468 3d70 6164 5f77   pad_width=pad_w
+00013ef0: 6964 7468 2c0a 2020 2020 2020 2020 290a  idth,.        ).
+00013f00: 0a20 2020 2064 6566 2077 7269 7465 5f73  .    def write_s
+00013f10: 746c 280a 2020 2020 2020 2020 7365 6c66  tl(.        self
+00013f20: 2c0a 2020 2020 2020 2020 6669 6c65 7061  ,.        filepa
+00013f30: 7468 3a20 7374 722c 0a20 2020 2020 2020  th: str,.       
+00013f40: 206c 6179 6572 5f73 7461 636b 3a20 4f70   layer_stack: Op
+00013f50: 7469 6f6e 616c 5b4c 6179 6572 5374 6163  tional[LayerStac
+00013f60: 6b5d 203d 204e 6f6e 652c 0a20 2020 2020  k] = None,.     
+00013f70: 2020 2065 7863 6c75 6465 5f6c 6179 6572     exclude_layer
+00013f80: 733a 204f 7074 696f 6e61 6c5b 5475 706c  s: Optional[Tupl
+00013f90: 655b 4c61 7965 722c 202e 2e2e 5d5d 203d  e[Layer, ...]] =
+00013fa0: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+00013fb0: 6e70 2e6e 6461 7272 6179 3a0a 2020 2020  np.ndarray:.    
+00013fc0: 2020 2020 2222 2257 7269 7465 2061 2043      """Write a C
+00013fd0: 6f6d 706f 6e65 6e74 2074 6f20 5354 4c20  omponent to STL 
+00013fe0: 666f 7220 3344 2070 7269 6e74 696e 672e  for 3D printing.
+00013ff0: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00014000: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+00014010: 7061 7468 3a20 746f 2077 7269 7465 2053  path: to write S
+00014020: 544c 2074 6f2e 0a20 2020 2020 2020 2020  TL to..         
+00014030: 2020 206c 6179 6572 5f73 7461 636b 3a20     layer_stack: 
+00014040: 636f 6e74 6169 6e73 2074 6869 636b 6e65  contains thickne
+00014050: 7373 2061 6e64 207a 6d69 6e20 666f 7220  ss and zmin for 
+00014060: 6561 6368 206c 6179 6572 2e0a 2020 2020  each layer..    
+00014070: 2020 2020 2020 2020 6578 636c 7564 655f          exclude_
+00014080: 6c61 7965 7273 3a20 6c61 7965 7273 2074  layers: layers t
+00014090: 6f20 6578 636c 7564 652e 0a20 2020 2020  o exclude..     
+000140a0: 2020 2020 2020 2075 7365 5f6c 6179 6572         use_layer
+000140b0: 5f6e 616d 653a 2049 6620 5472 7565 2c20  _name: If True, 
+000140c0: 7573 6573 204c 6179 6572 4c65 7665 6c20  uses LayerLevel 
+000140d0: 6e61 6d65 7320 696e 206f 7574 7075 7420  names in output 
+000140e0: 6669 6c65 6e61 6d65 7320 7261 7468 6572  filenames rather
+000140f0: 2074 6861 6e20 6764 735f 6c61 7965 7220   than gds_layer 
+00014100: 616e 6420 6764 735f 6461 7461 7479 7065  and gds_datatype
+00014110: 2e0a 2020 2020 2020 2020 2020 2020 6875  ..            hu
+00014120: 6c6c 5f69 6e76 616c 6964 5f70 6f6c 7967  ll_invalid_polyg
+00014130: 6f6e 733a 2049 6620 5472 7565 2c20 7265  ons: If True, re
+00014140: 706c 6163 6573 2069 6e76 616c 6964 2070  places invalid p
+00014150: 6f6c 7967 6f6e 7320 2864 6574 6572 6d69  olygons (determi
+00014160: 6e65 6420 6279 2073 6861 7065 6c79 2e50  ned by shapely.P
+00014170: 6f6c 7967 6f6e 2e69 735f 7661 6c69 6429  olygon.is_valid)
+00014180: 2077 6974 6820 6974 7320 636f 6e76 6578   with its convex
+00014190: 2068 756c 6c2e 0a20 2020 2020 2020 2020   hull..         
+000141a0: 2020 2073 6361 6c65 3a20 4f70 7469 6f6e     scale: Option
+000141b0: 616c 2066 6163 746f 7220 6279 2077 6869  al factor by whi
+000141c0: 6368 2074 6f20 7363 616c 6520 6d65 7368  ch to scale mesh
+000141d0: 6573 2062 6566 6f72 6520 7772 6974 696e  es before writin
+000141e0: 672e 0a0a 2020 2020 2020 2020 2222 220a  g...        """.
+000141f0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+00014200: 6661 6374 6f72 792e 6578 706f 7274 2e74  factory.export.t
+00014210: 6f5f 7374 6c20 696d 706f 7274 2074 6f5f  o_stl import to_
+00014220: 7374 6c0a 0a20 2020 2020 2020 2072 6574  stl..        ret
+00014230: 7572 6e20 746f 5f73 746c 280a 2020 2020  urn to_stl(.    
+00014240: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00014250: 2020 2020 2020 2020 2020 6669 6c65 7061            filepa
+00014260: 7468 3d66 696c 6570 6174 682c 0a20 2020  th=filepath,.   
+00014270: 2020 2020 2020 2020 206c 6179 6572 5f73           layer_s
+00014280: 7461 636b 3d6c 6179 6572 5f73 7461 636b  tack=layer_stack
+00014290: 2c0a 2020 2020 2020 2020 2020 2020 6578  ,.            ex
+000142a0: 636c 7564 655f 6c61 7965 7273 3d65 7863  clude_layers=exc
+000142b0: 6c75 6465 5f6c 6179 6572 732c 0a20 2020  lude_layers,.   
+000142c0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+000142d0: 746f 5f67 6d73 6828 0a20 2020 2020 2020  to_gmsh(.       
+000142e0: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
+000142f0: 7970 652c 0a20 2020 2020 2020 207a 3d4e  ype,.        z=N
+00014300: 6f6e 652c 0a20 2020 2020 2020 2078 7365  one,.        xse
+00014310: 6374 696f 6e5f 626f 756e 6473 3d4e 6f6e  ction_bounds=Non
+00014320: 652c 0a20 2020 2020 2020 206c 6179 6572  e,.        layer
+00014330: 5f73 7461 636b 3d4e 6f6e 652c 0a20 2020  _stack=None,.   
+00014340: 2020 2020 2077 6166 6572 5f70 6164 6469       wafer_paddi
+00014350: 6e67 3d30 2e30 2c0a 2020 2020 2020 2020  ng=0.0,.        
+00014360: 7761 6665 725f 6c61 7965 723d 4c41 5945  wafer_layer=LAYE
+00014370: 522e 5741 4645 522c 0a20 2020 2020 2020  R.WAFER,.       
+00014380: 202a 6172 6773 2c0a 2020 2020 2020 2020   *args,.        
+00014390: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
+000143a0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+000143b0: 726e 7320 6120 676d 7368 206d 7368 206f  rns a gmsh msh o
+000143c0: 6620 7468 6520 636f 6d70 6f6e 656e 7420  f the component 
+000143d0: 666f 7220 6669 6e69 7465 2065 6c65 6d65  for finite eleme
+000143e0: 6e74 2073 696d 756c 6174 696f 6e2e 0a0a  nt simulation...
+000143f0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+00014400: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
+00014410: 7970 653a 206f 6e65 206f 6620 2278 7922  ype: one of "xy"
+00014420: 2c20 2275 7a22 2c20 6f72 2022 3344 222e  , "uz", or "3D".
+00014430: 2044 6574 6572 6d69 6e65 7320 7468 6520   Determines the 
+00014440: 7479 7065 206f 6620 6d65 7368 2074 6f20  type of mesh to 
+00014450: 7265 7475 726e 2e0a 2020 2020 2020 2020  return..        
+00014460: 2020 2020 7a3a 2075 7365 6420 746f 2064      z: used to d
+00014470: 6566 696e 6520 7a2d 736c 6963 6520 666f  efine z-slice fo
+00014480: 7220 7879 206d 6573 6869 6e67 0a20 2020  r xy meshing.   
+00014490: 2020 2020 2020 2020 2078 7365 6374 696f           xsectio
+000144a0: 6e5f 626f 756e 6473 3a20 7573 6564 2074  n_bounds: used t
+000144b0: 6f20 6465 6669 6e65 2069 6e2d 706c 616e  o define in-plan
+000144c0: 6520 6c69 6e65 2066 6f72 2075 7a20 6d65  e line for uz me
+000144d0: 7368 696e 670a 2020 2020 2020 2020 2020  shing.          
+000144e0: 2020 7761 6665 725f 7061 6464 696e 673a    wafer_padding:
+000144f0: 2070 6164 6469 6e67 2062 6579 6f6e 6420   padding beyond 
+00014500: 6262 6f78 2074 6f20 6164 6420 746f 2057  bbox to add to W
+00014510: 4146 4552 206c 6179 6572 732e 0a0a 2020  AFER layers...  
+00014520: 2020 2020 2020 4b65 7977 6f72 6420 4172        Keyword Ar
+00014530: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
+00014540: 4172 6775 6d65 6e74 7320 666f 7220 7468  Arguments for th
+00014550: 6520 7461 7267 6574 206d 6573 6869 6e67  e target meshing
+00014560: 2066 756e 6374 696f 6e20 696e 2067 6473   function in gds
+00014570: 6661 6374 6f72 792e 7369 6d75 6c61 7469  factory.simulati
+00014580: 6f6e 2e67 6d73 680a 2020 2020 2020 2020  on.gmsh.        
+00014590: 2222 220a 2020 2020 2020 2020 2320 4164  """.        # Ad
+000145a0: 6420 5741 4645 5220 6c61 7965 723a 0a20  d WAFER layer:. 
+000145b0: 2020 2020 2020 2070 6164 6465 645f 636f         padded_co
+000145c0: 6d70 6f6e 656e 7420 3d20 436f 6d70 6f6e  mponent = Compon
+000145d0: 656e 7428 290a 2020 2020 2020 2020 7061  ent().        pa
+000145e0: 6464 6564 5f63 6f6d 706f 6e65 6e74 203c  dded_component <
+000145f0: 3c20 7365 6c66 0a20 2020 2020 2020 2028  < self.        (
+00014600: 786d 696e 2c20 796d 696e 292c 2028 786d  xmin, ymin), (xm
+00014610: 6178 2c20 796d 6178 2920 3d20 7365 6c66  ax, ymax) = self
+00014620: 2e62 626f 780a 2020 2020 2020 2020 706f  .bbox.        po
+00014630: 696e 7473 203d 205b 0a20 2020 2020 2020  ints = [.       
+00014640: 2020 2020 205b 786d 696e 202d 2077 6166       [xmin - waf
+00014650: 6572 5f70 6164 6469 6e67 2c20 796d 696e  er_padding, ymin
+00014660: 202d 2077 6166 6572 5f70 6164 6469 6e67   - wafer_padding
+00014670: 5d2c 0a20 2020 2020 2020 2020 2020 205b  ],.            [
+00014680: 786d 6178 202b 2077 6166 6572 5f70 6164  xmax + wafer_pad
+00014690: 6469 6e67 2c20 796d 696e 202d 2077 6166  ding, ymin - waf
+000146a0: 6572 5f70 6164 6469 6e67 5d2c 0a20 2020  er_padding],.   
+000146b0: 2020 2020 2020 2020 205b 786d 6178 202b           [xmax +
+000146c0: 2077 6166 6572 5f70 6164 6469 6e67 2c20   wafer_padding, 
+000146d0: 796d 6178 202b 2077 6166 6572 5f70 6164  ymax + wafer_pad
+000146e0: 6469 6e67 5d2c 0a20 2020 2020 2020 2020  ding],.         
+000146f0: 2020 205b 786d 696e 202d 2077 6166 6572     [xmin - wafer
+00014700: 5f70 6164 6469 6e67 2c20 796d 6178 202b  _padding, ymax +
+00014710: 2077 6166 6572 5f70 6164 6469 6e67 5d2c   wafer_padding],
+00014720: 0a20 2020 2020 2020 205d 0a20 2020 2020  .        ].     
+00014730: 2020 2070 6164 6465 645f 636f 6d70 6f6e     padded_compon
+00014740: 656e 742e 6164 645f 706f 6c79 676f 6e28  ent.add_polygon(
+00014750: 706f 696e 7473 2c20 6c61 7965 723d 7761  points, layer=wa
+00014760: 6665 725f 6c61 7965 7229 0a0a 2020 2020  fer_layer)..    
+00014770: 2020 2020 6966 206c 6179 6572 5f73 7461      if layer_sta
+00014780: 636b 2069 7320 4e6f 6e65 3a0a 2020 2020  ck is None:.    
+00014790: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000147a0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+000147b0: 2020 2020 2020 2020 2020 2741 204c 6179            'A Lay
+000147c0: 6572 5374 6163 6b20 6d75 7374 2062 6520  erStack must be 
+000147d0: 7072 6f76 6964 6564 2074 6872 6f75 6768  provided through
+000147e0: 2061 7267 756d 656e 7420 226c 6179 6572   argument "layer
+000147f0: 5f73 7461 636b 222e 270a 2020 2020 2020  _stack".'.      
+00014800: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00014810: 6966 2074 7970 6520 3d3d 2022 7879 223a  if type == "xy":
+00014820: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014830: 7a20 6973 204e 6f6e 653a 0a20 2020 2020  z is None:.     
+00014840: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00014850: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014870: 2027 466f 7220 7879 2d6d 6573 6869 6e67   'For xy-meshing
+00014880: 2c20 6120 7a2d 7661 6c75 6520 6d75 7374  , a z-value must
+00014890: 2062 6520 7072 6f76 6964 6564 2076 6961   be provided via
+000148a0: 2074 6865 2066 6c6f 6174 2061 7267 756d   the float argum
+000148b0: 656e 7420 227a 222e 270a 2020 2020 2020  ent "z".'.      
+000148c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000148d0: 2020 2020 2020 2020 6672 6f6d 2067 6473          from gds
+000148e0: 6661 6374 6f72 792e 7369 6d75 6c61 7469  factory.simulati
+000148f0: 6f6e 2e67 6d73 682e 7879 5f78 7365 6374  on.gmsh.xy_xsect
+00014900: 696f 6e5f 6d65 7368 2069 6d70 6f72 7420  ion_mesh import 
+00014910: 7879 5f78 7365 6374 696f 6e5f 6d65 7368  xy_xsection_mesh
+00014920: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00014930: 7475 726e 2078 795f 7873 6563 7469 6f6e  turn xy_xsection
+00014940: 5f6d 6573 6828 7061 6464 6564 5f63 6f6d  _mesh(padded_com
+00014950: 706f 6e65 6e74 2c20 7a2c 206c 6179 6572  ponent, z, layer
+00014960: 5f73 7461 636b 2c20 2a2a 6b77 6172 6773  _stack, **kwargs
+00014970: 290a 2020 2020 2020 2020 656c 6966 2074  ).        elif t
+00014980: 7970 6520 3d3d 2022 757a 223a 0a20 2020  ype == "uz":.   
+00014990: 2020 2020 2020 2020 2069 6620 7873 6563           if xsec
+000149a0: 7469 6f6e 5f62 6f75 6e64 7320 6973 204e  tion_bounds is N
+000149b0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000149c0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000149d0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+000149e0: 2020 2020 2020 2020 2020 2022 466f 7220             "For 
+000149f0: 757a 2d6d 6573 6869 6e67 2c20 796f 7520  uz-meshing, you 
+00014a00: 6d75 7374 2070 726f 7669 6465 2061 206c  must provide a l
+00014a10: 696e 6520 696e 2074 6865 2078 792d 706c  ine in the xy-pl
+00014a20: 616e 6520 220a 2020 2020 2020 2020 2020  ane ".          
+00014a30: 2020 2020 2020 2020 2020 2276 6961 2074            "via t
+00014a40: 6865 2054 7570 6c65 2061 7267 756d 656e  he Tuple argumen
+00014a50: 7420 5b5b 7831 2c79 315d 2c20 5b78 322c  t [[x1,y1], [x2,
+00014a60: 7932 5d5d 2078 7365 6374 696f 6e5f 626f  y2]] xsection_bo
+00014a70: 756e 6473 2e22 0a20 2020 2020 2020 2020  unds.".         
+00014a80: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00014a90: 2020 2020 2066 726f 6d20 6764 7366 6163       from gdsfac
+00014aa0: 746f 7279 2e73 696d 756c 6174 696f 6e2e  tory.simulation.
+00014ab0: 676d 7368 2e75 7a5f 7873 6563 7469 6f6e  gmsh.uz_xsection
+00014ac0: 5f6d 6573 6820 696d 706f 7274 2075 7a5f  _mesh import uz_
+00014ad0: 7873 6563 7469 6f6e 5f6d 6573 680a 0a20  xsection_mesh.. 
+00014ae0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00014af0: 6e20 757a 5f78 7365 6374 696f 6e5f 6d65  n uz_xsection_me
+00014b00: 7368 280a 2020 2020 2020 2020 2020 2020  sh(.            
+00014b10: 2020 2020 7061 6464 6564 5f63 6f6d 706f      padded_compo
+00014b20: 6e65 6e74 2c20 7873 6563 7469 6f6e 5f62  nent, xsection_b
+00014b30: 6f75 6e64 732c 206c 6179 6572 5f73 7461  ounds, layer_sta
+00014b40: 636b 2c20 2a2a 6b77 6172 6773 0a20 2020  ck, **kwargs.   
+00014b50: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00014b60: 2020 2065 6c69 6620 7479 7065 203d 3d20     elif type == 
+00014b70: 2233 4422 3a0a 2020 2020 2020 2020 2020  "3D":.          
+00014b80: 2020 6672 6f6d 2067 6473 6661 6374 6f72    from gdsfactor
+00014b90: 792e 7369 6d75 6c61 7469 6f6e 2e67 6d73  y.simulation.gms
+00014ba0: 682e 7879 7a5f 6d65 7368 2069 6d70 6f72  h.xyz_mesh impor
+00014bb0: 7420 7879 7a5f 6d65 7368 0a0a 2020 2020  t xyz_mesh..    
+00014bc0: 2020 2020 2020 2020 7265 7475 726e 2078          return x
+00014bd0: 797a 5f6d 6573 6828 7061 6464 6564 5f63  yz_mesh(padded_c
+00014be0: 6f6d 706f 6e65 6e74 2c20 6c61 7965 725f  omponent, layer_
+00014bf0: 7374 6163 6b2c 202a 2a6b 7761 7267 7329  stack, **kwargs)
+00014c00: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00014c10: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00014c20: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00014c30: 2020 2020 2020 2020 2020 2020 2027 5265               'Re
+00014c40: 7175 6972 6564 2061 7267 756d 656e 7420  quired argument 
+00014c50: 2274 7970 6522 206d 7573 7420 6265 206f  "type" must be o
+00014c60: 6e65 206f 6620 2278 7922 2c20 2275 7a22  ne of "xy", "uz"
+00014c70: 2c20 6f72 2022 3344 222e 270a 2020 2020  , or "3D".'.    
+00014c80: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00014c90: 6566 206f 6666 7365 7428 0a20 2020 2020  ef offset(.     
+00014ca0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00014cb0: 2064 6973 7461 6e63 653a 2066 6c6f 6174   distance: float
+00014cc0: 203d 2030 2e31 2c0a 2020 2020 2020 2020   = 0.1,.        
+00014cd0: 706f 6c79 676f 6e73 3d4e 6f6e 652c 0a20  polygons=None,. 
+00014ce0: 2020 2020 2020 2075 7365 5f75 6e69 6f6e         use_union
+00014cf0: 3a20 626f 6f6c 203d 2054 7275 652c 0a20  : bool = True,. 
+00014d00: 2020 2020 2020 2070 7265 6369 7369 6f6e         precision
+00014d10: 3a20 666c 6f61 7420 3d20 3165 2d34 2c0a  : float = 1e-4,.
+00014d20: 2020 2020 2020 2020 6a6f 696e 3a20 7374          join: st
+00014d30: 7220 3d20 226d 6974 6572 222c 0a20 2020  r = "miter",.   
+00014d40: 2020 2020 2074 6f6c 6572 616e 6365 3a20       tolerance: 
+00014d50: 696e 7420 3d20 322c 0a20 2020 2020 2020  int = 2,.       
+00014d60: 206c 6179 6572 3a20 4c61 7965 7253 7065   layer: LayerSpe
+00014d70: 6320 3d20 2257 4722 2c0a 2020 2020 2920  c = "WG",.    ) 
+00014d80: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+00014d90: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00014da0: 206e 6577 2043 6f6d 706f 6e65 6e74 2077   new Component w
+00014db0: 6974 6820 706f 6c79 676f 6e73 2065 726f  ith polygons ero
+00014dc0: 6465 6420 6f72 2064 696c 6174 6564 2062  ded or dilated b
+00014dd0: 7920 616e 206f 6666 7365 742e 0a0a 2020  y an offset...  
+00014de0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00014df0: 2020 2020 2020 2020 6469 7374 616e 6365          distance
+00014e00: 3a20 4469 7374 616e 6365 2074 6f20 6f66  : Distance to of
+00014e10: 6673 6574 2070 6f6c 7967 6f6e 732e 2050  fset polygons. P
+00014e20: 6f73 6974 6976 6520 7661 6c75 6573 2065  ositive values e
+00014e30: 7870 616e 642c 206e 6567 6174 6976 6520  xpand, negative 
+00014e40: 7368 7269 6e6b 2e0a 2020 2020 2020 2020  shrink..        
+00014e50: 2020 2020 7072 6563 6973 696f 6e3a 2044      precision: D
+00014e60: 6573 6972 6564 2070 7265 6369 7369 6f6e  esired precision
+00014e70: 2066 6f72 2072 6f75 6e64 696e 6720 7665   for rounding ve
+00014e80: 7274 6578 2063 6f6f 7264 696e 6174 6573  rtex coordinates
+00014e90: 2e0a 2020 2020 2020 2020 2020 2020 6a6f  ..            jo
+00014ea0: 696e 3a20 7b27 6d69 7465 7227 2c20 2762  in: {'miter', 'b
+00014eb0: 6576 656c 272c 2027 726f 756e 6427 7d20  evel', 'round'} 
+00014ec0: 5479 7065 206f 6620 6a6f 696e 2075 7365  Type of join use
+00014ed0: 6420 746f 2063 7265 6174 6520 706f 6c79  d to create poly
+00014ee0: 676f 6e20 6f66 6673 6574 0a20 2020 2020  gon offset.     
+00014ef0: 2020 2020 2020 2074 6f6c 6572 616e 6365         tolerance
+00014f00: 3a20 466f 7220 6d69 7465 7220 6a6f 696e  : For miter join
+00014f10: 7473 2c20 7468 6973 206e 756d 6265 7220  ts, this number 
+00014f20: 6d75 7374 2062 6520 6174 206c 6561 7374  must be at least
+00014f30: 2032 2072 6570 7265 7365 6e74 7320 7468   2 represents th
+00014f40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00014f50: 6d61 7869 6d61 6c20 6469 7374 616e 6365  maximal distance
+00014f60: 2069 6e20 6d75 6c74 6970 6c65 7320 6f66   in multiples of
+00014f70: 206f 6666 7365 7420 6265 7477 6565 6e20   offset between 
+00014f80: 6e65 7720 7665 7274 6963 6573 2061 6e64  new vertices and
+00014f90: 2074 6865 6972 0a20 2020 2020 2020 2020   their.         
+00014fa0: 2020 2020 206f 7269 6769 6e61 6c20 706f       original po
+00014fb0: 7369 7469 6f6e 2062 6566 6f72 6520 6265  sition before be
+00014fc0: 7665 6c69 6e67 2074 6f20 6176 6f69 6420  veling to avoid 
+00014fd0: 7370 696b 6573 2061 7420 6163 7574 6520  spikes at acute 
+00014fe0: 6a6f 696e 7473 2e20 466f 720a 2020 2020  joints. For.    
+00014ff0: 2020 2020 2020 2020 2020 726f 756e 6420            round 
+00015000: 6a6f 696e 7473 2c20 6974 2069 6e64 6963  joints, it indic
+00015010: 6174 6573 2074 6865 2063 7572 7661 7475  ates the curvatu
+00015020: 7265 2072 6573 6f6c 7574 696f 6e20 696e  re resolution in
+00015030: 206e 756d 6265 7220 6f66 0a20 2020 2020   number of.     
+00015040: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+00015050: 7065 7220 6675 6c6c 2063 6972 636c 652e  per full circle.
+00015060: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
+00015070: 6572 3a20 5370 6563 6966 6963 206c 6179  er: Specific lay
+00015080: 6572 2066 6f72 206e 6577 2070 6f6c 7967  er for new polyg
+00015090: 6f6e 732e 0a0a 2020 2020 2020 2020 2222  ons...        ""
+000150a0: 220a 2020 2020 2020 2020 696d 706f 7274  ".        import
+000150b0: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
+000150c0: 660a 0a20 2020 2020 2020 2067 6473 5f6c  f..        gds_l
+000150d0: 6179 6572 2c20 6764 735f 6461 7461 7479  ayer, gds_dataty
+000150e0: 7065 203d 2067 662e 6765 745f 6c61 7965  pe = gf.get_laye
+000150f0: 7228 6c61 7965 7229 0a20 2020 2020 2020  r(layer).       
+00015100: 2070 203d 2067 6473 746b 2e6f 6666 7365   p = gdstk.offse
+00015110: 7428 0a20 2020 2020 2020 2020 2020 2070  t(.            p
+00015120: 6f6c 7967 6f6e 7320 6f72 2073 656c 662e  olygons or self.
+00015130: 6765 745f 706f 6c79 676f 6e73 2829 2c0a  get_polygons(),.
+00015140: 2020 2020 2020 2020 2020 2020 6469 7374              dist
+00015150: 616e 6365 3d64 6973 7461 6e63 652c 0a20  ance=distance,. 
+00015160: 2020 2020 2020 2020 2020 206a 6f69 6e3d             join=
+00015170: 6a6f 696e 2c0a 2020 2020 2020 2020 2020  join,.          
+00015180: 2020 746f 6c65 7261 6e63 653d 746f 6c65    tolerance=tole
+00015190: 7261 6e63 652c 0a20 2020 2020 2020 2020  rance,.         
+000151a0: 2020 2070 7265 6369 7369 6f6e 3d70 7265     precision=pre
+000151b0: 6369 7369 6f6e 2c0a 2020 2020 2020 2020  cision,.        
+000151c0: 2020 2020 7573 655f 756e 696f 6e3d 7573      use_union=us
+000151d0: 655f 756e 696f 6e2c 0a20 2020 2020 2020  e_union,.       
+000151e0: 2020 2020 206c 6179 6572 3d67 6473 5f6c       layer=gds_l
+000151f0: 6179 6572 2c0a 2020 2020 2020 2020 2020  ayer,.          
+00015200: 2020 6461 7461 7479 7065 3d67 6473 5f64    datatype=gds_d
+00015210: 6174 6174 7970 652c 0a20 2020 2020 2020  atatype,.       
+00015220: 2029 0a0a 2020 2020 2020 2020 636f 6d70   )..        comp
+00015230: 6f6e 656e 7420 3d20 6766 2e43 6f6d 706f  onent = gf.Compo
+00015240: 6e65 6e74 2829 0a20 2020 2020 2020 2063  nent().        c
+00015250: 6f6d 706f 6e65 6e74 2e61 6464 5f70 6f6c  omponent.add_pol
+00015260: 7967 6f6e 2870 2c20 6c61 7965 723d 6c61  ygon(p, layer=la
+00015270: 7965 7229 0a20 2020 2020 2020 2072 6574  yer).        ret
+00015280: 7572 6e20 636f 6d70 6f6e 656e 740a 0a0a  urn component...
+00015290: 6465 6620 636f 7079 280a 2020 2020 443a  def copy(.    D:
+000152a0: 2043 6f6d 706f 6e65 6e74 2c0a 2020 2020   Component,.    
+000152b0: 7265 6665 7265 6e63 6573 3d4e 6f6e 652c  references=None,
+000152c0: 0a20 2020 2070 6f72 7473 3d4e 6f6e 652c  .    ports=None,
+000152d0: 0a20 2020 2070 6f6c 7967 6f6e 733d 4e6f  .    polygons=No
+000152e0: 6e65 2c0a 2020 2020 7061 7468 733d 4e6f  ne,.    paths=No
+000152f0: 6e65 2c0a 2020 2020 6e61 6d65 3d4e 6f6e  ne,.    name=Non
+00015300: 652c 0a20 2020 206c 6162 656c 733d 4e6f  e,.    labels=No
+00015310: 6e65 2c0a 2920 2d3e 2043 6f6d 706f 6e65  ne,.) -> Compone
+00015320: 6e74 3a0a 2020 2020 2222 2252 6574 7572  nt:.    """Retur
+00015330: 6e73 2061 2043 6f6d 706f 6e65 6e74 2063  ns a Component c
+00015340: 6f70 792e 0a0a 2020 2020 4172 6773 3a0a  opy...    Args:.
+00015350: 2020 2020 2020 2020 443a 2063 6f6d 706f          D: compo
+00015360: 6e65 6e74 2074 6f20 636f 7079 2e0a 2020  nent to copy..  
+00015370: 2020 2222 220a 2020 2020 445f 636f 7079    """.    D_copy
+00015380: 203d 2043 6f6d 706f 6e65 6e74 2829 0a20   = Component(). 
+00015390: 2020 2044 5f63 6f70 792e 696e 666f 203d     D_copy.info =
+000153a0: 2044 2e69 6e66 6f0a 2020 2020 2320 445f   D.info.    # D_
+000153b0: 636f 7079 2e5f 6365 6c6c 203d 2044 2e5f  copy._cell = D._
+000153c0: 6365 6c6c 2e63 6f70 7928 6e61 6d65 3d44  cell.copy(name=D
+000153d0: 5f63 6f70 792e 6e61 6d65 290a 0a20 2020  _copy.name)..   
+000153e0: 2066 6f72 2072 6566 2069 6e20 7265 6665   for ref in refe
+000153f0: 7265 6e63 6573 2069 6620 7265 6665 7265  rences if refere
+00015400: 6e63 6573 2069 7320 6e6f 7420 4e6f 6e65  nces is not None
+00015410: 2065 6c73 6520 442e 7265 6665 7265 6e63   else D.referenc
+00015420: 6573 3a0a 2020 2020 2020 2020 445f 636f  es:.        D_co
+00015430: 7079 2e61 6464 2863 6f70 795f 7265 6665  py.add(copy_refe
+00015440: 7265 6e63 6528 7265 6629 290a 2020 2020  rence(ref)).    
+00015450: 666f 7220 706f 7274 2069 6e20 2870 6f72  for port in (por
+00015460: 7473 2069 6620 706f 7274 7320 6973 206e  ts if ports is n
+00015470: 6f74 204e 6f6e 6520 656c 7365 2044 2e70  ot None else D.p
+00015480: 6f72 7473 292e 7661 6c75 6573 2829 3a0a  orts).values():.
+00015490: 2020 2020 2020 2020 445f 636f 7079 2e61          D_copy.a
+000154a0: 6464 5f70 6f72 7428 706f 7274 3d70 6f72  dd_port(port=por
+000154b0: 7429 0a20 2020 2066 6f72 2070 6f6c 7920  t).    for poly 
+000154c0: 696e 2070 6f6c 7967 6f6e 7320 6966 2070  in polygons if p
+000154d0: 6f6c 7967 6f6e 7320 6973 206e 6f74 204e  olygons is not N
+000154e0: 6f6e 6520 656c 7365 2044 2e70 6f6c 7967  one else D.polyg
+000154f0: 6f6e 733a 0a20 2020 2020 2020 2044 5f63  ons:.        D_c
+00015500: 6f70 792e 6164 645f 706f 6c79 676f 6e28  opy.add_polygon(
+00015510: 706f 6c79 290a 2020 2020 666f 7220 7061  poly).    for pa
+00015520: 7468 2069 6e20 7061 7468 7320 6966 2070  th in paths if p
+00015530: 6174 6873 2069 7320 6e6f 7420 4e6f 6e65  aths is not None
+00015540: 2065 6c73 6520 442e 7061 7468 733a 0a20   else D.paths:. 
+00015550: 2020 2020 2020 2044 5f63 6f70 792e 6164         D_copy.ad
+00015560: 6428 7061 7468 290a 2020 2020 666f 7220  d(path).    for 
+00015570: 6c61 6265 6c20 696e 206c 6162 656c 7320  label in labels 
+00015580: 6966 206c 6162 656c 7320 6973 206e 6f74  if labels is not
+00015590: 204e 6f6e 6520 656c 7365 2044 2e6c 6162   None else D.lab
+000155a0: 656c 733a 0a20 2020 2020 2020 2044 5f63  els:.        D_c
+000155b0: 6f70 792e 6164 645f 6c61 6265 6c28 0a20  opy.add_label(. 
+000155c0: 2020 2020 2020 2020 2020 2074 6578 743d             text=
+000155d0: 6c61 6265 6c2e 7465 7874 2c0a 2020 2020  label.text,.    
+000155e0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+000155f0: 3d6c 6162 656c 2e6f 7269 6769 6e2c 0a20  =label.origin,. 
+00015600: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00015610: 3d28 6c61 6265 6c2e 6c61 7965 722c 206c  =(label.layer, l
+00015620: 6162 656c 2e74 6578 7474 7970 6529 2c0a  abel.texttype),.
+00015630: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
+00015640: 6620 6e61 6d65 2069 7320 6e6f 7420 4e6f  f name is not No
+00015650: 6e65 3a0a 2020 2020 2020 2020 445f 636f  ne:.        D_co
+00015660: 7079 2e6e 616d 6520 3d20 6e61 6d65 0a0a  py.name = name..
+00015670: 2020 2020 7265 7475 726e 2044 5f63 6f70      return D_cop
+00015680: 790a 0a0a 6465 6620 636f 7079 5f72 6566  y...def copy_ref
+00015690: 6572 656e 6365 280a 2020 2020 7265 662c  erence(.    ref,
+000156a0: 0a20 2020 2070 6172 656e 743d 4e6f 6e65  .    parent=None
+000156b0: 2c0a 2020 2020 636f 6c75 6d6e 733d 4e6f  ,.    columns=No
+000156c0: 6e65 2c0a 2020 2020 726f 7773 3d4e 6f6e  ne,.    rows=Non
+000156d0: 652c 0a20 2020 2073 7061 6369 6e67 3d4e  e,.    spacing=N
+000156e0: 6f6e 652c 0a20 2020 206f 7269 6769 6e3d  one,.    origin=
+000156f0: 4e6f 6e65 2c0a 2020 2020 726f 7461 7469  None,.    rotati
+00015700: 6f6e 3d4e 6f6e 652c 0a20 2020 206d 6167  on=None,.    mag
+00015710: 6e69 6669 6361 7469 6f6e 3d4e 6f6e 652c  nification=None,
+00015720: 0a20 2020 2078 5f72 6566 6c65 6374 696f  .    x_reflectio
+00015730: 6e3d 4e6f 6e65 2c0a 2020 2020 6e61 6d65  n=None,.    name
+00015740: 3d4e 6f6e 652c 0a20 2020 2076 313d 4e6f  =None,.    v1=No
+00015750: 6e65 2c0a 2020 2020 7632 3d4e 6f6e 652c  ne,.    v2=None,
+00015760: 0a29 202d 3e20 436f 6d70 6f6e 656e 7452  .) -> ComponentR
+00015770: 6566 6572 656e 6365 3a0a 2020 2020 7265  eference:.    re
+00015780: 7475 726e 2043 6f6d 706f 6e65 6e74 5265  turn ComponentRe
+00015790: 6665 7265 6e63 6528 0a20 2020 2020 2020  ference(.       
+000157a0: 2063 6f6d 706f 6e65 6e74 3d70 6172 656e   component=paren
+000157b0: 7420 6f72 2072 6566 2e70 6172 656e 742c  t or ref.parent,
+000157c0: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
+000157d0: 3d63 6f6c 756d 6e73 206f 7220 7265 662e  =columns or ref.
+000157e0: 636f 6c75 6d6e 732c 0a20 2020 2020 2020  columns,.       
+000157f0: 2072 6f77 733d 726f 7773 206f 7220 7265   rows=rows or re
+00015800: 662e 726f 7773 2c0a 2020 2020 2020 2020  f.rows,.        
+00015810: 7370 6163 696e 673d 7370 6163 696e 6720  spacing=spacing 
+00015820: 6f72 2072 6566 2e73 7061 6369 6e67 2c0a  or ref.spacing,.
+00015830: 2020 2020 2020 2020 6f72 6967 696e 3d6f          origin=o
+00015840: 7269 6769 6e20 6f72 2072 6566 2e6f 7269  rigin or ref.ori
+00015850: 6769 6e2c 0a20 2020 2020 2020 2072 6f74  gin,.        rot
+00015860: 6174 696f 6e3d 726f 7461 7469 6f6e 206f  ation=rotation o
+00015870: 7220 7265 662e 726f 7461 7469 6f6e 2c0a  r ref.rotation,.
+00015880: 2020 2020 2020 2020 6d61 676e 6966 6963          magnific
+00015890: 6174 696f 6e3d 6d61 676e 6966 6963 6174  ation=magnificat
+000158a0: 696f 6e20 6f72 2072 6566 2e6d 6167 6e69  ion or ref.magni
+000158b0: 6669 6361 7469 6f6e 2c0a 2020 2020 2020  fication,.      
+000158c0: 2020 785f 7265 666c 6563 7469 6f6e 3d78    x_reflection=x
+000158d0: 5f72 6566 6c65 6374 696f 6e20 6f72 2072  _reflection or r
+000158e0: 6566 2e78 5f72 6566 6c65 6374 696f 6e2c  ef.x_reflection,
+000158f0: 0a20 2020 2020 2020 206e 616d 653d 6e61  .        name=na
+00015900: 6d65 206f 7220 7265 662e 6e61 6d65 2c0a  me or ref.name,.
+00015910: 2020 2020 2020 2020 7631 3d76 3120 6f72          v1=v1 or
+00015920: 2072 6566 2e76 312c 0a20 2020 2020 2020   ref.v1,.       
+00015930: 2076 323d 7632 206f 7220 7265 662e 7632   v2=v2 or ref.v2
+00015940: 2c0a 2020 2020 290a 0a0a 6465 6620 7465  ,.    )...def te
+00015950: 7374 5f67 6574 5f6c 6179 6572 7328 2920  st_get_layers() 
+00015960: 2d3e 2043 6f6d 706f 6e65 6e74 3a0a 2020  -> Component:.  
+00015970: 2020 696d 706f 7274 2067 6473 6661 6374    import gdsfact
+00015980: 6f72 7920 6173 2067 660a 0a20 2020 2063  ory as gf..    c
+00015990: 3120 3d20 6766 2e63 6f6d 706f 6e65 6e74  1 = gf.component
+000159a0: 732e 7374 7261 6967 6874 280a 2020 2020  s.straight(.    
+000159b0: 2020 2020 6c65 6e67 7468 3d31 302c 0a20      length=10,. 
+000159c0: 2020 2020 2020 2077 6964 7468 3d30 2e35         width=0.5
+000159d0: 2c0a 2020 2020 2020 2020 6c61 7965 723d  ,.        layer=
+000159e0: 2832 2c20 3029 2c0a 2020 2020 2020 2020  (2, 0),.        
+000159f0: 6262 6f78 5f6c 6179 6572 733d 5b28 3131  bbox_layers=[(11
+00015a00: 312c 2030 295d 2c0a 2020 2020 2020 2020  1, 0)],.        
+00015a10: 6262 6f78 5f6f 6666 7365 7473 3d5b 335d  bbox_offsets=[3]
+00015a20: 2c0a 2020 2020 2020 2020 7769 7468 5f62  ,.        with_b
+00015a30: 626f 783d 5472 7565 2c0a 2020 2020 2020  box=True,.      
+00015a40: 2020 636c 6164 6469 6e67 5f6c 6179 6572    cladding_layer
+00015a50: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+00015a60: 6164 645f 7069 6e73 3d4e 6f6e 652c 0a20  add_pins=None,. 
+00015a70: 2020 2020 2020 2061 6464 5f62 626f 783d         add_bbox=
+00015a80: 4e6f 6e65 2c0a 2020 2020 290a 2020 2020  None,.    ).    
+00015a90: 6173 7365 7274 2063 312e 6765 745f 6c61  assert c1.get_la
+00015aa0: 7965 7273 2829 203d 3d20 7b28 322c 2030  yers() == {(2, 0
+00015ab0: 292c 2028 3131 312c 2030 297d 2c20 6331  ), (111, 0)}, c1
+00015ac0: 2e67 6574 5f6c 6179 6572 7328 290a 2020  .get_layers().  
+00015ad0: 2020 2320 7265 7475 726e 2063 310a 2020    # return c1.  
+00015ae0: 2020 6332 203d 2063 312e 7265 6d6f 7665    c2 = c1.remove
+00015af0: 5f6c 6179 6572 7328 5b28 3131 312c 2030  _layers([(111, 0
+00015b00: 295d 290a 2020 2020 6173 7365 7274 2063  )]).    assert c
+00015b10: 322e 6765 745f 6c61 7965 7273 2829 203d  2.get_layers() =
+00015b20: 3d20 7b28 322c 2030 297d 2c20 6332 2e67  = {(2, 0)}, c2.g
+00015b30: 6574 5f6c 6179 6572 7328 290a 2020 2020  et_layers().    
+00015b40: 7265 7475 726e 2063 320a 0a0a 6465 6620  return c2...def 
+00015b50: 5f66 696c 7465 725f 706f 6c79 7328 706f  _filter_polys(po
+00015b60: 6c79 676f 6e73 2c20 6c61 7965 7273 5f65  lygons, layers_e
+00015b70: 7863 6c29 3a0a 2020 2020 7265 7475 726e  xcl):.    return
+00015b80: 205b 0a20 2020 2020 2020 2070 6f6c 7967   [.        polyg
+00015b90: 6f6e 0a20 2020 2020 2020 2066 6f72 2070  on.        for p
+00015ba0: 6f6c 7967 6f6e 2c20 6c61 7965 722c 2064  olygon, layer, d
+00015bb0: 6174 6174 7970 6520 696e 207a 6970 280a  atatype in zip(.
+00015bc0: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
+00015bd0: 676f 6e73 2e70 6f6c 7967 6f6e 732c 2070  gons.polygons, p
+00015be0: 6f6c 7967 6f6e 732e 6c61 7965 7273 2c20  olygons.layers, 
+00015bf0: 706f 6c79 676f 6e73 2e64 6174 6174 7970  polygons.datatyp
+00015c00: 6573 0a20 2020 2020 2020 2029 0a20 2020  es.        ).   
+00015c10: 2020 2020 2069 6620 286c 6179 6572 2c20       if (layer, 
+00015c20: 6461 7461 7479 7065 2920 6e6f 7420 696e  datatype) not in
+00015c30: 206c 6179 6572 735f 6578 636c 0a20 2020   layers_excl.   
+00015c40: 205d 0a0a 0a64 6566 2072 6563 7572 7365   ]...def recurse
+00015c50: 5f73 7472 7563 7475 7265 7328 0a20 2020  _structures(.   
+00015c60: 2063 6f6d 706f 6e65 6e74 3a20 436f 6d70   component: Comp
+00015c70: 6f6e 656e 742c 0a20 2020 2069 676e 6f72  onent,.    ignor
+00015c80: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
+00015c90: 6669 783a 204f 7074 696f 6e61 6c5b 4c69  fix: Optional[Li
+00015ca0: 7374 5b73 7472 5d5d 203d 204e 6f6e 652c  st[str]] = None,
+00015cb0: 0a20 2020 2069 676e 6f72 655f 6675 6e63  .    ignore_func
+00015cc0: 7469 6f6e 735f 7072 6566 6978 3a20 4f70  tions_prefix: Op
+00015cd0: 7469 6f6e 616c 5b4c 6973 745b 7374 725d  tional[List[str]
+00015ce0: 5d20 3d20 4e6f 6e65 2c0a 2920 2d3e 2044  ] = None,.) -> D
+00015cf0: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
+00015d00: 2020 2022 2222 5265 6375 7273 6520 636f     """Recurse co
+00015d10: 6d70 6f6e 656e 7420 616e 6420 636f 6d70  mponent and comp
+00015d20: 6f6e 656e 7473 2072 6566 6572 656e 6365  onents reference
+00015d30: 7320 7265 6375 7273 6976 656c 792e 0a0a  s recursively...
+00015d40: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00015d50: 2020 636f 6d70 6f6e 656e 743a 2063 6f6d    component: com
+00015d60: 706f 6e65 6e74 2074 6f20 7265 6375 7273  ponent to recurs
+00015d70: 652e 0a20 2020 2020 2020 2069 676e 6f72  e..        ignor
+00015d80: 655f 636f 6d70 6f6e 656e 7473 5f70 7265  e_components_pre
+00015d90: 6669 783a 206c 6973 7420 6f66 2070 7265  fix: list of pre
+00015da0: 6669 7820 746f 2069 676e 6f72 652e 0a20  fix to ignore.. 
+00015db0: 2020 2020 2020 2069 676e 6f72 655f 6675         ignore_fu
+00015dc0: 6e63 7469 6f6e 735f 7072 6566 6978 3a20  nctions_prefix: 
+00015dd0: 6c69 7374 206f 6620 7072 6566 6978 2074  list of prefix t
+00015de0: 6f20 6967 6e6f 7265 2e0a 2020 2020 2222  o ignore..    ""
+00015df0: 220a 2020 2020 6967 6e6f 7265 5f66 756e  ".    ignore_fun
+00015e00: 6374 696f 6e73 5f70 7265 6669 7820 3d20  ctions_prefix = 
+00015e10: 6967 6e6f 7265 5f66 756e 6374 696f 6e73  ignore_functions
+00015e20: 5f70 7265 6669 7820 6f72 205b 5d0a 2020  _prefix or [].  
+00015e30: 2020 6967 6e6f 7265 5f63 6f6d 706f 6e65    ignore_compone
+00015e40: 6e74 735f 7072 6566 6978 203d 2069 676e  nts_prefix = ign
+00015e50: 6f72 655f 636f 6d70 6f6e 656e 7473 5f70  ore_components_p
+00015e60: 7265 6669 7820 6f72 205b 5d0a 0a20 2020  refix or []..   
+00015e70: 2069 6620 280a 2020 2020 2020 2020 6861   if (.        ha
+00015e80: 7361 7474 7228 636f 6d70 6f6e 656e 742c  sattr(component,
+00015e90: 2022 6675 6e63 7469 6f6e 5f6e 616d 6522   "function_name"
+00015ea0: 290a 2020 2020 2020 2020 616e 6420 636f  ).        and co
+00015eb0: 6d70 6f6e 656e 742e 6675 6e63 7469 6f6e  mponent.function
+00015ec0: 5f6e 616d 6520 696e 2069 676e 6f72 655f  _name in ignore_
+00015ed0: 6675 6e63 7469 6f6e 735f 7072 6566 6978  functions_prefix
+00015ee0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+00015ef0: 7265 7475 726e 207b 7d0a 0a20 2020 2069  return {}..    i
+00015f00: 6620 6861 7361 7474 7228 636f 6d70 6f6e  f hasattr(compon
+00015f10: 656e 742c 2022 6e61 6d65 2229 2061 6e64  ent, "name") and
+00015f20: 2061 6e79 280a 2020 2020 2020 2020 636f   any(.        co
+00015f30: 6d70 6f6e 656e 742e 6e61 6d65 2e73 7461  mponent.name.sta
+00015f40: 7274 7377 6974 6828 6929 2066 6f72 2069  rtswith(i) for i
+00015f50: 2069 6e20 6967 6e6f 7265 5f63 6f6d 706f   in ignore_compo
+00015f60: 6e65 6e74 735f 7072 6566 6978 0a20 2020  nents_prefix.   
+00015f70: 2029 3a0a 2020 2020 2020 2020 7265 7475   ):.        retu
+00015f80: 726e 207b 7d0a 0a20 2020 206f 7574 7075  rn {}..    outpu
+00015f90: 7420 3d20 7b63 6f6d 706f 6e65 6e74 2e6e  t = {component.n
+00015fa0: 616d 653a 2064 6963 7428 636f 6d70 6f6e  ame: dict(compon
+00015fb0: 656e 742e 7365 7474 696e 6773 297d 0a20  ent.settings)}. 
+00015fc0: 2020 2066 6f72 2072 6566 6572 656e 6365     for reference
+00015fd0: 2069 6e20 636f 6d70 6f6e 656e 742e 7265   in component.re
+00015fe0: 6665 7265 6e63 6573 3a0a 2020 2020 2020  ferences:.      
+00015ff0: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+00016000: 2020 2069 7369 6e73 7461 6e63 6528 7265     isinstance(re
+00016010: 6665 7265 6e63 652c 2043 6f6d 706f 6e65  ference, Compone
+00016020: 6e74 5265 6665 7265 6e63 6529 0a20 2020  ntReference).   
+00016030: 2020 2020 2020 2020 2061 6e64 2072 6566           and ref
+00016040: 6572 656e 6365 2e72 6566 5f63 656c 6c2e  erence.ref_cell.
+00016050: 6e61 6d65 206e 6f74 2069 6e20 6f75 7470  name not in outp
+00016060: 7574 0a20 2020 2020 2020 2029 3a0a 2020  ut.        ):.  
+00016070: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00016080: 2e75 7064 6174 6528 7265 6375 7273 655f  .update(recurse_
+00016090: 7374 7275 6374 7572 6573 2872 6566 6572  structures(refer
+000160a0: 656e 6365 2e72 6566 5f63 656c 6c29 290a  ence.ref_cell)).
+000160b0: 0a20 2020 2072 6574 7572 6e20 6f75 7470  .    return outp
+000160c0: 7574 0a0a 0a64 6566 2066 6c61 7474 656e  ut...def flatten
+000160d0: 5f69 6e76 616c 6964 5f72 6566 735f 7265  _invalid_refs_re
+000160e0: 6375 7273 6976 6528 0a20 2020 2063 6f6d  cursive(.    com
+000160f0: 706f 6e65 6e74 3a20 436f 6d70 6f6e 656e  ponent: Componen
+00016100: 742c 0a20 2020 2067 7269 645f 7369 7a65  t,.    grid_size
+00016110: 3a20 4f70 7469 6f6e 616c 5b66 6c6f 6174  : Optional[float
+00016120: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 7570  ] = None,.    up
+00016130: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
+00016140: 3d4e 6f6e 652c 0a20 2020 2074 7261 7665  =None,.    trave
+00016150: 7273 6564 5f63 6f6d 706f 6e65 6e74 733d  rsed_components=
+00016160: 4e6f 6e65 2c0a 293a 0a20 2020 2022 2222  None,.):.    """
+00016170: 5265 6375 7273 6976 656c 7920 666c 6174  Recursively flat
+00016180: 7465 6e73 2063 6f6d 706f 6e65 6e74 2072  tens component r
+00016190: 6566 6572 656e 6365 7320 7768 6963 6820  eferences which 
+000161a0: 6861 7665 2069 6e76 616c 6964 2074 7261  have invalid tra
+000161b0: 6e73 666f 726d 6174 696f 6e73 2028 692e  nsformations (i.
+000161c0: 652e 206e 6f6e 2d39 3020 6465 6720 726f  e. non-90 deg ro
+000161d0: 7461 7469 6f6e 7320 6f72 2073 7562 2d67  tations or sub-g
+000161e0: 7269 6420 7472 616e 736c 6174 696f 6e73  rid translations
+000161f0: 2920 616e 6420 7265 7475 726e 7320 6120  ) and returns a 
+00016200: 636f 7079 2069 6620 616e 7920 7375 6263  copy if any subc
+00016210: 656c 6c73 2068 6176 6520 6265 656e 206d  ells have been m
+00016220: 6f64 6966 6965 642e 0a0a 2020 2020 5741  odified...    WA
+00016230: 524e 494e 473a 2074 6869 7320 6675 6e63  RNING: this func
+00016240: 7469 6f6e 2077 696c 6c20 7072 6f64 7563  tion will produc
+00016250: 6520 7361 6d65 2d6e 616d 6520 636f 7069  e same-name copi
+00016260: 6573 206f 6620 6365 6c6c 732e 2049 7420  es of cells. It 
+00016270: 6973 2073 7472 6963 746c 7920 6d65 616e  is strictly mean
+00016280: 7420 746f 2062 6520 7573 6564 206f 6e20  t to be used on 
+00016290: 7772 6974 6520 6f66 2074 6865 2047 4453  write of the GDS
+000162a0: 2066 696c 6520 616e 640a 2020 2020 7368   file and.    sh
+000162b0: 6f75 6c64 206e 6f74 2062 6520 6d69 7865  ould not be mixe
+000162c0: 6420 7769 7468 206f 7468 6572 2063 656c  d with other cel
+000162d0: 6c73 2c20 6f72 2079 6f75 2077 696c 6c20  ls, or you will 
+000162e0: 6c69 6b65 6c79 2065 7870 6572 6965 6e63  likely experienc
+000162f0: 6520 6973 7375 6573 2077 6974 6820 6475  e issues with du
+00016300: 706c 6963 6174 6520 6365 6c6c 730a 0a20  plicate cells.. 
+00016310: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
+00016320: 2063 6f6d 706f 6e65 6e74 3a20 7468 6520   component: the 
+00016330: 636f 6d70 6f6e 656e 7420 746f 2066 6978  component to fix
+00016340: 2028 696e 2070 6c61 6365 292e 0a20 2020   (in place)..   
+00016350: 2020 2020 2067 7269 645f 7369 7a65 3a20       grid_size: 
+00016360: 7468 6520 4744 5320 6772 6964 2073 697a  the GDS grid siz
+00016370: 652c 2069 6e20 756d 2c20 6465 6661 756c  e, in um, defaul
+00016380: 7473 2074 6f20 6163 7469 7665 2050 444b  ts to active PDK
+00016390: 2e67 6574 5f67 7269 645f 7369 7a65 2829  .get_grid_size()
+000163a0: 0a20 2020 2020 2020 2020 2020 2061 6e79  .            any
+000163b0: 2074 7261 6e73 6c61 7469 6f6e 7320 7769   translations wi
+000163c0: 7468 2068 6967 6865 7220 7265 736f 6c75  th higher resolu
+000163d0: 7469 6f6e 2074 6861 6e20 7468 6973 2061  tion than this a
+000163e0: 7265 2063 6f6e 7369 6465 7265 6420 696e  re considered in
+000163f0: 7661 6c69 642e 0a20 2020 2020 2020 2075  valid..        u
+00016400: 7064 6174 6564 5f63 6f6d 706f 6e65 6e74  pdated_component
+00016410: 733a 2074 6865 2072 756e 6e69 6e67 2064  s: the running d
+00016420: 6963 7469 6f6e 6172 7920 6f66 2063 6f6d  ictionary of com
+00016430: 706f 6e65 6e74 7320 7768 6963 6820 6861  ponents which ha
+00016440: 7665 2062 6565 6e20 6d6f 6469 6669 6564  ve been modified
+00016450: 2062 7920 7468 6973 2074 7261 6e73 666f   by this transfo
+00016460: 726d 6174 696f 6e2e 2053 686f 756c 6420  rmation. Should 
+00016470: 616c 7761 7973 2062 6520 4e6f 6e65 2c20  always be None, 
+00016480: 6578 6365 7074 2066 6f72 2072 6563 7572  except for recur
+00016490: 7369 7665 2069 6e76 6f63 6174 696f 6e73  sive invocations
+000164a0: 2e0a 2020 2020 2020 2020 7472 6176 6572  ..        traver
+000164b0: 7365 645f 636f 6d70 6f6e 656e 7473 3a20  sed_components: 
+000164c0: 7468 6520 7365 7420 6f66 2063 6f6d 706f  the set of compo
+000164d0: 6e65 6e74 206e 616d 6573 2077 6869 6368  nent names which
+000164e0: 2068 6176 6520 6265 656e 2074 7261 7665   have been trave
+000164f0: 7273 6564 2e20 5368 6f75 6c64 2061 6c77  rsed. Should alw
+00016500: 6179 7320 6265 204e 6f6e 652c 2065 7863  ays be None, exc
+00016510: 6570 7420 666f 7220 7265 6375 7273 6976  ept for recursiv
+00016520: 6520 696e 766f 6361 7469 6f6e 732e 0a20  e invocations.. 
+00016530: 2020 2022 2222 0a20 2020 2066 726f 6d20     """.    from 
+00016540: 6764 7366 6163 746f 7279 2e64 6563 6f72  gdsfactory.decor
+00016550: 6174 6f72 7320 696d 706f 7274 2069 735f  ators import is_
+00016560: 696e 7661 6c69 645f 7265 660a 0a20 2020  invalid_ref..   
+00016570: 2069 6e76 616c 6964 5f72 6566 7320 3d20   invalid_refs = 
+00016580: 5b5d 0a20 2020 2072 6566 7320 3d20 636f  [].    refs = co
+00016590: 6d70 6f6e 656e 742e 7265 6665 7265 6e63  mponent.referenc
+000165a0: 6573 0a20 2020 2073 7562 6365 6c6c 5f6d  es.    subcell_m
+000165b0: 6f64 6966 6965 6420 3d20 4661 6c73 650a  odified = False.
+000165c0: 2020 2020 6966 2075 7064 6174 6564 5f63      if updated_c
+000165d0: 6f6d 706f 6e65 6e74 7320 6973 204e 6f6e  omponents is Non
+000165e0: 653a 0a20 2020 2020 2020 2075 7064 6174  e:.        updat
+000165f0: 6564 5f63 6f6d 706f 6e65 6e74 7320 3d20  ed_components = 
+00016600: 7b7d 0a20 2020 2069 6620 7472 6176 6572  {}.    if traver
+00016610: 7365 645f 636f 6d70 6f6e 656e 7473 2069  sed_components i
+00016620: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00016630: 7472 6176 6572 7365 645f 636f 6d70 6f6e  traversed_compon
+00016640: 656e 7473 203d 2073 6574 2829 0a20 2020  ents = set().   
+00016650: 2066 6f72 2072 6566 2069 6e20 7265 6673   for ref in refs
+00016660: 3a0a 2020 2020 2020 2020 2320 6d61 726b  :.        # mark
+00016670: 2061 6e79 2069 6e76 616c 6964 2072 6566   any invalid ref
+00016680: 7320 666f 7220 666c 6174 7465 6e69 6e67  s for flattening
+00016690: 0a20 2020 2020 2020 2023 206f 7468 6572  .        # other
+000166a0: 7769 7365 2c20 6368 6563 6b20 6966 2074  wise, check if t
+000166b0: 6865 7265 2061 7265 2061 6e79 206d 6f64  here are any mod
+000166c0: 6966 6965 6420 6365 6c6c 7320 6265 6e65  ified cells bene
+000166d0: 6174 6820 2877 6520 6e65 6564 206e 6f74  ath (we need not
+000166e0: 2064 6f20 7468 6973 2069 6620 7468 6520   do this if the 
+000166f0: 7265 6620 7769 6c6c 2062 6520 666c 6174  ref will be flat
+00016700: 7465 6e65 6420 616e 7977 6179 7329 0a20  tened anyways). 
+00016710: 2020 2020 2020 2069 6620 6973 5f69 6e76         if is_inv
+00016720: 616c 6964 5f72 6566 2872 6566 2c20 6772  alid_ref(ref, gr
+00016730: 6964 5f73 697a 6529 3a0a 2020 2020 2020  id_size):.      
+00016740: 2020 2020 2020 696e 7661 6c69 645f 7265        invalid_re
+00016750: 6673 2e61 7070 656e 6428 7265 662e 6e61  fs.append(ref.na
+00016760: 6d65 290a 2020 2020 2020 2020 656c 7365  me).        else
+00016770: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00016780: 6f74 6865 7277 6973 652c 2072 6563 7572  otherwise, recur
+00016790: 7369 7665 6c79 2066 6c61 7474 656e 2072  sively flatten r
+000167a0: 6566 7320 6966 2074 6865 2073 7562 6365  efs if the subce
+000167b0: 6c6c 2068 6173 206e 6f74 2061 6c72 6561  ll has not alrea
+000167c0: 6479 2062 6565 6e20 7472 6176 6572 7365  dy been traverse
+000167d0: 640a 2020 2020 2020 2020 2020 2020 6966  d.            if
+000167e0: 2072 6566 2e70 6172 656e 742e 6e61 6d65   ref.parent.name
+000167f0: 206e 6f74 2069 6e20 7472 6176 6572 7365   not in traverse
+00016800: 645f 636f 6d70 6f6e 656e 7473 3a0a 2020  d_components:.  
+00016810: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+00016820: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
+00016830: 6673 5f72 6563 7572 7369 7665 280a 2020  fs_recursive(.  
+00016840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016850: 2020 7265 662e 7061 7265 6e74 2c0a 2020    ref.parent,.  
+00016860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016870: 2020 6772 6964 5f73 697a 653d 6772 6964    grid_size=grid
+00016880: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+00016890: 2020 2020 2020 2020 2020 2075 7064 6174             updat
+000168a0: 6564 5f63 6f6d 706f 6e65 6e74 733d 7570  ed_components=up
+000168b0: 6461 7465 645f 636f 6d70 6f6e 656e 7473  dated_components
+000168c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000168d0: 2020 2020 2020 7472 6176 6572 7365 645f        traversed_
+000168e0: 636f 6d70 6f6e 656e 7473 3d74 7261 7665  components=trave
+000168f0: 7273 6564 5f63 6f6d 706f 6e65 6e74 732c  rsed_components,
+00016900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016910: 2029 0a20 2020 2020 2020 2020 2020 2023   ).            #
+00016920: 206e 6f77 2c20 6966 2074 6865 2072 6566   now, if the ref
+00016930: 2773 2063 656c 6c20 6265 656e 206d 6f64  's cell been mod
+00016940: 6966 6965 642c 206d 6172 6b20 6974 2061  ified, mark it a
+00016950: 7320 7375 6368 0a20 2020 2020 2020 2020  s such.         
+00016960: 2020 2069 6620 7265 662e 7061 7265 6e74     if ref.parent
+00016970: 2e6e 616d 6520 696e 2075 7064 6174 6564  .name in updated
+00016980: 5f63 6f6d 706f 6e65 6e74 733a 0a20 2020  _components:.   
+00016990: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+000169a0: 6365 6c6c 5f6d 6f64 6966 6965 6420 3d20  cell_modified = 
+000169b0: 5472 7565 0a20 2020 2069 6620 696e 7661  True.    if inva
+000169c0: 6c69 645f 7265 6673 206f 7220 7375 6263  lid_refs or subc
+000169d0: 656c 6c5f 6d6f 6469 6669 6564 3a0a 2020  ell_modified:.  
+000169e0: 2020 2020 2020 6e65 775f 636f 6d70 6f6e        new_compon
+000169f0: 656e 7420 3d20 636f 6d70 6f6e 656e 742e  ent = component.
+00016a00: 636f 7079 2829 0a20 2020 2020 2020 206e  copy().        n
+00016a10: 6577 5f63 6f6d 706f 6e65 6e74 2e6e 616d  ew_component.nam
+00016a20: 6520 3d20 636f 6d70 6f6e 656e 742e 6e61  e = component.na
+00016a30: 6d65 0a20 2020 2020 2020 2023 206d 616b  me.        # mak
+00016a40: 6520 7375 7265 2061 6c6c 206d 6f64 6966  e sure all modif
+00016a50: 6965 6420 6365 6c6c 7320 6861 7665 2074  ied cells have t
+00016a60: 6865 6972 2072 6566 6572 656e 6365 7320  heir references 
+00016a70: 7570 6461 7465 640a 2020 2020 2020 2020  updated.        
+00016a80: 6e65 775f 7265 6673 203d 206e 6577 5f63  new_refs = new_c
+00016a90: 6f6d 706f 6e65 6e74 2e72 6566 6572 656e  omponent.referen
+00016aa0: 6365 732e 636f 7079 2829 0a20 2020 2020  ces.copy().     
+00016ab0: 2020 2066 6f72 2072 6566 2069 6e20 6e65     for ref in ne
+00016ac0: 775f 7265 6673 3a0a 2020 2020 2020 2020  w_refs:.        
+00016ad0: 2020 2020 6966 2072 6566 2e6e 616d 6520      if ref.name 
+00016ae0: 696e 2069 6e76 616c 6964 5f72 6566 733a  in invalid_refs:
+00016af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016b00: 206e 6577 5f63 6f6d 706f 6e65 6e74 2e66   new_component.f
+00016b10: 6c61 7474 656e 5f72 6566 6572 656e 6365  latten_reference
+00016b20: 2872 6566 290a 2020 2020 2020 2020 2020  (ref).          
+00016b30: 2020 656c 6966 2028 0a20 2020 2020 2020    elif (.       
+00016b40: 2020 2020 2020 2020 2072 6566 2e70 6172           ref.par
+00016b50: 656e 742e 6e61 6d65 2069 6e20 7570 6461  ent.name in upda
+00016b60: 7465 645f 636f 6d70 6f6e 656e 7473 0a20  ted_components. 
+00016b70: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00016b80: 6e64 2072 6566 2e70 6172 656e 7420 6973  nd ref.parent is
+00016b90: 206e 6f74 2075 7064 6174 6564 5f63 6f6d   not updated_com
+00016ba0: 706f 6e65 6e74 735b 7265 662e 7061 7265  ponents[ref.pare
+00016bb0: 6e74 2e6e 616d 655d 0a20 2020 2020 2020  nt.name].       
+00016bc0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00016bd0: 2020 2020 2020 2020 7265 662e 7061 7265          ref.pare
+00016be0: 6e74 203d 2075 7064 6174 6564 5f63 6f6d  nt = updated_com
+00016bf0: 706f 6e65 6e74 735b 7265 662e 7061 7265  ponents[ref.pare
+00016c00: 6e74 2e6e 616d 655d 0a20 2020 2020 2020  nt.name].       
+00016c10: 2063 6f6d 706f 6e65 6e74 203d 206e 6577   component = new
+00016c20: 5f63 6f6d 706f 6e65 6e74 0a20 2020 2020  _component.     
+00016c30: 2020 2075 7064 6174 6564 5f63 6f6d 706f     updated_compo
+00016c40: 6e65 6e74 735b 636f 6d70 6f6e 656e 742e  nents[component.
+00016c50: 6e61 6d65 5d20 3d20 6e65 775f 636f 6d70  name] = new_comp
+00016c60: 6f6e 656e 740a 2020 2020 7472 6176 6572  onent.    traver
+00016c70: 7365 645f 636f 6d70 6f6e 656e 7473 2e61  sed_components.a
+00016c80: 6464 2863 6f6d 706f 6e65 6e74 2e6e 616d  dd(component.nam
+00016c90: 6529 0a20 2020 2072 6574 7572 6e20 636f  e).    return co
+00016ca0: 6d70 6f6e 656e 740a 0a0a 6465 6620 5f63  mponent...def _c
+00016cb0: 6865 636b 5f75 6e63 6163 6865 645f 636f  heck_uncached_co
+00016cc0: 6d70 6f6e 656e 7473 2863 6f6d 706f 6e65  mponents(compone
+00016cd0: 6e74 2c20 6d6f 6465 293a 0a20 2020 2076  nt, mode):.    v
+00016ce0: 616c 6964 5f6d 6f64 6573 203d 205b 2277  alid_modes = ["w
+00016cf0: 6172 6e22 2c20 2265 7272 6f72 222c 2022  arn", "error", "
+00016d00: 6967 6e6f 7265 225d 0a0a 2020 2020 6966  ignore"]..    if
+00016d10: 206d 6f64 6520 3d3d 2022 6967 6e6f 7265   mode == "ignore
+00016d20: 223a 0a20 2020 2020 2020 2072 6574 7572  ":.        retur
+00016d30: 6e0a 2020 2020 656c 6966 206d 6f64 6520  n.    elif mode 
+00016d40: 6e6f 7420 696e 2076 616c 6964 5f6d 6f64  not in valid_mod
+00016d50: 6573 3a0a 2020 2020 2020 2020 7261 6973  es:.        rais
+00016d60: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00016d70: 2020 2020 2020 2020 2020 6622 7b6d 6f64            f"{mod
+00016d80: 657d 2069 7320 6e6f 7420 6120 7661 6c69  e} is not a vali
+00016d90: 6420 7661 6c75 6520 666f 7220 6f6e 5f75  d value for on_u
+00016da0: 6e63 6163 6865 645f 636f 6d70 6f6e 656e  ncached_componen
+00016db0: 742e 2054 7279 206f 6e65 206f 6620 7468  t. Try one of th
+00016dc0: 6573 653a 207b 7661 6c69 645f 6d6f 6465  ese: {valid_mode
+00016dd0: 737d 2e22 0a20 2020 2020 2020 2029 0a0a  s}.".        )..
+00016de0: 2020 2020 666f 7220 7375 625f 636f 6d70      for sub_comp
+00016df0: 6f6e 656e 7420 696e 2063 6f6d 706f 6e65  onent in compone
+00016e00: 6e74 2e67 6574 5f64 6570 656e 6465 6e63  nt.get_dependenc
+00016e10: 6965 7328 7265 6375 7273 6976 653d 5472  ies(recursive=Tr
+00016e20: 7565 293a 0a20 2020 2020 2020 2069 6620  ue):.        if 
+00016e30: 6e6f 7420 7375 625f 636f 6d70 6f6e 656e  not sub_componen
+00016e40: 742e 5f6c 6f63 6b65 643a 0a20 2020 2020  t._locked:.     
+00016e50: 2020 2020 2020 206d 6573 7361 6765 203d         message =
+00016e60: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00016e70: 2020 2066 2243 6f6d 706f 6e65 6e74 207b     f"Component {
+00016e80: 7375 625f 636f 6d70 6f6e 656e 742e 6e61  sub_component.na
+00016e90: 6d65 2172 7d20 7761 7320 4e4f 5420 7072  me!r} was NOT pr
+00016ea0: 6f70 6572 6c79 206c 6f63 6b65 642e 2022  operly locked. "
+00016eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ec0: 2022 596f 7520 6e65 6564 2074 6f20 7772   "You need to wr
+00016ed0: 6974 6520 6974 2069 6e74 6f20 6120 6675  ite it into a fu
+00016ee0: 6e63 7469 6f6e 2074 6861 7420 6861 7320  nction that has 
+00016ef0: 7468 6520 4063 656c 6c20 6465 636f 7261  the @cell decora
+00016f00: 746f 722e 220a 2020 2020 2020 2020 2020  tor.".          
+00016f10: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00016f20: 6966 206d 6f64 6520 3d3d 2022 7761 726e  if mode == "warn
+00016f30: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00016f40: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
+00016f50: 286d 6573 7361 6765 2c20 556e 6361 6368  (message, Uncach
+00016f60: 6564 436f 6d70 6f6e 656e 7457 6172 6e69  edComponentWarni
+00016f70: 6e67 290a 0a20 2020 2020 2020 2020 2020  ng)..           
+00016f80: 2065 6c69 6620 6d6f 6465 203d 3d20 2265   elif mode == "e
+00016f90: 7272 6f72 223a 0a20 2020 2020 2020 2020  rror":.         
+00016fa0: 2020 2020 2020 2072 6169 7365 2055 6e63         raise Unc
+00016fb0: 6163 6865 6443 6f6d 706f 6e65 6e74 4572  achedComponentEr
+00016fc0: 726f 7228 6d65 7373 6167 6529 0a0a 0a64  ror(message)...d
+00016fd0: 6566 2074 6573 745f 7361 6d65 5f75 6964  ef test_same_uid
+00016fe0: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+00016ff0: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+00017000: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
+00017010: 2043 6f6d 706f 6e65 6e74 2829 0a20 2020   Component().   
+00017020: 2063 203c 3c20 6766 2e63 6f6d 706f 6e65   c << gf.compone
+00017030: 6e74 732e 7265 6374 616e 676c 6528 290a  nts.rectangle().
+00017040: 2020 2020 6320 3c3c 2067 662e 636f 6d70      c << gf.comp
+00017050: 6f6e 656e 7473 2e72 6563 7461 6e67 6c65  onents.rectangle
+00017060: 2829 0a0a 2020 2020 7231 203d 2063 2e72  ()..    r1 = c.r
+00017070: 6566 6572 656e 6365 735b 305d 2e70 6172  eferences[0].par
+00017080: 656e 740a 2020 2020 7232 203d 2063 2e72  ent.    r2 = c.r
+00017090: 6566 6572 656e 6365 735b 315d 2e70 6172  eferences[1].par
+000170a0: 656e 740a 0a20 2020 2061 7373 6572 7420  ent..    assert 
+000170b0: 7231 2e75 6964 203d 3d20 7232 2e75 6964  r1.uid == r2.uid
+000170c0: 2c20 6622 7b72 312e 7569 647d 206d 7573  , f"{r1.uid} mus
+000170d0: 7420 6571 7561 6c20 7b72 322e 7569 647d  t equal {r2.uid}
+000170e0: 220a 0a0a 6465 6620 7465 7374 5f6e 6574  "...def test_net
+000170f0: 6c69 7374 5f73 696d 706c 6528 2920 2d3e  list_simple() ->
+00017100: 204e 6f6e 653a 0a20 2020 2069 6d70 6f72   None:.    impor
+00017110: 7420 6764 7366 6163 746f 7279 2061 7320  t gdsfactory as 
+00017120: 6766 0a0a 2020 2020 6320 3d20 6766 2e43  gf..    c = gf.C
+00017130: 6f6d 706f 6e65 6e74 2829 0a20 2020 2063  omponent().    c
+00017140: 3120 3d20 6320 3c3c 2067 662e 636f 6d70  1 = c << gf.comp
+00017150: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
+00017160: 6c65 6e67 7468 3d31 2c20 7769 6474 683d  length=1, width=
+00017170: 3229 0a20 2020 2063 3220 3d20 6320 3c3c  2).    c2 = c <<
+00017180: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+00017190: 7472 6169 6768 7428 6c65 6e67 7468 3d32  traight(length=2
+000171a0: 2c20 7769 6474 683d 3229 0a20 2020 2063  , width=2).    c
+000171b0: 322e 636f 6e6e 6563 7428 706f 7274 3d22  2.connect(port="
+000171c0: 6f31 222c 2064 6573 7469 6e61 7469 6f6e  o1", destination
+000171d0: 3d63 312e 706f 7274 735b 226f 3222 5d29  =c1.ports["o2"])
+000171e0: 0a20 2020 2063 2e61 6464 5f70 6f72 7428  .    c.add_port(
+000171f0: 226f 3122 2c20 706f 7274 3d63 312e 706f  "o1", port=c1.po
+00017200: 7274 735b 226f 3122 5d29 0a20 2020 2063  rts["o1"]).    c
+00017210: 2e61 6464 5f70 6f72 7428 226f 3222 2c20  .add_port("o2", 
+00017220: 706f 7274 3d63 322e 706f 7274 735b 226f  port=c2.ports["o
+00017230: 3222 5d29 0a20 2020 206e 6574 6c69 7374  2"]).    netlist
+00017240: 203d 2063 2e67 6574 5f6e 6574 6c69 7374   = c.get_netlist
+00017250: 2829 0a20 2020 2023 2070 7269 6e74 286e  ().    # print(n
+00017260: 6574 6c69 7374 2e70 7265 7474 7928 2929  etlist.pretty())
+00017270: 0a20 2020 2061 7373 6572 7420 6c65 6e28  .    assert len(
+00017280: 6e65 746c 6973 745b 2269 6e73 7461 6e63  netlist["instanc
+00017290: 6573 225d 2920 3d3d 2032 0a0a 0a64 6566  es"]) == 2...def
+000172a0: 2074 6573 745f 6e65 746c 6973 745f 7369   test_netlist_si
+000172b0: 6d70 6c65 5f77 6964 7468 5f6d 6973 6d61  mple_width_misma
+000172c0: 7463 685f 7468 726f 7773 5f65 7272 6f72  tch_throws_error
+000172d0: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+000172e0: 696d 706f 7274 2070 7974 6573 740a 0a20  import pytest.. 
+000172f0: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+00017300: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+00017310: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
+00017320: 2829 0a20 2020 2063 3120 3d20 6320 3c3c  ().    c1 = c <<
+00017330: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+00017340: 7472 6169 6768 7428 6c65 6e67 7468 3d31  traight(length=1
+00017350: 2c20 7769 6474 683d 3129 0a20 2020 2063  , width=1).    c
+00017360: 3220 3d20 6320 3c3c 2067 662e 636f 6d70  2 = c << gf.comp
+00017370: 6f6e 656e 7473 2e73 7472 6169 6768 7428  onents.straight(
+00017380: 6c65 6e67 7468 3d32 2c20 7769 6474 683d  length=2, width=
+00017390: 3229 0a20 2020 2063 322e 636f 6e6e 6563  2).    c2.connec
+000173a0: 7428 706f 7274 3d22 6f31 222c 2064 6573  t(port="o1", des
+000173b0: 7469 6e61 7469 6f6e 3d63 312e 706f 7274  tination=c1.port
+000173c0: 735b 226f 3222 5d29 0a20 2020 2063 2e61  s["o2"]).    c.a
+000173d0: 6464 5f70 6f72 7428 226f 3122 2c20 706f  dd_port("o1", po
+000173e0: 7274 3d63 312e 706f 7274 735b 226f 3122  rt=c1.ports["o1"
+000173f0: 5d29 0a20 2020 2063 2e61 6464 5f70 6f72  ]).    c.add_por
+00017400: 7428 226f 3222 2c20 706f 7274 3d63 322e  t("o2", port=c2.
+00017410: 706f 7274 735b 226f 3222 5d29 0a20 2020  ports["o2"]).   
+00017420: 2077 6974 6820 7079 7465 7374 2e72 6169   with pytest.rai
+00017430: 7365 7328 5661 6c75 6545 7272 6f72 293a  ses(ValueError):
+00017440: 0a20 2020 2020 2020 2063 2e67 6574 5f6e  .        c.get_n
+00017450: 6574 6c69 7374 2829 0a0a 0a64 6566 2074  etlist()...def t
+00017460: 6573 745f 6e65 746c 6973 745f 636f 6d70  est_netlist_comp
+00017470: 6c65 7828 2920 2d3e 204e 6f6e 653a 0a20  lex() -> None:. 
+00017480: 2020 2069 6d70 6f72 7420 6764 7366 6163     import gdsfac
+00017490: 746f 7279 2061 7320 6766 0a0a 2020 2020  tory as gf..    
+000174a0: 6320 3d20 6766 2e63 6f6d 706f 6e65 6e74  c = gf.component
+000174b0: 732e 6d7a 695f 6172 6d73 2829 0a20 2020  s.mzi_arms().   
+000174c0: 206e 6574 6c69 7374 203d 2063 2e67 6574   netlist = c.get
+000174d0: 5f6e 6574 6c69 7374 2829 0a20 2020 2023  _netlist().    #
+000174e0: 2070 7269 6e74 286e 6574 6c69 7374 2e70   print(netlist.p
+000174f0: 7265 7474 7928 2929 0a20 2020 2061 7373  retty()).    ass
+00017500: 6572 7420 6c65 6e28 6e65 746c 6973 745b  ert len(netlist[
+00017510: 2269 6e73 7461 6e63 6573 225d 2920 3d3d  "instances"]) ==
+00017520: 2034 2c20 6c65 6e28 6e65 746c 6973 745b   4, len(netlist[
+00017530: 2269 6e73 7461 6e63 6573 225d 290a 0a0a  "instances"])...
+00017540: 6465 6620 7465 7374 5f65 7874 7261 6374  def test_extract
+00017550: 2829 202d 3e20 436f 6d70 6f6e 656e 743a  () -> Component:
+00017560: 0a20 2020 2069 6d70 6f72 7420 6764 7366  .    import gdsf
+00017570: 6163 746f 7279 2061 7320 6766 0a0a 2020  actory as gf..  
+00017580: 2020 6320 3d20 6766 2e63 6f6d 706f 6e65    c = gf.compone
+00017590: 6e74 732e 7374 7261 6967 6874 280a 2020  nts.straight(.  
+000175a0: 2020 2020 2020 6c65 6e67 7468 3d31 302c        length=10,
+000175b0: 0a20 2020 2020 2020 2077 6964 7468 3d30  .        width=0
+000175c0: 2e35 2c0a 2020 2020 2020 2020 6262 6f78  .5,.        bbox
+000175d0: 5f6c 6179 6572 733d 5b67 662e 4c41 5945  _layers=[gf.LAYE
+000175e0: 522e 5747 434c 4144 5d2c 0a20 2020 2020  R.WGCLAD],.     
+000175f0: 2020 2062 626f 785f 6f66 6673 6574 733d     bbox_offsets=
+00017600: 5b33 5d2c 0a20 2020 2020 2020 2077 6974  [3],.        wit
+00017610: 685f 6262 6f78 3d54 7275 652c 0a20 2020  h_bbox=True,.   
+00017620: 2020 2020 2063 6c61 6464 696e 675f 6c61       cladding_la
+00017630: 7965 7273 3d4e 6f6e 652c 0a20 2020 2020  yers=None,.     
+00017640: 2020 2061 6464 5f70 696e 733d 4e6f 6e65     add_pins=None
+00017650: 2c0a 2020 2020 2020 2020 6164 645f 6262  ,.        add_bb
+00017660: 6f78 3d4e 6f6e 652c 0a20 2020 2029 0a20  ox=None,.    ). 
+00017670: 2020 2063 3220 3d20 632e 6578 7472 6163     c2 = c.extrac
+00017680: 7428 6c61 7965 7273 3d5b 6766 2e4c 4159  t(layers=[gf.LAY
+00017690: 4552 2e57 4743 4c41 445d 290a 0a20 2020  ER.WGCLAD])..   
+000176a0: 2061 7373 6572 7420 6c65 6e28 632e 706f   assert len(c.po
+000176b0: 6c79 676f 6e73 2920 3d3d 2032 2c20 6c65  lygons) == 2, le
+000176c0: 6e28 632e 706f 6c79 676f 6e73 290a 2020  n(c.polygons).  
+000176d0: 2020 6173 7365 7274 206c 656e 2863 322e    assert len(c2.
+000176e0: 706f 6c79 676f 6e73 2920 3d3d 2031 2c20  polygons) == 1, 
+000176f0: 6c65 6e28 6332 2e70 6f6c 7967 6f6e 7329  len(c2.polygons)
+00017700: 0a20 2020 2061 7373 6572 7420 6766 2e4c  .    assert gf.L
+00017710: 4159 4552 2e57 4743 4c41 4420 696e 2063  AYER.WGCLAD in c
+00017720: 322e 6c61 7965 7273 0a20 2020 2072 6574  2.layers.    ret
+00017730: 7572 6e20 6332 0a0a 0a64 6566 2068 6173  urn c2...def has
+00017740: 685f 6669 6c65 2866 696c 6570 6174 6829  h_file(filepath)
+00017750: 3a0a 2020 2020 6d64 3520 3d20 6861 7368  :.    md5 = hash
+00017760: 6c69 622e 6d64 3528 290a 2020 2020 6d64  lib.md5().    md
+00017770: 352e 7570 6461 7465 2866 696c 6570 6174  5.update(filepat
+00017780: 682e 7265 6164 5f62 7974 6573 2829 290a  h.read_bytes()).
+00017790: 2020 2020 7265 7475 726e 206d 6435 2e68      return md5.h
+000177a0: 6578 6469 6765 7374 2829 0a0a 0a64 6566  exdigest()...def
+000177b0: 2074 6573 745f 6262 6f78 5f72 6566 6572   test_bbox_refer
+000177c0: 656e 6365 2829 202d 3e20 436f 6d70 6f6e  ence() -> Compon
+000177d0: 656e 743a 0a20 2020 2069 6d70 6f72 7420  ent:.    import 
+000177e0: 6764 7366 6163 746f 7279 2061 7320 6766  gdsfactory as gf
+000177f0: 0a0a 2020 2020 6320 3d20 6766 2e43 6f6d  ..    c = gf.Com
+00017800: 706f 6e65 6e74 2822 636f 6d70 6f6e 656e  ponent("componen
+00017810: 745f 7769 7468 5f6f 6666 6772 6964 5f70  t_with_offgrid_p
+00017820: 6f6c 7967 6f6e 7322 290a 2020 2020 6331  olygons").    c1
+00017830: 203d 2063 203c 3c20 6766 2e63 6f6d 706f   = c << gf.compo
+00017840: 6e65 6e74 732e 7265 6374 616e 676c 6528  nents.rectangle(
+00017850: 7369 7a65 3d28 312e 3565 2d33 2c20 312e  size=(1.5e-3, 1.
+00017860: 3565 2d33 292c 2070 6f72 745f 7479 7065  5e-3), port_type
+00017870: 3d4e 6f6e 6529 0a20 2020 2063 3220 3d20  =None).    c2 = 
+00017880: 6320 3c3c 2067 662e 636f 6d70 6f6e 656e  c << gf.componen
+00017890: 7473 2e72 6563 7461 6e67 6c65 2873 697a  ts.rectangle(siz
+000178a0: 653d 2831 2e35 652d 332c 2031 2e35 652d  e=(1.5e-3, 1.5e-
+000178b0: 3329 2c20 706f 7274 5f74 7970 653d 4e6f  3), port_type=No
+000178c0: 6e65 290a 2020 2020 6332 2e78 6d69 6e20  ne).    c2.xmin 
+000178d0: 3d20 6331 2e78 6d61 780a 0a20 2020 2061  = c1.xmax..    a
+000178e0: 7373 6572 7420 6332 2e78 7369 7a65 203d  ssert c2.xsize =
+000178f0: 3d20 3265 2d33 0a20 2020 2072 6574 7572  = 2e-3.    retur
+00017900: 6e20 6332 0a0a 0a64 6566 2074 6573 745f  n c2...def test_
+00017910: 6262 6f78 5f63 6f6d 706f 6e65 6e74 2829  bbox_component()
+00017920: 202d 3e20 4e6f 6e65 3a0a 2020 2020 696d   -> None:.    im
+00017930: 706f 7274 2067 6473 6661 6374 6f72 7920  port gdsfactory 
+00017940: 6173 2067 660a 0a20 2020 2063 203d 2067  as gf..    c = g
+00017950: 662e 636f 6d70 6f6e 656e 7473 2e72 6563  f.components.rec
+00017960: 7461 6e67 6c65 2873 697a 653d 2831 2e35  tangle(size=(1.5
+00017970: 652d 332c 2031 2e35 652d 3329 2c20 706f  e-3, 1.5e-3), po
+00017980: 7274 5f74 7970 653d 4e6f 6e65 290a 2020  rt_type=None).  
+00017990: 2020 6173 7365 7274 2063 2e78 7369 7a65    assert c.xsize
+000179a0: 203d 3d20 3265 2d33 0a0a 0a64 6566 2074   == 2e-3...def t
+000179b0: 6573 745f 7265 6d61 705f 6c61 7965 7273  est_remap_layers
+000179c0: 2829 202d 3e20 4e6f 6e65 3a0a 2020 2020  () -> None:.    
+000179d0: 696d 706f 7274 2067 6473 6661 6374 6f72  import gdsfactor
+000179e0: 7920 6173 2067 660a 0a20 2020 2063 203d  y as gf..    c =
+000179f0: 2067 662e 636f 6d70 6f6e 656e 7473 2e73   gf.components.s
+00017a00: 7472 6169 6768 7428 6c61 7965 723d 2832  traight(layer=(2
+00017a10: 2c20 3029 290a 2020 2020 7265 6d61 7020  , 0)).    remap 
+00017a20: 3d20 632e 7265 6d61 705f 6c61 7965 7273  = c.remap_layers
+00017a30: 286c 6179 6572 6d61 703d 7b28 322c 2030  (layermap={(2, 0
+00017a40: 293a 2067 662e 4c41 5945 522e 5747 4e7d  ): gf.LAYER.WGN}
+00017a50: 290a 2020 2020 6861 7368 5f67 656f 6d65  ).    hash_geome
+00017a60: 7472 7920 3d20 2238 3366 6263 3661 3832  try = "83fbc6a82
+00017a70: 3839 3530 3565 6165 6433 6132 6533 6162  89505eaed3a2e3ab
+00017a80: 3237 3963 6330 3366 3565 3464 3030 6322  279cc03f5e4d00c"
+00017a90: 0a0a 2020 2020 6173 7365 7274 2028 0a20  ..    assert (. 
+00017aa0: 2020 2020 2020 2072 656d 6170 2e68 6173         remap.has
+00017ab0: 685f 6765 6f6d 6574 7279 2829 203d 3d20  h_geometry() == 
+00017ac0: 6861 7368 5f67 656f 6d65 7472 790a 2020  hash_geometry.  
+00017ad0: 2020 292c 2066 2268 6173 685f 6765 6f6d    ), f"hash_geom
+00017ae0: 6574 7279 203d 207b 7265 6d61 702e 6861  etry = {remap.ha
+00017af0: 7368 5f67 656f 6d65 7472 7928 2921 727d  sh_geometry()!r}
+00017b00: 220a 0a0a 6465 6620 7465 7374 5f72 656d  "...def test_rem
+00017b10: 6f76 655f 6c61 6265 6c73 2829 202d 3e20  ove_labels() -> 
+00017b20: 4e6f 6e65 3a0a 2020 2020 696d 706f 7274  None:.    import
+00017b30: 2067 6473 6661 6374 6f72 7920 6173 2067   gdsfactory as g
+00017b40: 660a 0a20 2020 2063 203d 2067 662e 632e  f..    c = gf.c.
+00017b50: 7374 7261 6967 6874 2829 0a20 2020 2063  straight().    c
+00017b60: 2e72 656d 6f76 655f 6c61 6265 6c73 2829  .remove_labels()
+00017b70: 0a0a 2020 2020 6173 7365 7274 206c 656e  ..    assert len
+00017b80: 2863 2e6c 6162 656c 7329 203d 3d20 300a  (c.labels) == 0.
+00017b90: 0a0a 6465 6620 7465 7374 5f69 6d70 6f72  ..def test_impor
+00017ba0: 745f 6764 735f 7365 7474 696e 6773 2829  t_gds_settings()
+00017bb0: 3a0a 2020 2020 696d 706f 7274 2067 6473  :.    import gds
+00017bc0: 6661 6374 6f72 7920 6173 2067 660a 0a20  factory as gf.. 
+00017bd0: 2020 2063 203d 2067 662e 636f 6d70 6f6e     c = gf.compon
+00017be0: 656e 7473 2e6d 7a69 2829 0a20 2020 2067  ents.mzi().    g
+00017bf0: 6473 7061 7468 203d 2063 2e77 7269 7465  dspath = c.write
+00017c00: 5f67 6473 5f77 6974 685f 6d65 7461 6461  _gds_with_metada
+00017c10: 7461 2829 0a20 2020 2063 3220 3d20 6766  ta().    c2 = gf
+00017c20: 2e69 6d70 6f72 745f 6764 7328 6764 7370  .import_gds(gdsp
+00017c30: 6174 682c 206e 616d 653d 226d 7a69 5f73  ath, name="mzi_s
+00017c40: 616d 706c 6522 2c20 7265 6164 5f6d 6574  ample", read_met
+00017c50: 6164 6174 613d 5472 7565 290a 2020 2020  adata=True).    
+00017c60: 6333 203d 2067 662e 726f 7574 696e 672e  c3 = gf.routing.
+00017c70: 6164 645f 6669 6265 725f 7369 6e67 6c65  add_fiber_single
+00017c80: 2863 3229 0a20 2020 2061 7373 6572 7420  (c2).    assert 
+00017c90: 6333 0a0a 0a64 6566 2074 6573 745f 666c  c3...def test_fl
+00017ca0: 6174 7465 6e5f 696e 7661 6c69 645f 7265  atten_invalid_re
+00017cb0: 6673 5f72 6563 7572 7369 7665 2829 3a0a  fs_recursive():.
+00017cc0: 2020 2020 696d 706f 7274 2067 6473 6661      import gdsfa
+00017cd0: 6374 6f72 7920 6173 2067 660a 2020 2020  ctory as gf.    
+00017ce0: 6672 6f6d 2067 6473 6661 6374 6f72 792e  from gdsfactory.
+00017cf0: 6469 6666 7465 7374 2069 6d70 6f72 7420  difftest import 
+00017d00: 7275 6e5f 786f 720a 2020 2020 6672 6f6d  run_xor.    from
+00017d10: 2067 6473 6661 6374 6f72 792e 726f 7574   gdsfactory.rout
+00017d20: 696e 672e 616c 6c5f 616e 676c 6520 696d  ing.all_angle im
+00017d30: 706f 7274 2067 6574 5f62 756e 646c 655f  port get_bundle_
+00017d40: 616c 6c5f 616e 676c 650a 0a20 2020 2040  all_angle..    @
+00017d50: 6766 2e63 656c 6c0a 2020 2020 6465 6620  gf.cell.    def 
+00017d60: 666c 6174 2829 3a0a 2020 2020 2020 2020  flat():.        
+00017d70: 6320 3d20 6766 2e43 6f6d 706f 6e65 6e74  c = gf.Component
+00017d80: 2829 0a20 2020 2020 2020 206d 6d69 3120  ().        mmi1 
+00017d90: 3d20 2863 203c 3c20 6766 2e63 6f6d 706f  = (c << gf.compo
+00017da0: 6e65 6e74 732e 6d6d 6931 7832 2829 292e  nents.mmi1x2()).
+00017db0: 6d6f 7665 2828 302c 202d 312e 3030 3035  move((0, -1.0005
+00017dc0: 2929 0a20 2020 2020 2020 206d 6d69 3220  )).        mmi2 
+00017dd0: 3d20 2863 203c 3c20 6766 2e63 6f6d 706f  = (c << gf.compo
+00017de0: 6e65 6e74 732e 6d6d 6931 7832 2829 292e  nents.mmi1x2()).
+00017df0: 726f 7461 7465 2838 3029 0a20 2020 2020  rotate(80).     
+00017e00: 2020 206d 6d69 322e 6d6f 7665 2828 3430     mmi2.move((40
+00017e10: 2c20 3230 2929 0a20 2020 2020 2020 2062  , 20)).        b
+00017e20: 756e 646c 6520 3d20 6765 745f 6275 6e64  undle = get_bund
+00017e30: 6c65 5f61 6c6c 5f61 6e67 6c65 285b 6d6d  le_all_angle([mm
+00017e40: 6931 2e70 6f72 7473 5b22 6f32 225d 5d2c  i1.ports["o2"]],
+00017e50: 205b 6d6d 6932 2e70 6f72 7473 5b22 6f31   [mmi2.ports["o1
+00017e60: 225d 5d29 0a20 2020 2020 2020 2066 6f72  "]]).        for
+00017e70: 2072 6f75 7465 2069 6e20 6275 6e64 6c65   route in bundle
+00017e80: 3a0a 2020 2020 2020 2020 2020 2020 632e  :.            c.
+00017e90: 6164 6428 726f 7574 652e 7265 6665 7265  add(route.refere
+00017ea0: 6e63 6573 290a 2020 2020 2020 2020 7265  nces).        re
+00017eb0: 7475 726e 2063 0a0a 2020 2020 4067 662e  turn c..    @gf.
+00017ec0: 6365 6c6c 0a20 2020 2064 6566 2068 6965  cell.    def hie
+00017ed0: 7261 7263 6879 2829 3a0a 2020 2020 2020  rarchy():.      
+00017ee0: 2020 6320 3d20 6766 2e43 6f6d 706f 6e65    c = gf.Compone
+00017ef0: 6e74 2829 0a20 2020 2020 2020 2028 6320  nt().        (c 
+00017f00: 3c3c 2066 6c61 7428 2929 2e72 6f74 6174  << flat()).rotat
+00017f10: 6528 3333 290a 2020 2020 2020 2020 2863  e(33).        (c
+00017f20: 203c 3c20 666c 6174 2829 292e 726f 7461   << flat()).rota
+00017f30: 7465 2833 3329 2e6d 6f76 6528 2830 2c20  te(33).move((0, 
+00017f40: 3130 3029 290a 2020 2020 2020 2020 2863  100)).        (c
+00017f50: 203c 3c20 666c 6174 2829 292e 6d6f 7665   << flat()).move
+00017f60: 2828 3130 302c 2030 2929 0a20 2020 2020  ((100, 0)).     
+00017f70: 2020 2072 6574 7572 6e20 630a 0a20 2020     return c..   
+00017f80: 2063 5f6f 7269 6720 3d20 6869 6572 6172   c_orig = hierar
+00017f90: 6368 7928 290a 2020 2020 635f 6e65 7720  chy().    c_new 
+00017fa0: 3d20 666c 6174 7465 6e5f 696e 7661 6c69  = flatten_invali
+00017fb0: 645f 7265 6673 5f72 6563 7572 7369 7665  d_refs_recursive
+00017fc0: 2863 5f6f 7269 6729 0a20 2020 2061 7373  (c_orig).    ass
+00017fd0: 6572 7420 635f 6e65 7720 6973 206e 6f74  ert c_new is not
+00017fe0: 2063 5f6f 7269 670a 2020 2020 696e 7661   c_orig.    inva
+00017ff0: 6c69 645f 7265 6673 5f66 696c 656e 616d  lid_refs_filenam
+00018000: 6520 3d20 2269 6e76 616c 6964 5f72 6566  e = "invalid_ref
+00018010: 732e 6764 7322 0a20 2020 2069 6e76 616c  s.gds".    inval
+00018020: 6964 5f72 6566 735f 6669 7865 645f 6669  id_refs_fixed_fi
+00018030: 6c65 6e61 6d65 203d 2022 696e 7661 6c69  lename = "invali
+00018040: 645f 7265 6673 5f66 6978 6564 2e67 6473  d_refs_fixed.gds
+00018050: 220a 2020 2020 2320 6764 7320 6669 6c65  ".    # gds file
+00018060: 7320 7368 6f75 6c64 2073 7469 6c6c 2062  s should still b
+00018070: 6520 7361 6d65 2074 6f20 316e 6d20 746f  e same to 1nm to
+00018080: 6c65 7261 6e63 650a 2020 2020 635f 6f72  lerance.    c_or
+00018090: 6967 2e77 7269 7465 5f67 6473 2869 6e76  ig.write_gds(inv
+000180a0: 616c 6964 5f72 6566 735f 6669 6c65 6e61  alid_refs_filena
+000180b0: 6d65 290a 2020 2020 635f 6e65 772e 7772  me).    c_new.wr
+000180c0: 6974 655f 6764 7328 696e 7661 6c69 645f  ite_gds(invalid_
+000180d0: 7265 6673 5f66 6978 6564 5f66 696c 656e  refs_fixed_filen
+000180e0: 616d 6529 0a20 2020 2072 756e 5f78 6f72  ame).    run_xor
+000180f0: 2869 6e76 616c 6964 5f72 6566 735f 6669  (invalid_refs_fi
+00018100: 6c65 6e61 6d65 2c20 696e 7661 6c69 645f  lename, invalid_
+00018110: 7265 6673 5f66 6978 6564 5f66 696c 656e  refs_fixed_filen
+00018120: 616d 6529 0a0a 0a69 6620 5f5f 6e61 6d65  ame)...if __name
+00018130: 5f5f 203d 3d20 225f 5f6d 6169 6e5f 5f22  __ == "__main__"
+00018140: 3a0a 2020 2020 696d 706f 7274 2067 6473  :.    import gds
+00018150: 6661 6374 6f72 7920 6173 2067 660a 0a20  factory as gf.. 
+00018160: 2020 2023 2063 3220 3d20 6766 2e43 6f6d     # c2 = gf.Com
+00018170: 706f 6e65 6e74 2829 0a20 2020 2063 203d  ponent().    c =
+00018180: 2067 662e 636f 6d70 6f6e 656e 7473 2e6d   gf.components.m
+00018190: 7a69 2829 0a20 2020 2070 7269 6e74 2863  zi().    print(c
+000181a0: 2e67 6574 5f6c 6179 6572 5f6e 616d 6573  .get_layer_names
+000181b0: 2829 290a 2020 2020 2320 7220 3d20 632e  ()).    # r = c.
+000181c0: 7265 6628 290a 2020 2020 2320 6332 2e63  ref().    # c2.c
+000181d0: 6f70 795f 6368 696c 645f 696e 666f 2863  opy_child_info(c
+000181e0: 2e6e 616d 6564 5f72 6566 6572 656e 6365  .named_reference
+000181f0: 735b 2273 7874 225d 290a 2020 2020 2320  s["sxt"]).    # 
+00018200: 7465 7374 5f72 656d 6170 5f6c 6179 6572  test_remap_layer
+00018210: 7328 290a 2020 2020 2320 6320 3d20 7465  s().    # c = te
+00018220: 7374 5f67 6574 5f6c 6179 6572 7328 290a  st_get_layers().
+00018230: 2020 2020 2320 632e 706c 6f74 5f71 7428      # c.plot_qt(
+00018240: 290a 2020 2020 2320 632e 706c 6f74 6828  ).    # c.ploth(
+00018250: 290a 2020 2020 2320 6320 3d20 7465 7374  ).    # c = test
+00018260: 5f65 7874 7261 6374 2829 0a20 2020 2023  _extract().    #
+00018270: 2067 6473 7061 7468 203d 2063 2e77 7269   gdspath = c.wri
+00018280: 7465 5f67 6473 2829 0a20 2020 2023 2067  te_gds().    # g
+00018290: 662e 7368 6f77 2867 6473 7061 7468 290a  f.show(gdspath).
+000182a0: 2020 2020 2320 632e 7368 6f77 2873 686f      # c.show(sho
+000182b0: 775f 706f 7274 733d 5472 7565 290a 2020  w_ports=True).  
+000182c0: 2020 632e 7368 6f77 2829 0a                c.show().
```

### Comparing `gdsfactory-6.90.9/gdsfactory/component_layout.py` & `gdsfactory-6.91.0/gdsfactory/component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/component_reference.py` & `gdsfactory-6.91.0/gdsfactory/component_reference.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/C.py` & `gdsfactory-6.91.0/gdsfactory/components/C.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/L.py` & `gdsfactory-6.91.0/gdsfactory/components/L.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/__init__.py` & `gdsfactory-6.91.0/gdsfactory/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/add_fiducials.py` & `gdsfactory-6.91.0/gdsfactory/components/add_fiducials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/add_grating_couplers.py` & `gdsfactory-6.91.0/gdsfactory/components/add_grating_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/add_trenches.py` & `gdsfactory-6.91.0/gdsfactory/components/add_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/align.py` & `gdsfactory-6.91.0/gdsfactory/components/align.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/array_component.py` & `gdsfactory-6.91.0/gdsfactory/components/array_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/array_with_fanout.py` & `gdsfactory-6.91.0/gdsfactory/components/array_with_fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/array_with_via.py` & `gdsfactory-6.91.0/gdsfactory/components/array_with_via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/awg.py` & `gdsfactory-6.91.0/gdsfactory/components/awg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/bbox.py` & `gdsfactory-6.91.0/gdsfactory/components/bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/bend_circular.py` & `gdsfactory-6.91.0/gdsfactory/components/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/bend_circular_heater.py` & `gdsfactory-6.91.0/gdsfactory/components/bend_circular_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/bend_euler.py` & `gdsfactory-6.91.0/gdsfactory/components/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/bend_port.py` & `gdsfactory-6.91.0/gdsfactory/components/bend_port.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/bend_s.py` & `gdsfactory-6.91.0/gdsfactory/components/bend_s.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/bezier.py` & `gdsfactory-6.91.0/gdsfactory/components/bezier.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cavity.py` & `gdsfactory-6.91.0/gdsfactory/components/cavity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cdc.py` & `gdsfactory-6.91.0/gdsfactory/components/cdc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cdsem_all.py` & `gdsfactory-6.91.0/gdsfactory/components/cdsem_all.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cdsem_bend180.py` & `gdsfactory-6.91.0/gdsfactory/components/cdsem_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cdsem_coupler.py` & `gdsfactory-6.91.0/gdsfactory/components/cdsem_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cdsem_straight.py` & `gdsfactory-6.91.0/gdsfactory/components/cdsem_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cdsem_straight_density.py` & `gdsfactory-6.91.0/gdsfactory/components/cdsem_straight_density.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/circle.py` & `gdsfactory-6.91.0/gdsfactory/components/circle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coh_rx_dual_pol.py` & `gdsfactory-6.91.0/gdsfactory/components/coh_rx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coh_rx_single_pol.py` & `gdsfactory-6.91.0/gdsfactory/components/coh_rx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coh_tx_dual_pol.py` & `gdsfactory-6.91.0/gdsfactory/components/coh_tx_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coh_tx_single_pol.py` & `gdsfactory-6.91.0/gdsfactory/components/coh_tx_single_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/compass.py` & `gdsfactory-6.91.0/gdsfactory/components/compass.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/component_lattice.py` & `gdsfactory-6.91.0/gdsfactory/components/component_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/component_sequence.py` & `gdsfactory-6.91.0/gdsfactory/components/component_sequence.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/copy_layers.py` & `gdsfactory-6.91.0/gdsfactory/components/copy_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler90.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler90.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler90bend.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler90bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler_adiabatic.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler_asymmetric.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler_full.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler_full.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler_ring.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler_straight.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler_straight_asymmetric.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler_straight_asymmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/coupler_symmetric.py` & `gdsfactory-6.91.0/gdsfactory/components/coupler_symmetric.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cross.py` & `gdsfactory-6.91.0/gdsfactory/components/cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/crossing_waveguide.py` & `gdsfactory-6.91.0/gdsfactory/components/crossing_waveguide.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv` & `gdsfactory-6.91.0/gdsfactory/components/csv_data/grating_coupler_2etch_h220_e70_e220.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv` & `gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_10_100.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv` & `gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_10_150.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv` & `gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_10_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv` & `gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_11_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv` & `gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_12_200.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv` & `gdsfactory-6.91.0/gdsfactory/components/csv_data/taper_strip_0p5_3_36.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cutback_2x2.py` & `gdsfactory-6.91.0/gdsfactory/components/cutback_2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cutback_bend.py` & `gdsfactory-6.91.0/gdsfactory/components/cutback_bend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cutback_component.py` & `gdsfactory-6.91.0/gdsfactory/components/cutback_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/cutback_splitter.py` & `gdsfactory-6.91.0/gdsfactory/components/cutback_splitter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/dbr.py` & `gdsfactory-6.91.0/gdsfactory/components/dbr.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/dbr_tapered.py` & `gdsfactory-6.91.0/gdsfactory/components/dbr_tapered.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/delay_snake.py` & `gdsfactory-6.91.0/gdsfactory/components/delay_snake.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/delay_snake2.py` & `gdsfactory-6.91.0/gdsfactory/components/delay_snake2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/delay_snake3.py` & `gdsfactory-6.91.0/gdsfactory/components/delay_snake3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/delay_snake_sbend.py` & `gdsfactory-6.91.0/gdsfactory/components/delay_snake_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/dicing_lane.py` & `gdsfactory-6.91.0/gdsfactory/components/dicing_lane.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/die.py` & `gdsfactory-6.91.0/gdsfactory/components/die.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/die_bbox.py` & `gdsfactory-6.91.0/gdsfactory/components/die_bbox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/die_bbox_frame.py` & `gdsfactory-6.91.0/gdsfactory/components/die_bbox_frame.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/disk.py` & `gdsfactory-6.91.0/gdsfactory/components/disk.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/edge_coupler_array.py` & `gdsfactory-6.91.0/gdsfactory/components/edge_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ellipse.py` & `gdsfactory-6.91.0/gdsfactory/components/ellipse.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/extend_ports_list.py` & `gdsfactory-6.91.0/gdsfactory/components/extend_ports_list.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/extension.py` & `gdsfactory-6.91.0/gdsfactory/components/extension.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/fiber.py` & `gdsfactory-6.91.0/gdsfactory/components/fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/fiber_array.py` & `gdsfactory-6.91.0/gdsfactory/components/fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/fiducial_squares.py` & `gdsfactory-6.91.0/gdsfactory/components/fiducial_squares.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ge_detector_straight_si_contacts.py` & `gdsfactory-6.91.0/gdsfactory/components/ge_detector_straight_si_contacts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_array.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_dual_pol.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_dual_pol.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical_arbitrary.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical_lumerical.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_elliptical_trenches.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_elliptical_trenches.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_functions.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_loss.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_loss.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_loss_fiber_single.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_loss_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_rectangular.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_rectangular_arbitrary.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_rectangular_arbitrary.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_rectangular_arbitrary_slab.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/grating_coupler_tree.py` & `gdsfactory-6.91.0/gdsfactory/components/grating_coupler_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/greek_cross.py` & `gdsfactory-6.91.0/gdsfactory/components/greek_cross.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/hline.py` & `gdsfactory-6.91.0/gdsfactory/components/hline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/interdigital_capacitor.py` & `gdsfactory-6.91.0/gdsfactory/components/interdigital_capacitor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/litho_calipers.py` & `gdsfactory-6.91.0/gdsfactory/components/litho_calipers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/litho_ruler.py` & `gdsfactory-6.91.0/gdsfactory/components/litho_ruler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/litho_steps.py` & `gdsfactory-6.91.0/gdsfactory/components/litho_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/logo.py` & `gdsfactory-6.91.0/gdsfactory/components/logo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/loop_mirror.py` & `gdsfactory-6.91.0/gdsfactory/components/loop_mirror.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mmi1x2.py` & `gdsfactory-6.91.0/gdsfactory/components/mmi1x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mmi1x2_with_sbend.py` & `gdsfactory-6.91.0/gdsfactory/components/mmi1x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mmi2x2.py` & `gdsfactory-6.91.0/gdsfactory/components/mmi2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mmi2x2_with_sbend.py` & `gdsfactory-6.91.0/gdsfactory/components/mmi2x2_with_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mmi_90degree_hybrid.py` & `gdsfactory-6.91.0/gdsfactory/components/mmi_90degree_hybrid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mode_converter.py` & `gdsfactory-6.91.0/gdsfactory/components/mode_converter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzi.py` & `gdsfactory-6.91.0/gdsfactory/components/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzi_arm.py` & `gdsfactory-6.91.0/gdsfactory/components/mzi_arm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzi_arms.py` & `gdsfactory-6.91.0/gdsfactory/components/mzi_arms.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzi_lattice.py` & `gdsfactory-6.91.0/gdsfactory/components/mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzi_pads_center.py` & `gdsfactory-6.91.0/gdsfactory/components/mzi_pads_center.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzi_phase_shifter.py` & `gdsfactory-6.91.0/gdsfactory/components/mzi_phase_shifter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzit.py` & `gdsfactory-6.91.0/gdsfactory/components/mzit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzit_lattice.py` & `gdsfactory-6.91.0/gdsfactory/components/mzit_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/mzm.py` & `gdsfactory-6.91.0/gdsfactory/components/mzm.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/nxn.py` & `gdsfactory-6.91.0/gdsfactory/components/nxn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/optimal_90deg.py` & `gdsfactory-6.91.0/gdsfactory/components/optimal_90deg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/optimal_hairpin.py` & `gdsfactory-6.91.0/gdsfactory/components/optimal_hairpin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/optimal_step.py` & `gdsfactory-6.91.0/gdsfactory/components/optimal_step.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/pack_doe.py` & `gdsfactory-6.91.0/gdsfactory/components/pack_doe.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/pad.py` & `gdsfactory-6.91.0/gdsfactory/components/pad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/pad_gsg.py` & `gdsfactory-6.91.0/gdsfactory/components/pad_gsg.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/pads_shorted.py` & `gdsfactory-6.91.0/gdsfactory/components/pads_shorted.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/polarization_splitter_rotator.py` & `gdsfactory-6.91.0/gdsfactory/components/polarization_splitter_rotator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ramp.py` & `gdsfactory-6.91.0/gdsfactory/components/ramp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/rectangle.py` & `gdsfactory-6.91.0/gdsfactory/components/rectangle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/rectangle_with_slits.py` & `gdsfactory-6.91.0/gdsfactory/components/rectangle_with_slits.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/regular_polygon.py` & `gdsfactory-6.91.0/gdsfactory/components/regular_polygon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/resistance_meander.py` & `gdsfactory-6.91.0/gdsfactory/components/resistance_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/resistance_sheet.py` & `gdsfactory-6.91.0/gdsfactory/components/resistance_sheet.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring.py` & `gdsfactory-6.91.0/gdsfactory/components/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_crow.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_crow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_crow_couplers.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_crow_couplers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_double.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_double_heater.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_double_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_double_pn.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_double_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_section_based.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_section_based.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_single.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_single_array.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_single_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_single_bend_coupler.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_single_bend_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_single_dut.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_single_dut.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_single_heater.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_single_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/ring_single_pn.py` & `gdsfactory-6.91.0/gdsfactory/components/ring_single_pn.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/seal_ring.py` & `gdsfactory-6.91.0/gdsfactory/components/seal_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/snspd.py` & `gdsfactory-6.91.0/gdsfactory/components/snspd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/spiral_double.py` & `gdsfactory-6.91.0/gdsfactory/components/spiral_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/spiral_external_io.py` & `gdsfactory-6.91.0/gdsfactory/components/spiral_external_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/spiral_heater.py` & `gdsfactory-6.91.0/gdsfactory/components/spiral_heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/spiral_inner_io.py` & `gdsfactory-6.91.0/gdsfactory/components/spiral_inner_io.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/splitter_chain.py` & `gdsfactory-6.91.0/gdsfactory/components/splitter_chain.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/splitter_tree.py` & `gdsfactory-6.91.0/gdsfactory/components/splitter_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight.py` & `gdsfactory-6.91.0/gdsfactory/components/straight.py`

 * *Files 1% similar despite different names*

```diff
@@ -66,15 +66,15 @@
     # c = straight(cross_section=gf.partial('metal_routing', width=2), with_hash=False)
     # c = straight(
     #     cross_section=gf.partial(gf.cross_section.strip, width=2), with_hash=False
     # )
     # c = straight(cladding_offset=2.5)
 
     nm = 1e-3
-    c = straight(width=101 * nm)
+    c = straight(width=202 * nm)
     print(c.name)
 
     # strip2 = gf.get_cross_section("strip", layer=(2, 0))
     # settings = dict(width=2)
 
     # c = straight(
     #     length=1, cross_section={"cross_section": "strip", "settings": settings}
```

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_array.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_heater_doped_rib.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_heater_doped_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_heater_doped_strip.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_heater_doped_strip.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_heater_meander.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_heater_meander.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_heater_meander_doped.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_heater_meander_doped.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_heater_metal.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_heater_metal.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_pin.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_pin.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_pin_slot.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_pin_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/straight_rib.py` & `gdsfactory-6.91.0/gdsfactory/components/straight_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/switch_tree.py` & `gdsfactory-6.91.0/gdsfactory/components/switch_tree.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/taper.py` & `gdsfactory-6.91.0/gdsfactory/components/taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/taper_adiabatic.py` & `gdsfactory-6.91.0/gdsfactory/components/taper_adiabatic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/taper_cross_section.py` & `gdsfactory-6.91.0/gdsfactory/components/taper_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/taper_from_csv.py` & `gdsfactory-6.91.0/gdsfactory/components/taper_from_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/taper_parabolic.py` & `gdsfactory-6.91.0/gdsfactory/components/taper_parabolic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/terminator.py` & `gdsfactory-6.91.0/gdsfactory/components/terminator.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/text.py` & `gdsfactory-6.91.0/gdsfactory/components/text.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/text_freetype.py` & `gdsfactory-6.91.0/gdsfactory/components/text_freetype.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/text_rectangular.py` & `gdsfactory-6.91.0/gdsfactory/components/text_rectangular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/text_rectangular_font.py` & `gdsfactory-6.91.0/gdsfactory/components/text_rectangular_font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/triangles.py` & `gdsfactory-6.91.0/gdsfactory/components/triangles.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/verniers.py` & `gdsfactory-6.91.0/gdsfactory/components/verniers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/version_stamp.py` & `gdsfactory-6.91.0/gdsfactory/components/version_stamp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/via.py` & `gdsfactory-6.91.0/gdsfactory/components/via.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/via_corner.py` & `gdsfactory-6.91.0/gdsfactory/components/via_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/via_cutback.py` & `gdsfactory-6.91.0/gdsfactory/components/via_cutback.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/via_stack.py` & `gdsfactory-6.91.0/gdsfactory/components/via_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/via_stack_slot.py` & `gdsfactory-6.91.0/gdsfactory/components/via_stack_slot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/via_stack_with_offset.py` & `gdsfactory-6.91.0/gdsfactory/components/via_stack_with_offset.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/wafer.py` & `gdsfactory-6.91.0/gdsfactory/components/wafer.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/wire.py` & `gdsfactory-6.91.0/gdsfactory/components/wire.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/components/wire_sbend.py` & `gdsfactory-6.91.0/gdsfactory/components/wire_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/config.py` & `gdsfactory-6.91.0/gdsfactory/config.py`

 * *Files 2% similar despite different names*

```diff
@@ -17,27 +17,28 @@
 import warnings
 import sys
 import io
 import json
 import os
 import pathlib
 import subprocess
+import tempfile
 from pathlib import Path
 from pprint import pprint
 from typing import Any, Iterable, Optional, Union
 import importlib
 
 from loguru import logger
 import omegaconf
 from omegaconf import OmegaConf
 
 from rich.console import Console
 from rich.table import Table
 
-__version__ = "6.90.9"
+__version__ = "6.91.0"
 PathType = Union[str, pathlib.Path]
 
 home = pathlib.Path.home()
 cwd = pathlib.Path.cwd()
 module_path = pathlib.Path(__file__).parent.absolute()
 repo_path = module_path.parent
 home_path = pathlib.Path.home() / ".gdsfactory"
@@ -45,14 +46,15 @@
 logpath = home_path / "log.log"
 
 yamlpath_cwd = cwd / "config.yml"
 yamlpath_default = module_path / "config.yml"
 yamlpath_home = home_path / "config.yml"
 
 MAX_NAME_LENGTH = 32
+GDSDIR_TEMP = pathlib.Path(tempfile.TemporaryDirectory().name).parent / "gdsfactory"
 
 logger.remove()
 logger.add(sink=sys.stderr, level="WARNING")
 
 showwarning_ = warnings.showwarning
 
 
@@ -152,26 +154,28 @@
 class Paths:
     module = module_path
     repo = repo_path
     results_tidy3d = home / ".tidy3d"
     generic_tech = module / "generic_tech"
     klayout = generic_tech / "klayout"
     klayout_tech = klayout / "tech"
-    klayout_lyp = klayout_tech / "layers.lyp"
+    klayout_lyp = klayout_tech / "generic_tech.lyp"
     klayout_yaml = generic_tech / "layer_views.yaml"
     schema_netlist = repo_path / "tests" / "schemas" / "netlist.json"
     netlists = module_path / "samples" / "netlists"
     gdsdir = repo_path / "tests" / "gds"
-    gdslib = repo_path / "gdslib"
+    gdslib = repo_path / "data"
     modes = gdslib / "modes"
-    gdsdiff = gdslib / "gds"
     sparameters = gdslib / "sp"
     interconnect = gdslib / "interconnect"
     optimiser = repo_path / "tune"
     notebooks = repo_path / "docs" / "notebooks"
+    gds_ref = gdslib / "gds"
+    gds_run = GDSDIR_TEMP / "gds_run"
+    gds_diff = GDSDIR_TEMP / "gds_diff"
 
 
 def read_config(
     yamlpaths: Iterable[PathType] = (yamlpath_default, yamlpath_home, yamlpath_cwd),
 ) -> omegaconf.DictConfig:
     config = OmegaConf.load(default_config)
     for yamlpath in set(yamlpaths):
```

### Comparing `gdsfactory-6.90.9/gdsfactory/constants.py` & `gdsfactory-6.91.0/gdsfactory/constants.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/containers.py` & `gdsfactory-6.91.0/gdsfactory/containers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/cross_section.py` & `gdsfactory-6.91.0/gdsfactory/cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/decorators.py` & `gdsfactory-6.91.0/gdsfactory/decorators.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/difftest.py` & `gdsfactory-6.91.0/gdsfactory/difftest.py`

 * *Files 6% similar despite different names*

```diff
@@ -120,15 +120,17 @@
             "Differences found between layouts {} and {}".format(*fn_abgd)
         )
 
 
 def difftest(
     component: Component,
     test_name: Optional[str] = None,
-    dirpath: pathlib.Path = PATH.gdsdiff,
+    dirpath_ref: pathlib.Path = PATH.gds_ref,
+    dirpath_run: pathlib.Path = PATH.gds_run,
+    dirpath_diff: pathlib.Path = PATH.gds_diff,
 ) -> None:
     """Avoids GDS regressions tests on the GeometryDifference.
 
     If files are the same it returns None. If files are different runs XOR
     between new component and the GDS reference stored in dirpath and
     raises GeometryDifference if there are differences and show differences in KLayout.
 
@@ -144,17 +146,17 @@
     test_name = test_name or (
         f"{component.function_name}_{component.name}"
         if hasattr(component, "function_name")
         and component.name != component.function_name
         else f"{component.name}"
     )
     filename = f"{test_name}.gds"
-    ref_file = dirpath / "gds_ref" / filename
-    run_file = dirpath / "gds_run" / filename
-    diff_file = dirpath / "gds_diff" / filename
+    ref_file = dirpath_ref / filename
+    run_file = dirpath_run / filename
+    diff_file = dirpath_diff / filename
 
     component.write_gds(gdspath=run_file)
 
     if not ref_file.exists():
         component.write_gds(gdspath=ref_file)
         raise AssertionError(
             f"Reference GDS file for {test_name!r} not found. Writing to {ref_file!r}"
```

### Comparing `gdsfactory-6.90.9/gdsfactory/events.py` & `gdsfactory-6.91.0/gdsfactory/events.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/export/to_3d.py` & `gdsfactory-6.91.0/gdsfactory/export/to_3d.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/export/to_np.py` & `gdsfactory-6.91.0/gdsfactory/export/to_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/export/to_stl.py` & `gdsfactory-6.91.0/gdsfactory/export/to_stl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/export/write_gerbers.py` & `gdsfactory-6.91.0/gdsfactory/export/write_gerbers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/filestorage.py` & `gdsfactory-6.91.0/gdsfactory/filestorage.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/fill.py` & `gdsfactory-6.91.0/gdsfactory/fill.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/font.py` & `gdsfactory-6.91.0/gdsfactory/font.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/functions.py` & `gdsfactory-6.91.0/gdsfactory/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/gdsdiff/gds_diff_git.py` & `gdsfactory-6.91.0/gdsfactory/gdsdiff/gds_diff_git.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/gdsdiff/gdsdiff.py` & `gdsfactory-6.91.0/gdsfactory/gdsdiff/gdsdiff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/gdsdiff/install.py` & `gdsfactory-6.91.0/gdsfactory/gdsdiff/install.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/gdsdiff/test_xor.py` & `gdsfactory-6.91.0/gdsfactory/gdsdiff/test_xor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/__init__.py` & `gdsfactory-6.91.0/gdsfactory/generic_tech/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/get_klayout_pyxs.py` & `gdsfactory-6.91.0/gdsfactory/generic_tech/get_klayout_pyxs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/errors.py` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/generic.drc` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/generic.drc`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/generic.lydrc` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/generic.lydrc`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/drc/write_drc.py` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/drc/write_drc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/grain.xml`

 * *Files 1% similar despite different names*

#### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/grain.xml` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/grain.xml`

```diff
@@ -1,13 +1,13 @@
 <?xml version="1.0" encoding="utf-8"?>
 <salt-grain>
   <name>gdsfactory</name>
   <token/>
   <hidden>false</hidden>
-  <version>6.90.9</version>
+  <version>6.91.0</version>
   <api-version/>
   <title>gdsfactory</title>
   <doc>EDA tool to layout integrated circuits</doc>
   <doc-url>https://gdsfactory.github.io/gdsfactory/</doc-url>
   <url>https://github.com/gdsfactory/gdsfactory</url>
   <license>MIT</license>
   <author>Joaquin Matres</author>
```

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/icon_128x128.png` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/icon_128x128.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/icon_64x64.png` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/icon_64x64.png`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/pymacros/import_generic_pcells.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

 * *Files 1% similar despite different names*

#### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/pymacros/set_menus.lym`

```diff
@@ -12,15 +12,15 @@
   <show-in-menu>false</show-in-menu>
   <group-name/>
   <menu-path>gdsfactory.begin</menu-path>
   <interpreter>python</interpreter>
   <dsl-interpreter-name/>
   <text>import pya
 
-__version__ = &quot;6.90.9&quot;
+__version__ = &quot;6.91.0&quot;
 
 
 def set_menu():
     menu = pya.Application.instance().main_window().menu()
 
     s0 = &quot;gdsfactory&quot;
     if not (menu.is_menu(s0)):
```

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/pymacros/set_shortcuts.lym`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/python/kgdsfactory/shortcuts.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/generic.layerstack` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/generic.layerstack`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/layers.lyp` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/generic_tech.lyp`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_generic.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.pyxs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs` & `gdsfactory-6.91.0/gdsfactory/generic_tech/klayout/tech/xsection_planarized.xs`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/layer_map.py` & `gdsfactory-6.91.0/gdsfactory/generic_tech/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/layer_stack.py` & `gdsfactory-6.91.0/gdsfactory/generic_tech/layer_stack.py`

 * *Files 0% similar despite different names*

```diff
@@ -28,14 +28,15 @@
 
     based on paper https://www.degruyter.com/document/doi/10.1515/nanoph-2013-0034/html
 
     Args:
         thickness_wg: waveguide thickness in um.
         thickness_slab_deep_etch: for deep etched slab.
         thickness_shallow_etch: thickness for the etch.
+        thickness_shallow_etch: in um.
         sidewall_angle_wg: waveguide side angle.
         thickness_clad: cladding thickness in um.
         thickness_nitride: nitride thickness in um.
         thickness_ge: germanium thickness.
         gap_silicon_to_nitride: distance from silicon to nitride in um.
         zmin_heater: TiN heater.
         zmin_metal1: metal1.
```

### Comparing `gdsfactory-6.90.9/gdsfactory/generic_tech/layer_views.yaml` & `gdsfactory-6.91.0/gdsfactory/generic_tech/layer_views.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/__init__.py` & `gdsfactory-6.91.0/gdsfactory/geometry/__init__.py`

 * *Files 3% similar despite different names*

```diff
@@ -15,27 +15,29 @@
 from gdsfactory.geometry.invert import invert
 from gdsfactory.geometry.layer_priority import layer_priority
 from gdsfactory.geometry.offset import offset
 from gdsfactory.geometry.outline import outline
 from gdsfactory.geometry.trim import trim
 from gdsfactory.geometry.union import union
 from gdsfactory.geometry.xor_diff import xor_diff
+from gdsfactory.geometry.manhattanize import manhattanize_polygon
 
 __all__ = (
     "boolean",
     "boolean_klayout",
     "boolean_polygons",
     "check_duplicated_cells",
     "check_exclusion",
     "check_inclusion",
     "check_space",
     "check_width",
     "fillet",
+    "functions",
     "invert",
+    "layer_priority",
+    "manhattanize_polygon",
     "offset",
     "outline",
+    "trim",
     "union",
     "xor_diff",
-    "functions",
-    "trim",
-    "layer_priority",
 )
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/boolean.py` & `gdsfactory-6.91.0/gdsfactory/geometry/boolean.py`

 * *Files 8% similar despite different names*

```diff
@@ -36,17 +36,29 @@
         layer: Specific layer to put polygon geometry on.
 
     Returns: Component with polygon(s) of the boolean operations between
       the 2 input Components performed.
 
     Notes
     -----
-    'A+B' is equivalent to 'or'.
-    'A-B' is equivalent to 'not'.
-    'B-A' is equivalent to 'not' with the operands switched.
+    - 'A+B' is equivalent to 'or'.
+    - 'A-B' is equivalent to 'not'.
+    - 'B-A' is equivalent to 'not' with the operands switched.
+
+    .. plot::
+      :include-source:
+
+      import gdsfactory as gf
+
+      c1 = gf.components.circle(radius=10).ref()
+      c2 = gf.components.circle(radius=9).ref()
+      c2.movex(5)
+
+      c = gf.geometry.boolean(c1, c2, operation="xor")
+      c.plot_matplotlib()
 
     """
     D = Component()
     A_polys = []
     B_polys = []
     A = list(A) if isinstance(A, (list, tuple)) else [A]
     B = list(B) if isinstance(B, (list, tuple)) else [B]
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/boolean_klayout.py` & `gdsfactory-6.91.0/gdsfactory/geometry/boolean_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/boolean_polygons.py` & `gdsfactory-6.91.0/gdsfactory/geometry/boolean_polygons.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/check_duplicated_cells.py` & `gdsfactory-6.91.0/gdsfactory/geometry/check_duplicated_cells.py`

 * *Files 13% similar despite different names*

```diff
@@ -3,14 +3,16 @@
 from pathlib import Path
 from typing import Union
 
 
 def check_duplicated_cells(gdspath: Union[Path, str]):
     """Reads cell and checks for duplicated cells.
 
+    klayout will fail to load the layout if it finds any duplicated cells.
+
     Args:
         gdspath: path to GDS or Component
 
     """
     import klayout.db as pya
 
     from gdsfactory.component import Component
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/check_exclusion.py` & `gdsfactory-6.91.0/gdsfactory/geometry/check_exclusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/check_inclusion.py` & `gdsfactory-6.91.0/gdsfactory/geometry/check_inclusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/check_space.py` & `gdsfactory-6.91.0/gdsfactory/geometry/check_space.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/check_width.py` & `gdsfactory-6.91.0/gdsfactory/geometry/check_width.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/fill_klayout.py` & `gdsfactory-6.91.0/gdsfactory/geometry/fill_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/fill_tiled.py` & `gdsfactory-6.91.0/gdsfactory/geometry/fill_tiled.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/fillet.py` & `gdsfactory-6.91.0/gdsfactory/geometry/fillet.py`

 * *Files 23% similar despite different names*

```diff
@@ -15,14 +15,31 @@
     """Perform a fillet operation and return the list of resulting Polygons.
 
     Args:
         operand: polygon, list of Polygons, Component, or ComponentReference.
         radius: Fillet radius. You can also define a value for each vertex.
         tolerance: for calculating the polygonal approximation of the filleted corners.
 
+    .. plot::
+      :include-source:
+
+      import gdstk
+      import gdsfactory as gf
+
+      points = [(0, 0), (1.2, 0), (1.2, 0.3), (1, 0.3), (1.5, 1), (0, 1.5)]
+      p0 = gdstk.Polygon(points, datatype=1)
+      p1 = gdstk.Polygon(points, datatype=1)
+      p1 = gf.geometry.fillet(p1, radius=1.0)
+
+      c = gf.Component("demo")
+      c.add_polygon(p0, layer=(1, 0))
+      c.add_polygon(p1, layer=(2, 0))
+      c.plot_matplotlib()
+      c.show()
+
     """
 
     if hasattr(operand, "get_polygons"):
         operand = operand.get_polygons(as_array=False)
 
     elif isinstance(operand, gdstk.Polygon):
         operand = [operand]
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/functions.py` & `gdsfactory-6.91.0/gdsfactory/geometry/functions.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/invert.py` & `gdsfactory-6.91.0/gdsfactory/geometry/invert.py`

 * *Files 8% similar despite different names*

```diff
@@ -26,14 +26,23 @@
         precision: Desired precision for rounding vertex coordinates.
         layer: Specific layer(s) to put polygon geometry on.
 
     Returns
         D: A Component containing the inverted version of the input shape(s) and the
         corresponding border(s).
 
+    .. plot::
+      :include-source:
+
+      import gdsfactory as gf
+
+      e1 = gf.components.ellipse(radii=(6, 6))
+      c = gf.geometry.invert(e1)
+      c.plot_matplotlib()
+
     """
     Temp = Component()
     if type(elements) is not list:
         elements = [elements]
     for e in elements:
         if isinstance(e, Component):
             Temp.add_ref(e)
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/layer_priority.py` & `gdsfactory-6.91.0/gdsfactory/geometry/layer_priority.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/manhattanize.py` & `gdsfactory-6.91.0/gdsfactory/geometry/manhattanize.py`

 * *Files 6% similar despite different names*

```diff
@@ -8,20 +8,35 @@
     p: Polygon,
     target_step: float = 0.05,
 ):
     """Return a Manhattanized version of the input polygon (where non-x and non-y parallel segments are decomposed into a staircase of small x and y-parallel segments)
 
     Implemented in pure Python, and hence only suited to small polygons.
 
-    Arguments:
-        p: input polygon
-        target_step: target staircase step size
+    Args:
+        p: input polygon.
+        target_step: target staircase step size.
 
     Returns:
         manhattanized polygon
+
+    .. plot::
+      :include-source:
+
+      import gdsfactory as gf
+      c = gf.Component()
+
+      poly = gdstk.rectangle((-2, -2), (2, 2))
+      poly.rotate(np.pi / 4)
+      poly.scale(1, 0.5)
+      init_poly = c.add_polygon(poly, layer=1)
+      final_poly = gf.geometry.manhattanize_polygon(poly)
+      c.add_polygon(final_poly, layer=2)
+      c.plot_matplotlib()
+
     """
     p_manhattan = []
     points = list(p.points)
     points.append(p.points[0])
     x_polarity = 0
     for pt1, pt2 in zip(points[:-1], points[1:]):
         dx = pt2[0] - pt1[0]
@@ -74,15 +89,12 @@
 
 if __name__ == "__main__":
     c = gf.Component()
 
     poly = gdstk.rectangle((-2, -2), (2, 2))
     poly.rotate(np.pi / 4)
     poly.scale(1, 0.5)
-
     init_poly = c.add_polygon(poly, layer=1)
-
     final_poly = c.add_polygon(manhattanize_polygon(poly), layer=2)
-
     c.show()
 
     # test_manhattanize()
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/maskprep.py` & `gdsfactory-6.91.0/gdsfactory/geometry/maskprep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/maskprep_flat.py` & `gdsfactory-6.91.0/gdsfactory/geometry/maskprep_flat.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/offset.py` & `gdsfactory-6.91.0/gdsfactory/geometry/offset.py`

 * *Files 20% similar despite different names*

```diff
@@ -33,14 +33,31 @@
           round joints, it indicates the curvature resolution in number of
           points per full circle.
         layer: Specific layer to put polygon geometry on.
 
     Returns:
         Component containing a polygon(s) with the specified offset applied.
 
+    .. plot::
+      :include-source:
+
+      import gdsfactory as gf
+      c = gf.Component()
+      layer_slab = (2, 0)
+      c1 = gf.components.coupler_ring(
+          cladding_layers=[layer_slab], cladding_offsets=[0.5]
+      )
+      d = 0.8
+      c2 = gf.geometry.offset(c1, distance=+d, layer=layer_slab)
+      c3 = gf.geometry.offset(c2, distance=-d, layer=layer_slab)
+
+      c << c1.extract(layers=("WG",))
+      c << c3
+      c.plot_matplotlib()
+
     """
     if not isinstance(elements, list):
         elements = [elements]
     polygons_to_offset = []
     for e in elements:
         if isinstance(e, (Component, ComponentReference)):
             polygons_to_offset += e.get_polygons(by_spec=False)
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/outline.py` & `gdsfactory-6.91.0/gdsfactory/geometry/outline.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/trim.py` & `gdsfactory-6.91.0/gdsfactory/geometry/trim.py`

 * *Files 20% similar despite different names*

```diff
@@ -22,20 +22,28 @@
     return_ports: Optional[bool] = False,
 ) -> Component:
     """Trim a component by another geometry, preserving the component's layers and ports.
 
     Useful to get a smaller component from a larger one for simulation.
 
     Args:
-        component: Component(/Reference)
+        component: Component(/Reference).
         domain: list of array-like[N][2] representing the boundary of the component to keep.
         precision: float Desired precision for rounding vertex coordinates.
         return_ports: whether to return the included ports or not. Ports are always renamed to avoid inheritance conflicts.
 
     Returns: New component with layers (and possibly ports) of the component restricted to the domain.
+
+    .. plot::
+      :include-source:
+
+      import gdsfactory as gf
+      c = gf.components.straight_pin(length=10, taper=None)
+      trimmed_c = gf.geometry.trim(component=c, domain=[[0, -5], [0, 5], [5, 5], [5, -5]])
+      trimmed_c.plot_matplotlib()
     """
     domain_shape = gdstk.Polygon(domain)
     c = Component()
 
     for layer, layer_polygons in component.get_polygons(by_spec=True).items():
         gds_layer, gds_datatype = _parse_layer(layer)
         for layer_polygon in layer_polygons:
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/union.py` & `gdsfactory-6.91.0/gdsfactory/geometry/union.py`

 * *Files 12% similar despite different names*

```diff
@@ -36,25 +36,34 @@
     by_layer: bool = False,
     precision: float = 1e-4,
     join_first: bool = True,
     layer: Layer = (1, 0),
 ) -> Component:
     """Returns new Component with inverted union of Component polygons.
 
-    based on phidl.geometry.invert
+    based on phidl.geometry.union
 
     Args:
         component: Component(/Reference), list of Component(/Reference), or Polygon
             A containing the polygons to perform union and inversion on.
         by_Layer: performs the union operation layer-wise so each layer can be
             individually combined.
         precision: Desired precision for rounding vertex coordinates.
         join_first: before offsetting to avoid unnecessary joins
             in adjacent polygons.
         layer: Specific layer to put polygon geometry on.
+
+    .. plot::
+      :include-source:
+
+      import gdsfactory as gf
+      c = Component()
+      c << gf.components.ellipse(radii=(6, 6))
+      c << gf.components.ellipse(radii=(10, 4))
+      c2 = gf.geometry.union(c, join_first=False)
     """
     U = Component()
 
     if by_layer:
         all_polygons = component.get_polygons(by_spec=True)
         for layer, polygons in all_polygons.items():
             unioned_polygons = _union_polygons(
```

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/write_drc.py` & `gdsfactory-6.91.0/gdsfactory/geometry/write_drc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/geometry/xor_diff.py` & `gdsfactory-6.91.0/gdsfactory/geometry/xor_diff.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/get_factories.py` & `gdsfactory-6.91.0/gdsfactory/get_factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/get_netlist.py` & `gdsfactory-6.91.0/gdsfactory/get_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/get_netlist_flat.py` & `gdsfactory-6.91.0/gdsfactory/get_netlist_flat.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/get_netlist_klayout.py` & `gdsfactory-6.91.0/gdsfactory/get_netlist_klayout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/grid.py` & `gdsfactory-6.91.0/gdsfactory/grid.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/install.py` & `gdsfactory-6.91.0/gdsfactory/install.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/klive.py` & `gdsfactory-6.91.0/gdsfactory/klive.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/labels/__init__.py` & `gdsfactory-6.91.0/gdsfactory/labels/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/labels/add_label_yaml.py` & `gdsfactory-6.91.0/gdsfactory/labels/add_label_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/labels/ehva.py` & `gdsfactory-6.91.0/gdsfactory/labels/ehva.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/labels/merge_test_metadata.py` & `gdsfactory-6.91.0/gdsfactory/labels/merge_test_metadata.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/labels/siepic.py` & `gdsfactory-6.91.0/gdsfactory/labels/siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/labels/write_labels.py` & `gdsfactory-6.91.0/gdsfactory/labels/write_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/materials.py` & `gdsfactory-6.91.0/gdsfactory/materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/name.py` & `gdsfactory-6.91.0/gdsfactory/name.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/pack.py` & `gdsfactory-6.91.0/gdsfactory/pack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/path.py` & `gdsfactory-6.91.0/gdsfactory/path.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/pdk.py` & `gdsfactory-6.91.0/gdsfactory/pdk.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/picmodel.py` & `gdsfactory-6.91.0/gdsfactory/picmodel.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/pixelate.py` & `gdsfactory-6.91.0/gdsfactory/pixelate.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/plugins/dagster/workflow.py` & `gdsfactory-6.91.0/gdsfactory/plugins/dagster/workflow.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/plugins/database/README.md` & `gdsfactory-6.91.0/gdsfactory/plugins/database/README.md`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/plugins/database/__init__.py` & `gdsfactory-6.91.0/gdsfactory/plugins/database/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/plugins/database/db_upload.py` & `gdsfactory-6.91.0/gdsfactory/plugins/database/db_upload.py`

 * *Files 1% similar despite different names*

```diff
@@ -9,15 +9,14 @@
 import boto3
 import boto3.session
 import numpy as np
 import pandas as pd
 from sqlmodel import SQLModel, Field, Session as _Session, create_engine
 
 import gdsfactory as gf
-import gdsfactory.simulation.gmeep as gm
 
 
 class Session(_Session):
     def safe_add(self, model: SQLModel):
         """adds a model to the database, but ignores it if it's already in there."""
         return self.execute(model.__class__.__table__.insert().prefix_with("IGNORE").values([model.dict()]))  # type: ignore
 
@@ -52,44 +51,41 @@
 def get_database_engine():
     host = os.getenv("PS_HOST", "")
     database = os.getenv("PS_DATABASE", "")
     username = os.getenv("PS_USERNAME", "")
     password = os.getenv("PS_PASSWORD", "")
     ssl_ca = os.getenv("PS_SSL_CERT", "")
     connection_string = f"mysql+pymysql://{username}:{password}@{host}/{database}"
-    engine = create_engine(
+    return create_engine(
         connection_string, echo=True, connect_args={"ssl": {"ca": ssl_ca}}
     )
-    return engine
 
 
 @lru_cache(maxsize=None)
 def s3_client():
     return boto3.client("s3")
 
 
 def get_component_hash(component: gf.Component) -> str:
     with tempfile.NamedTemporaryFile() as file:
         path = os.path.abspath(file.name)
         component.write_gds(path)
-        hash = hashlib.md5(file.read()).hexdigest()
-        return hash
+        return hashlib.md5(file.read()).hexdigest()
 
 
 def get_s3_key_from_hash(prefix: str, hash: str, ext: str = "gds") -> str:
     return os.path.join(f"{prefix}/{ext}/{hash}.{ext}")
 
 
 def convert_to_db_format(sp: dict) -> pd.DataFrame:
     df = pd.DataFrame(sp)
     wls = df.pop("wavelengths").values
     dfs = []
     for c in df.columns:
         port_in, port_out = (p.strip() for p in c.split(","))
-        df[c].values
         cdf = pd.DataFrame(
             {
                 "wavelength": wls,
                 "port_in": port_in,
                 "port_out": port_out,
                 "abs": np.abs(df[c].values),
                 "angle": np.angle(df[c].values),
@@ -97,14 +93,16 @@
         )
         dfs.append(cdf)
 
     return pd.concat(dfs, axis=0)
 
 
 if __name__ == "__main__":
+    import gdsfactory.simulation.gmeep as gm
+
     component = gf.components.taper(length=100)
     component_yaml = component.to_yaml()
 
     component_model = Component(
         function_name=component.metadata["function_name"],
         module=component.metadata["module"],
         name=component.name,
```

### Comparing `gdsfactory-6.90.9/gdsfactory/plugins/database/models.py` & `gdsfactory-6.91.0/gdsfactory/plugins/database/models.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/port.py` & `gdsfactory-6.91.0/gdsfactory/port.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/quickplotter.py` & `gdsfactory-6.91.0/gdsfactory/quickplotter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/__init__.py` & `gdsfactory-6.91.0/gdsfactory/read/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/from_dphox.py` & `gdsfactory-6.91.0/gdsfactory/read/from_dphox.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/from_gdspaths.py` & `gdsfactory-6.91.0/gdsfactory/read/from_gdspaths.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/from_np.py` & `gdsfactory-6.91.0/gdsfactory/read/from_np.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/from_phidl.py` & `gdsfactory-6.91.0/gdsfactory/read/from_phidl.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/from_yaml.py` & `gdsfactory-6.91.0/gdsfactory/read/from_yaml.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/from_yaml_template.py` & `gdsfactory-6.91.0/gdsfactory/read/from_yaml_template.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/import_gds.py` & `gdsfactory-6.91.0/gdsfactory/read/import_gds.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/read/labels.py` & `gdsfactory-6.91.0/gdsfactory/read/labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/__init__.py` & `gdsfactory-6.91.0/gdsfactory/routing/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/add_electrical_pads_shortest.py` & `gdsfactory-6.91.0/gdsfactory/routing/add_electrical_pads_shortest.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/add_electrical_pads_top.py` & `gdsfactory-6.91.0/gdsfactory/routing/add_electrical_pads_top.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/add_electrical_pads_top_dc.py` & `gdsfactory-6.91.0/gdsfactory/routing/add_electrical_pads_top_dc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/add_fiber_array.py` & `gdsfactory-6.91.0/gdsfactory/routing/add_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/add_fiber_single.py` & `gdsfactory-6.91.0/gdsfactory/routing/add_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/add_pads.py` & `gdsfactory-6.91.0/gdsfactory/routing/add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/all_angle.py` & `gdsfactory-6.91.0/gdsfactory/routing/all_angle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/auto_taper.py` & `gdsfactory-6.91.0/gdsfactory/routing/auto_taper.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/factories.py` & `gdsfactory-6.91.0/gdsfactory/routing/factories.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/fanout.py` & `gdsfactory-6.91.0/gdsfactory/routing/fanout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/fanout2x2.py` & `gdsfactory-6.91.0/gdsfactory/routing/fanout2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_bundle.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_bundle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_bundle_corner.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_bundle_corner.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_bundle_from_steps.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_bundle_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_bundle_from_waypoints.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_bundle_from_waypoints.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_bundle_path_length_match.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_bundle_path_length_match.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_bundle_sbend.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_bundle_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_bundle_u.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_bundle_u.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_input_labels.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_input_labels.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_route.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_route.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_route_astar.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_route_astar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_route_from_steps.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_route_from_steps.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_route_sbend.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_route_sbend.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_routes_bend180.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_routes_bend180.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/get_routes_straight.py` & `gdsfactory-6.91.0/gdsfactory/routing/get_routes_straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/manhattan.py` & `gdsfactory-6.91.0/gdsfactory/routing/manhattan.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/path_length_matching.py` & `gdsfactory-6.91.0/gdsfactory/routing/path_length_matching.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/route_fiber_array.py` & `gdsfactory-6.91.0/gdsfactory/routing/route_fiber_array.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/route_fiber_single.py` & `gdsfactory-6.91.0/gdsfactory/routing/route_fiber_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/route_ports_to_side.py` & `gdsfactory-6.91.0/gdsfactory/routing/route_ports_to_side.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/route_quad.py` & `gdsfactory-6.91.0/gdsfactory/routing/route_quad.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/route_sharp.py` & `gdsfactory-6.91.0/gdsfactory/routing/route_sharp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/route_south.py` & `gdsfactory-6.91.0/gdsfactory/routing/route_south.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/sort_ports.py` & `gdsfactory-6.91.0/gdsfactory/routing/sort_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/routing/utils.py` & `gdsfactory-6.91.0/gdsfactory/routing/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell.py` & `gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell/test_straight_wide.yml` & `gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell/test_straight_wide.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell_with_pins.py` & `gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell_with_pins.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml` & `gdsfactory-6.91.0/gdsfactory/samples/01_component_pcell_with_pins/test_straight_narrow.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/03_move.py` & `gdsfactory-6.91.0/gdsfactory/samples/03_move.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/04_connect.py` & `gdsfactory-6.91.0/gdsfactory/samples/04_connect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/05_remove_layers.py` & `gdsfactory-6.91.0/gdsfactory/samples/05_remove_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/06_remapping_layers.py` & `gdsfactory-6.91.0/gdsfactory/samples/06_remapping_layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/07_flattening_device.py` & `gdsfactory-6.91.0/gdsfactory/samples/07_flattening_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/11_component_layout.py` & `gdsfactory-6.91.0/gdsfactory/samples/11_component_layout.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/12_component_refs.py` & `gdsfactory-6.91.0/gdsfactory/samples/12_component_refs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/13_component_netlist.py` & `gdsfactory-6.91.0/gdsfactory/samples/13_component_netlist.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/14_component_connectivity.py` & `gdsfactory-6.91.0/gdsfactory/samples/14_component_connectivity.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/15_component_sequence1.py` & `gdsfactory-6.91.0/gdsfactory/samples/15_component_sequence1.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/16_component_sequence2.py` & `gdsfactory-6.91.0/gdsfactory/samples/16_component_sequence2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/17_ports.py` & `gdsfactory-6.91.0/gdsfactory/samples/17_ports.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/20_components.py` & `gdsfactory-6.91.0/gdsfactory/samples/20_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/22_add_pads.py` & `gdsfactory-6.91.0/gdsfactory/samples/22_add_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/23_reticle.py` & `gdsfactory-6.91.0/gdsfactory/samples/23_reticle.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/23_reticle_passives.py` & `gdsfactory-6.91.0/gdsfactory/samples/23_reticle_passives.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/24_doe_2.py` & `gdsfactory-6.91.0/gdsfactory/samples/24_doe_2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/24_doe_3.py` & `gdsfactory-6.91.0/gdsfactory/samples/24_doe_3.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/30_lidar.py` & `gdsfactory-6.91.0/gdsfactory/samples/30_lidar.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/30_lidar_pcell.py` & `gdsfactory-6.91.0/gdsfactory/samples/30_lidar_pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/30_lidar_with_pads.py` & `gdsfactory-6.91.0/gdsfactory/samples/30_lidar_with_pads.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing.py` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_basic_01.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_bundles.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_gone_wrong.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_implicit_final_angle.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_slalom.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_start_end_customizations.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_step_definitions.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/aar_tricky_connections.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/all_angle_routing/all_angle_routes.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/big_device.py` & `gdsfactory-6.91.0/gdsfactory/samples/big_device.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/benchmark/fill_demo.py` & `gdsfactory-6.91.0/gdsfactory/samples/demo/benchmark/fill_demo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/mask.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/mask.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/mzi_lattice_filter.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml` & `gdsfactory-6.91.0/gdsfactory/samples/demo/circuits/mzi_ubcpdk.pic.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/drc_errors.py` & `gdsfactory-6.91.0/gdsfactory/samples/demo/drc_errors.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/drc_write.py` & `gdsfactory-6.91.0/gdsfactory/samples/demo/drc_write.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/layers.py` & `gdsfactory-6.91.0/gdsfactory/samples/demo/layers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/lvs.py` & `gdsfactory-6.91.0/gdsfactory/samples/demo/lvs.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/demo/pcell.py` & `gdsfactory-6.91.0/gdsfactory/samples/demo/pcell.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/netlists/mzi.yml` & `gdsfactory-6.91.0/gdsfactory/samples/netlists/mzi.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/netlists/mzi_full.yml` & `gdsfactory-6.91.0/gdsfactory/samples/netlists/mzi_full.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/fab_c.py` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/fab_d/phase_shifters.py` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/fab_d/phase_shifters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c.py` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_bend_euler_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_gc_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mmi1x2_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_nitride_o_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_mzi_no_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_c_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml` & `gdsfactory-6.91.0/gdsfactory/samples/pdk/test_fab_c/test_settings_straight_nc_.yml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/schematic_editor.py` & `gdsfactory-6.91.0/gdsfactory/schematic_editor.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/serialization.py` & `gdsfactory-6.91.0/gdsfactory/serialization.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/show.py` & `gdsfactory-6.91.0/gdsfactory/show.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/add_simulation_markers.py` & `gdsfactory-6.91.0/gdsfactory/simulation/add_simulation_markers.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/convert_sparameters.py` & `gdsfactory-6.91.0/gdsfactory/simulation/convert_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/devsim/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/devsim/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/devsim/doping.py` & `gdsfactory-6.91.0/gdsfactory/simulation/devsim/doping.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/devsim/get_simulation.py` & `gdsfactory-6.91.0/gdsfactory/simulation/devsim/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/devsim/get_simulation_xsection.py` & `gdsfactory-6.91.0/gdsfactory/simulation/devsim/get_simulation_xsection.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/devsim/get_solver.py` & `gdsfactory-6.91.0/gdsfactory/simulation/devsim/get_solver.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/devsim/test_devsim.py` & `gdsfactory-6.91.0/gdsfactory/simulation/devsim/test_devsim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/eme/meow_eme.py` & `gdsfactory-6.91.0/gdsfactory/simulation/eme/meow_eme.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/eme/test_meow_simulation.py` & `gdsfactory-6.91.0/gdsfactory/simulation/eme/test_meow_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/fem/mode_solver.py` & `gdsfactory-6.91.0/gdsfactory/simulation/fem/mode_solver.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/fem/test_mode_solver.py` & `gdsfactory-6.91.0/gdsfactory/simulation/fem/test_mode_solver.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/get_effective_indices.py` & `gdsfactory-6.91.0/gdsfactory/simulation/get_effective_indices.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/get_modes_path.py` & `gdsfactory-6.91.0/gdsfactory/simulation/get_modes_path.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/get_sparameters_path.py` & `gdsfactory-6.91.0/gdsfactory/simulation/get_sparameters_path.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_material.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_material.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_meep_geometry.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_meep_geometry.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_port_eigenmode.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_port_eigenmode.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_simulation.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_simulation_grating_farfield.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/get_simulation_grating_fiber.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/meep_adjoint_optimization.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_eigenmode.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_eigenmode.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_materials.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_crossing.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_sparameterNxN/test_sparameterNxN_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_crossing.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameterNxN_symmetries_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameter_straight_mpi_pool.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_crossing_symmetric.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_batch.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_mpi_pool.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/test_write_sparameters_meep/test_sparameters_straight_symmetric.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_grating.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_grating.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_meep.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_meep.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_meep_batch.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmeep/write_sparameters_meep_mpi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/break_geometry.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/break_geometry.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/mesh.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/meshtracker.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/meshtracker.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/parse_component.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/parse_component.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/parse_gds.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/parse_gds.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/parse_layerstack.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/parse_layerstack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/refine.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/refine.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/scratch/mesh3D.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/scratch/mesh3D.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/tests/test_meshing.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/tests/test_meshing.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/uz_xsection_mesh.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/uz_xsection_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/xy_xsection_mesh.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/xy_xsection_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gmsh/xyz_mesh.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gmsh/xyz_mesh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/get_results.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/get_results.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/get_simulation.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/get_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/get_simulation_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/materials.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/materials.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/modes.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/sim_run.yaml` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/sim_run.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/sim_ref.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/sim_run.yaml`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_modes.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_results.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_results.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_simulation.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_simulation.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters/test_sparameters_straight.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/tests/test_write_sparameters_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/utils.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/write_sparameters.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/write_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/gtidy3d/write_sparameters_grating_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/lumerical/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/lumerical/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/lumerical/interconnect.py` & `gdsfactory-6.91.0/gdsfactory/simulation/lumerical/interconnect.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/lumerical/read.py` & `gdsfactory-6.91.0/gdsfactory/simulation/lumerical/read.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/lumerical/settings.py` & `gdsfactory-6.91.0/gdsfactory/simulation/lumerical/settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/lumerical/test_read_sparameters.py` & `gdsfactory-6.91.0/gdsfactory/simulation/lumerical/test_read_sparameters.py`

 * *Files 3% similar despite different names*

```diff
@@ -41,35 +41,35 @@
 #     assert len(port_names) == len(c.ports)
 #     if check:
 #         data_regression.check(dict(port_names=port_names))
 #     assert lenf == len(f)
 
 
 def test_read_sparameters_2port_bend() -> None:
-    filepath = gf.PATH.sparameters / "bend_circular" / "bend_circular_S220.dat"
+    filepath = gf.PATH.sparameters / "bend_circular_S220.dat"
     port_names, f, s = read_sparameters_lumerical(filepath=filepath, numports=2)
     assert port_names == ("N0", "W0"), port_names
 
 
 def test_read_sparameters_2port_straight() -> None:
-    filepath = gf.PATH.sparameters / "straight" / "straight_S220.dat"
+    filepath = gf.PATH.sparameters / "straight_S220.dat"
     port_names, f, s = read_sparameters_lumerical(filepath=filepath, numports=2)
     assert len(f) == 500
     assert port_names == ("E0", "W0"), port_names
 
 
 def test_read_sparameters_3port_mmi1x2() -> None:
-    filepath = gf.PATH.sparameters / "mmi1x2" / "mmi1x2_si220n.dat"
+    filepath = gf.PATH.sparameters / "mmi1x2_si220n.dat"
     port_names, f, s = read_sparameters_lumerical(filepath=filepath, numports=3)
     assert len(f) == 500
     assert port_names == ("E0", "E1", "W0"), port_names
 
 
 def test_read_sparameters_4port_mmi2x2() -> None:
-    filepath = gf.PATH.sparameters / "mmi2x2" / "mmi2x2_si220n.dat"
+    filepath = gf.PATH.sparameters / "mmi2x2_si220n.dat"
     port_names, f, s = read_sparameters_lumerical(filepath=filepath, numports=4)
     assert len(f) == 500
     assert port_names == ("E0", "E1", "W0", "W1"), port_names
 
 
 if __name__ == "__main__":
     # c = gf.components.straight(layer=(2, 0))
```

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py` & `gdsfactory-6.91.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py` & `gdsfactory-6.91.0/gdsfactory/simulation/lumerical/write_sparameters_lumerical_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/find_coupling_vs_gap.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/find_coupling_vs_gap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/find_mode_dispersion.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/find_mode_dispersion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/find_modes.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/find_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/find_modes_cross_section.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/find_modes_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/find_neff_ng_dw_dh.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/find_neff_vs_width.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/find_neff_vs_width.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/get_mode_solver_coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/get_mode_solver_coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/get_mode_solver_cross_section.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/get_mode_solver_cross_section.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/get_mode_solver_rib.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/get_mode_solver_rib.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/modes/neff_vs_width_nitride.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/modes/neff_vs_width_rib.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/modes/neff_vs_width_strip.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/neff_convergence_test.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/neff_convergence_test.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/overlap.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/overlap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_dw_dh/test_dw_dh_dispersion.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_find_modes.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_find_modes.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/tests/test_find_modes_dispersion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/types.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/types.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/modes/waveguide.py` & `gdsfactory-6.91.0/gdsfactory/simulation/modes/waveguide.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/mzi.py` & `gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/photonic_circuit_models/ring.py` & `gdsfactory-6.91.0/gdsfactory/simulation/photonic_circuit_models/ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/plot.py` & `gdsfactory-6.91.0/gdsfactory/simulation/plot.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/plot_csv.py` & `gdsfactory-6.91.0/gdsfactory/simulation/plot_csv.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/port_symmetries.py` & `gdsfactory-6.91.0/gdsfactory/simulation/port_symmetries.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/diffusion.py` & `gdsfactory-6.91.0/gdsfactory/simulation/process/diffusion.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/implant_tables.py` & `gdsfactory-6.91.0/gdsfactory/simulation/process/implant_tables.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/pysrim.py` & `gdsfactory-6.91.0/gdsfactory/simulation/process/pysrim.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/silicon.py` & `gdsfactory-6.91.0/gdsfactory/simulation/process/silicon.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/skew/antimony_si_skew.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/process/skew/antimony_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/skew/arsenic_si_skew.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/process/skew/arsenic_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/skew/boron_si_skew.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/process/skew/boron_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv` & `gdsfactory-6.91.0/gdsfactory/simulation/process/skew/phosphorus_si_skew.csv`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/build_model.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/build_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/femwell_waveguide_model.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/femwell_waveguide_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/interpolators.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/interpolators.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/meep_FDTD_model.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/meep_FDTD_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/meow_eme_model.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/meow_eme_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/mlp.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/mlp.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/models.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/models.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/parameter.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/parameter.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/plot_model.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/plot_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/read.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/read.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/tests/test_mzi.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/tests/test_mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/tests/test_mzi_lattice.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/tests/test_mzi_lattice.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sax/tests/test_parameters.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sax/tests/test_parameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/add_gc.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/add_gc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/circuit.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/__init__.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/bend_circular.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/bend_euler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_fdtd.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_fdtd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_ring.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_ring_fdtd.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/coupler_ring_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/gc.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/gc.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mmi1x2.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mmi1x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mmi2x2.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mmi2x2.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mzi.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mzi.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/mzi_siepic.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/mzi_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_double.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_double.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_double_siepic.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_double_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_single.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_single.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/ring_single_siepic.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/ring_single_siepic.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/components/straight.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/components/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/get_transmission.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/get_transmission.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/model_from_gdsfactory.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/model_from_gdsfactory.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/model_from_sparameters.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/model_from_sparameters.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/plot_circuit.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/plot_circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/plot_circuit_montecarlo.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/plot_model.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/plot_model.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_circuit.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_circuit.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/simphony/tests/test_components.py` & `gdsfactory-6.91.0/gdsfactory/simulation/simphony/tests/test_components.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sipann/bend_circular.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sipann/bend_circular.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sipann/bend_euler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sipann/bend_euler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sipann/coupler.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sipann/coupler.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sipann/coupler_ring.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sipann/coupler_ring.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/sipann/straight.py` & `gdsfactory-6.91.0/gdsfactory/simulation/sipann/straight.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/simulation/thermal/heater.py` & `gdsfactory-6.91.0/gdsfactory/simulation/thermal/heater.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/snap.py` & `gdsfactory-6.91.0/gdsfactory/snap.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/symbols.py` & `gdsfactory-6.91.0/gdsfactory/symbols.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/technology/__init__.py` & `gdsfactory-6.91.0/gdsfactory/technology/__init__.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/technology/klayout_tech.py` & `gdsfactory-6.91.0/gdsfactory/technology/klayout_tech.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/technology/layer_map.py` & `gdsfactory-6.91.0/gdsfactory/technology/layer_map.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/technology/layer_stack.py` & `gdsfactory-6.91.0/gdsfactory/technology/layer_stack.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/technology/layer_views.py` & `gdsfactory-6.91.0/gdsfactory/technology/layer_views.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/technology/simulation_settings.py` & `gdsfactory-6.91.0/gdsfactory/technology/simulation_settings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/types.py` & `gdsfactory-6.91.0/gdsfactory/types.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/typings.py` & `gdsfactory-6.91.0/gdsfactory/typings.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/utils/async_utils.py` & `gdsfactory-6.91.0/gdsfactory/utils/async_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/utils/file_utils.py` & `gdsfactory-6.91.0/gdsfactory/utils/file_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/utils/xml_utils.py` & `gdsfactory-6.91.0/gdsfactory/utils/xml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/utils/yaml_utils.py` & `gdsfactory-6.91.0/gdsfactory/utils/yaml_utils.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/watch.py` & `gdsfactory-6.91.0/gdsfactory/watch.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/widgets/layout_viewer.py` & `gdsfactory-6.91.0/gdsfactory/widgets/layout_viewer.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/gdsfactory/write_cells.py` & `gdsfactory-6.91.0/gdsfactory/write_cells.py`

 * *Files identical despite different names*

### Comparing `gdsfactory-6.90.9/pyproject.toml` & `gdsfactory-6.91.0/pyproject.toml`

 * *Files 2% similar despite different names*

```diff
@@ -10,15 +10,15 @@
   "Programming Language :: Python :: 3.7",
   "Programming Language :: Python :: 3.8",
   "Programming Language :: Python :: 3.9",
   "Programming Language :: Python :: 3.10",
   "Programming Language :: Python :: 3.11",
   "Operating System :: OS Independent",
 ]
-version = "6.90.9"
+version = "6.91.0"
 authors = [
 {name = "gdsfactory community", email = "contact@gdsfactory.com"},
 ]
 keywords = ["eda", "photonics", "python"]
 license = {file = "LICENSE"}
 dependencies = [
   "click",
@@ -70,16 +70,24 @@
     "jupytext",
     "klayout",
     "kfactory",
     "ipytree",
     "rich-click",
     "ipycytoscape",
     ]
-    femwell = ["femwell<=0.0.18"]
-    database = ["sqlalchemy", "sqlalchemy-utils", "dagster", "dagit"]
+    femwell = ["femwell==0.0.18"]
+    database = [
+    "sqlalchemy",
+    "sqlalchemy-utils",
+    "dagster",
+    "dagit",
+    "sqlmodel",
+    "boto3",
+    "pymysql",
+    ]
     gmsh = [
       "gmsh",
       "h5py",
       "mapbox_earcut",
       "meshio",
       "pygmsh",
       "pyvista",
@@ -117,19 +125,14 @@
       "jupyter-book==0.15.1",
       "pydata_sphinx_theme==0.13.1",
     ]
     ray = [
       "ray[tune,air]",
       "hyperopt"
     ]
-    db = [
-      "pymysql",
-      "sqlmodel",
-      "boto3",
-    ]
 
     [tool.setuptools.packages]
     find = {}
 
     [project.scripts]
     gf = "gdsfactory.cli:cli"
```

### Comparing `gdsfactory-6.90.9/PKG-INFO` & `gdsfactory-6.91.0/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: gdsfactory
-Version: 6.90.9
+Version: 6.91.0
 Summary: python library to generate GDS layouts
 Keywords: eda,photonics,python
 Author-email: gdsfactory community <contact@gdsfactory.com>
 Requires-Python: >=3.7
 Description-Content-Type: text/markdown
 Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
@@ -34,17 +34,17 @@
 Requires-Dist: typing_extensions
 Requires-Dist: watchdog
 Requires-Dist: rich
 Requires-Dist: sqlalchemy ; extra == "database"
 Requires-Dist: sqlalchemy-utils ; extra == "database"
 Requires-Dist: dagster ; extra == "database"
 Requires-Dist: dagit ; extra == "database"
-Requires-Dist: pymysql ; extra == "db"
-Requires-Dist: sqlmodel ; extra == "db"
-Requires-Dist: boto3 ; extra == "db"
+Requires-Dist: sqlmodel ; extra == "database"
+Requires-Dist: boto3 ; extra == "database"
+Requires-Dist: pymysql ; extra == "database"
 Requires-Dist: autotyping ; extra == "dev"
 Requires-Dist: black>=21 ; extra == "dev"
 Requires-Dist: doc8 ; extra == "dev"
 Requires-Dist: ipykernel ; extra == "dev"
 Requires-Dist: jsondiff ; extra == "dev"
 Requires-Dist: mypy ; extra == "dev"
 Requires-Dist: pre-commit ; extra == "dev"
@@ -59,15 +59,15 @@
 Requires-Dist: mkl ; extra == "devsim"
 Requires-Dist: pyvista ; extra == "devsim"
 Requires-Dist: tidy3d ; extra == "devsim"
 Requires-Dist: autodoc_pydantic ; extra == "docs"
 Requires-Dist: jupytext ; extra == "docs"
 Requires-Dist: jupyter-book==0.15.1 ; extra == "docs"
 Requires-Dist: pydata_sphinx_theme==0.13.1 ; extra == "docs"
-Requires-Dist: femwell<=0.0.18 ; extra == "femwell"
+Requires-Dist: femwell==0.0.18 ; extra == "femwell"
 Requires-Dist: autograd ; extra == "full"
 Requires-Dist: bokeh ; extra == "full"
 Requires-Dist: freetype-py ; extra == "full"
 Requires-Dist: holoviews ; extra == "full"
 Requires-Dist: ipympl ; extra == "full"
 Requires-Dist: ipywidgets==7.7.3 ; extra == "full"
 Requires-Dist: ipyevents ; extra == "full"
@@ -99,27 +99,26 @@
 Requires-Dist: ray[tune,air] ; extra == "ray"
 Requires-Dist: hyperopt ; extra == "ray"
 Requires-Dist: sax>=0.8.6 ; extra == "sax"
 Requires-Dist: jaxlib ; extra == "sax"
 Requires-Dist: jax ; extra == "sax"
 Requires-Dist: tidy3d==2.0.3 ; extra == "tidy3d"
 Provides-Extra: database
-Provides-Extra: db
 Provides-Extra: dev
 Provides-Extra: devsim
 Provides-Extra: docs
 Provides-Extra: femwell
 Provides-Extra: full
 Provides-Extra: gmsh
 Provides-Extra: meow
 Provides-Extra: ray
 Provides-Extra: sax
 Provides-Extra: tidy3d
 
-# gdsfactory 6.90.9
+# gdsfactory 6.91.0
 
 [![docs](https://github.com/gdsfactory/gdsfactory/actions/workflows/pages.yml/badge.svg)](https://gdsfactory.github.io/gdsfactory/)
 [![PyPI](https://img.shields.io/pypi/v/gdsfactory)](https://pypi.org/project/gdsfactory/)
 [![Conda Version](https://img.shields.io/conda/vn/conda-forge/gdsfactory.svg)](https://anaconda.org/conda-forge/gdsfactory)
 [![Dockerhub](https://img.shields.io/docker/pulls/joamatab/gdsfactory)](https://hub.docker.com/r/joamatab/gdsfactory)
 [![PyPI Python](https://img.shields.io/pypi/pyversions/gdsfactory.svg)](https://pypi.python.org/pypi/gdsfactory)
 [![issues](https://img.shields.io/github/issues/gdsfactory/gdsfactory)](https://github.com/gdsfactory/gdsfactory/issues)
```

